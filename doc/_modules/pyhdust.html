<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pyhdust &mdash; Python tools for the BeACoN group Beta documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     'Beta',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Python tools for the BeACoN group Beta documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">Python tools for the BeACoN group Beta documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pyhdust</h1><div class="highlight"><pre>
<span class="c"># -*- coding:utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;PyHdust main module: Hdust tools.</span>

<span class="sd">This module contains:</span>

<span class="sd">- PyHdust package routines</span>
<span class="sd">- Hdust I/O functions</span>
<span class="sd">- Hdust useful routines and plots</span>
<span class="sd">- Be stars quantities conversions</span>
<span class="sd">- Astronomic useful and plotting functions</span>
<span class="sd">- Astronomic filters tools</span>

<span class="sd">:license: GNU GPL v3.0 https://github.com/danmoser/pyhdust/blob/master/LICENSE</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span> <span class="kn">as</span> <span class="nn">_os</span>
<span class="kn">import</span> <span class="nn">time</span> <span class="kn">as</span> <span class="nn">_time</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="kn">as</span> <span class="nn">_dt</span>
<span class="kn">import</span> <span class="nn">math</span> <span class="kn">as</span> <span class="nn">_math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">_np</span>
<span class="kn">import</span> <span class="nn">struct</span> <span class="kn">as</span> <span class="nn">_struct</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span> <span class="k">as</span> <span class="n">_glob</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span> <span class="k">as</span> <span class="n">_itprod</span>
<span class="kn">import</span> <span class="nn">pyhdust.phc</span> <span class="kn">as</span> <span class="nn">_phc</span>
<span class="kn">import</span> <span class="nn">pyhdust.jdcal</span> <span class="kn">as</span> <span class="nn">_jdcal</span>
<span class="kn">from</span> <span class="nn">pyhdust.tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span> <span class="k">as</span> <span class="n">_tab</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">_plt</span>
    <span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="kn">as</span> <span class="nn">_mpatches</span>
    <span class="c"># from matplotlib.ticker import MultipleLocator as _ML</span>
    <span class="c"># import matplotlib.dates as mdates</span>
    <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span> <span class="k">as</span> <span class="n">_interpolate</span>
    <span class="kn">import</span> <span class="nn">pyfits</span> <span class="kn">as</span> <span class="nn">_pf</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Warning! matplotlib, pyfits and/or scipy module not installed!!!&#39;</span><span class="p">)</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="mf">0.994</span>
<span class="n">__release__</span> <span class="o">=</span> <span class="s">&quot;Beta&quot;</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s">&quot;Daniel Moser&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s">&quot;dmfaes@gmail.com&quot;</span>


<span class="c"># Package tools</span>
<div class="viewcode-block" id="hdtpath"><a class="viewcode-back" href="../pyhdust.html#pyhdust.hdtpath">[docs]</a><span class="k">def</span> <span class="nf">hdtpath</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    :rtype: str</span>
<span class="sd">    :returns: The module path.</span>

<span class="sd">    :Example:</span>

<span class="sd">    &gt;&gt;&gt; hdt.hdtpath()</span>
<span class="sd">    /home/user/Scripts/pyhdust/</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fulldir</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">__file__</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">fulldir</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span>


<span class="c"># Hdust I/O</span></div>
<div class="viewcode-block" id="sed2info"><a class="viewcode-back" href="../pyhdust.html#pyhdust.sed2info">[docs]</a><span class="k">def</span> <span class="nf">sed2info</span><span class="p">(</span><span class="n">sfile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Read info from a HDUST SED2 file.</span>

<span class="sd">    :type  sfile: str</span>
<span class="sd">    :param sfile: HDUST SED2 file path.</span>

<span class="sd">    :rtype: tuple of float variables</span>
<span class="sd">    :returns: HDUST parameters *nlbd, nobs, Rstar, Rwind*</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f0</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sfile</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">fcont</span> <span class="o">=</span> <span class="n">f0</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">f0</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">info</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">info</span> <span class="ow">is</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fcont</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;%&#39;</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fcont</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">info</span>

</div>
<div class="viewcode-block" id="readsed2"><a class="viewcode-back" href="../pyhdust.html#pyhdust.readsed2">[docs]</a><span class="k">def</span> <span class="nf">readsed2</span><span class="p">(</span><span class="n">sfile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Read data from HDUST SED2 file.</span>

<span class="sd">    Note: this format is different of **readfullsed2**.</span>

<span class="sd">    :type sfile: str</span>
<span class="sd">    :param sfile: HDUST SED2 file path.</span>

<span class="sd">    :rtype: np.array[nobs*nlbd, -1] (number of columns from SED2 file replaces </span>
<span class="sd">        &quot;-1&quot;.)</span>
<span class="sd">    :returns: HDUST SED2 file content.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nlbd</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="n">Rstar</span><span class="p">,</span> <span class="n">Rwind</span> <span class="o">=</span> <span class="n">sed2info</span><span class="p">(</span><span class="n">sfile</span><span class="p">)</span>
    <span class="n">sed2data</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sed2data</span>

</div>
<div class="viewcode-block" id="readfullsed2"><a class="viewcode-back" href="../pyhdust.html#pyhdust.readfullsed2">[docs]</a><span class="k">def</span> <span class="nf">readfullsed2</span><span class="p">(</span><span class="nb">file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Read data from HDUST fullSED2 file.</span>

<span class="sd">    :type sfile: str</span>
<span class="sd">    :param sfile: HDUST fullSED2 file path.</span>

<span class="sd">    :rtype: np.array[nobs, nlbd, -1] (number of columns from fullSED2 file </span>
<span class="sd">        replaces &quot;-1&quot;.)</span>
<span class="sd">    :returns: HDUST fullSED2 file content.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nlbd</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="n">Rstar</span><span class="p">,</span> <span class="n">Rwind</span> <span class="o">=</span> <span class="n">sed2info</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
    <span class="n">sed2data</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">sed2data</span> <span class="o">=</span> <span class="n">sed2data</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nobs</span><span class="p">,</span> <span class="n">nlbd</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">sed2data</span>

</div>
<div class="viewcode-block" id="readtemp"><a class="viewcode-back" href="../pyhdust.html#pyhdust.readtemp">[docs]</a><span class="k">def</span> <span class="nf">readtemp</span><span class="p">(</span><span class="n">tfile</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Read HDUST temp file</span>

<span class="sd">    - ncr = número de células da simulação na coordenada radial</span>
<span class="sd">    - ncmu = número de células da simulação na coordenada latitudinal</span>
<span class="sd">    - ncphi = número de células da simulação na coordenada azimutal</span>
<span class="sd">    - nLTE = number of atomic LTE levels</span>
<span class="sd">    - nNLTE = number of atomic NLTE levels</span>
<span class="sd">    - beta = flare disk parameter</span>
<span class="sd">    - Rstar = raio da estrela (Rsun)</span>
<span class="sd">    - Ra = raio máximo da simulação, onde acabam todas as poeiras (Rsun)</span>
<span class="sd">    - pcrc = coordenadas das células em raio</span>
<span class="sd">    - pcmuc = coordenadas das células em mu</span>
<span class="sd">    - pcphic = coordenadas das células em phi</span>
<span class="sd">    - pcr = distância entre as células em raio</span>
<span class="sd">    - pcmu = distância entre as células em mu</span>
<span class="sd">    - pcphi = distância entre as células em phi</span>

<span class="sd">    `data` format is: `data[nLTE+6, ncr, ncmu, ncphi]`</span>

<span class="sd">    .. seealso::</span>

<span class="sd">        Temperature are in `data[3, ...]`. More info. see :py:func:`plottemp` </span>
<span class="sd">        function.</span>

<span class="sd">    :type sfile: str</span>
<span class="sd">    :param sfile: HDUST fullSED2 file path.</span>

<span class="sd">    :rtype: np.array[nobs, nlbd, -1] (number of columns from fullSED2 file </span>
<span class="sd">        replaces &quot;-1&quot;.)</span>
<span class="sd">    :returns: HDUST fullSED2 file content.</span>

<span class="sd">    OUTPUT = ncr,ncmu,ncphi,nLTE,nNLTE,Rstar,Ra,beta,data,pcr,pcmu,pcphi</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">tfile</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">ixdr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ncr</span><span class="p">,</span> <span class="n">ncmu</span><span class="p">,</span> <span class="n">ncphi</span><span class="p">,</span> <span class="n">nLTE</span><span class="p">,</span> <span class="n">nNLTE</span> <span class="o">=</span> <span class="n">_struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&gt;5l&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">ixdr</span><span class="p">:</span><span class="n">ixdr</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">5</span><span class="p">])</span>
    <span class="n">ixdr</span> <span class="o">+=</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">5</span>
    <span class="n">Rstar</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="n">_struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&gt;3f&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">ixdr</span><span class="p">:</span><span class="n">ixdr</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">3</span><span class="p">])</span>
    <span class="n">ixdr</span> <span class="o">+=</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">3</span>
    <span class="c"># </span>
    <span class="n">rlen</span> <span class="o">=</span> <span class="p">(</span><span class="n">nLTE</span> <span class="o">+</span> <span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="n">ncr</span> <span class="o">*</span> <span class="n">ncmu</span> <span class="o">*</span> <span class="n">ncphi</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">_struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&gt;{0}f&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rlen</span><span class="p">),</span> <span class="n">f</span><span class="p">[</span><span class="n">ixdr</span><span class="p">:</span><span class="n">ixdr</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">rlen</span><span class="p">])</span>
    <span class="n">ixdr</span> <span class="o">+=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">rlen</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">nLTE</span> <span class="o">+</span> <span class="mi">6</span><span class="p">,</span> <span class="n">ncr</span><span class="p">,</span> <span class="n">ncmu</span><span class="p">,</span> <span class="n">ncphi</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s">&#39;F&#39;</span><span class="p">)</span>
    <span class="c">#</span>
    <span class="c"># this will check if the XDR is finished.</span>
    <span class="k">if</span> <span class="n">ixdr</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;# XDR {0} completely read!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tfile</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Warning: XDR {0} not completely read!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tfile</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;# length difference is {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">-</span> <span class="n">ixdr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span> <span class="p">)</span> <span class="p">)</span>
    <span class="c">#</span>
    <span class="n">pcrc</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">pcr</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ncr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">pcr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Rstar</span>
    <span class="k">for</span> <span class="n">icr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">pcr</span><span class="p">[</span><span class="n">icr</span><span class="p">]</span> <span class="o">=</span> <span class="n">pcr</span><span class="p">[</span><span class="n">icr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">pcrc</span><span class="p">[</span><span class="n">icr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pcr</span><span class="p">[</span><span class="n">icr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">pcmu</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ncmu</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ncr</span><span class="p">))</span>
    <span class="c"># </span>
    <span class="k">for</span> <span class="n">icr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ncr</span><span class="p">):</span>
        <span class="n">pcmuc</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">icr</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">pcmu</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">icr</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span>
        <span class="k">for</span> <span class="n">icmu</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncmu</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">pcmu</span><span class="p">[</span><span class="n">icmu</span><span class="p">,</span> <span class="n">icr</span><span class="p">]</span> <span class="o">=</span> <span class="n">pcmu</span><span class="p">[</span><span class="n">icmu</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">icr</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.</span> <span class="o">*</span> \
                <span class="p">(</span><span class="n">pcmuc</span><span class="p">[</span><span class="n">icmu</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pcmu</span><span class="p">[</span><span class="n">icmu</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">icr</span><span class="p">])</span>
    <span class="c">#</span>
    <span class="n">pcphic</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">pcphi</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ncphi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">pcphi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">for</span> <span class="n">icphi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncphi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">pcphi</span><span class="p">[</span><span class="n">icphi</span><span class="p">]</span> <span class="o">=</span> <span class="n">pcphi</span><span class="p">[</span><span class="n">icphi</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> \
            <span class="p">(</span><span class="n">pcphic</span><span class="p">[</span><span class="n">icphi</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pcphi</span><span class="p">[</span><span class="n">icphi</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
    <span class="c"># </span>
    <span class="k">return</span> <span class="n">ncr</span><span class="p">,</span> <span class="n">ncmu</span><span class="p">,</span> <span class="n">ncphi</span><span class="p">,</span> <span class="n">nLTE</span><span class="p">,</span> <span class="n">nNLTE</span><span class="p">,</span> <span class="n">Rstar</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">pcr</span><span class="p">,</span> <span class="n">pcmu</span><span class="p">,</span>\
        <span class="n">pcphi</span>

</div>
<div class="viewcode-block" id="readdust"><a class="viewcode-back" href="../pyhdust.html#pyhdust.readdust">[docs]</a><span class="k">def</span> <span class="nf">readdust</span><span class="p">(</span><span class="n">dfile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Read *.dust files</span>

<span class="sd">    - ncr = número de células da simulação na coordenada radial</span>
<span class="sd">    - ncmu = número de células da simulação na coordenada latitudinal</span>
<span class="sd">    - ncphi = número de células da simulação na coordenada azimutal</span>
<span class="sd">    - Rstar = raio da estrela (Rsun)</span>
<span class="sd">    - Ra = raio máximo da simulação, onde acabam todas as poeiras (Rsun)</span>
<span class="sd">    - pcrc = coordenadas das células em raio</span>
<span class="sd">    - pcmuc = coordenadas das células em mu</span>
<span class="sd">    - pcphic = coordenadas das células em phi</span>
<span class="sd">    - pcr = distância entre as células em raio</span>
<span class="sd">    - pcmu = distância entre as células em mu</span>
<span class="sd">    - pcphi = distância entre as células em phi</span>

<span class="sd">    - ntip = número de tipos de poeira determinados para a simulação </span>
<span class="sd">    (composição)</span>
<span class="sd">    - na = número de tamanho por tipo da poeira </span>
<span class="sd">    - NdustShells = número de camadas de poeiras da simulação</span>
<span class="sd">    - Rdust = raio onde está(ão) a(s) camada(s)</span>
<span class="sd">    - Tdestruction = temperatura na qual os grãos são evaporados</span>
<span class="sd">    - Tdust = temperatura da poeira numa da posição da grade da simulação </span>
<span class="sd">    (r,phi,mu)</span>
<span class="sd">    - lacentro = controla os tipos e tamanhos das poeiras</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f0</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">dfile</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">f0</span> <span class="o">=</span> <span class="n">f0</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="c"># Header</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">f0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">ncr</span><span class="p">,</span> <span class="n">ncmu</span><span class="p">,</span> <span class="n">ncphi</span><span class="p">,</span> <span class="n">NdustShells</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp</span><span class="p">[:</span><span class="mi">4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;int&#39;</span><span class="p">)</span>
    <span class="n">Rstar</span><span class="p">,</span> <span class="n">Ra</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">4</span><span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;float&#39;</span><span class="p">)</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">f0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">ncrdust</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">Rdust</span><span class="p">,</span> <span class="n">Tdestruction</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;float&#39;</span><span class="p">)</span>
    <span class="n">ntip</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f0</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="c"># </span>
    <span class="n">pcrc</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ncr</span><span class="p">)</span>
    <span class="n">pcmuc</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ncmu</span><span class="p">,</span> <span class="n">ncr</span><span class="p">))</span>
    <span class="n">pcphic</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ncphi</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">for</span> <span class="n">stip</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntip</span><span class="p">):</span>
        <span class="n">na</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="c"># </span>
        <span class="k">if</span> <span class="n">stip</span> <span class="ow">is</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">Tdust</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ntip</span><span class="p">,</span> <span class="n">na</span><span class="p">,</span> <span class="n">ncr</span><span class="p">,</span> <span class="n">ncmu</span><span class="p">,</span> <span class="n">ncphi</span><span class="p">))</span>
            <span class="n">lacentro</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ntip</span><span class="p">,</span> <span class="n">na</span><span class="p">))</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">lacentro</span><span class="p">[</span><span class="n">stip</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">icphi</span><span class="p">,</span> <span class="n">icmu</span><span class="p">,</span> <span class="n">icr</span> <span class="ow">in</span> <span class="n">_itprod</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ncphi</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncmu</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncr</span><span class="p">)):</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span> 
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">pcrc</span><span class="p">[</span><span class="n">icr</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">pcmuc</span><span class="p">[</span><span class="n">icmu</span><span class="p">,</span> <span class="n">icr</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">pcphic</span><span class="p">[</span><span class="n">icphi</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">Tdust</span><span class="p">[</span><span class="n">stip</span><span class="p">,</span> <span class="p">:,</span> <span class="n">icr</span><span class="p">,</span> <span class="n">icmu</span><span class="p">,</span> <span class="n">icphi</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">3</span> <span class="o">+</span> <span class="n">na</span><span class="p">]</span>
    <span class="c"># </span>
    <span class="n">pcr</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ncr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">pcr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Rdust</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">icr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">pcr</span><span class="p">[</span><span class="n">icr</span><span class="p">]</span> <span class="o">=</span> <span class="n">pcr</span><span class="p">[</span><span class="n">icr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">pcrc</span><span class="p">[</span><span class="n">icr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pcr</span><span class="p">[</span><span class="n">icr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
    <span class="c"># </span>
    <span class="n">pcmu</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ncmu</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ncr</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">icr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncr</span><span class="p">):</span>
        <span class="n">pcmu</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">icr</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span>
        <span class="k">for</span> <span class="n">icmu</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncmu</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">pcmu</span><span class="p">[</span><span class="n">icmu</span><span class="p">,</span> <span class="n">icr</span><span class="p">]</span> <span class="o">=</span> <span class="n">pcmu</span><span class="p">[</span><span class="n">icmu</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">icr</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">pcmuc</span><span class="p">[</span><span class="n">icmu</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span>
                <span class="n">pcmu</span><span class="p">[</span><span class="n">icmu</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">icr</span><span class="p">])</span>
    <span class="c"># </span>
    <span class="n">pcphi</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ncphi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">pcphi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">for</span> <span class="n">icphi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncphi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">pcphi</span><span class="p">[</span><span class="n">icphi</span><span class="p">]</span> <span class="o">=</span> <span class="n">pcphi</span><span class="p">[</span><span class="n">icphi</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> \
            <span class="p">(</span><span class="n">pcphic</span><span class="p">[</span><span class="n">icphi</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pcphi</span><span class="p">[</span><span class="n">icphi</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">ncr</span><span class="p">,</span> <span class="n">ncmu</span><span class="p">,</span> <span class="n">ncphi</span><span class="p">,</span> <span class="n">ntip</span><span class="p">,</span> <span class="n">na</span><span class="p">,</span> <span class="n">Rstar</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">NdustShells</span><span class="p">,</span> <span class="n">Rdust</span><span class="p">,</span>\
        <span class="n">Tdestruction</span><span class="p">,</span> <span class="n">Tdust</span><span class="p">,</span> <span class="n">pcrc</span><span class="p">,</span> <span class="n">pcmuc</span><span class="p">,</span> <span class="n">pcphic</span><span class="p">,</span> <span class="n">pcr</span><span class="p">,</span> <span class="n">pcmu</span><span class="p">,</span> <span class="n">pcphi</span><span class="p">,</span> <span class="n">lacentro</span>

</div>
<div class="viewcode-block" id="mergesed2"><a class="viewcode-back" href="../pyhdust.html#pyhdust.mergesed2">[docs]</a><span class="k">def</span> <span class="nf">mergesed2</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="n">Vrots</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">checklineval</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">onlyfilters</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Merge all mod#/*.sed2 files into the fullsed file.</span>

<span class="sd">    It will check if all sed2info are the same (i.e., nobs, Rstar, Rwind). </span>
<span class="sd">    That&#39;s the reason why SED was the first band in previous versions.</span>
<span class="sd">    If not, it ask if you want to continue (and receive and error).</span>

<span class="sd">    The presence of the SED file is not required anymore.</span>
<span class="sd">    The structure is set by the first broadband sed2 found.</span>

<span class="sd">    NO AVERAGE is coded (yet).</span>

<span class="sd">    `onlyfitlters` is a iterable of desired filters (``None`` for all).</span>

<span class="sd">    IMPORTANT: the line rest wavelength is assumed to be the center of the SEI </span>
<span class="sd">    band!</span>

<span class="sd">    INPUT: models lists (*.txt or *.inp), Vrots (array).</span>

<span class="sd">    OUTPUT: *files written (status printed).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># sufbands = [&#39;SED&#39;, &#39;UV&#39;, &#39;IR&#39;, &#39;NIR&#39;, &#39;BALMER&#39;, &#39;PASCHEN&#39;, &#39;CM&#39;, &#39;MM&#39;,</span>
                <span class="c"># &#39;J&#39;, &#39;H&#39;, &#39;K&#39;, &#39;L&#39;, &#39;M&#39;, &#39;N&#39;, &#39;Q1&#39;, &#39;Q2&#39;]  # 8-14</span>
    <span class="c"># wavelength in microns</span>
    <span class="c"># suflines = {&#39;H12&#39;: .372300, &#39;H11&#39;: .373543, &#39;H10&#39;: .375122, </span>
    <span class="c"># &#39;H9&#39;: .377170,</span>
    <span class="c"># &#39;H8&#39;: .379899, &#39;H7&#39;: .383649, &#39;H6&#39;: .389017, &#39;H5&#39;: .397120, </span>
    <span class="c"># &#39;Hd&#39;: .410289,</span>
    <span class="c"># &#39;Hg&#39;: .434169, &#39;Hb&#39;: .486271, &#39;Ha&#39;: .656461, &#39;Br13&#39;:1.61137, </span>
    <span class="c"># &#39;Br12&#39;:1.6416,</span>
    <span class="c"># &#39;Brg&#39;:2.166}</span>

    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.inp&#39;</span><span class="p">,</span> <span class="s">&#39;.txt&#39;</span><span class="p">)</span>
        <span class="n">modfld</span><span class="p">,</span> <span class="n">modelname</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">trimpathname</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">trimpathname</span><span class="p">(</span><span class="n">modfld</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;{0}fullsed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
            <span class="n">_os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;mkdir {0}fullsed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
        <span class="n">sed2data</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">sfound</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># Get all *.sed2 and choose if it is a broad-band or a line</span>
        <span class="k">if</span> <span class="n">onlyfilters</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">lsed2</span> <span class="o">=</span> <span class="n">_glob</span><span class="p">(</span><span class="s">&#39;{0}*{1}.sed2&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">modfld</span><span class="p">,</span> <span class="n">modelname</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]))</span>
            <span class="n">lsed2</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_glob</span><span class="p">(</span><span class="s">&#39;{0}*{1}_SEI.sed2&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">modfld</span><span class="p">,</span> 
                <span class="n">modelname</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">])))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lsed2</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">onlyfilters</span><span class="p">:</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">modfld</span><span class="p">,</span> <span class="s">&#39;{0}*{1}.sed2&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> 
                    <span class="n">modelname</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]))</span>
                <span class="n">lsed2</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_glob</span><span class="p">(</span><span class="n">pattern</span><span class="p">))</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">modfld</span><span class="p">,</span> <span class="s">&#39;{0}*{1}_SEI.sed2&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> 
                    <span class="n">modelname</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]))</span>
                <span class="n">lsed2</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_glob</span><span class="p">(</span><span class="n">pattern</span><span class="p">))</span>
        <span class="c"># print lsed2, &#39;{0}*{1}*.sed2&#39;.format(modfld, modelname[:-4])</span>
        <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">lsed2</span><span class="p">:</span>
            <span class="n">suf</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">trimpathname</span><span class="p">(</span><span class="nb">file</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">sfound</span> <span class="o">+=</span> <span class="p">[</span><span class="n">suf</span><span class="p">]</span>
            <span class="n">newdata</span> <span class="o">=</span> <span class="n">readsed2</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">file</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;_SEI.&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="c"># Process broad-band</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sed2data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">sed2data</span> <span class="o">=</span> <span class="n">newdata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">nlbd</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="n">Rstar</span><span class="p">,</span> <span class="n">Rwind</span> <span class="o">=</span> <span class="n">sed2info</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Check if the SED2 file has the info as the first file</span>
                    <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">product</span><span class="p">((</span><span class="n">nobs</span><span class="p">,</span> <span class="n">Rstar</span><span class="p">,</span> <span class="n">Rwind</span><span class="p">)</span> <span class="o">==</span> <span class="n">sed2info</span><span class="p">(</span><span class="nb">file</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>\
                        <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                        <span class="k">while</span> <span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&#39;Y&#39;</span><span class="p">:</span>
                            <span class="k">print</span><span class="p">(</span><span class="s">&#39;# WARNING: {0} has different HDUST output!&#39;</span><span class="o">.</span>
                                  <span class="n">format</span><span class="p">(</span><span class="n">modelname</span><span class="p">))</span>
                            <span class="n">key</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span>
                                <span class="s">&#39;Do you want do proceed? (y/other): &#39;</span><span class="p">)</span>
                    <span class="n">nlbd</span> <span class="o">+=</span> <span class="n">sed2info</span><span class="p">(</span><span class="nb">file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">sed2data</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">sed2data</span><span class="p">,</span> <span class="n">newdata</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Process lines</span>
                <span class="n">Vrot</span> <span class="o">=</span> <span class="n">Vrots</span><span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">model</span><span class="p">)]</span>
                <span class="n">nlbdSEI</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">sed2info</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
                <span class="c"># Rest wavelength</span>
                <span class="c"># print nlbd, nlbdSEI, newdata[:nlbdSEI, 2]</span>
                <span class="n">lbrest</span> <span class="o">=</span> <span class="p">(</span><span class="n">newdata</span><span class="p">[</span><span class="n">nlbdSEI</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">newdata</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">+</span>\
                    <span class="n">newdata</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">checklineval</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;# I found {0} as wavelength for {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lbrest</span><span class="p">,</span>
                        <span class="n">suf</span><span class="p">))</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Type a number to change it (no sci. notation/&#39;</span> <span class="o">+</span>
                        <span class="s">&#39;or empty to continue): &#39;</span><span class="p">)</span>
                    <span class="n">loop</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">while</span> <span class="n">loop</span><span class="p">:</span>
                        <span class="n">userinp</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;# lbd: &#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">userinp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">loop</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="k">elif</span> <span class="n">userinp</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                            <span class="n">lbrest</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">userinp</span><span class="p">)</span>
                            <span class="n">loop</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">deltalbd</span> <span class="o">=</span> <span class="n">Vrot</span> <span class="o">/</span> <span class="n">_phc</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">cgs</span> <span class="o">/</span> <span class="mf">1e-5</span> <span class="o">*</span> <span class="n">lbrest</span>
                <span class="n">mini</span> <span class="o">=</span> <span class="n">newdata</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">deltalbd</span>
                <span class="n">maxi</span> <span class="o">=</span> <span class="n">newdata</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">deltalbd</span>
                <span class="c"># print deltalbd, Vrot</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">newdata</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">mini</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">newdata</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">maxi</span><span class="p">))</span>
                <span class="c"># print len(newdata), len(newdata[idx])</span>
                <span class="n">ncut</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">newdata</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">newdata</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                <span class="n">newdata</span> <span class="o">=</span> <span class="n">newdata</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sed2data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">sed2data</span> <span class="o">=</span> <span class="n">newdata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">nlbd</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="n">Rstar</span><span class="p">,</span> <span class="n">Rwind</span> <span class="o">=</span> <span class="n">sed2info</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Check if the SED2 file has the info as the first file</span>
                    <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">product</span><span class="p">((</span><span class="n">nobs</span><span class="p">,</span> <span class="n">Rstar</span><span class="p">,</span> <span class="n">Rwind</span><span class="p">)</span> <span class="o">==</span> <span class="n">sed2info</span><span class="p">(</span><span class="nb">file</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>\
                        <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                        <span class="k">while</span> <span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&#39;Y&#39;</span><span class="p">:</span>
                            <span class="k">print</span><span class="p">(</span><span class="s">&#39;# WARNING: {0} has different HDUST input!!&#39;</span><span class="o">.</span>
                                  <span class="n">format</span><span class="p">(</span><span class="n">modelname</span><span class="p">))</span>
                            <span class="n">key</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span>
                                <span class="s">&#39;Do you want do proceed? (y/other): &#39;</span><span class="p">)</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">sed2data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">mini</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">sed2data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">maxi</span><span class="p">))</span>
                    <span class="n">ncut</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sed2data</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sed2data</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                    <span class="n">sed2data</span> <span class="o">=</span> <span class="n">sed2data</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="n">nlbd</span> <span class="o">+=</span> <span class="n">sed2info</span><span class="p">(</span><span class="nb">file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ncut</span> <span class="o">/</span> <span class="n">sed2info</span><span class="p">(</span><span class="nb">file</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">sed2data</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">sed2data</span><span class="p">,</span> <span class="n">newdata</span><span class="p">))</span>
        <span class="c"># </span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sfound</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;# PROCESSED: {0} with {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sfound</span><span class="p">))</span>
            <span class="n">fullsed2</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">sed2data</span><span class="p">),</span> <span class="mi">16</span><span class="p">))</span>
            <span class="n">fullsed2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sed2data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">fullsed2</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">sed2data</span><span class="p">[:,</span> <span class="mi">11</span><span class="p">]</span>
            <span class="n">fullsed2</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">sed2data</span><span class="p">[:,</span> <span class="mi">19</span><span class="p">]</span>
            <span class="n">fullsed2</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">sed2data</span><span class="p">[:,</span> <span class="mi">27</span><span class="p">]</span>
            <span class="n">fullsed2</span><span class="p">[:,</span> <span class="mi">7</span><span class="p">:</span><span class="mi">8</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sed2data</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="c"># Old </span>
            <span class="c"># if _np.max(fullsed2[_np.isfinite(fullsed2)]) &lt; 100000:</span>
                <span class="c"># fmt = &#39;%13.6f&#39;</span>
            <span class="c"># elif _np.max(fullsed2[_np.isfinite(fullsed2)]) &lt; 1000000:</span>
                <span class="c"># fmt = &#39;%13.5f&#39;</span>
            <span class="c"># else:</span>
                <span class="c"># print(&#39;# ERROR at max values of fullsed2!!!!!!!!&#39;)</span>
                <span class="c"># print(_np.max(fullsed2[_np.isfinite(fullsed2)]))</span>
                <span class="c"># raise SystemExit(0)</span>
            <span class="n">fullsed2</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">fromarrays</span><span class="p">(</span><span class="n">fullsed2</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> 
                <span class="n">names</span><span class="o">=</span><span class="s">&#39;MU,PHI,LAMBDA,FLUX,SCT FLUX,EMIT FLUX,TRANS FLUX,Q,U,&#39;</span> <span class="o">+</span>
                <span class="s">&#39;Sig FLUX,Sig SCT FLUX,Sig EMIT FLUX,Sig TRANS FLU,Sig Q,&#39;</span> <span class="o">+</span>
                <span class="s">&#39;Sig U&#39;</span><span class="p">,</span> <span class="n">formats</span><span class="o">=</span><span class="s">&#39;f8,f8,f8,f8,f8,f8,f8,f8,f8,f8,f8,f8,f8,f8,&#39;</span> <span class="o">+</span>
                <span class="s">&#39;f8,f8&#39;</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">fullsed2</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;MU&#39;</span><span class="p">,</span> <span class="s">&#39;PHI&#39;</span><span class="p">,</span> <span class="s">&#39;LAMBDA&#39;</span><span class="p">))</span>
            <span class="n">fullsed2</span> <span class="o">=</span> <span class="n">fullsed2</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">hd</span> <span class="o">=</span> <span class="s">&#39;%CONTAINS: {0}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sfound</span><span class="p">))</span>
            <span class="n">hd</span> <span class="o">+=</span> <span class="s">&#39;%CREATED: {0}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">_time</span><span class="o">.</span><span class="n">asctime</span><span class="p">(</span><span class="n">_time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">_time</span><span class="o">.</span><span class="n">time</span><span class="p">())))</span>
            <span class="n">hd</span> <span class="o">+=</span> <span class="s">&#39;%{0:&gt;7s}{1:&gt;8s}{2:&gt;13s}{3:&gt;13s}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s">&#39;nlbd&#39;</span><span class="p">,</span> <span class="s">&#39;nobs&#39;</span><span class="p">,</span> <span class="s">&#39;Rstar&#39;</span><span class="p">,</span> <span class="s">&#39;Rwind&#39;</span><span class="p">)</span>
            <span class="n">hd</span> <span class="o">+=</span> <span class="s">&#39;{0:8d}{1:8d}{2:13.4f}{3:13.2f}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">nlbd</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">nobs</span><span class="p">),</span> <span class="n">Rstar</span><span class="p">,</span> <span class="n">Rwind</span><span class="p">)</span>
            <span class="c"># hd += &#39;%{0:&gt;12s}&#39;.format(&#39;MU&#39;) + (15 * &#39;{:&gt;13s}&#39;).format(&#39;PHI&#39;, </span>
                <span class="c"># &#39;LAMBDA&#39;, &#39;FLUX&#39;, \</span>
                <span class="c"># &#39;SCT FLUX&#39;, &#39;EMIT FLUX&#39;, &#39;TRANS FLUX&#39;, &#39;Q&#39;, &#39;U&#39;,</span>
                <span class="c"># &#39;Sig FLUX&#39;, &#39;Sig FLUX&#39;, \</span>
                <span class="c"># &#39;SigSCTFLX&#39;, &#39;SigEMITFLX&#39;, &#39;SigTRANSFLX&#39;,</span>
                <span class="c"># &#39;Sig Q&#39;, &#39;Sig U&#39;)</span>
            <span class="c"># _np.savetxt(path + &#39;fullsed/fullsed_&#39; + modelname.replace(&#39;.txt&#39;, </span>
                <span class="c"># &#39;.sed2&#39;), fullsed2, header=hd, comments=&quot;&quot;, fmt=fmt, </span>
                <span class="c"># delimiter=&#39;&#39;)</span>
            <span class="c"># New</span>
            <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;% PHI&#39;</span><span class="p">,</span> <span class="s">&#39;LAMBDA&#39;</span><span class="p">,</span> <span class="s">&#39;FLUX&#39;</span><span class="p">,</span> <span class="s">&#39;SCT FLUX&#39;</span><span class="p">,</span> <span class="s">&#39;EMIT FLUX&#39;</span><span class="p">,</span> 
                <span class="s">&#39;TRANS FLUX&#39;</span><span class="p">,</span> <span class="s">&#39;Q&#39;</span><span class="p">,</span> <span class="s">&#39;U&#39;</span><span class="p">,</span> <span class="s">&#39;Sig FLUX&#39;</span><span class="p">,</span> <span class="s">&#39;Sig FLUX&#39;</span><span class="p">,</span> <span class="s">&#39;SigSCTFLX&#39;</span><span class="p">,</span> 
                <span class="s">&#39;SigEMITFLX&#39;</span><span class="p">,</span> <span class="s">&#39;SigTRANSFLX&#39;</span><span class="p">,</span> <span class="s">&#39;Sig Q&#39;</span><span class="p">,</span> <span class="s">&#39;Sig U&#39;</span><span class="p">]</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="n">hd</span> <span class="o">+</span> <span class="n">_tab</span><span class="p">(</span><span class="n">fullsed2</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">header</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s">&quot;plain&quot;</span><span class="p">)</span>
            <span class="n">f0</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
                <span class="n">path</span> <span class="o">+</span> <span class="s">&#39;fullsed/fullsed_&#39;</span> <span class="o">+</span> <span class="n">modelname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.txt&#39;</span><span class="p">,</span> <span class="s">&#39;.sed2&#39;</span><span class="p">),</span>
                <span class="s">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">f0</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
            <span class="n">f0</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;# WARNING: No SED2 found for {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">))</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="readSingleBe"><a class="viewcode-back" href="../pyhdust.html#pyhdust.readSingleBe">[docs]</a><span class="k">def</span> <span class="nf">readSingleBe</span><span class="p">(</span><span class="n">sBfile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Read the singleBe output</span>

<span class="sd">    OUTPUT = rgrid, lsig_r, nsnaps, simdays, alpha</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">readSBeBlock</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>              <span class="c"># tauintval in rad</span>
        <span class="n">tausec</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>           <span class="c"># tausec in rad</span>
        <span class="n">sinject</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>          <span class="c"># `sinject` ?</span>
        <span class="n">alpha_r</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>  <span class="c"># alpha(r)</span>
        <span class="n">s1_r</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
            <span class="nb">float</span><span class="p">)</span>    <span class="c"># s1(r) = sig/sig0 ?</span>
        <span class="n">sig_r</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>   <span class="c"># sigma(r)</span>
        <span class="n">maxr</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>            <span class="c"># maxr = maximmum</span>
                                                            <span class="c"># non-zero cell</span>
        <span class="n">vr_cs</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>  <span class="c"># vel_rad/cs ?</span>
        <span class="n">decrr</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>   <span class="c"># Decretion rate</span>
                                                            <span class="c">#(units?)</span>
        <span class="k">return</span>

    <span class="n">hs</span> <span class="o">=</span> <span class="mi">15</span>                     <span class="c"># header size</span>
    <span class="n">f0</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sBfile</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">f0</span> <span class="o">=</span> <span class="n">f0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">nsnaps</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f0</span><span class="p">)</span> <span class="o">-</span> <span class="n">hs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">9</span>   <span class="c"># number of snapshots</span>
    <span class="n">line0</span> <span class="o">=</span> <span class="n">f0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="n">alpha</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>       <span class="c"># constant alpha parameter</span>
    <span class="n">teff</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line0</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>        <span class="c"># stellar effective temperature in K</span>
    <span class="n">tdisk</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line0</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>       <span class="c"># disk temperature in K</span>
    <span class="n">cs</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line0</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>          <span class="c"># &quot;sound speed&quot; in cm/s</span>
    <span class="n">mstar</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line0</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>       <span class="c"># mass of the star, in solar masses</span>
    <span class="n">req</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line0</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>         <span class="c"># equatorial radius, in solar units</span>
    <span class="n">omega0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line0</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>      <span class="c"># disk angular velocity at equator in rad/s?</span>
    <span class="n">rho0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line0</span><span class="p">[</span><span class="mi">13</span><span class="p">])</span>       <span class="c"># g cm-3</span>
    <span class="n">sigma0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line0</span><span class="p">[</span><span class="mi">14</span><span class="p">])</span>     <span class="c"># g cm-2</span>
    <span class="n">rin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line0</span><span class="p">[</span><span class="mi">15</span><span class="p">])</span>        <span class="c"># internal radius of the disk (in req?)</span>
    <span class="n">rout</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line0</span><span class="p">[</span><span class="mi">16</span><span class="p">])</span>       <span class="c"># external radius of the disk (in req?)</span>
    <span class="n">rinject</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line0</span><span class="p">[</span><span class="mi">17</span><span class="p">])</span>    <span class="c"># radius of injection in the disk (in req?)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line0</span><span class="p">[</span><span class="mi">18</span><span class="p">])</span>            <span class="c"># number of radial cells</span>
    <span class="n">kinject</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line0</span><span class="p">[</span><span class="mi">19</span><span class="p">])</span>      <span class="c"># cell of mass injection</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line0</span><span class="p">[</span><span class="mi">24</span><span class="p">])</span>         <span class="c"># ?</span>
    <span class="n">tauintval</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line0</span><span class="p">[</span><span class="mi">26</span><span class="p">])</span>  <span class="c"># time steps (in rad)</span>

    <span class="c"># BLOCKS</span>
    <span class="n">ltau</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f0</span><span class="p">[</span><span class="n">hs</span> <span class="o">+</span> <span class="mi">0</span><span class="p">::</span><span class="mi">9</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>     <span class="c"># tauintval in rad</span>
    <span class="n">ltausec</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f0</span><span class="p">[</span><span class="n">hs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">::</span><span class="mi">9</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>  <span class="c"># tausec in seconds</span>
    <span class="n">lsinject</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f0</span><span class="p">[</span><span class="n">hs</span> <span class="o">+</span> <span class="mi">2</span><span class="p">::</span><span class="mi">9</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>  <span class="c"># `sinject` ?</span>
    <span class="c"># alpha(r)</span>
    <span class="n">lalpha_r</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">f0</span><span class="p">[</span><span class="n">hs</span> <span class="o">+</span> <span class="mi">3</span><span class="p">::</span><span class="mi">9</span><span class="p">]])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> 
    <span class="c"># s1(r) = sig/sig0 ?</span>
    <span class="n">ls1_r</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">f0</span><span class="p">[</span><span class="n">hs</span> <span class="o">+</span> <span class="mi">4</span><span class="p">::</span><span class="mi">9</span><span class="p">]])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="c"># sigma(r)</span>
    <span class="n">lsig_r</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">f0</span><span class="p">[</span><span class="n">hs</span> <span class="o">+</span> <span class="mi">5</span><span class="p">::</span><span class="mi">9</span><span class="p">]])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="c"># maxr = maximmum non-zero cell</span>
    <span class="n">lmaxr</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f0</span><span class="p">[</span><span class="n">hs</span> <span class="o">+</span> <span class="mi">6</span><span class="p">::</span><span class="mi">9</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>            
    <span class="c"># vel_rad/cs ?  ##VARIABLE SIZE = not read</span>
    <span class="c"># lvr_cs  =  _np.array([l.split() for l in f0[hs+7::9]]).astype(float)  </span>
    <span class="c"># Decretion rate (units?)  ##VARIABLE SIZE = not read</span>
    <span class="c"># ldecrr =  _np.array([l.split() for l in f0[hs+8::9]]).astype(float)   </span>

    <span class="n">tauintvaldays</span> <span class="o">=</span> <span class="n">tauintval</span> <span class="o">/</span> <span class="n">omega0</span> <span class="o">/</span> <span class="mi">24</span> <span class="o">/</span> <span class="mi">3600</span>  <span class="c"># time steps in days</span>
    <span class="n">rgrid</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f0</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>  <span class="c"># radial grid values</span>
    <span class="c"># simulation total time in days</span>
    <span class="n">simdays</span> <span class="o">=</span> <span class="n">ltausec</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">24</span> <span class="o">/</span> <span class="mi">3600</span>

    <span class="k">return</span> <span class="n">rgrid</span><span class="p">,</span> <span class="n">lsig_r</span><span class="p">,</span> <span class="n">nsnaps</span><span class="p">,</span> <span class="n">simdays</span><span class="p">,</span> <span class="n">alpha</span>


<span class="c"># Hdust useful</span></div>
<div class="viewcode-block" id="plotdust"><a class="viewcode-back" href="../pyhdust.html#pyhdust.plotdust">[docs]</a><span class="k">def</span> <span class="nf">plotdust</span><span class="p">(</span><span class="n">tfile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; TBD!!</span>

<span class="sd">    For more info, see `readdust` help. </span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="gentemplist"><a class="viewcode-back" href="../pyhdust.html#pyhdust.gentemplist">[docs]</a><span class="k">def</span> <span class="nf">gentemplist</span><span class="p">(</span><span class="n">tfile</span><span class="p">,</span> <span class="n">tfrange</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">avg</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a list of *.temp files.</span>

<span class="sd">    `tfile` = file name or file prefix to be plotted. If `tfrange` (e.g.,</span>
<span class="sd">    tfrange=[20,24] is present, it you automatically plot the interval.</span>

<span class="sd">    `avg` = include tfile_avg.temp file (if exists).</span>

<span class="sd">    OUTPUT = file list, label list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">tfrange</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">tfrange</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">tfile</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.temp&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])]</span>
    <span class="n">ltfile</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ltlabel</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">tn</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tfrange</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">tfrange</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tfile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.temp&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ltfile</span> <span class="o">+=</span> <span class="p">[</span><span class="n">tfile</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tfile</span><span class="p">[</span><span class="o">-</span><span class="mi">7</span><span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">],</span> <span class="s">&#39;{0:02d}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tn</span><span class="p">))]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ltfile</span> <span class="o">+=</span> <span class="p">[</span><span class="n">tfile</span> <span class="o">+</span> <span class="s">&#39;{0:02d}.temp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tn</span><span class="p">)]</span>
        <span class="n">ltlabel</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">tn</span><span class="p">)]</span>
    <span class="n">tfile</span> <span class="o">=</span> <span class="n">ltfile</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.temp&#39;</span><span class="p">,</span> <span class="s">&#39;_avg.temp&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tfile</span><span class="p">)</span> <span class="ow">and</span> <span class="n">avg</span><span class="p">:</span>
        <span class="n">ltfile</span> <span class="o">+=</span> <span class="p">[</span><span class="n">tfile</span><span class="p">]</span>
        <span class="n">ltlabel</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;Avg.&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ltfile</span><span class="p">,</span> <span class="n">ltlabel</span>

</div>
<div class="viewcode-block" id="genlog"><a class="viewcode-back" href="../pyhdust.html#pyhdust.genlog">[docs]</a><span class="k">def</span> <span class="nf">genlog</span><span class="p">(</span><span class="n">mods</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">extrainfo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Gen. log of the calculated models of the project.</span>

<span class="sd">    ppath = Project&#39;s path. If it is not given, it assumes the local pwd.</span>

<span class="sd">    | extrainfo = {\</span>
<span class="sd">    | &#39;mod01&#39;:&#39;i=60&#39;,\</span>
<span class="sd">    | &#39;mod02&#39;:&#39;i=60+70&#39;,\</span>
<span class="sd">    | &#39;mod03&#39;:&#39;i=60+70&#39;,\</span>
<span class="sd">    | &#39;mod04&#39;:&#39;i=60+70/-source NO ROT&#39;,\</span>
<span class="sd">    | &#39;mod05&#39;:&#39;i=60+70/?&#39;,\</span>
<span class="sd">    | &#39;mod06&#39;:&#39;i=60+70/?&#39;}</span>

<span class="sd">    INPUT: `path` (string), `extrainfo` (dictionary with modn number as index),</span>
<span class="sd">    `mods` (list of model folders. If None, then all).</span>

<span class="sd">    OUTPUT: file written.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">mods</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">modfld</span> <span class="o">=</span> <span class="n">_glob</span><span class="p">(</span><span class="s">&#39;{0}/mod*&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">modfld</span> <span class="o">=</span> <span class="n">mods</span>
    <span class="n">modfld</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

    <span class="c"># MODN, steps, sed2, maps, extrainfo</span>
    <span class="n">tab</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;|S127&#39;</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">modn</span> <span class="ow">in</span> <span class="n">modfld</span><span class="p">:</span>
        <span class="n">modnn</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">trimpathname</span><span class="p">(</span><span class="n">modn</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">modglob</span> <span class="o">=</span> <span class="n">_glob</span><span class="p">(</span><span class="s">&#39;{0}/*&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">modn</span><span class="p">))</span>
        <span class="n">mods</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">modglob</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.txt&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;{0}_&#39;</span><span class="o">.</span>
            <span class="n">format</span><span class="p">(</span><span class="n">modnn</span><span class="p">))</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)]</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Running catalogue of {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">modn</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">mod</span> <span class="ow">in</span> <span class="n">mods</span><span class="p">:</span>
            <span class="n">suf</span> <span class="o">=</span> <span class="n">mod</span><span class="p">[</span><span class="n">mod</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>

            <span class="c"># step1 = _glob(&#39;{0}/{1}??.temp&#39;.format(modn, suf))</span>
            <span class="n">sufglob</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">modglob</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">suf</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
            <span class="n">step1</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sufglob</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.temp&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span>
            <span class="n">x</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;/{0}_&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">modnn</span><span class="p">))</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;_avg&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">step1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">step1</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;0&#39;</span><span class="p">]</span>
            <span class="n">step1</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

            <span class="c"># sed2 = _glob(&#39;{0}/*{1}_*.sed2&#39;.format(modn, suf))</span>
            <span class="c"># sed2 += _glob(&#39;{0}/*{1}.sed2&#39;.format(modn, suf))</span>
            <span class="n">sed2</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sufglob</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.sed2&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">sed2</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">s2out</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">sedi</span> <span class="ow">in</span> <span class="n">sed2</span><span class="p">:</span>
                <span class="n">s2out</span> <span class="o">+=</span> <span class="n">sedi</span><span class="p">[</span><span class="n">sedi</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">sedi</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)]</span> <span class="o">+</span> <span class="s">&#39;+&#39;</span>
            <span class="n">s2out</span> <span class="o">+=</span> <span class="s">&#39;+&#39;</span>

            <span class="c"># maps = _glob(&#39;{0}/*{1}_*.maps&#39;.format(modn, suf))</span>
            <span class="c"># maps += _glob(&#39;{0}/*{1}.maps&#39;.format(modn, suf))</span>
            <span class="n">maps</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sufglob</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.map&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">maps</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">mout</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">mapi</span> <span class="ow">in</span> <span class="n">maps</span><span class="p">:</span>
                <span class="n">mout</span> <span class="o">+=</span> <span class="n">mapi</span><span class="p">[</span><span class="n">mapi</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">mapi</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)]</span> <span class="o">+</span> <span class="s">&#39;+&#39;</span>

            <span class="k">if</span> <span class="n">extrainfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">modnn</span> <span class="ow">in</span> <span class="n">extrainfo</span><span class="p">:</span>
                    <span class="n">extra</span> <span class="o">=</span> <span class="n">extrainfo</span><span class="p">[</span><span class="n">modnn</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">extra</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

            <span class="n">tab</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">suf</span><span class="p">,</span> <span class="n">step1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">7</span><span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">],</span> <span class="n">s2out</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mout</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">extra</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mods</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;# NO model found in {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">modn</span><span class="p">))</span>

    <span class="c"># tab = tab[:i,:]</span>
    <span class="c"># tab = tab[tab[:,0].argsort()]</span>
    <span class="c"># _np.savetxt(&#39;log.csv&#39;, tab, fmt=&#39;%s&#39;, delimiter=&#39;,&#39;)</span>
    <span class="n">_np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span>
        <span class="s">&#39;{0}/log.csv&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">tab</span><span class="p">[:</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
    <span class="c"># tab = _np.loadtxt(&#39;log.csv&#39;, dtype=str)</span>
    <span class="c"># tab = tab[tab[:,0].argsort()]</span>
    <span class="c"># _np.savetxt(&#39;log.csv&#39;, tab, fmt=&#39;%s&#39;, delimiter=&#39;,&#39;)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Generated {0}/log.csv !&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="printN0"><a class="viewcode-back" href="../pyhdust.html#pyhdust.printN0">[docs]</a><span class="k">def</span> <span class="nf">printN0</span><span class="p">(</span><span class="n">modn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print the n0 of the model inside modn folder. It does a grep of `n_0` of</span>
<span class="sd">    all *.txt files of the folder.</span>

<span class="sd">    INPUT: string</span>

<span class="sd">    OUTPUT: figures written. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># generate and print n_0</span>
    <span class="n">_os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;grep n_0 mod{0}/*.txt &gt; n0_mod{0}.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">modn</span><span class="p">))</span>
    <span class="c"># n0file = _np.genfromtxt(&#39;n0_mod01.txt&#39;, delimiter = (6,3,3,4,4,2,3,3,5,\</span>
    <span class="c"># 5,5,3,4), usecols=(4,10,12), dtype=None) </span>
    <span class="c"># cols = (0#, 1type, 2typeVal, 3#, 4sig, 5#, 6h, 7#, 8Rd, 9#, 10M, 11#,</span>
    <span class="c"># 12ob, 13#)</span>
    <span class="n">n0file</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="s">&#39;n0_mod{0}.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">modn</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="p">(</span>
        <span class="mi">22</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
    <span class="c"># cols = (sig0, M, ob, n0)</span>

    <span class="n">sig0s</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">n0file</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sig0s</span><span class="p">:</span>
            <span class="n">sig0s</span> <span class="o">+=</span> <span class="p">[</span><span class="n">item</span><span class="p">]</span>

    <span class="n">Ms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">n0file</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Ms</span><span class="p">:</span>
            <span class="n">Ms</span> <span class="o">+=</span> <span class="p">[</span><span class="n">item</span><span class="p">]</span>

    <span class="n">obs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.45</span><span class="p">]</span>

    <span class="n">_plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">obs</span><span class="p">:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">n0file</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">item</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
            <span class="s">&#39;Sig0 range: [{0}, {1}] (g cm-2)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sig0s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sig0s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n0file</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">idx</span><span class="p">],</span> <span class="n">n0file</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">][</span><span class="n">idx</span><span class="p">],</span> <span class="s">&#39;o&#39;</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;n0 (# cm-3)&#39;</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;sig0 (g cm-2)&#39;</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;n0_vs_sig0.png&#39;</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;n0_vs_sig0.pdf&#39;</span><span class="p">)</span>

    <span class="n">Btp</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;B0.5&#39;</span><span class="p">,</span> <span class="s">&#39;B1&#39;</span><span class="p">,</span> <span class="s">&#39;B1.5&#39;</span><span class="p">,</span> <span class="s">&#39;B2&#39;</span><span class="p">,</span> <span class="s">&#39;B2.5&#39;</span><span class="p">,</span>
        <span class="s">&#39;B3&#39;</span><span class="p">,</span> <span class="s">&#39;B4&#39;</span><span class="p">,</span> <span class="s">&#39;B5&#39;</span><span class="p">,</span> <span class="s">&#39;B6&#39;</span><span class="p">,</span> <span class="s">&#39;B7&#39;</span><span class="p">,</span> <span class="s">&#39;B8&#39;</span><span class="p">,</span> <span class="s">&#39;B9&#39;</span><span class="p">]</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">obs</span><span class="p">:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">n0file</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">item</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
            <span class="s">&#39;Sig0 range: [{0}, {1}] (g cm-2)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sig0s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sig0s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n0file</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">idx</span><span class="p">],</span> <span class="n">n0file</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">][</span><span class="n">idx</span><span class="p">],</span> <span class="s">&#39;o&#39;</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">3.4</span><span class="p">,</span> <span class="mf">14.6</span><span class="p">],</span> <span class="p">[</span><span class="mf">1e13</span><span class="p">,</span> <span class="mf">1e14</span><span class="p">],</span> <span class="s">&#39;r-&#39;</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">3.4</span><span class="p">,</span> <span class="mf">14.6</span><span class="p">],</span> <span class="p">[</span><span class="mf">1e12</span><span class="p">,</span> <span class="mf">1e12</span><span class="p">],</span> <span class="s">&#39;r-&#39;</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;n0 (# cm-3)&#39;</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;mass (Solar units)&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Btp</span><span class="p">)):</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">Ms</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="mf">4e14</span><span class="p">,</span> <span class="n">Btp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;n0_vs_M.png&#39;</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;n0_vs_M.pdf&#39;</span><span class="p">)</span>

    <span class="n">_plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">obs</span><span class="p">:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">n0file</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">item</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
            <span class="s">&#39;Sig0 range: [{0}, {1}] (g cm-2)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sig0s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sig0s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n0file</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">][</span><span class="n">idx</span><span class="p">],</span> <span class="n">n0file</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">][</span><span class="n">idx</span><span class="p">],</span> <span class="s">&#39;o&#39;</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;n0 (# cm-3)&#39;</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;radii ratio (Req/Rp)&#39;</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;n0_vs_ob.png&#39;</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;n0_vs_ob.pdf&#39;</span><span class="p">)</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="fs2rm_nan"><a class="viewcode-back" href="../pyhdust.html#pyhdust.fs2rm_nan">[docs]</a><span class="k">def</span> <span class="nf">fs2rm_nan</span><span class="p">(</span><span class="n">fsed2</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">refcol</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Remove ``nan`` values present in columns of a matrix file.</span>
<span class="sd">    In a *fullsed2* file, ``cols=[3]`` and ``refcol=[2]``.</span>

<span class="sd">    Input=filename, cols</span>

<span class="sd">    Output=file overwritten.</span>

<span class="sd">    TDB: refcol apparently is not working...</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f2mtx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fsed2</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
        <span class="n">nans</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">nan_helper</span><span class="p">(</span><span class="n">f2mtx</span><span class="p">[:,</span> <span class="n">col</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">refcol</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">f2mtx</span><span class="p">[:,</span> <span class="n">col</span><span class="p">][</span><span class="n">nans</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">(</span><span class="n">nans</span><span class="p">),</span> <span class="n">x</span><span class="p">(</span><span class="o">~</span><span class="n">nans</span><span class="p">),</span> <span class="n">f2mtx</span><span class="p">[:,</span> <span class="n">col</span><span class="p">][</span><span class="o">~</span><span class="n">nans</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;# WARNING! The output must be checked!&#39;</span><span class="p">)</span>
            <span class="n">f2mtx</span><span class="p">[:,</span> <span class="n">col</span><span class="p">][</span><span class="n">nans</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">f2mtx</span><span class="p">[:,</span> <span class="n">refcol</span><span class="p">][</span><span class="n">nans</span><span class="p">],</span> 
                <span class="n">f2mtx</span><span class="p">[:,</span> <span class="n">refcol</span><span class="p">][</span><span class="o">~</span><span class="n">nans</span><span class="p">],</span> <span class="n">f2mtx</span><span class="p">[:,</span> <span class="n">col</span><span class="p">][</span><span class="o">~</span><span class="n">nans</span><span class="p">])</span>
    <span class="c">#</span>
    <span class="n">oldf</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fsed2</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">f2mtx</span><span class="p">[</span><span class="n">_np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">f2mtx</span><span class="p">)])</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">:</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%13.6f</span><span class="s">&#39;</span>
    <span class="k">elif</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">f2mtx</span><span class="p">[</span><span class="n">_np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">f2mtx</span><span class="p">)])</span> <span class="o">&lt;</span> <span class="mi">1000000</span><span class="p">:</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%13.5f</span><span class="s">&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;# ERROR at max values of fullsed2 {0}!!!!!!!!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fsed2</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">_np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fsed2</span><span class="p">,</span> <span class="n">f2mtx</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">oldf</span><span class="p">[:</span><span class="mi">5</span><span class="p">]),</span> <span class="n">comments</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;# {0} file updated!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fsed2</span><span class="p">))</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="plottemp"><a class="viewcode-back" href="../pyhdust.html#pyhdust.plottemp">[docs]</a><span class="k">def</span> <span class="nf">plottemp</span><span class="p">(</span><span class="n">tfiles</span><span class="p">,</span> <span class="n">philist</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">interpol</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">xax</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;png&#39;</span><span class="p">],</span>
    <span class="n">outpref</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tlabels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    .. code::</span>

<span class="sd">        &gt;&gt;&gt; import pyhdust as hdt</span>
<span class="sd">        &gt;&gt;&gt; tfiles, tlabels = hdt.gentemplist(&#39;bestar2.02/mod01/mod01b33.temp&#39;, </span>
<span class="sd">            tfrange=[30,33])</span>
<span class="sd">        &gt;&gt;&gt; hdt.plottemp(tfiles, tlabels=tlabels)</span>

<span class="sd">    .. image:: _static/hdt_plottemp.png</span>
<span class="sd">        :width: 512px</span>
<span class="sd">        :align: center</span>
<span class="sd">        :alt: hdt.plottemp example</span>

<span class="sd">    `tfile` = filenames list.</span>

<span class="sd">    `xax` = 0: log10(r/R-1), 1: r/R; 2: 1-R/r</span>

<span class="sd">    `outpref` = prefix of the output images</span>

<span class="sd">    `fmts` = format os the output images.</span>

<span class="sd">    If interpol==True, what will be plotted is the population along rays of</span>
<span class="sd">    a given latitude. The latitudes are defined in array muplot below.</span>

<span class="sd">    If interpola==False, what will be plotted is the population for a given mu</span>
<span class="sd">    index as a function of radius, starting with index ncmu/2(midplane) + plus</span>

<span class="sd">    OUTPUT = ...</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tfiles</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
        <span class="n">tfiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">tfiles</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">tfiles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">interpol</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Interpol option currently is not available.&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xax</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Invalid `xax` option. Try again.&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="c">#</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c"># , figsize=(21./3,29.7/3), sharex=True)</span>
    <span class="n">lev</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">np</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">rplus</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tfiles</span><span class="p">)):</span>
        <span class="n">rtfile</span> <span class="o">=</span> <span class="n">tfiles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">ncr</span><span class="p">,</span> <span class="n">ncmu</span><span class="p">,</span> <span class="n">ncphi</span><span class="p">,</span> <span class="n">nLTE</span><span class="p">,</span> <span class="n">nNLTE</span><span class="p">,</span> <span class="n">Rstar</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">pcr</span><span class="p">,</span> <span class="n">pcmu</span><span class="p">,</span> <span class="n">pcphi</span>\
            <span class="o">=</span> <span class="n">readtemp</span><span class="p">(</span><span class="n">rtfile</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">phiidx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">philist</span><span class="p">)):</span>
            <span class="n">icphi</span> <span class="o">=</span> <span class="n">philist</span><span class="p">[</span><span class="n">phiidx</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">icphi</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">xax</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">Rstar</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span>
                <span class="n">xtitle</span> <span class="o">=</span> <span class="s">r&#39;$\log_{10}(r/R_*-1)$&#39;</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">xax</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">Rstar</span>
                <span class="n">xtitle</span> <span class="o">=</span> <span class="s">r&#39;$r/R_*$&#39;</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">xax</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">Rstar</span> <span class="o">/</span> <span class="n">x</span>
                <span class="n">xtitle</span> <span class="o">=</span> <span class="s">r&#39;$1-R_*/r$&#39;</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span> <span class="o">+</span> <span class="n">lev</span><span class="p">,</span> <span class="p">:,</span> <span class="n">ncmu</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">np</span> <span class="o">+</span> <span class="n">rplus</span><span class="p">,</span> <span class="n">icphi</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">/</span> <span class="mf">1000.</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;o:&#39;</span>
            <span class="k">if</span> <span class="n">rtfile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;avg&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;o-&#39;</span>
            <span class="k">if</span> <span class="n">tlabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">tlabels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
    <span class="c">#</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">&#39;best&#39;</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xtitle</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;Temperature (10$^3$ K)&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">outpref</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">outpref</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">dtflag</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fmt</span><span class="p">:</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;{0}.{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outpref</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span> <span class="n">transparent</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span>


<span class="c"># Be quantities convertions</span></div>
<div class="viewcode-block" id="diskcalcs"><a class="viewcode-back" href="../pyhdust.html#pyhdust.diskcalcs">[docs]</a><span class="k">def</span> <span class="nf">diskcalcs</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">Tpole</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">R0</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="n">Rd</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Do the equivalence of disk density for different quantities.</span>

<span class="sd">    Note that they all depend of specific stellar quantities!!!</span>

<span class="sd">    INPUT: </span>
<span class="sd">    M = 10.3065*Msun,</span>
<span class="sd">    R = 7*Rsun,</span>
<span class="sd">    Tpole = 26025.,</span>
<span class="sd">    T = 0.72*Tpole,</span>
<span class="sd">    alpha = 1.,</span>
<span class="sd">    R0 = 1e14*R,</span>
<span class="sd">    mu = 0.5,</span>
<span class="sd">    rho0 = 5e12 #in particles per cubic centimeter,</span>
<span class="sd">    Rd = 18.6*R.</span>

<span class="sd">    OUTPUT: printed status</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">rho2sigp</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">a</span> <span class="o">/</span> <span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">cgs</span> <span class="o">*</span> <span class="n">M</span> <span class="o">/</span> <span class="n">R</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">R</span> <span class="o">*</span> <span class="n">rho0</span>
        <span class="k">return</span> <span class="n">sig</span>

    <span class="k">def</span> <span class="nf">rho2Mdot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="n">R0</span><span class="p">):</span>
        <span class="n">Mdot</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">a</span> <span class="o">**</span> <span class="mf">3.</span> <span class="o">/</span> \
            <span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">cgs</span> <span class="o">*</span> <span class="n">M</span> <span class="o">/</span> <span class="n">R</span><span class="p">)</span> <span class="o">*</span> <span class="n">rho0</span> <span class="o">*</span> <span class="n">R</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">((</span><span class="n">R0</span> <span class="o">/</span> <span class="n">R</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="o">-</span><span class="mf">1.</span>
        <span class="k">return</span> <span class="n">Mdot</span>

    <span class="k">def</span> <span class="nf">Mdot2sig</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">Mdot</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">R0</span><span class="p">):</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">Mdot</span> <span class="o">*</span> <span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">cgs</span> <span class="o">*</span> <span class="n">M</span> <span class="o">/</span> <span class="n">R</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span> <span class="o">/</span> \
            <span class="p">(</span><span class="mf">3.</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">R</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">R0</span> <span class="o">/</span> <span class="n">R</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sig</span>

    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">kB</span><span class="o">.</span><span class="n">cgs</span> <span class="o">*</span> <span class="n">T</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">/</span> <span class="n">_phc</span><span class="o">.</span><span class="n">mH</span><span class="o">.</span><span class="n">cgs</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span>
    <span class="n">rho0</span> <span class="o">=</span> <span class="n">rho0</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">mH</span><span class="o">.</span><span class="n">cgs</span>
    <span class="n">sigp</span> <span class="o">=</span> <span class="n">rho2sigp</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
    <span class="n">rho0p</span> <span class="o">=</span> <span class="n">sigp</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span> <span class="o">/</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">cgs</span> <span class="o">*</span> <span class="n">M</span> <span class="o">/</span> <span class="n">R</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span> <span class="o">/</span> <span class="n">R</span>
    <span class="n">Mdot</span> <span class="o">=</span> <span class="n">rho2Mdot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="n">R0</span><span class="p">)</span>
    <span class="n">sig</span> <span class="o">=</span> <span class="n">Mdot2sig</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">Mdot</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">R0</span><span class="p">)</span>
    <span class="c"># sigl = Mdot * (_phc.G.cgs * M) ** .5 / 3 / _np.pi</span>
    <span class="n">Mdisk0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">rho0</span> <span class="o">*</span> <span class="n">R</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">Rd</span> <span class="o">-</span> <span class="n">R</span><span class="p">)</span> <span class="o">*</span> <span class="n">a</span> <span class="o">/</span> <span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">cgs</span> <span class="o">*</span> <span class="n">M</span> <span class="o">/</span> <span class="n">R</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span>
    <span class="n">Mdisk</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">Mdot</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">cgs</span> <span class="o">*</span> <span class="n">M</span> <span class="o">/</span> <span class="n">R</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">R</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> \
        <span class="n">alpha</span> <span class="o">/</span> <span class="n">a</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">R0</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span> <span class="n">Rd</span> <span class="o">/</span> <span class="n">R</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Mdisk</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">Mdisk</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">Mdot</span> <span class="o">*</span> \
            <span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">cgs</span> <span class="o">*</span> <span class="n">M</span> <span class="o">/</span> <span class="n">R</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">R</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> \
            <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">alpha</span> <span class="o">/</span> <span class="n">a</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">Rd</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span> <span class="o">-</span> <span class="n">R</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">MdiskG</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Mdot</span> <span class="o">*</span> <span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">cgs</span> <span class="o">*</span> <span class="n">M</span> <span class="o">/</span> <span class="n">R</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">R</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">alpha</span> <span class="o">/</span>\
        <span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">R0</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Rd</span> <span class="o">/</span> <span class="n">R</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">R</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Rd</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&#39;R0/R  = {0:.1f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">R0</span> <span class="o">/</span> <span class="n">R</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Valid sigma (1)?: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sigp</span> <span class="o">/</span> <span class="n">sig</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Valid sigma (2)?: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">rho0</span> <span class="o">/</span> <span class="n">rho0p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;rho0  = {0:.2e} g/cm3&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rho0</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;sigma0= {0:.2e} g/cm2&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sig</span> <span class="o">/</span> <span class="n">alpha</span> <span class="o">/</span> <span class="n">a</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Mdot  = {0:.2e} Msun/yr&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Mdot</span> <span class="o">/</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Msun</span><span class="o">.</span><span class="n">cgs</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">yr</span><span class="o">.</span><span class="n">cgs</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Mdisk0= {0:.2e} Msun [#from rho0]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Mdisk0</span> <span class="o">/</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Msun</span><span class="o">.</span><span class="n">cgs</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;Mdisk = {0:.2e} Msun [#approx.]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Mdisk</span> <span class="o">/</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Msun</span><span class="o">.</span><span class="n">cgs</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;MdiskG= {0:.2e} Msun&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">MdiskG</span> <span class="o">/</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Msun</span><span class="o">.</span><span class="n">cgs</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;PS: Mdisk for both isothermal Sigma(r) and H(r)&#39;</span><span class="p">)</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="n0toSigma0"><a class="viewcode-back" href="../pyhdust.html#pyhdust.n0toSigma0">[docs]</a><span class="k">def</span> <span class="nf">n0toSigma0</span><span class="p">(</span><span class="n">n0</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">Tp</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; VDD Steady-State conversion between `n0` (particles[ionized]/volume) </span>
<span class="sd">    to `Sigma0`.</span>

<span class="sd">    INPUT: n0 (float), M, Req (mass and equatorial radius, Solar units),</span>
<span class="sd">    fraction and polar temperature ([0-1], Kelvin) and mu molecular weight</span>
<span class="sd">    [0.5-2.0].</span>

<span class="sd">    OUTPUT: float (g cm-2) &quot;&quot;&quot;</span>
    <span class="n">rho0</span> <span class="o">=</span> <span class="n">n0</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">mH</span><span class="o">.</span><span class="n">cgs</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">kB</span><span class="o">.</span><span class="n">cgs</span> <span class="o">*</span> <span class="n">f</span> <span class="o">*</span> <span class="n">Tp</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">/</span> <span class="n">_phc</span><span class="o">.</span><span class="n">mH</span><span class="o">.</span><span class="n">cgs</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span>
    <span class="n">sig0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">a</span> <span class="o">/</span> <span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">cgs</span> <span class="o">*</span> <span class="n">M</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Msun</span><span class="o">.</span><span class="n">cgs</span> <span class="o">/</span> <span class="p">(</span><span class="n">Req</span> <span class="o">*</span>
        <span class="n">_phc</span><span class="o">.</span><span class="n">Rsun</span><span class="o">.</span><span class="n">cgs</span><span class="p">))</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">Req</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Rsun</span><span class="o">.</span><span class="n">cgs</span> <span class="o">*</span> <span class="n">rho0</span>
    <span class="k">return</span> <span class="n">sig0</span>

</div>
<div class="viewcode-block" id="n0toMdot"><a class="viewcode-back" href="../pyhdust.html#pyhdust.n0toMdot">[docs]</a><span class="k">def</span> <span class="nf">n0toMdot</span><span class="p">(</span><span class="n">n0</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">Req</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">Tp</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">R0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; VDD Steady-State conversion between `n0` to `Mdot`.</span>

<span class="sd">    INPUT: n0 (float), M, Req (mass and equatorial radius, Solar units),</span>
<span class="sd">    fraction and polar temperature ([0-1], Kelvin), mu molecular weight</span>
<span class="sd">    [0.5-2.0], alpha (viscous parameter), R0 (&quot;truncation&quot; radius, Solar unit).</span>

<span class="sd">    OUTPUT: float (Msun yr-1)&quot;&quot;&quot;</span>
    <span class="n">Req</span> <span class="o">=</span> <span class="n">Req</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Rsun</span><span class="o">.</span><span class="n">cgs</span>
    <span class="n">R0</span> <span class="o">=</span> <span class="n">R0</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Rsun</span><span class="o">.</span><span class="n">cgs</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">M</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Msun</span><span class="o">.</span><span class="n">cgs</span>
    <span class="n">rho0</span> <span class="o">=</span> <span class="n">n0</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">mH</span><span class="o">.</span><span class="n">cgs</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">kB</span><span class="o">.</span><span class="n">cgs</span> <span class="o">*</span> <span class="n">f</span> <span class="o">*</span> <span class="n">Tp</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">/</span> <span class="n">_phc</span><span class="o">.</span><span class="n">mH</span><span class="o">.</span><span class="n">cgs</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span>
    <span class="n">Mdot</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">a</span> <span class="o">**</span> <span class="mf">3.</span> <span class="o">/</span> <span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">cgs</span> <span class="o">*</span>
        <span class="n">M</span> <span class="o">/</span> <span class="n">Req</span><span class="p">)</span> <span class="o">*</span> <span class="n">rho0</span> <span class="o">*</span> <span class="n">Req</span> <span class="o">**</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">((</span><span class="n">R0</span> <span class="o">/</span> <span class="n">Req</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="o">-</span><span class="mf">1.</span>
    <span class="k">return</span> <span class="n">Mdot</span> <span class="o">/</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Msun</span><span class="o">.</span><span class="n">cgs</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">yr</span><span class="o">.</span><span class="n">cgs</span>

</div>
<div class="viewcode-block" id="calcTeff"><a class="viewcode-back" href="../pyhdust.html#pyhdust.calcTeff">[docs]</a><span class="k">def</span> <span class="nf">calcTeff</span><span class="p">(</span><span class="n">lum</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate Teff for the non-rotating case.</span>

<span class="sd">    INPUT: Lum, Radius (or Mass in Solar units). `size` variable is assumed to</span>
<span class="sd">    be  the stellar radius (i.e., M==None). If M is given, size is assumed to</span>
<span class="sd">    be log(g) (cgs units).</span>

<span class="sd">    OUTPUT: float (Kelvin)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># M, Rp, Lum = fundline</span>
    <span class="k">if</span> <span class="n">M</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">Rp</span> <span class="o">=</span> <span class="n">size</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Rsun</span><span class="o">.</span><span class="n">cgs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Rp</span> <span class="o">=</span> <span class="p">(</span><span class="n">M</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Msun</span><span class="o">.</span><span class="n">cgs</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">cgs</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">size</span><span class="p">)</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">lum</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Lsun</span><span class="o">.</span><span class="n">cgs</span>
    <span class="c"># Lum = 4*_np.pi*Rp**2*_phc.sigma*Teff**4</span>
    <span class="n">Teff</span> <span class="o">=</span> <span class="p">(</span><span class="n">L</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">Rp</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">sigma</span><span class="o">.</span><span class="n">cgs</span><span class="p">))</span> <span class="o">**</span> <span class="o">.</span><span class="mi">25</span>
    <span class="k">return</span> <span class="n">Teff</span>

</div>
<div class="viewcode-block" id="calclogg"><a class="viewcode-back" href="../pyhdust.html#pyhdust.calclogg">[docs]</a><span class="k">def</span> <span class="nf">calclogg</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">R</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate log(g) for the non-rotating case. </span>

<span class="sd">    INPUT: Radius and Mass in Solar units.</span>

<span class="sd">    OUTPUT: log(g) in cgs units.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Rsun</span><span class="o">.</span><span class="n">cgs</span>
    <span class="n">logg</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">cgs</span> <span class="o">*</span> <span class="n">M</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Msun</span><span class="o">.</span><span class="n">cgs</span> <span class="o">/</span> <span class="n">R</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">logg</span>


<span class="c"># Astro Useful and Plots</span></div>
<div class="viewcode-block" id="loadfits"><a class="viewcode-back" href="../pyhdust.html#pyhdust.loadfits">[docs]</a><span class="k">def</span> <span class="nf">loadfits</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">hdu</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Load a generic FITS. This function is different of the function as </span>
<span class="sd">    pyhdust.spectools.</span>

<span class="sd">    if `hdu` is not a integer, it returns a list with all headers and data.</span>

<span class="sd">    OUTPUT: header, data </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fits</span> <span class="o">=</span> <span class="n">_pf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hdu</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">fits</span><span class="p">[</span><span class="n">hdu</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">fits</span><span class="p">[</span><span class="n">hdu</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">header</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="p">([],</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">fitshdu</span> <span class="ow">in</span> <span class="n">fits</span><span class="p">:</span>
            <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fitshdu</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fitshdu</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">header</span><span class="p">,</span> <span class="n">data</span>

</div>
<div class="viewcode-block" id="obsCalc"><a class="viewcode-back" href="../pyhdust.html#pyhdust.obsCalc">[docs]</a><span class="k">def</span> <span class="nf">obsCalc</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Obs. Calculation</span>

<span class="sd">    INPUT:</span>

<span class="sd">    OUTPUT:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">base60_to_decimal</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Decimal value from numbers in sexagesimal system.</span>

<span class="sd">        The input value can be either a floating point number or a string</span>
<span class="sd">        such as &quot;hh mm ss.ss&quot; or &quot;dd mm ss.ss&quot;. Delimiters other than &quot; &quot;</span>
<span class="sd">        can be specified using the keyword ``delimiter``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">divisors</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">,</span> <span class="mf">3600.0</span><span class="p">]</span>
        <span class="n">xyzlist</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">xyzlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="n">xyzlist</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xyzlist</span><span class="p">]</span>
        <span class="n">decimal_value</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xyzlist</span><span class="p">,</span> <span class="n">divisors</span><span class="p">):</span>  <span class="c"># if xyzlist has &lt;3 values then</span>
            <span class="c"># divisors gets clipped.</span>
            <span class="n">decimal_value</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">/</span> <span class="n">j</span>

        <span class="n">decimal_value</span> <span class="o">=</span> <span class="o">-</span><span class="n">decimal_value</span> <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">decimal_value</span>
        <span class="k">return</span> <span class="n">decimal_value</span>

    <span class="k">def</span> <span class="nf">julian_date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="n">second</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given year, month, day, hour, minute and second return JD.</span>

<span class="sd">        ``year``, ``month``, ``day``, ``hour`` and ``minute`` are integers,</span>
<span class="sd">        truncates fractional part; ``second`` is a floating point number.</span>
<span class="sd">        For BC year: use -(year-1). Example: 1 BC = 0, 1000 BC = -999.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">MJD0</span> <span class="o">=</span> <span class="mf">2400000.5</span>  <span class="c"># 1858 November 17, 00:00:00 hours</span>

        <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="n">minute</span> <span class="o">=</span> \
            <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">month</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">day</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">hour</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">minute</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">month</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">month</span> <span class="o">+=</span> <span class="mi">12</span>
            <span class="n">year</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="n">modf</span> <span class="o">=</span> <span class="n">_math</span><span class="o">.</span><span class="n">modf</span>
        <span class="c"># Julian calendar on or before 1582 October 4 and Gregorian calendar</span>
        <span class="c"># afterwards.</span>
        <span class="k">if</span> <span class="p">((</span><span class="nb">long</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span> <span class="o">*</span> <span class="n">year</span> <span class="o">+</span> <span class="nb">long</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="n">month</span> <span class="o">+</span> <span class="n">day</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">long</span><span class="p">(</span><span class="mi">15821004</span><span class="p">)):</span>
            <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">modf</span><span class="p">((</span><span class="n">year</span> <span class="o">+</span> <span class="mi">4716</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1179</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">modf</span><span class="p">(</span><span class="n">year</span> <span class="o">/</span> <span class="mi">400</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">modf</span><span class="p">(</span><span class="n">year</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> \
                <span class="nb">int</span><span class="p">(</span><span class="n">modf</span><span class="p">(</span><span class="n">year</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">mjdmidnight</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="mi">365</span><span class="p">)</span> <span class="o">*</span> <span class="n">year</span> <span class="o">-</span> <span class="nb">long</span><span class="p">(</span><span class="mi">679004</span><span class="p">)</span> <span class="o">+</span> \
            <span class="n">b</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="mf">30.6001</span> <span class="o">*</span> <span class="p">(</span><span class="n">month</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="n">day</span>

        <span class="n">fracofday</span> <span class="o">=</span> <span class="n">base60_to_decimal</span><span class="p">(</span>
            <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">hour</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">minute</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">second</span><span class="p">)]))</span> <span class="o">/</span> <span class="mf">24.0</span>

        <span class="k">return</span> <span class="n">MJD0</span> <span class="o">+</span> <span class="n">mjdmidnight</span> <span class="o">+</span> <span class="n">fracofday</span>

    <span class="k">def</span> <span class="nf">obs_ver</span><span class="p">(</span><span class="n">hmin</span><span class="p">,</span> <span class="n">hnas</span><span class="p">,</span> <span class="n">hmax</span><span class="p">,</span> <span class="n">hpoe</span><span class="p">):</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">hnas</span> <span class="o">-</span> <span class="n">hmin</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">12</span><span class="p">:</span>
            <span class="n">cor</span> <span class="o">=</span> <span class="mi">24</span>
        <span class="k">elif</span> <span class="n">hnas</span> <span class="o">-</span> <span class="n">hmin</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">:</span>
            <span class="n">cor</span> <span class="o">=</span> <span class="o">-</span><span class="mi">24</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cor</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">hmin</span> <span class="o">&gt;</span> <span class="n">hnas</span> <span class="o">+</span> <span class="n">cor</span> <span class="ow">and</span> <span class="n">hpoe</span> <span class="o">&gt;</span> <span class="n">hmin</span><span class="p">:</span>
            <span class="n">hnas</span> <span class="o">=</span> <span class="n">hmin</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;ok0&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">hmin</span> <span class="o">&gt;</span> <span class="n">hnas</span> <span class="o">+</span> <span class="n">cor</span> <span class="ow">and</span> <span class="n">hmax</span> <span class="o">&gt;</span> <span class="n">hpoe</span> <span class="ow">and</span> <span class="p">(</span><span class="n">hpoe</span> <span class="o">-</span> <span class="n">hmin</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">12</span><span class="p">:</span>
            <span class="n">hnas</span> <span class="o">=</span> <span class="n">hmin</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;ok0&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">hmin</span> <span class="o">&gt;</span> <span class="n">hnas</span> <span class="o">+</span> <span class="n">cor</span> <span class="ow">and</span> <span class="n">hmax</span> <span class="o">&lt;</span> <span class="n">hpoe</span> <span class="ow">and</span> <span class="n">hnas</span> <span class="o">&lt;</span> <span class="n">hmax</span><span class="p">:</span>
            <span class="n">hnas</span> <span class="o">=</span> <span class="n">hmin</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;ok1&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">hmin</span> <span class="o">&lt;</span> <span class="n">hnas</span> <span class="o">+</span> <span class="n">cor</span> <span class="ow">and</span> <span class="n">hmax</span> <span class="o">&lt;</span> <span class="n">hpoe</span> <span class="ow">and</span> <span class="n">hnas</span> <span class="o">&lt;</span> <span class="n">hmax</span><span class="p">:</span>
            <span class="n">hpoe</span> <span class="o">=</span> <span class="n">hmax</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;ok2&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">hmin</span> <span class="o">&lt;</span> <span class="n">hnas</span> <span class="o">+</span> <span class="n">cor</span> <span class="ow">and</span> <span class="n">hmax</span> <span class="o">&lt;</span> <span class="n">hpoe</span> <span class="ow">and</span> <span class="p">(</span><span class="n">hnas</span> <span class="o">-</span> <span class="n">hmax</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">:</span>
            <span class="n">hpoe</span> <span class="o">=</span> <span class="n">hmax</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;ok2a&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">hmin</span> <span class="o">&lt;</span> <span class="n">hnas</span> <span class="o">+</span> <span class="n">cor</span> <span class="ow">and</span> <span class="n">hmax</span> <span class="o">&gt;</span> <span class="n">hpoe</span> <span class="ow">and</span> <span class="p">(</span><span class="n">hpoe</span> <span class="o">-</span> <span class="n">hmin</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">12</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;ok3&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">hmin</span> <span class="o">&lt;</span> <span class="n">hnas</span> <span class="o">+</span> <span class="n">cor</span> <span class="ow">and</span> <span class="n">hmax</span> <span class="o">&gt;</span> <span class="n">hpoe</span> <span class="ow">and</span> <span class="n">hpoe</span> <span class="o">&gt;</span> <span class="n">hmin</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;ok4&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">hmin</span><span class="p">,</span> <span class="n">hnas</span><span class="p">,</span> <span class="n">hmax</span><span class="p">,</span> <span class="n">hpoe</span><span class="p">)</span>
            <span class="n">hnas</span> <span class="o">=</span> <span class="n">hpoe</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">NaN</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">hnas</span><span class="p">,</span> <span class="n">hpoe</span><span class="p">)</span>

    <span class="c"># equinocio set 2011 (djsol)</span>
    <span class="n">djsol</span> <span class="o">=</span> <span class="mf">2455827.87778</span>

    <span class="c"># Input: dia gregoriano (dg), para dia juliano (dj) as 0h local</span>
    <span class="c"># +3 do UT #OPD@LNA</span>
    <span class="n">ut</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&quot;# Programa de planejamento de alvos BEACON</span><span class="se">\n</span><span class="s">#&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;# Horas em UT=</span><span class="si">%d</span><span class="s"> ! (horario de &#39;inverno&#39; de Brasilia)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;# Digite a Data de Observacao, ou &#39;ENTER&#39; para hoje...</span><span class="se">\n</span><span class="s">#&quot;</span><span class="p">)</span>
    <span class="n">dg</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dg</span> <span class="o">=</span> <span class="n">dg</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;Digite o Ano (xxxx): &quot;</span><span class="p">))]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dg</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">dg</span> <span class="o">=</span> <span class="n">dg</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;Digite o Mes (1-12): &quot;</span><span class="p">))]</span>
        <span class="n">dg</span> <span class="o">=</span> <span class="n">dg</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;Digite o Dia (1-31): &quot;</span><span class="p">))]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">_dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">dg</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dg</span> <span class="o">=</span> <span class="n">dg</span> <span class="o">+</span> <span class="p">[</span><span class="n">now</span><span class="o">.</span><span class="n">year</span><span class="p">]</span>
        <span class="n">dg</span> <span class="o">=</span> <span class="n">dg</span> <span class="o">+</span> <span class="p">[</span><span class="n">now</span><span class="o">.</span><span class="n">month</span><span class="p">]</span>
        <span class="n">dg</span> <span class="o">=</span> <span class="n">dg</span> <span class="o">+</span> <span class="p">[</span><span class="n">now</span><span class="o">.</span><span class="n">day</span><span class="p">]</span>

    <span class="n">dg</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dg</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">dj</span> <span class="o">=</span> <span class="n">julian_date</span><span class="p">(</span><span class="n">dg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="o">+</span> <span class="n">ut</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
    <span class="c"># dj = julian_date(now.year, now.month, now.day, now.hour, now.minute, </span>
        <span class="c"># now.second)</span>

    <span class="c"># dias/ano passados do solsticio de verao (ndays)</span>
    <span class="n">ndays</span> <span class="o">=</span> <span class="n">dj</span> <span class="o">-</span> <span class="n">djsol</span>
    <span class="k">while</span> <span class="n">ndays</span> <span class="o">&gt;</span> <span class="mi">365</span><span class="p">:</span>
        <span class="n">ndays</span> <span class="o">=</span> <span class="n">ndays</span> <span class="o">-</span> <span class="mi">365</span>
    <span class="k">while</span> <span class="n">ndays</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ndays</span> <span class="o">=</span> <span class="n">ndays</span> <span class="o">+</span> <span class="mi">365</span>

    <span class="c"># Hora sideral &#39;as 0h local (hz) em horas</span>
    <span class="n">hz</span> <span class="o">=</span> <span class="n">ndays</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.065711111</span><span class="p">)</span>

    <span class="c"># Reducao do tempo de observacao (rt) em minutos</span>
    <span class="k">if</span> <span class="n">ndays</span> <span class="o">&lt;=</span> <span class="mf">91.25</span><span class="p">:</span>
        <span class="n">rt</span> <span class="o">=</span> <span class="mi">75</span> <span class="o">+</span> <span class="mi">15</span> <span class="o">/</span> <span class="mf">91.25</span> <span class="o">*</span> <span class="n">ndays</span>
    <span class="k">elif</span> <span class="n">ndays</span> <span class="o">&lt;=</span> <span class="mf">273.75</span><span class="p">:</span>
        <span class="n">rt</span> <span class="o">=</span> <span class="mi">90</span> <span class="o">-</span> <span class="p">(</span><span class="n">ndays</span> <span class="o">-</span> <span class="mf">91.25</span><span class="p">)</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="mi">365</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rt</span> <span class="o">=</span> <span class="p">(</span><span class="n">ndays</span> <span class="o">-</span> <span class="mf">273.75</span><span class="p">)</span> <span class="o">*</span> <span class="mi">75</span> <span class="o">/</span> <span class="mf">91.25</span>
    <span class="c"># rt de min. para horas</span>
    <span class="n">rt</span> <span class="o">=</span> <span class="n">rt</span> <span class="o">/</span> <span class="mi">60</span>

    <span class="c"># hora maximo (hmax) e minimo (hmin) de observacao</span>
    <span class="n">hmin</span> <span class="o">=</span> <span class="n">hz</span> <span class="o">-</span> <span class="mi">6</span> <span class="o">+</span> <span class="n">rt</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">hmin</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">hmin</span> <span class="o">=</span> <span class="n">hmin</span> <span class="o">+</span> <span class="mi">24</span>
    <span class="n">hmax</span> <span class="o">=</span> <span class="n">hz</span> <span class="o">+</span> <span class="mi">6</span> <span class="o">-</span> <span class="n">rt</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">hmax</span> <span class="o">&gt;</span> <span class="mi">24</span><span class="p">:</span>
        <span class="n">hmax</span> <span class="o">=</span> <span class="n">hmax</span> <span class="o">-</span> <span class="mi">24</span>

    <span class="c"># observacao minima e maxima em dj (dmin, dmax)</span>
    <span class="c"># rt de horas para segs.</span>
    <span class="c"># rt = rt*3600.</span>
    <span class="c"># dmin = julian_date(dg[0],dg[1],dg[2]+1,3-6,0,rt/2)</span>
    <span class="c"># dmax = julian_date(dg[0],dg[1],dg[2]+1,3+6,0,-rt/2) #seg. so&#39; &gt;0!!!</span>

    <span class="c"># carrega lista de alvos</span>
    <span class="n">alvos</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&#39;{0}refs/obs_alvos.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hdtpath</span><span class="p">()),</span> 
        <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="c"># carrega tempo das declinacoes</span>
    <span class="n">obsdec</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span>
        <span class="s">&#39;{0}refs/obs_dec.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hdtpath</span><span class="p">()),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="c"># carrega efemerides</span>
    <span class="k">if</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;{0}refs/obs_ef.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hdtpath</span><span class="p">())):</span>
        <span class="n">ef_alvos</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&#39;{0}refs/obs_ef.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hdtpath</span><span class="p">()),</span>
                               <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">ef_alvos</span> <span class="o">=</span> <span class="n">ef_alvos</span><span class="o">.</span><span class="n">T</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"># Info. da noite: </span><span class="si">%2d</span><span class="s"> </span><span class="si">%2d</span><span class="s"> </span><span class="si">%4d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">dg</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">dg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dg</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">)</span>
    <span class="k">print</span><span class="p">(</span>  <span class="s">&quot;Tempo sideral no anoitecer : </span><span class="si">%2d</span><span class="s"> </span><span class="si">%2d</span><span class="s">&quot;</span> <span class="o">%</span>
          <span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="n">hmin</span><span class="p">),</span> <span class="nb">int</span><span class="p">((</span><span class="n">hmin</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">hmin</span><span class="p">))</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="p">)</span>  <span class="p">)</span>
    <span class="k">print</span><span class="p">(</span>  <span class="s">&quot;Tempo sideral &#39;a meia noite: </span><span class="si">%2d</span><span class="s"> </span><span class="si">%2d</span><span class="s">&quot;</span> <span class="o">%</span>
          <span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="n">hz</span><span class="p">),</span> <span class="nb">int</span><span class="p">((</span><span class="n">hz</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">hz</span><span class="p">))</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="p">)</span>  <span class="p">)</span>
    <span class="k">print</span><span class="p">(</span>  <span class="s">&quot;Tempo sideral no amanhecer : </span><span class="si">%2d</span><span class="s"> </span><span class="si">%2d</span><span class="s">&quot;</span> <span class="o">%</span>
          <span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="n">hmax</span><span class="p">),</span> <span class="nb">int</span><span class="p">((</span><span class="n">hmax</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">hmax</span><span class="p">))</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="p">)</span>  <span class="p">)</span>
    <span class="k">print</span><span class="p">(</span>  <span class="s">&quot;Dif. de observ. ao inverno : -</span><span class="si">%d</span><span class="s"> </span><span class="si">%2d</span><span class="s">&quot;</span> <span class="o">%</span>
          <span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="n">rt</span><span class="p">),</span> <span class="nb">int</span><span class="p">((</span><span class="n">rt</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">rt</span><span class="p">))</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="p">)</span>  <span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">ALVO</span><span class="se">\t</span><span class="s">INICIO</span><span class="se">\t</span><span class="s">FIM</span><span class="se">\t</span><span class="s">MERID.</span><span class="se">\t</span><span class="s">F_INI</span><span class="se">\t</span><span class="s">F_FIM&quot;</span><span class="p">)</span>

    <span class="n">outfile</span> <span class="o">=</span> <span class="s">&quot;ALVO</span><span class="se">\t</span><span class="s">INICIO</span><span class="se">\t</span><span class="s">FIM</span><span class="se">\t</span><span class="s">MERID.</span><span class="se">\t</span><span class="s">F_INI</span><span class="se">\t</span><span class="s">F_FIM</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">alvos</span><span class="p">)):</span>
        <span class="c"># calcula a ascencao reta (ra) e declinacao (dec)</span>
        <span class="n">ra</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">alvos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">][:</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">alvos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span> <span class="o">/</span> <span class="mi">60</span>
        <span class="n">dec</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">alvos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">][:</span><span class="mi">3</span><span class="p">])</span> <span class="o">+</span> \
            <span class="nb">float</span><span class="p">(</span><span class="n">alvos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">alvos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span> <span class="o">/</span> <span class="mi">60</span>
        <span class="c"># calcula tempo observavel na declinacao (to)</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">odmin</span> <span class="o">=</span> <span class="n">odmax</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">odmax</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">decmin</span> <span class="o">=</span> <span class="n">obsdec</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">odmin</span> <span class="o">=</span> <span class="n">obsdec</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">obsdec</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dec</span><span class="p">:</span>
                <span class="n">decmax</span> <span class="o">=</span> <span class="n">obsdec</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">odmax</span> <span class="o">=</span> <span class="n">obsdec</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">to</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">dec</span> <span class="o">-</span> <span class="n">decmax</span><span class="p">)</span> <span class="o">*</span> <span class="n">odmin</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dec</span> <span class="o">-</span> <span class="n">decmin</span><span class="p">)</span> <span class="o">*</span> <span class="n">odmax</span><span class="p">)</span> <span class="o">/</span> \
            <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">dec</span> <span class="o">-</span> <span class="n">decmin</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dec</span> <span class="o">-</span> <span class="n">decmax</span><span class="p">))</span>

        <span class="c"># calcula para cada alvo o tempo de observacao</span>
        <span class="c"># hora de inicio da observacao (&#39;nascer&#39;)</span>
        <span class="n">hnas</span> <span class="o">=</span> <span class="n">ra</span> <span class="o">-</span> <span class="n">to</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">hnas</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">hnas</span> <span class="o">=</span> <span class="n">hnas</span> <span class="o">+</span> <span class="mi">24</span>
        <span class="c"># hora de termino da observacao (&#39;poente&#39;)</span>
        <span class="n">hpoe</span> <span class="o">=</span> <span class="n">ra</span> <span class="o">+</span> <span class="n">to</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">hpoe</span> <span class="o">&gt;</span> <span class="mi">24</span><span class="p">:</span>
            <span class="n">hpoe</span> <span class="o">=</span> <span class="n">hpoe</span> <span class="o">-</span> <span class="mi">24</span>
        <span class="c"># observavel ao anoitecer?</span>
        <span class="p">(</span><span class="n">hnas</span><span class="p">,</span> <span class="n">hpoe</span><span class="p">)</span> <span class="o">=</span> <span class="n">obs_ver</span><span class="p">(</span><span class="n">hmin</span><span class="p">,</span> <span class="n">hnas</span><span class="p">,</span> <span class="n">hmax</span><span class="p">,</span> <span class="n">hpoe</span><span class="p">)</span>
        <span class="c"># estara&#39; observavel por mais de um 3/4 de hora? (dt)</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">hpoe</span> <span class="o">-</span> <span class="n">hnas</span>
        <span class="k">if</span> <span class="n">dt</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">+</span> <span class="mi">24</span>
        <span class="k">if</span> <span class="n">dt</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">-</span> <span class="mi">24</span>
        <span class="k">if</span> <span class="n">dt</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="o">/</span> <span class="mf">4.</span><span class="p">:</span>
            <span class="n">hnas</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">NaN</span>
            <span class="n">hpoe</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">NaN</span>

        <span class="c"># procura posicao nas efemerides (pef)</span>
        <span class="k">if</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;{0}refs/obs_ef.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hdtpath</span><span class="p">())):</span>
            <span class="n">pef</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                <span class="n">ef_alvos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">alvos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pef</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pef</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">hnas</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pef</span> <span class="o">=</span> <span class="n">pef</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">per</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ef_alvos</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">pef</span><span class="p">])</span>
            <span class="n">T0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ef_alvos</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">pef</span><span class="p">])</span>
            <span class="c"># calcula fases</span>
            <span class="c"># dj dia juliano &#39;a meia-noite local</span>
            <span class="c"># dj = julian_date(dg[0],dg[1],dg[2]+1,0+ut,0,0.)</span>
            <span class="c"># observacao ANTES da 0h UT</span>
            <span class="n">cor</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">hnas</span> <span class="o">-</span> <span class="n">hz</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">:</span>
                <span class="n">cor</span> <span class="o">=</span> <span class="o">-</span><span class="mi">24</span>
            <span class="k">if</span> <span class="n">hnas</span> <span class="o">-</span> <span class="n">hz</span> <span class="o">+</span> <span class="n">ut</span> <span class="o">+</span> <span class="n">cor</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c"># or (hz-hnas &lt; 0 and hz-nas&lt;-12):</span>
                <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">hour</span> <span class="o">=</span> <span class="n">hnas</span> <span class="o">-</span> <span class="n">hz</span> <span class="o">+</span> <span class="n">ut</span> <span class="o">+</span> <span class="n">cor</span>
                <span class="n">minute</span> <span class="o">=</span> <span class="p">(</span><span class="n">hour</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">hour</span><span class="p">))</span> <span class="o">*</span> <span class="mi">60</span>
                <span class="n">hour</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span>
                <span class="n">djnas</span> <span class="o">=</span> <span class="n">julian_date</span><span class="p">(</span><span class="n">dg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dg</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">hour</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="n">hour</span> <span class="o">=</span> <span class="n">hnas</span> <span class="o">-</span> <span class="n">hz</span> <span class="o">+</span> <span class="n">ut</span> <span class="o">+</span> <span class="n">cor</span>
                <span class="n">minute</span> <span class="o">=</span> <span class="p">(</span><span class="n">hour</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">hour</span><span class="p">))</span> <span class="o">*</span> <span class="mi">60</span>
                <span class="n">hour</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span>
                <span class="n">djnas</span> <span class="o">=</span> <span class="n">julian_date</span><span class="p">(</span><span class="n">dg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
            <span class="c"># print(j,hour,djnas)</span>
            <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">hpoe</span> <span class="o">-</span> <span class="n">hz</span> <span class="o">+</span> <span class="n">ut</span> <span class="o">+</span> <span class="n">cor</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">hour</span> <span class="o">=</span> <span class="n">hpoe</span> <span class="o">-</span> <span class="n">hz</span> <span class="o">+</span> <span class="n">ut</span> <span class="o">+</span> <span class="n">cor</span>
                <span class="n">minute</span> <span class="o">=</span> <span class="p">(</span><span class="n">hour</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">hour</span><span class="p">))</span> <span class="o">*</span> <span class="mi">60</span>
                <span class="n">hour</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span>
                <span class="n">djpoe</span> <span class="o">=</span> <span class="n">julian_date</span><span class="p">(</span><span class="n">dg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dg</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">hour</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="n">hour</span> <span class="o">=</span> <span class="n">hpoe</span> <span class="o">-</span> <span class="n">hz</span> <span class="o">+</span> <span class="n">ut</span> <span class="o">+</span> <span class="n">cor</span>
                <span class="n">minute</span> <span class="o">=</span> <span class="p">(</span><span class="n">hour</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">hour</span><span class="p">))</span> <span class="o">*</span> <span class="mi">60</span>
                <span class="n">hour</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span>
                <span class="n">djpoe</span> <span class="o">=</span> <span class="n">julian_date</span><span class="p">(</span><span class="n">dg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
            <span class="c"># print(j,hour,djpoe)</span>
            <span class="c"># Warnings</span>
            <span class="c"># if T0 == 0.:</span>
                <span class="c"># print(&quot;WARNING: No &#39;T0&#39; is available for this star!!!&quot;)</span>
            <span class="c"># if per == 1.:</span>
                <span class="c"># print(&quot;WARNING: No Period is available for this star!!!&quot;)</span>
            <span class="c"># print(&quot;# A fase atual e&#39; &quot;+str( (j-T0)%Per/Per )+&quot;\n&quot; )</span>
            <span class="n">fase_inc</span> <span class="o">=</span> <span class="p">((</span><span class="n">djnas</span> <span class="o">-</span> <span class="n">T0</span><span class="p">)</span> <span class="o">%</span> <span class="n">per</span><span class="p">)</span> <span class="o">/</span> <span class="n">per</span>
            <span class="n">fase_fim</span> <span class="o">=</span> <span class="p">((</span><span class="n">djpoe</span> <span class="o">-</span> <span class="n">T0</span><span class="p">)</span> <span class="o">%</span> <span class="n">per</span><span class="p">)</span> <span class="o">/</span> <span class="n">per</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fase_inc</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">NaN</span>
            <span class="n">fase_fim</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">NaN</span>

        <span class="c"># tempos locais</span>
        <span class="n">hlmin</span> <span class="o">=</span> <span class="n">hnas</span> <span class="o">-</span> <span class="n">hz</span>
        <span class="k">if</span> <span class="n">hlmin</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">hlmin</span> <span class="o">=</span> <span class="n">hlmin</span> <span class="o">+</span> <span class="mi">24</span>
        <span class="n">hlmax</span> <span class="o">=</span> <span class="n">hpoe</span> <span class="o">-</span> <span class="n">hz</span>
        <span class="k">if</span> <span class="n">hlmax</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">hlmax</span> <span class="o">=</span> <span class="n">hlmax</span> <span class="o">+</span> <span class="mi">24</span>
        <span class="n">hmer</span> <span class="o">=</span> <span class="n">ra</span> <span class="o">-</span> <span class="n">hz</span>
        <span class="k">if</span> <span class="n">hmer</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">hmer</span> <span class="o">=</span> <span class="n">hmer</span> <span class="o">+</span> <span class="mi">24</span>

        <span class="k">if</span> <span class="n">hlmin</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="si">%2d</span><span class="s"> </span><span class="si">%2d</span><span class="se">\t</span><span class="si">%2d</span><span class="s"> </span><span class="si">%2d</span><span class="se">\t</span><span class="si">%2d</span><span class="s"> </span><span class="si">%2d</span><span class="se">\t</span><span class="si">%.2f</span><span class="se">\t</span><span class="si">%.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">alvos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][:</span><span class="mi">7</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">hlmin</span><span class="p">),</span> <span class="nb">int</span><span class="p">((</span><span class="n">hlmin</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">hlmin</span><span class="p">))</span> <span class="o">*</span> <span class="mi">60</span><span class="p">),</span> 
                <span class="nb">int</span><span class="p">(</span><span class="n">hlmax</span><span class="p">),</span> <span class="nb">int</span><span class="p">((</span><span class="n">hlmax</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">hlmax</span><span class="p">))</span> <span class="o">*</span> <span class="mi">60</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">hmer</span><span class="p">),</span> 
                <span class="nb">int</span><span class="p">((</span><span class="n">hmer</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">hmer</span><span class="p">))</span> <span class="o">*</span> <span class="mi">60</span><span class="p">),</span> <span class="n">fase_inc</span><span class="p">,</span> <span class="n">fase_fim</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="n">outfile</span> <span class="o">+</span> <span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="si">%2d</span><span class="s"> </span><span class="si">%2d</span><span class="se">\t</span><span class="si">%2d</span><span class="s"> </span><span class="si">%2d</span><span class="se">\t</span><span class="si">%2d</span><span class="s"> </span><span class="si">%2d</span><span class="se">\t</span><span class="si">%.2f</span><span class="se">\t</span><span class="si">%.2f</span><span class="s">&quot;</span> <span class="o">%</span>
                <span class="p">(</span><span class="n">alvos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][:</span><span class="mi">7</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">hlmin</span><span class="p">),</span> <span class="nb">int</span><span class="p">((</span><span class="n">hlmin</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">hlmin</span><span class="p">))</span> <span class="o">*</span> <span class="mi">60</span><span class="p">),</span> 
                <span class="nb">int</span><span class="p">(</span><span class="n">hlmax</span><span class="p">),</span> <span class="nb">int</span><span class="p">((</span><span class="n">hlmax</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">hlmax</span><span class="p">))</span> <span class="o">*</span> <span class="mi">60</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">hmer</span><span class="p">),</span> 
                <span class="nb">int</span><span class="p">((</span><span class="n">hmer</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">hmer</span><span class="p">))</span> <span class="o">*</span> <span class="mi">60</span><span class="p">),</span> <span class="n">fase_inc</span><span class="p">,</span> <span class="n">fase_fim</span><span class="p">)</span> <span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="s">-- --</span><span class="se">\t</span><span class="s">-- --</span><span class="se">\t</span><span class="s">-- --</span><span class="se">\t</span><span class="s">-.--</span><span class="se">\t</span><span class="s">-.--&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">alvos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][:</span><span class="mi">7</span><span class="p">])</span> <span class="p">)</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="n">outfile</span> <span class="o">+</span> <span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="s">-- --</span><span class="se">\t</span><span class="s">-- --</span><span class="se">\t</span><span class="s">-- --</span><span class="se">\t</span><span class="s">-.--</span><span class="se">\t</span><span class="s">-.--&quot;</span> <span class="o">%</span>
                 <span class="p">(</span><span class="n">alvos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][:</span><span class="mi">7</span><span class="p">])</span> <span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>

    <span class="n">wfile</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Deseja salvar a lista?(Sim/outro): &quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wfile</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;s&#39;</span><span class="p">,</span> <span class="s">&#39;sim&#39;</span><span class="p">,</span> <span class="s">&#39;Sim&#39;</span><span class="p">,</span> <span class="s">&#39;S&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="s">&#39;yes&#39;</span><span class="p">,</span> <span class="s">&#39;Yes&#39;</span><span class="p">,</span> <span class="s">&#39;Y&#39;</span><span class="p">]:</span>
        <span class="n">f0</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;obs_</span><span class="si">%2d</span><span class="s">_</span><span class="si">%2d</span><span class="s">_</span><span class="si">%4d</span><span class="s">.txt&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dg</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">dg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">f0</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
        <span class="n">f0</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="plot_obs"><a class="viewcode-back" href="../pyhdust.html#pyhdust.plot_obs">[docs]</a><span class="k">def</span> <span class="nf">plot_obs</span><span class="p">(</span><span class="n">observ_dates</span><span class="o">=</span><span class="p">[],</span> <span class="n">legend</span><span class="o">=</span><span class="p">[],</span> <span class="n">civcfg</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;m&#39;</span><span class="p">],</span> <span class="n">civdt</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>  
    <span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;png&#39;</span><span class="p">],</span> <span class="n">addsuf</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">markers</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
    <span class="n">mjdlims</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">graymjds</span><span class="o">=</span><span class="p">[],</span> <span class="n">dolines</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">mincivcfg</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot; Plot observations as done in Faes+2016. </span>

<span class="sd">    INPUT: `observ_dates` in a list of arrays. Each array contains the dates of </span>
<span class="sd">    a given observation. Dates, in principle (TODO), must be in MJD.</span>

<span class="sd">    `legend` is a list of names, one for each array.</span>

<span class="sd">    `civcfg` = [step, &#39;d&#39;|&#39;m&#39;|&#39;y&#39;] </span>

<span class="sd">    `civdt` = starting date at the Civil Date axis (MJD?).</span>

<span class="sd">    if `addsuf` is None, a date-time string will be added to the filename.</span>

<span class="sd">    `colors` = colors for each observ_dates array. If `None`, then </span>
<span class="sd">    phc.cycles(ctype=&#39;cor&#39;).</span>

<span class="sd">    `ls` same as above, for linestyle.</span>

<span class="sd">    `markers` same as above, for markers.</span>

<span class="sd">    `graymjds`, gray areas; example `graymjds =[[56200, 56260], [57000, 57100]]</span>

<span class="sd">    OUTPUT: File saved.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">civdt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">civdt</span> <span class="o">=</span> <span class="n">_dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">civdt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">civdt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">civdt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
    <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">observ_dates</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">_phc</span><span class="o">.</span><span class="n">cycles</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;cor&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">ls</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ls</span> <span class="o">=</span> <span class="p">[</span><span class="n">_phc</span><span class="o">.</span><span class="n">cycles</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;ls&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">markers</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">mk</span> <span class="o">=</span> <span class="p">[</span><span class="n">_phc</span><span class="o">.</span><span class="n">cycles</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s">&#39;mk&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span>
    <span class="c">#</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">observ_dates</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">observ_dates</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">observ_dates</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dolines</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">dt</span><span class="p">,</span> <span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">ys</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="n">i</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> 
                    <span class="n">marker</span><span class="o">=</span><span class="n">mk</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">legend</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">ys</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="n">i</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> 
                    <span class="n">marker</span><span class="o">=</span><span class="n">mk</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">graymjds</span><span class="p">:</span>
        <span class="n">rect</span> <span class="o">=</span> <span class="n">_mpatches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">([</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s">&quot;gray&quot;</span><span class="p">,</span> 
            <span class="n">fc</span><span class="o">=</span><span class="s">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
    <span class="c"># </span>
    <span class="n">flatdataes</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">observ_dates</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
    <span class="n">mjd0</span><span class="p">,</span> <span class="n">mjd1</span> <span class="o">=</span> <span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">flatdataes</span><span class="p">),</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">flatdataes</span><span class="p">))</span>
    <span class="n">civvals</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Y&#39;</span><span class="p">:</span> <span class="mi">365</span><span class="p">,</span> <span class="s">&#39;M&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s">&#39;D&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="n">extratick</span> <span class="o">=</span> <span class="n">civcfg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">civvals</span><span class="p">[</span><span class="n">civcfg</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="c"># ax.set_title(&#39;Title&#39;)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Julian date - 2400000.5&#39;</span><span class="p">)</span>
    <span class="n">dtticks</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">gentkdates</span><span class="p">(</span><span class="n">mjd0</span><span class="p">,</span> <span class="n">mjd1</span><span class="o">+</span><span class="n">extratick</span><span class="p">,</span> <span class="n">civcfg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">civcfg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
        <span class="n">dtstart</span><span class="o">=</span><span class="n">civdt</span><span class="p">)</span>
    <span class="n">mjdticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">_jdcal</span><span class="o">.</span><span class="n">gcal2jd</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">day</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> 
        <span class="n">dtticks</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dtticks</span><span class="p">,</span> <span class="n">mjdticks</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span>
    <span class="c"># ax.plot([mjdticks[-1], mjdticks[-1]], [0, 1], alpha=0)</span>
    <span class="c"># xlim = [mjdticks[0], ax.get_xlim()[-1]]</span>
    <span class="k">if</span> <span class="n">mjdlims</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="n">mjd0</span><span class="p">,</span> <span class="n">mjd1</span><span class="o">+</span><span class="n">extratick</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xlim</span> <span class="o">=</span> <span class="n">mjdlims</span>
    <span class="c"># print xlim</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
    <span class="c"># ax.set_xlim(limits)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s">&#39;axes&#39;</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">))</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Civil date&#39;</span><span class="p">)</span>
    <span class="n">dtminticks</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">gentkdates</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mincivcfg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mincivcfg</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">dtticks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dtminticks</span><span class="p">:</span>
        <span class="n">dtminticks</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">gentkdates</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mincivcfg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
            <span class="n">mincivcfg</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">minjdticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">_jdcal</span><span class="o">.</span><span class="n">gcal2jd</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">day</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">date</span> 
        <span class="ow">in</span> <span class="n">dtminticks</span><span class="p">]</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">mjdticks</span><span class="p">)</span>
    <span class="n">xlabs</span> <span class="o">=</span> <span class="p">[</span><span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">dtticks</span><span class="p">]</span>
    <span class="n">xlabs</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">xlabs</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">xlabs</span><span class="p">)</span>  
        <span class="c"># , fontsize=10)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">minjdticks</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c"># ax2.set_xticklabels([date.strftime(&quot;%Y/%M/%d&quot;) for date in dtticks])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="c"># ax.xaxis.set_minor_locator(_ML(50))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s">&#39;both&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s">&#39;minor&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s">&#39;minor&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span> <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_majorticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span> <span class="p">)</span>
    <span class="c"># ax2.fmt_xdata = mdates.DateFormatter(&#39;%Y-%m-%d&#39;)</span>
    <span class="c"># fig.autofmt_xdate()</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.67</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.16</span><span class="p">,</span> 
        <span class="n">hspace</span><span class="o">=.</span><span class="mi">15</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">addsuf</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">addsuf</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">dtflag</span><span class="p">()</span>
    <span class="c"># for f in fmt:</span>
    <span class="c">#     print(&#39;# Saved plot_obs{0}.{1}&#39;.format(addsuf, f))</span>
    <span class="c">#     _plt.savefig(&#39;plot_obs{0}.{1}&#39;.format(addsuf, f), transparent=True)</span>
    <span class="n">_phc</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="plotMJDdates"><a class="viewcode-back" href="../pyhdust.html#pyhdust.plotMJDdates">[docs]</a><span class="k">def</span> <span class="nf">plotMJDdates</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">pol</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">interf</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot dates from spec (Class), pol (routines) and interf (ESO query)</span>

<span class="sd">    TODO: This need to be polished !!!!</span>

<span class="sd">    spec = &#39;data_aeri_splot.txt&#39;</span>
<span class="sd">    pol = &#39;pol_aeri.log&#39;</span>
<span class="sd">    interf = &#39;interf_aeri.txt&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">spec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">spJD</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="n">spJD</span> <span class="o">=</span> <span class="n">spJD</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span> <span class="k">for</span> <span class="n">JD</span> <span class="ow">in</span> <span class="n">spJD</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spJD</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="c"># yerr = [ [1. for JD in spJD], [1. for JD in spJD] ]</span>
        <span class="c"># ax.errorbar(spJD, y, yerr, marker=&#39;o&#39;, color=&#39;blue&#39;, ls=&#39;&#39;)</span>

    <span class="k">if</span> <span class="n">pol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">polJD</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">pol</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">polJD</span> <span class="o">=</span> <span class="n">polJD</span><span class="p">[:,</span> <span class="mi">9</span><span class="p">]</span>
        <span class="n">polJD</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">polJD</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">-</span> <span class="mf">2400000.5</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="o">-.</span><span class="mi">5</span> <span class="k">for</span> <span class="n">JD</span> <span class="ow">in</span> <span class="n">polJD</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">polJD</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="c"># yerr = [ [.5 for JD in polJD], [1.5 for JD in polJD] ]</span>
        <span class="c"># ax.errorbar(polJD, y, yerr, marker=&#39;x&#39;, color=&#39;green&#39;, ls=&#39;&#39;)</span>

    <span class="k">if</span> <span class="n">interf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">intJD</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">interf</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">intJD</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">intJD</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="mi">5</span> <span class="k">for</span> <span class="n">JD</span> <span class="ow">in</span> <span class="n">intJD</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">intJD</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;darkgrey&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="c"># yerr = [ [1.5 for JD in intJD], [.5 for JD in intJD] ]</span>
        <span class="c"># ax.errorbar(intJD, y, yerr, marker=&#39;s&#39;, color=&#39;red&#39;, ls=&#39;&#39;)</span>

    <span class="n">limits</span> <span class="o">=</span> <span class="p">(</span><span class="mf">56100.</span><span class="p">,</span> <span class="mf">56750.</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">limits</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">mjd0</span><span class="p">,</span> <span class="n">mjd1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mjd0</span><span class="p">,</span> <span class="n">mjd1</span> <span class="o">=</span> <span class="n">limits</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">limits</span><span class="p">)</span>
    <span class="n">ticks</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">gentkdates</span><span class="p">(</span><span class="n">mjd0</span><span class="p">,</span> <span class="n">mjd1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">dtstart</span><span class="o">=</span><span class="n">_dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">())</span>
    <span class="n">mjdticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">_jdcal</span><span class="o">.</span><span class="n">gcal2jd</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">day</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span>
                <span class="n">ticks</span><span class="p">]</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">limits</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">mjdticks</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Civil date&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s"> %b %y&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">ticks</span><span class="p">])</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_majorticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;MJD&#39;</span><span class="p">)</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="plot_gal"><a class="viewcode-back" href="../pyhdust.html#pyhdust.plot_gal">[docs]</a><span class="k">def</span> <span class="nf">plot_gal</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">addsuf</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;png&#39;</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot; Plot in &quot;Galatic Coordinates&quot; (i.e., Mollweide projection).</span>

<span class="sd">    Input: RA and DEC arrays in RADIANS (fraction)</span>

<span class="sd">    Output: Saved images &quot;&quot;&quot;</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>  <span class="c"># figsize=(8,6))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s">&quot;mollweide&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s">&#39;14h&#39;</span><span class="p">,</span> <span class="s">&#39;16h&#39;</span><span class="p">,</span> <span class="s">&#39;18h&#39;</span><span class="p">,</span> <span class="s">&#39;20h&#39;</span><span class="p">,</span> <span class="s">&#39;22h&#39;</span><span class="p">,</span> <span class="s">&#39;0h&#39;</span><span class="p">,</span> <span class="s">&#39;2h&#39;</span><span class="p">,</span> <span class="s">&#39;4h&#39;</span><span class="p">,</span> 
        <span class="s">&#39;6h&#39;</span><span class="p">,</span> <span class="s">&#39;8h&#39;</span><span class="p">,</span> <span class="s">&#39;10h&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">addsuf</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">addsuf</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">dtflag</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fmt</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Saved plot_gal{0}.{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addsuf</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;plot_gal{0}.{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addsuf</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span> <span class="n">transparent</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span>


<span class="c"># Filters tools</span></div>
<div class="viewcode-block" id="doFilterConv"><a class="viewcode-back" href="../pyhdust.html#pyhdust.doFilterConv">[docs]</a><span class="k">def</span> <span class="nf">doFilterConv</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">filt</span><span class="p">,</span> <span class="n">zeropt</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot; Return the convolved filter total flux for a given flux profile y0,</span>
<span class="sd">    at wavelengths x0.</span>

<span class="sd">    .. math::</span>

<span class="sd">        \text{zero}_{\rm pt} = \frac{\int F(\lambda) Sp(\lambda)\,d\lambda}</span>
<span class="sd">        {\int F(\lambda)\,d\lambda} </span>

<span class="sd">    INPUT: x0 lambda array (**Angstroms**), y0 flux array, filter (string, </span>
<span class="sd">    uppercase for standard filters)</span>

<span class="sd">    OUTPUT: summed flux (y0 units; default) or *zero point level* </span>
<span class="sd">    (**polarimetry**)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fpath</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hdtpath</span><span class="p">(),</span> <span class="s">&#39;refs&#39;</span><span class="p">,</span> <span class="s">&#39;filters&#39;</span><span class="p">,</span> <span class="n">filt</span><span class="o">+</span><span class="s">&#39;.dat&#39;</span><span class="p">)</span>
    <span class="n">fdat</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c"># fdat[:, 0] /= 1e4  # from Angs to microns</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">x0</span> <span class="o">&gt;=</span> <span class="n">fdat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x0</span> <span class="o">&lt;=</span> <span class="n">fdat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">x0</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="n">y0</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="c"># interpfunc = interpolate.interp1d(fdat[:,0], fdat[:,1], kind=&#39;linear&#39;)</span>
    <span class="n">interpfunc</span> <span class="o">=</span> <span class="n">_interpolate</span><span class="o">.</span><span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span>
        <span class="n">fdat</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">fdat</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">zeropt</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">interpfunc</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span> <span class="o">*</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># return _phc.wg_avg_and_std(y0, 1 / interpfunc(x0))[0]</span>
        <span class="k">return</span> <span class="n">_np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">interpfunc</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span> <span class="o">*</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span><span class="o">/</span><span class="n">_np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">interpfunc</span><span class="p">(</span><span class="n">x0</span><span class="p">),</span> <span class="n">x0</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="doPlotFilter"><a class="viewcode-back" href="../pyhdust.html#pyhdust.doPlotFilter">[docs]</a><span class="k">def</span> <span class="nf">doPlotFilter</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">fsed2data</span><span class="p">,</span> <span class="n">pol</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">addsuf</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;png&#39;</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    obs = integer; filter = single string</span>

<span class="sd">    TODO = lambda standard in .../filters/*.dat</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">fsed2data</span><span class="p">[</span><span class="n">obs</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">pol</span><span class="p">:</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="n">fsed2data</span><span class="p">[</span><span class="n">obs</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">7</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="n">fsed2data</span><span class="p">[</span><span class="n">obs</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">x0</span>

    <span class="n">fdat</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&#39;{0}filters/{1}.dat&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hdtpath</span><span class="p">(),</span> <span class="nb">filter</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span>
                       <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fdat</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/=</span> <span class="mf">10000.</span>
    <span class="c"># interpfunc = interpolate.interp1d(fdat[:,0], fdat[:,1], kind=&#39;linear&#39;)</span>
    <span class="n">interpfunc</span> <span class="o">=</span> <span class="n">_interpolate</span><span class="o">.</span><span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span>
        <span class="n">fdat</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">fdat</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="n">idx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">x0</span> <span class="o">&gt;=</span> <span class="n">fdat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x0</span> <span class="o">&lt;=</span> <span class="n">fdat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">x0</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="n">y0</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="c"># y = interpfunc(x0) * y0  # /_np.sum( interpfunc(x0) )</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;SED&#39;</span><span class="p">)</span>
    <span class="c"># ax.plot(fdat[:,0], fdat[:,1], label=&#39;Filter&#39;)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">interpfunc</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span> <span class="o">*</span> <span class="n">y0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Convolved&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fdat</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">fdat</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y0</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Filter (eff.)&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">addsuf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">addsuf</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">&#39;best&#39;</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">addsuf</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">addsuf</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">dtflag</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">pol</span><span class="p">:</span>
            <span class="n">addsuf</span> <span class="o">+=</span> <span class="s">&#39;_pol&#39;</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fmt</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Saved doPlotFilter{0}.{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addsuf</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;doPlotFilter{0}.{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addsuf</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span> <span class="n">transparent</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span>

</div>
<div class="viewcode-block" id="plot_hdt_filters"><a class="viewcode-back" href="../pyhdust.html#pyhdust.plot_hdt_filters">[docs]</a><span class="k">def</span> <span class="nf">plot_hdt_filters</span><span class="p">(</span><span class="n">outname</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="s">&quot;Plot all filters available in PyHdust&quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">_glob</span><span class="p">(</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hdtpath</span><span class="p">(),</span> <span class="s">&#39;refs&#39;</span><span class="p">,</span> <span class="s">&#39;filters&#39;</span><span class="p">,</span> 
        <span class="s">&#39;*.dat&#39;</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">9000</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">50000</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span>
            <span class="n">replace</span><span class="p">(</span><span class="s">&#39;.dat&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">axs</span><span class="p">)):</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&#39;Wavelength ($\AA$)&#39;</span><span class="p">)</span>
    <span class="n">_phc</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">figname</span><span class="o">=</span><span class="n">outname</span><span class="p">)</span>
    <span class="c"># print(&#39;# Filtres ploted in file {0}&#39;.format(outname))</span>
    <span class="k">return</span> 

</div>
<div class="viewcode-block" id="readphotxdr"><a class="viewcode-back" href="../pyhdust.html#pyhdust.readphotxdr">[docs]</a><span class="k">def</span> <span class="nf">readphotxdr</span><span class="p">(</span><span class="n">xdrfile</span><span class="o">=</span><span class="s">&#39;kur_ap00k0.xdr&#39;</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; doc &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">xdrfile</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">ixdr</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">_</span> <span class="o">=</span> <span class="n">_struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&gt;l&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">ixdr</span><span class="p">:</span><span class="n">ixdr</span><span class="o">+</span> <span class="mi">4</span><span class="p">])</span>
    <span class="n">ixdr</span> <span class="o">+=</span> <span class="mi">4</span>
    <span class="n">nlin</span><span class="p">,</span> <span class="n">nlbd</span><span class="p">,</span> <span class="n">nmod</span> <span class="o">=</span> <span class="n">_struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&gt;3l&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">ixdr</span><span class="p">:</span><span class="n">ixdr</span><span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">ixdr</span> <span class="o">+=</span> <span class="mi">4</span><span class="o">*</span><span class="mi">3</span>

    <span class="n">_</span> <span class="o">=</span> <span class="n">_struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&gt;l&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">ixdr</span><span class="p">:</span><span class="n">ixdr</span><span class="o">+</span> <span class="mi">4</span><span class="p">])</span>
    <span class="n">ixdr</span> <span class="o">+=</span> <span class="mi">4</span>
    <span class="n">istr</span> <span class="o">=</span> <span class="s">&#39;&gt;{0:d}f&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nlin</span><span class="p">)</span>
    <span class="n">lbdcentr</span> <span class="o">=</span> <span class="n">_struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">istr</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">ixdr</span><span class="p">:</span><span class="n">ixdr</span><span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">nlin</span><span class="p">])</span>
    <span class="n">ixdr</span> <span class="o">+=</span> <span class="mi">4</span><span class="o">*</span><span class="n">nlin</span>

    <span class="n">_</span> <span class="o">=</span> <span class="n">_struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&gt;l&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">ixdr</span><span class="p">:</span><span class="n">ixdr</span><span class="o">+</span> <span class="mi">4</span><span class="p">])</span>
    <span class="n">ixdr</span> <span class="o">+=</span> <span class="mi">4</span>
    <span class="n">istr</span> <span class="o">=</span> <span class="s">&#39;&gt;{0:d}f&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nmod</span><span class="p">)</span>
    <span class="n">ltemp</span> <span class="o">=</span> <span class="n">_struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">istr</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">ixdr</span><span class="p">:</span><span class="n">ixdr</span><span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">nmod</span><span class="p">])</span>
    <span class="n">ixdr</span> <span class="o">+=</span> <span class="mi">4</span><span class="o">*</span><span class="n">nmod</span>

    <span class="n">_</span> <span class="o">=</span> <span class="n">_struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&gt;l&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">ixdr</span><span class="p">:</span><span class="n">ixdr</span><span class="o">+</span> <span class="mi">4</span><span class="p">])</span>
    <span class="n">ixdr</span> <span class="o">+=</span> <span class="mi">4</span>
    <span class="n">istr</span> <span class="o">=</span> <span class="s">&#39;&gt;{0:d}f&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nmod</span><span class="p">)</span>
    <span class="n">llogg</span> <span class="o">=</span> <span class="n">_struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">istr</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">ixdr</span><span class="p">:</span><span class="n">ixdr</span><span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">nmod</span><span class="p">])</span>
    <span class="n">ixdr</span> <span class="o">+=</span> <span class="mi">4</span><span class="o">*</span><span class="n">nmod</span>

    <span class="n">lambdas</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nlin</span><span class="p">,</span> <span class="n">nlbd</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlin</span><span class="p">):</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">_struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&gt;l&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">ixdr</span><span class="p">:</span><span class="n">ixdr</span><span class="o">+</span> <span class="mi">4</span><span class="p">])</span>
        <span class="n">ixdr</span> <span class="o">+=</span> <span class="mi">4</span>
        <span class="n">istr</span> <span class="o">=</span> <span class="s">&#39;&gt;{0:d}f&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nlbd</span><span class="p">)</span>
        <span class="n">lambdas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">istr</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">ixdr</span><span class="p">:</span><span class="n">ixdr</span><span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">nlbd</span><span class="p">])</span>
        <span class="n">ixdr</span> <span class="o">+=</span> <span class="mi">4</span><span class="o">*</span><span class="n">nlbd</span>

    <span class="n">profiles</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nmod</span><span class="p">,</span> <span class="n">nlin</span><span class="p">,</span> <span class="n">nlbd</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">_itprod</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nmod</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlin</span><span class="p">)):</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">_struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&gt;l&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">ixdr</span><span class="p">:</span><span class="n">ixdr</span><span class="o">+</span> <span class="mi">4</span><span class="p">])</span>
        <span class="n">ixdr</span> <span class="o">+=</span> <span class="mi">4</span>
        <span class="n">istr</span> <span class="o">=</span> <span class="s">&#39;&gt;{0:d}f&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nlbd</span><span class="p">)</span>
        <span class="n">profiles</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">_struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">istr</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">ixdr</span><span class="p">:</span><span class="n">ixdr</span><span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">nlbd</span><span class="p">])</span>
        <span class="n">ixdr</span> <span class="o">+=</span> <span class="mi">4</span><span class="o">*</span><span class="n">nlbd</span>

    <span class="k">if</span> <span class="n">ixdr</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;# XDR {0} completely read!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xdrfile</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Warning: XDR {0} not completely read!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xdrfile</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;# length difference is {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">-</span> <span class="n">ixdr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span> <span class="p">)</span> <span class="p">)</span>

    <span class="k">return</span> <span class="n">lbdcentr</span><span class="p">,</span> <span class="n">ltemp</span><span class="p">,</span> <span class="n">llogg</span><span class="p">,</span> <span class="n">lambdas</span><span class="p">,</span> <span class="n">profiles</span>

<span class="c"># def chkObsLog(path=None, nights=None, badweath=None):</span>
    <span class="c"># &quot;&quot;&quot; Check if there is data for all nights with observations.</span>
<span class="c"># </span>
    <span class="c"># If not, check if the night is in the list of night lost due to bad </span>
        <span class="c"># weather.</span>
<span class="c"># </span>
    <span class="c"># If no data and no bad weather info is registered, prints an error.</span>
<span class="c"># </span>
    <span class="c"># If the night is included as bad weather and is not in night list, prints</span>
    <span class="c"># a warning.</span>
    <span class="c"># &quot;&quot;&quot;</span>
    <span class="c"># if path == None:</span>
        <span class="c"># path = _os.getcwd()</span>
    <span class="c"># if nights == None:</span>
        <span class="c"># nights = &#39;{0}pyhdust/refs/noites.txt&#39;.format(hdtpath())</span>
    <span class="c"># lnights = _np.loadtxt(nights, dtype=str)</span>
    <span class="c"># if badweath == None:</span>
        <span class="c"># badweath = &#39;{0}pyhdust/refs/maltempo.txt&#39;.format(hdtpath())</span>
    <span class="c"># lbadweath = _np.loadtxt(badweath, dtype=str)</span>
    <span class="c"># for night in lnights:</span>
        <span class="c"># if night in lbadweath:</span>
            <span class="c"># pass</span>
        <span class="c"># elif not _os.path.exists(night):</span>
            <span class="c"># print(&#39;# ERROR! {0} has no data and was not lost for bad&#39; +\</span>
                <span class="c"># &#39;weather!&#39;.format(night))</span>
    <span class="c"># flds = [fld for fld in _os.listdir(&#39;{0}&#39;.format(path)) if \</span>
            <span class="c"># _os.path.isdir(_os.path.join(&#39;{0}&#39;.format(path), fld))]</span>
    <span class="c"># for fld in flds:</span>
        <span class="c"># if fld not in lnights:</span>
            <span class="c"># print(&#39;# Warning! Night {0} is not recorded as OPD night!&#39;. \</span>
                <span class="c"># format(fld))</span>
            <span class="c"># print(&#39;# Update the file {0}&#39;.format(nights))</span>
    <span class="c"># for night in lbadweath:</span>
        <span class="c"># if night not in lnights:</span>
            <span class="c"># print(&#39;# Warning! Bad weather {0} is not recorded as OPD &#39; +\</span>
                <span class="c"># &#39;night!&#39;.format(night))</span>
            <span class="c"># print(&#39;# Probably it is a spec night.&#39;)</span>
    <span class="c"># return</span>

</div>
<div class="viewcode-block" id="tefflum_dJN"><a class="viewcode-back" href="../pyhdust.html#pyhdust.tefflum_dJN">[docs]</a><span class="k">def</span> <span class="nf">tefflum_dJN</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Calculate the Teff and Lum from *s* and *b* variables from de Jager &amp; </span>
<span class="sd">    Niewuwenhuijzen (1987).</span>

<span class="sd">    return log10_T, log10_L (in Solar and Kelvin units)</span>

<span class="sd">    ====== ======== ==============</span>
<span class="sd">    Spec   s-value  s-step/0.1-Sp</span>
<span class="sd">    ====== ======== ==============</span>
<span class="sd">    01-09  0.1-0.9  0.1</span>
<span class="sd">    09-B2  0.9-1.8  0.3</span>
<span class="sd">    B2-A0  1.8-3.0  0.15</span>
<span class="sd">    A0-F0  3.0-4.0  0.1</span>
<span class="sd">    F0-G0  4.0-5.0  0.1</span>
<span class="sd">    G0-K0  5.0-5.5  0.05</span>
<span class="sd">    K0-M0  5.5-6.5  0.1</span>
<span class="sd">    M0-M10 6.5-8.5  0.2</span>
<span class="sd">    ====== ======== ==============</span>

<span class="sd">    ========== ========</span>
<span class="sd">    L class    b-value</span>
<span class="sd">    ========== ========</span>
<span class="sd">    V          5.0</span>
<span class="sd">    IV         4.0</span>
<span class="sd">    III        3.0</span>
<span class="sd">    II         2.0</span>
<span class="sd">    Ib         1.4</span>
<span class="sd">    Iab (or I) 1.0</span>
<span class="sd">    Ia         0.6</span>
<span class="sd">    Ia+        0.0</span>
<span class="sd">    ========== ========</span>

<span class="sd">    The calcs are made based on Chebyshev polynomials. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cij</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="o">+</span><span class="mf">3.82573</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.13868</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.46357</span><span class="p">,</span> <span class="o">+</span><span class="mf">0.02076</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.11937</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">1.55607</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.89216</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.96916</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.08869</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.20423</span><span class="p">],</span>
        <span class="p">[</span><span class="o">+</span><span class="mf">1.05165</span><span class="p">,</span> <span class="o">+</span><span class="mf">0.42330</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.94379</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.07438</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.01663</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.20024</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.18552</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.07576</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.10934</span><span class="p">],</span>
        <span class="p">[</span><span class="o">+</span><span class="mf">0.11008</span><span class="p">]]</span>

    <span class="n">dij</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="o">+</span><span class="mf">3.96105</span><span class="p">,</span> <span class="o">+</span><span class="mf">0.03165</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.02963</span><span class="p">,</span> <span class="o">+</span><span class="mf">0.01307</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01172</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.62945</span><span class="p">,</span> <span class="o">+</span><span class="mf">0.02596</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.06009</span><span class="p">,</span> <span class="o">+</span><span class="mf">0.01881</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01121</span><span class="p">],</span>
        <span class="p">[</span><span class="o">+</span><span class="mf">0.14370</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00977</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03265</span><span class="p">,</span> <span class="o">+</span><span class="mf">0.01649</span><span class="p">],</span>
        <span class="p">[</span><span class="o">+</span><span class="mf">0.00791</span><span class="p">,</span> <span class="o">+</span><span class="mf">0.00076</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03006</span><span class="p">],</span>
        <span class="p">[</span><span class="o">+</span><span class="mf">0.00723</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.02621</span><span class="p">],</span>
        <span class="p">[</span><span class="o">+</span><span class="mf">0.02755</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">Tk</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">k</span><span class="p">,</span> <span class="p">(</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">long</span> <span class="p">)</span> <span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Wrong Tk call! Invalid k&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">Tk</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">Tk</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="n">logL</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">n</span><span class="o">-</span><span class="n">i</span>
            <span class="n">logL</span> <span class="o">+=</span> <span class="n">cij</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">Tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="mf">4.25</span><span class="p">)</span><span class="o">/</span><span class="mf">4.25</span><span class="p">)</span><span class="o">*</span><span class="n">Tk</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mf">2.5</span><span class="p">)</span><span class="o">/</span><span class="mf">2.5</span><span class="p">)</span>
    <span class="n">logT</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">n</span><span class="o">-</span><span class="n">i</span>
            <span class="n">logT</span> <span class="o">+=</span> <span class="n">dij</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">Tk</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="mf">4.25</span><span class="p">)</span><span class="o">/</span><span class="mf">4.25</span><span class="p">)</span><span class="o">*</span><span class="n">Tk</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mf">2.5</span><span class="p">)</span><span class="o">/</span><span class="mf">2.5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">logT</span><span class="p">,</span> <span class="n">logL</span>

</div>
<div class="viewcode-block" id="masslum_OB"><a class="viewcode-back" href="../pyhdust.html#pyhdust.masslum_OB">[docs]</a><span class="k">def</span> <span class="nf">masslum_OB</span><span class="p">(</span><span class="n">logL</span><span class="p">,</span> <span class="n">classL</span><span class="o">=</span><span class="s">&#39;V&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Mass determination based on luminosity and class (Claret 2004). </span>

<span class="sd">    Warning! Valid only for late O to late B range (ie., Be stars).</span>

<span class="sd">    return log10_M (solar units)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1997</span><span class="p">,</span> <span class="mf">0.0844</span><span class="p">,</span> <span class="mf">0.0312</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">classL</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;IV&#39;</span><span class="p">:</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2055</span><span class="p">,</span> <span class="mf">0.0746</span><span class="p">,</span> <span class="mf">0.0322</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">classL</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;III&#39;</span><span class="p">:</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2084</span><span class="p">,</span> <span class="mf">0.0643</span><span class="p">,</span> <span class="mf">0.0325</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">classL</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&#39;V&#39;</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Warning! Invalid &quot;classL&quot;. Assuming &quot;V&quot; for masslum_OB...&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">cs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">logL</span> <span class="o">+</span> <span class="n">cs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">logL</span><span class="o">**</span><span class="mi">2</span>

<span class="c"># MAIN ###</span></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">Python tools for the BeACoN group Beta documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015-2016, D. Moser.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>