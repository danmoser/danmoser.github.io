<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pyhdust.interftools &mdash; Python tools for the BeACoN group Beta documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     'Beta',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Python tools for the BeACoN group Beta documentation" href="../../index.html" />
    <link rel="up" title="pyhdust" href="../pyhdust.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Python tools for the BeACoN group Beta documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li>
          <li><a href="../pyhdust.html" accesskey="U">pyhdust</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pyhdust.interftools</h1><div class="highlight"><pre>
<span class="c"># -*- coding:utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;PyHdust *interftools* module: interferometry tools</span>

<span class="sd">`colors` keep the *amdlib* standard.</span>

<span class="sd">A biblioteca python XDRLIB eh MUITO lenta... Usa muitas listas!!!</span>

<span class="sd">&gt;&gt;&gt; import xdrlib</span>

<span class="sd">A biblioteca PYDAP estah em desenvolvimento... Eh complicada de usar</span>

<span class="sd">&gt;&gt;&gt; from pydap.model import *</span>
<span class="sd">&gt;&gt;&gt; from pydap.xdr import DapUnpacker</span>
<span class="sd">&gt;&gt;&gt; base_int = BaseType(name=&#39;base_int&#39;)</span>
<span class="sd">&gt;&gt;&gt; base_float = BaseType(name=&#39;base_float&#39;, type=Float32)</span>

<span class="sd">Todas as leituras binarias baseiam-se no struct.</span>

<span class="sd">- Rotines based on images (np.array matrix)</span>
<span class="sd">- Rotines based on oifiles</span>
<span class="sd">- Rotines based on HDUST (maps/data)</span>
<span class="sd">- Other?</span>

<span class="sd">:license: GNU GPL v3.0 https://github.com/danmoser/pyhdust/blob/master/LICENSE</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span> <span class="kn">as</span> <span class="nn">_os</span>
<span class="kn">import</span> <span class="nn">struct</span> <span class="kn">as</span> <span class="nn">_struct</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">_np</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span> <span class="k">as</span> <span class="n">_glob</span>
<span class="kn">import</span> <span class="nn">pyhdust.phc</span> <span class="kn">as</span> <span class="nn">_phc</span>
<span class="kn">import</span> <span class="nn">pyhdust.tabulate</span> <span class="kn">as</span> <span class="nn">_tab</span>
<span class="kn">import</span> <span class="nn">pyhdust.oifits</span> <span class="kn">as</span> <span class="nn">_oifits</span>
<span class="kn">from</span> <span class="nn">pyhdust.spectools</span> <span class="kn">import</span> <span class="n">linfit</span> <span class="k">as</span> <span class="n">_linfit</span>
<span class="kn">import</span> <span class="nn">copy</span> <span class="kn">as</span> <span class="nn">_copy</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">_plt</span>
    <span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="kn">as</span> <span class="nn">_gridspec</span>
    <span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="kn">as</span> <span class="nn">_mtick</span>
    <span class="kn">from</span> <span class="nn">matplotlib.lines</span> <span class="kn">import</span> <span class="n">Line2D</span> <span class="k">as</span> <span class="n">_Line2D</span>
    <span class="kn">import</span> <span class="nn">pyfits</span> <span class="kn">as</span> <span class="nn">_pyfits</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Warning! matplotlib and/or pyfits module not installed!!!&#39;</span><span class="p">)</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s">&quot;Daniel Moser&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s">&quot;dmfaes@gmail.com&quot;</span>


<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="s">&quot;green&quot;</span><span class="p">,</span> <span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="s">&quot;black&quot;</span><span class="p">]</span>


<div class="viewcode-block" id="log_transform"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.log_transform">[docs]</a><span class="k">def</span> <span class="nf">log_transform</span><span class="p">(</span><span class="n">im</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns log(image) scaled to the interval [0,1]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="p">(</span><span class="n">imin</span><span class="p">,</span> <span class="n">imax</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">im</span><span class="p">[</span><span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">im</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]),</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">im</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">imax</span> <span class="o">&gt;</span> <span class="n">imin</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">imax</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">im</span> <span class="o">=</span> <span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">imin</span><span class="p">,</span> <span class="n">imax</span><span class="p">))</span><span class="o">-</span><span class="n">_np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">imin</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
                <span class="n">_np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">imax</span><span class="p">)</span><span class="o">-</span><span class="n">_np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">imin</span><span class="p">))</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">im</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">im</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">NaN</span>
            <span class="k">return</span> <span class="n">im</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;#Warning! The image could not be normalized !!!&#39;</span><span class="p">)</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">im</span>

</div>
<div class="viewcode-block" id="imshowl"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.imshowl">[docs]</a><span class="k">def</span> <span class="nf">imshowl</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&#39;gist_heat&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s">&#39;lower&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Plot the normalized image in log-scale.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">log_transform</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">_plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">),</span> <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="readmap"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.readmap">[docs]</a><span class="k">def</span> <span class="nf">readmap</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read *Hdust* MAP or MAPS files.</span>

<span class="sd">    `mapimg`: extract this component from the *.map* file.</span>

<span class="sd">        - 0 = total flux</span>
<span class="sd">        - 1 = transmitted flux</span>
<span class="sd">        - 2 = scattered flux</span>
<span class="sd">        - 3 = emitted flux</span>
<span class="sd">        - 4 = pol. *Q* flux</span>
<span class="sd">        - 5 = pol. *U* flux</span>
<span class="sd">        - 6 = pol. *V* flux</span>

<span class="sd">    OUTPUT = data, obslist, lbdc, Ra, xmax</span>

<span class="sd">        - data = image matrix</span>
<span class="sd">        - obslist = observers info (*i*, :math:`\phi`)</span>
<span class="sd">        - lbdc = central :math:`\lambda`</span>
<span class="sd">        - Ra = ?</span>
<span class="sd">        - xmax = image size in Rsun untis</span>

<span class="sd">    | data(nimgs,nobs,nlbd,ny,nx,dfact)</span>
<span class="sd">    | .map, dfact = 6</span>
<span class="sd">    | .maps, dfact = 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">file</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&#39;.map&#39;</span><span class="p">:</span>
        <span class="n">dfact</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="k">elif</span> <span class="nb">file</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&#39;.maps&#39;</span><span class="p">:</span>
        <span class="n">dfact</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;# ERROR: This is not a HDUST valid image!&#39;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="c">#</span>
    <span class="n">ixdr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nobs</span><span class="p">,</span> <span class="n">lnum</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="n">_struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&gt;4l&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">ixdr</span><span class="p">:</span><span class="n">ixdr</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">4</span><span class="p">])</span>
    <span class="n">ixdr</span> <span class="o">+=</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">4</span>
    <span class="n">Ra</span><span class="p">,</span> <span class="n">Rstar</span><span class="p">,</span> <span class="n">Lratio</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">_struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&gt;4f&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">ixdr</span><span class="p">:</span><span class="n">ixdr</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">4</span><span class="p">])</span>
    <span class="n">ixdr</span> <span class="o">+=</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">4</span>
    <span class="c"># nf no IDL estah como DOUBLE, mas com certea eh float ou int...</span>
    <span class="c"># caso contrario nm nao faz sentido.</span>
    <span class="n">nf</span> <span class="o">=</span> <span class="n">_struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&gt;f&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">ixdr</span><span class="p">:</span><span class="n">ixdr</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">4</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ixdr</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">4</span>
    <span class="n">nm</span> <span class="o">=</span> <span class="n">_struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&gt;l&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">ixdr</span><span class="p">:</span><span class="n">ixdr</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">4</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ixdr</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">4</span>

    <span class="n">npxs</span> <span class="o">=</span> <span class="n">nm</span>
    <span class="n">upck</span> <span class="o">=</span> <span class="s">&#39;&gt;{}f&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">npxs</span><span class="p">)</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">_struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">upck</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">ixdr</span><span class="p">:</span><span class="n">ixdr</span> <span class="o">+</span> <span class="n">npxs</span> <span class="o">*</span> <span class="mi">4</span><span class="p">])</span> <span class="p">)</span>
    <span class="n">ixdr</span> <span class="o">+=</span> <span class="n">npxs</span> <span class="o">*</span> <span class="mi">4</span>

    <span class="k">if</span> <span class="nb">file</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&#39;.map&#39;</span><span class="p">:</span>
        <span class="c"># tmp must be a &quot;small&quot; array. Otherwise, a MemoryError will be raised</span>
        <span class="n">npxs</span> <span class="o">=</span> <span class="n">nx</span> <span class="o">*</span> <span class="n">ny</span> <span class="o">*</span> <span class="n">lnum</span> <span class="o">*</span> <span class="n">nobs</span> <span class="o">*</span> <span class="n">nm</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">npxs</span> <span class="o">*</span> <span class="n">dfact</span><span class="p">))</span>
        <span class="n">upck</span> <span class="o">=</span> <span class="s">&#39;&gt;{}f&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">npxs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dfact</span><span class="p">):</span>
            <span class="c"># skip first npxs... See below</span>
            <span class="n">tmp</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">npxs</span><span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">npxs</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">_struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">upck</span><span class="p">,</span>
            <span class="n">f</span><span class="p">[</span><span class="n">ixdr</span><span class="p">:</span><span class="n">ixdr</span> <span class="o">+</span> <span class="n">npxs</span> <span class="o">*</span> <span class="mi">4</span><span class="p">])</span> <span class="p">)</span>
            <span class="n">ixdr</span> <span class="o">+=</span> <span class="n">npxs</span> <span class="o">*</span> <span class="mi">4</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nm</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="n">lnum</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">dfact</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dfact</span><span class="p">):</span>
            <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">::</span><span class="n">dfact</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span>
                <span class="n">nm</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="n">lnum</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>
        <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span>\
            <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="c">#</span>
    <span class="k">elif</span> <span class="nb">file</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&#39;.maps&#39;</span><span class="p">:</span>
        <span class="n">npxs</span> <span class="o">=</span> <span class="n">dfact</span> <span class="o">*</span> <span class="n">nx</span> <span class="o">*</span> <span class="n">ny</span> <span class="o">*</span> <span class="n">lnum</span> <span class="o">*</span> <span class="n">nobs</span> <span class="o">*</span> <span class="n">nm</span>
        <span class="n">upck</span> <span class="o">=</span> <span class="s">&#39;&gt;{}f&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">npxs</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">_struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">upck</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">ixdr</span><span class="p">:</span><span class="n">ixdr</span> <span class="o">+</span> <span class="n">npxs</span> <span class="o">*</span> <span class="mi">4</span><span class="p">])</span> <span class="p">)</span><span class="o">.</span>\
            <span class="n">reshape</span><span class="p">((</span><span class="n">nm</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="n">lnum</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>
        <span class="n">ixdr</span> <span class="o">+=</span> <span class="n">npxs</span> <span class="o">*</span> <span class="mi">4</span>

    <span class="n">npxs</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nobs</span>
    <span class="n">upck</span> <span class="o">=</span> <span class="s">&#39;&gt;{}f&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">npxs</span><span class="p">)</span>
    <span class="n">obslist</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">_struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">upck</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">ixdr</span><span class="p">:</span><span class="n">ixdr</span> <span class="o">+</span> <span class="n">npxs</span> <span class="o">*</span> <span class="mi">4</span><span class="p">])</span> <span class="p">)</span>
    <span class="n">ixdr</span> <span class="o">+=</span> <span class="n">npxs</span> <span class="o">*</span> <span class="mi">4</span>

    <span class="n">npxs</span> <span class="o">=</span> <span class="n">lnum</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">upck</span> <span class="o">=</span> <span class="s">&#39;&gt;{}f&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">npxs</span><span class="p">)</span>
    <span class="n">lbdarr</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">_struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">upck</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">ixdr</span><span class="p">:</span><span class="n">ixdr</span> <span class="o">+</span> <span class="n">npxs</span> <span class="o">*</span> <span class="mi">4</span><span class="p">])</span> <span class="p">)</span>
    <span class="n">ixdr</span> <span class="o">+=</span> <span class="n">npxs</span> <span class="o">*</span> <span class="mi">4</span>

    <span class="c"># this will check if the XDR is finished.</span>
    <span class="k">if</span> <span class="n">ixdr</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;# XDR {} completely read!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">file</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Warning: XDR {} not completely read!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">file</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;# length difference is {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">-</span> <span class="n">ixdr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span> <span class="p">)</span> <span class="p">)</span>

    <span class="c"># lbdarr tem lnum+1, pois reflete o INTERVALO de cada imagem.</span>
    <span class="c"># Para termos o lambda central de cada imagem, fazemos o seguinte:</span>
    <span class="n">lbdc</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">lnum</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lnum</span><span class="p">):</span>
        <span class="n">lbdc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lbdarr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">lbdarr</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span>

    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">obslist</span><span class="p">,</span> <span class="n">lbdc</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">xmax</span>

</div>
<div class="viewcode-block" id="img2fits"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.img2fits">[docs]</a><span class="k">def</span> <span class="nf">img2fits</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">lbd</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">outname</span><span class="o">=</span><span class="s">&#39;model&#39;</span><span class="p">,</span> <span class="n">rot</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">lum</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
    <span class="n">orient</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">coordsinf</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ulbd</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Export an image (e.g., data[0,0,0,:,:]) to the fits format.</span>

<span class="sd">    `lbd` is the wavelength value and the dimension is kept as it is. It must</span>
<span class="sd">    be in meters for JMMC softwares (ASPRO2/LITPRO).</span>

<span class="sd">    `ulbd` units of the lbd.</span>

<span class="sd">    `rot` = rotation angle to be applied to the images. &#39;x&#39; and &#39;y&#39; coordinate</span>
<span class="sd">    axes should be orientated with equatorial north corresponding to &#39;up&#39; (and</span>
<span class="sd">    east == &#39;left&#39;). Units according to `deg` bool.</span>

<span class="sd">    `orient` = orientation of the coordinate system. This is completely</span>
<span class="sd">    independent of the `rot` variable. Units according to `deg` bool.</span>

<span class="sd">    `lum` = luminosity given in Solar units.</span>
<span class="sd">    BUNIT sets the units of the image. Considering that HDUST images</span>
<span class="sd">    give the pixels counts as :math:`F_\lambda/F`, the same correction as done</span>
<span class="sd">    to BeAtlas is performed, and the final results are in 10^-17</span>
<span class="sd">    erg/s/cm^2/Ang. If `lum` = 0, no change is done.</span>

<span class="sd">    `coordsinf` = [RA,DEC], as [&#39;21:51:12.055&#39;, &#39;+28:51:38.72&#39;]</span>

<span class="sd">    `deg` = angles in degrees (instead of radians).</span>

<span class="sd">    Example: image at 21 cm, rotated 45 degrees, 2 AU long at 10 parsecs.</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        img = np.arange(900).reshape((30,30))</span>

<span class="sd">        intt.img2fits(img, 21., [2*phc.au.cgs/phc.Rsun.cgs], 10, orient=45.,</span>
<span class="sd">        coordsinf=[&#39;21:51:12.055&#39;, &#39;-28:51:38.72&#39;], ulbd=&#39;cm&#39;, deg=True)</span>

<span class="sd">    .. image:: _static/modelfits.png</span>
<span class="sd">        :align: center</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        intt.img2fits(img, 21., [2*phc.au.cgs/phc.Rsun.cgs], 10, rot=45.,</span>
<span class="sd">        coordsinf=[&#39;21:51:12.055&#39;, &#39;-28:51:38.72&#39;], ulbd=&#39;cm&#39;, deg=True,</span>
<span class="sd">        outname=&#39;model_rotated&#39;)</span>

<span class="sd">    .. image:: _static/modelrotfits.png</span>
<span class="sd">        :align: center</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">deg</span><span class="p">:</span>
        <span class="n">rot</span> <span class="o">=</span> <span class="n">rot</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>
        <span class="n">ucdelt</span> <span class="o">=</span> <span class="s">&#39;degrees&#39;</span>
        <span class="n">ushort</span> <span class="o">=</span> <span class="s">&#39;deg&#39;</span>
        <span class="n">orientr</span> <span class="o">=</span> <span class="n">orient</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ucdelt</span> <span class="o">=</span> <span class="s">&#39;radians&#39;</span>
        <span class="n">ushort</span> <span class="o">=</span> <span class="s">&#39;rad&#39;</span>
        <span class="n">orientr</span> <span class="o">=</span> <span class="n">orient</span>
        <span class="n">orient</span> <span class="o">=</span> <span class="n">orient</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
    <span class="c">#</span>
    <span class="k">if</span> <span class="n">rot</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="c"># print(&#39;# Total flux BEFORE rotation {0}&#39;.format(_np.sum(img)))</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">rotate_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">rot</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
        <span class="c"># print(&#39;# Total flux AFTER rotation {0}\n&#39;.format(_np.sum(img)))</span>
    <span class="k">if</span> <span class="n">lum</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span> <span class="o">*</span> <span class="p">(</span><span class="n">lum</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Lsun</span><span class="o">.</span><span class="n">cgs</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> \
            <span class="p">(</span><span class="n">dist</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">cgs</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">1e-4</span> <span class="o">*</span> <span class="mf">1e17</span>
    <span class="c">#</span>
    <span class="n">hdu</span> <span class="o">=</span> <span class="n">_pyfits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">(</span><span class="n">img</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
    <span class="n">hdulist</span> <span class="o">=</span> <span class="n">_pyfits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">([</span><span class="n">hdu</span><span class="p">])</span>
    <span class="n">pixsize</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">ang_per_pixel</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">pixsize</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Rsun</span><span class="o">.</span><span class="n">cgs</span> <span class="o">/</span> <span class="p">(</span><span class="n">dist</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">cgs</span><span class="p">))</span>
    <span class="c"># *60.*60.*1000.*180./_np.pi)</span>
    <span class="k">if</span> <span class="n">deg</span><span class="p">:</span>
        <span class="n">ang_per_pixel</span> <span class="o">*=</span> <span class="mf">180.</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
    <span class="c">#</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CDELT1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">ang_per_pixel</span><span class="p">,</span> <span class="n">ucdelt</span><span class="p">)</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CDELT2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ang_per_pixel</span><span class="p">,</span> <span class="n">ucdelt</span><span class="p">)</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CDELT3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="n">ulbd</span><span class="p">)</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CRVAL3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lbd</span><span class="p">,</span> <span class="n">ulbd</span><span class="p">)</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;NAXIS1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;NAXIS2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CRPIX1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CRPIX2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CPPIX1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CPPIX2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CROTA2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s">&#39;{0:.3f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">orient</span><span class="p">)),</span> <span class="s">&#39;degrees&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lum</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;BUNIT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;10^-17 erg/s/cm^2/Ang&#39;</span>
    <span class="k">if</span> <span class="n">coordsinf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CTYPE1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;RA---TAN&#39;</span>  <span class="c"># &#39;GLON-CAR&#39;</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CTYPE2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;DEC--TAN&#39;</span>  <span class="c"># &#39;GLON-CAR&#39;</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;RA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coordsinf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;DEC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coordsinf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c"># hdulist[0].header[&#39;RADECSYS&#39;] = &#39;FK5&#39;</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;EQUINOX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2000.0</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CRVAL1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">ra2degf</span><span class="p">(</span><span class="n">coordsinf</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s">&#39;degrees&#39;</span><span class="p">)</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CRVAL2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">dec2degf</span><span class="p">(</span><span class="n">coordsinf</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="s">&#39;degrees&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CRVAL1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CRVAL2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CROTA1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.000</span><span class="p">,</span> <span class="s">&#39;degrees&#39;</span><span class="p">)</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CD1_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">ang_per_pixel</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">orientr</span><span class="p">),</span> <span class="n">ucdelt</span><span class="p">)</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CD1_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">ang_per_pixel</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">orientr</span><span class="p">),</span> <span class="n">ucdelt</span><span class="p">)</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CD2_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ang_per_pixel</span> <span class="o">*</span> <span class="o">-</span><span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">orientr</span><span class="p">),</span> <span class="n">ucdelt</span><span class="p">)</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CD2_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ang_per_pixel</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">orientr</span><span class="p">),</span> <span class="n">ucdelt</span><span class="p">)</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CUNIT1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ushort</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CUNIT2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ushort</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;LONPOLE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">180.000</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;LATPOLE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.000</span>
    <span class="n">outname</span> <span class="o">=</span> <span class="s">&#39;{0}.fits&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;.fits&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">))</span>
    <span class="n">hdu</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">outname</span><span class="p">,</span> <span class="n">clobber</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Saved {0} !&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outname</span><span class="p">))</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="data2fitscube"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.data2fitscube">[docs]</a><span class="k">def</span> <span class="nf">data2fitscube</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">lbdc</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">outname</span><span class="o">=</span><span class="s">&#39;model&#39;</span><span class="p">,</span>
    <span class="n">orient</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">rot</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">lum</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">coordsinf</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">map</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Export a set of images (e.g., data[zoom,obs,:,:,:]) to the fits cube</span>
<span class="sd">    format.</span>

<span class="sd">    `map` = if `data` is a *.map file, set it to True. Leave false to *.maps.</span>

<span class="sd">    `lbdc` is the wavelength array and the dimension is kept as it is. It must</span>
<span class="sd">    be in meters for JMMC softwares (ASPRO2/LITPRO).</span>

<span class="sd">    `rot` = rotation angle to be applied to the images. &#39;x&#39; and &#39;y&#39; coordinate</span>
<span class="sd">    axes should be orientated with equatorial north corresponding to &#39;up&#39; (and</span>
<span class="sd">    east == &#39;left&#39;). Units in Degrees.</span>

<span class="sd">    `orient` = orientation of the coordinate system. This is completely</span>
<span class="sd">    independent of the `rot` variable.</span>

<span class="sd">    `lum` = luminosity given in Solar units.</span>
<span class="sd">    BUNIT sets the units of the image. Considering that HDUST images</span>
<span class="sd">    give the pixels counts as :math:`F_\lambda/F`, the same correction as done</span>
<span class="sd">    to BeAtlas is performed, and the final results are in 10^-17</span>
<span class="sd">    erg/s/cm^2/Ang. If `lum` = 0, no change is done.</span>

<span class="sd">    `coordsinf` = [RA,DEC].</span>
<span class="sd">    Example: [&#39;21:51:12.055&#39;, &#39;+28:51:38.72&#39;]</span>

<span class="sd">    `deg` = angles in degrees (instead of radians).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">deg</span><span class="p">:</span>
        <span class="n">rot</span> <span class="o">=</span> <span class="n">rot</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>
        <span class="n">ucdelt</span> <span class="o">=</span> <span class="s">&#39;degrees&#39;</span>
        <span class="n">ushort</span> <span class="o">=</span> <span class="s">&#39;deg&#39;</span>
        <span class="n">orientr</span> <span class="o">=</span> <span class="n">orient</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ucdelt</span> <span class="o">=</span> <span class="s">&#39;radians&#39;</span>
        <span class="n">ushort</span> <span class="o">=</span> <span class="s">&#39;rad&#39;</span>
        <span class="n">orientr</span> <span class="o">=</span> <span class="n">orient</span>
        <span class="n">orient</span> <span class="o">=</span> <span class="n">orientr</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">ulbd</span> <span class="o">=</span> <span class="s">&#39;meters&#39;</span>
    <span class="c">#</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">map</span><span class="p">:</span>
        <span class="n">imgs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">zoom</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="p">:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">imgs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">zoom</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="p">:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="c">#</span>
    <span class="k">if</span> <span class="n">rot</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;# ERROR! Rotation of CUBES not yet implemented!&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lum</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c"># iL = _phc.fltTxtOccur(&#39;L =&#39;, lines, seq=2)*_phc.Lsun.cgs</span>
        <span class="n">imgs</span> <span class="o">=</span> <span class="n">imgs</span> <span class="o">*</span> <span class="p">(</span><span class="n">lum</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Lsun</span><span class="o">.</span><span class="n">cgs</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="n">dist</span> <span class="o">*</span>
            <span class="n">_phc</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">cgs</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">1e-4</span> <span class="o">*</span> <span class="mf">1e17</span>
    <span class="c">#</span>
    <span class="n">hdu</span> <span class="o">=</span> <span class="n">_pyfits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">(</span><span class="n">imgs</span><span class="p">)</span>
    <span class="n">hdulist</span> <span class="o">=</span> <span class="n">_pyfits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">([</span><span class="n">hdu</span><span class="p">])</span>
    <span class="n">pixsize</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">zoom</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
    <span class="n">ang_per_pixel</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">pixsize</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Rsun</span><span class="o">.</span><span class="n">cgs</span> <span class="o">/</span> <span class="p">(</span><span class="n">dist</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">cgs</span><span class="p">))</span>
    <span class="c"># *60.*60.*1000.*180./_np.pi)</span>
    <span class="k">if</span> <span class="n">deg</span><span class="p">:</span>
        <span class="n">ang_per_pixel</span> <span class="o">*=</span> <span class="mf">180.</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
    <span class="c">#</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CDELT1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">ang_per_pixel</span><span class="p">,</span> <span class="n">ucdelt</span><span class="p">)</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CDELT2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ang_per_pixel</span><span class="p">,</span> <span class="n">ucdelt</span><span class="p">)</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CDELT3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">lbdc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lbdc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">lbdc</span><span class="p">),</span> <span class="n">ulbd</span><span class="p">)</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CRVAL3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lbdc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ulbd</span><span class="p">)</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;NAXIS1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">imgs</span><span class="p">)</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;NAXIS2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">imgs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CRPIX1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">imgs</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CRPIX2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">imgs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CPPIX1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">imgs</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CPPIX2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">imgs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CROTA2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s">&#39;{0:.3f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">orient</span><span class="p">)),</span> <span class="s">&#39;degrees&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lum</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;BUNIT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;10^-17 erg/s/cm^2/Ang&#39;</span>
    <span class="k">if</span> <span class="n">coordsinf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CTYPE1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;RA---TAN&#39;</span>  <span class="c"># &#39;GLON-CAR&#39;</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CTYPE2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;DEC--TAN&#39;</span>  <span class="c"># &#39;GLON-CAR&#39;</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;RA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coordsinf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;DEC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coordsinf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c"># hdulist[0].header[&#39;RADECSYS&#39;] = &#39;FK5&#39;</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;EQUINOX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2000.0</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CRVAL1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">ra2degf</span><span class="p">(</span><span class="n">coordsinf</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s">&#39;degrees&#39;</span><span class="p">)</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CRVAL2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">dec2degf</span><span class="p">(</span><span class="n">coordsinf</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="s">&#39;degrees&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CRVAL1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CRVAL2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CROTA1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.000</span><span class="p">,</span> <span class="s">&#39;degrees&#39;</span><span class="p">)</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CD1_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">ang_per_pixel</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">orientr</span><span class="p">),</span> <span class="n">ucdelt</span><span class="p">)</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CD1_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">ang_per_pixel</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">orientr</span><span class="p">),</span> <span class="n">ucdelt</span><span class="p">)</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CD2_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ang_per_pixel</span> <span class="o">*</span> <span class="o">-</span><span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">orientr</span><span class="p">),</span> <span class="n">ucdelt</span><span class="p">)</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CD2_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ang_per_pixel</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">orientr</span><span class="p">),</span> <span class="n">ucdelt</span><span class="p">)</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CUNIT1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ushort</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CUNIT2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ushort</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;LONPOLE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">180.000</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;LATPOLE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.000</span>
    <span class="n">outname</span> <span class="o">=</span> <span class="s">&#39;{0}.fits&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;.fits&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">))</span>
    <span class="n">hdu</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">outname</span><span class="p">,</span> <span class="n">clobber</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Saved {0} !&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outname</span><span class="p">))</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="setspacecoords"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.setspacecoords">[docs]</a><span class="k">def</span> <span class="nf">setspacecoords</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">rad_per_pixel</span><span class="p">,</span> <span class="n">xc</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">yc</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    return xx and yy, 2D physical coordinates in ANGULAR dimensions</span>
<span class="sd">    (unit = defined by &#39;rad_per_pixel&#39;, i.e., radians).</span>
<span class="sd">    The physical scale (or length) on both axis must be the same.</span>

<span class="sd">    xc and yc are the the center position in PIXELS</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">+</span> <span class="n">xc</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">rad_per_pixel</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">ny</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">+</span> <span class="n">yc</span>
    <span class="n">yy</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span> <span class="o">*</span> <span class="n">rad_per_pixel</span>
    <span class="k">return</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span>

</div>
<div class="viewcode-block" id="fastnumvis"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.fastnumvis">[docs]</a><span class="k">def</span> <span class="nf">fastnumvis</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">lbd</span><span class="p">,</span> <span class="n">Bproj</span><span class="p">,</span> <span class="n">PA</span><span class="p">,</span> <span class="n">rad_per_pixel</span><span class="p">,</span> <span class="n">PAdisk</span><span class="o">=</span><span class="mf">90.</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For a given image (in phys.units = `rad_per_pixel`) and a interf. setup,</span>
<span class="sd">        it returns the visibility and phase.</span>

<span class="sd">    `PA` and `PAdisk` in degrees.</span>

<span class="sd">    `Bproj` and `lbd` must have the same units (m).</span>

<span class="sd">    output: complexVis, VisAmp, VisPhase</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">lbd</span> <span class="o">&lt;</span> <span class="mf">1e-6</span> <span class="ow">or</span> <span class="n">lbd</span> <span class="o">&gt;</span> <span class="mf">4e-6</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Warning! *fastnumvis*(lbd) is {.1e} m!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lbd</span><span class="p">))</span>
    <span class="n">PA</span> <span class="o">=</span> <span class="n">PA</span> <span class="o">-</span> <span class="n">PAdisk</span> <span class="o">+</span> <span class="mf">90.</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">img</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">u</span> <span class="o">=</span> <span class="n">Bproj</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PA</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="mf">180.</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">/</span> <span class="n">lbd</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">Bproj</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PA</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="mf">180.</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">/</span> <span class="n">lbd</span><span class="p">)</span>
    <span class="c"># print PA,phc.ra2deg,lbd,Bproj,v</span>

    <span class="n">ny</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">nx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">setspacecoords</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">rad_per_pixel</span><span class="p">,</span> <span class="n">xc</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">yc</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>

    <span class="n">arg</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">xx</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span> <span class="o">+</span> <span class="n">yy</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">)</span>
    <span class="n">TF_z_re</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
    <span class="n">TF_z_im</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
    <span class="c"># print TF_z_re,TF_z_im</span>

    <span class="n">TF_z</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">(</span><span class="n">TF_z_re</span><span class="p">,</span> <span class="n">TF_z_im</span><span class="p">)</span>
    <span class="n">TF_z0</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

    <span class="n">complexVis</span> <span class="o">=</span> <span class="n">TF_z</span> <span class="o">/</span> <span class="n">TF_z0</span>

    <span class="n">VisAmp</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">complexVis</span><span class="p">)</span>
    <span class="n">VisPhase</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span>
        <span class="n">complexVis</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">complexVis</span><span class="o">.</span><span class="n">real</span><span class="p">)</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="mf">180.</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">complexVis</span><span class="p">,</span> <span class="n">VisAmp</span><span class="p">,</span> <span class="n">VisPhase</span>

</div>
<div class="viewcode-block" id="fastnumvis3"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.fastnumvis3">[docs]</a><span class="k">def</span> <span class="nf">fastnumvis3</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">lbd</span><span class="p">,</span> <span class="n">Bprojs</span><span class="p">,</span> <span class="n">PAs</span><span class="p">,</span> <span class="n">rad_per_pixel</span><span class="p">,</span> <span class="n">PAdisk</span><span class="o">=</span><span class="mf">90.</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; For a given image (in phys.units = `rad_per_pixel`) and 3 telescopes</span>
<span class="sd">    interferometric setup, it returns the visibility and closure phase.</span>

<span class="sd">    Is </span>

<span class="sd">    `PA` as array/list (two values) and `PAdisk` in degrees.</span>

<span class="sd">    `Bproj` as array/list (two values) and `lbd` must have the same units (m).</span>

<span class="sd">    output: complexVis, VisAmp, VisPhase (closure phase)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u1</span> <span class="o">=</span> <span class="n">Bprojs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PAs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span><span class="p">)</span>
    <span class="n">u2</span> <span class="o">=</span> <span class="n">Bprojs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PAs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span><span class="p">)</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">Bprojs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PAs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span><span class="p">)</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="n">Bprojs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PAs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span><span class="p">)</span>
    <span class="n">B3</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">u1</span> <span class="o">+</span> <span class="n">u2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">v1</span> <span class="o">+</span> <span class="n">v2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
    <span class="n">PA3</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span> <span class="n">u1</span> <span class="o">+</span> <span class="n">u2</span><span class="p">,</span> <span class="n">v1</span> <span class="o">+</span> <span class="n">v2</span> <span class="p">)</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>

    <span class="n">cV1</span><span class="p">,</span> <span class="n">VA1</span><span class="p">,</span> <span class="n">VP1</span> <span class="o">=</span> <span class="n">fastnumvis</span><span class="p">(</span>
        <span class="n">img</span><span class="p">,</span> <span class="n">lbd</span><span class="p">,</span> <span class="n">Bprojs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rad_per_pixel</span><span class="p">,</span> <span class="n">PAdisk</span><span class="o">=</span><span class="n">PAdisk</span><span class="p">)</span>
    <span class="n">cV2</span><span class="p">,</span> <span class="n">VA2</span><span class="p">,</span> <span class="n">VP2</span> <span class="o">=</span> <span class="n">fastnumvis</span><span class="p">(</span>
        <span class="n">img</span><span class="p">,</span> <span class="n">lbd</span><span class="p">,</span> <span class="n">Bprojs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rad_per_pixel</span><span class="p">,</span> <span class="n">PAdisk</span><span class="o">=</span><span class="n">PAdisk</span><span class="p">)</span>
    <span class="n">cV3</span><span class="p">,</span> <span class="n">VA3</span><span class="p">,</span> <span class="n">VP3</span> <span class="o">=</span> <span class="n">fastnumvis</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">lbd</span><span class="p">,</span> <span class="n">B3</span><span class="p">,</span> <span class="n">PA3</span><span class="p">,</span> <span class="n">rad_per_pixel</span><span class="p">,</span> <span class="n">PAdisk</span><span class="o">=</span><span class="n">PAdisk</span><span class="p">)</span>

    <span class="n">complexVis</span> <span class="o">=</span> <span class="n">cV1</span> <span class="o">*</span> <span class="n">cV2</span> <span class="o">*</span> <span class="n">cV3</span><span class="o">.</span><span class="n">conjugate</span><span class="p">()</span>

    <span class="n">VisAmp</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">complexVis</span><span class="p">)</span>
    <span class="n">VisPhase</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span>
        <span class="n">complexVis</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">complexVis</span><span class="o">.</span><span class="n">real</span><span class="p">)</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="mf">180.</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">complexVis</span><span class="p">,</span> <span class="n">VisAmp</span><span class="p">,</span> <span class="n">VisPhase</span>

</div>
<div class="viewcode-block" id="reversePAs"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.reversePAs">[docs]</a><span class="k">def</span> <span class="nf">reversePAs</span><span class="p">(</span><span class="n">PAs</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot; Calculte the reverse of the PAs input range.</span>

<span class="sd">    OUTPUT: PArv (list, units deg)</span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="n">PArv</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">PArv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># PArv[0] == 0 must be -180!</span>
        <span class="n">PArv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">180</span>
    <span class="k">if</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c"># PArv[1] == 0 must be +180!</span>
        <span class="n">PArv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">PArv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">180</span>
    <span class="k">return</span> <span class="n">PArv</span>

</div>
<div class="viewcode-block" id="oiClass"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.oiClass">[docs]</a><span class="k">class</span> <span class="nc">oiClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; PyHdust class for interferometric data. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oitype</span><span class="p">,</span> <span class="n">oifile</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oitype</span> <span class="o">=</span> <span class="n">oitype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oifile</span> <span class="o">=</span> <span class="n">oifile</span>

    <span class="k">def</span> <span class="nf">readvis2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oidata_vis2</span><span class="p">):</span>
        <span class="n">tlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v2i</span> <span class="ow">in</span> <span class="n">oidata_vis2</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">v2i</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">v2i</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">v2i</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> 
                    <span class="n">v2i</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&#39;unnamed&#39;</span><span class="p">])</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">v2i</span><span class="o">.</span><span class="n">ucoord</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v2i</span><span class="o">.</span><span class="n">vcoord</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)])</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">])</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">v2i</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">])</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v2i</span><span class="o">.</span><span class="n">vis2data</span><span class="p">)])</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v2i</span><span class="o">.</span><span class="n">vis2err</span><span class="p">)])</span>
        <span class="c"># print tlist</span>
        <span class="c"># tlist = _np.array(tlist)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v2t</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">6</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v2B</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">6</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v2PA</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">[</span><span class="mi">2</span><span class="p">::</span><span class="mi">6</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v2lb</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">[</span><span class="mi">3</span><span class="p">::</span><span class="mi">6</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v2</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">[</span><span class="mi">4</span><span class="p">::</span><span class="mi">6</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v2e</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">[</span><span class="mi">5</span><span class="p">::</span><span class="mi">6</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">tlist</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v2t</span><span class="p">)</span>
        <span class="n">tlist2</span> <span class="o">=</span> <span class="p">[</span><span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v2B</span><span class="p">[</span><span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v2t</span> <span class="o">==</span> <span class="n">t</span><span class="p">)])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tlist</span><span class="p">]</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">tlist2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v2tavg</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">)[</span><span class="n">idx</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v2Bavg</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist2</span><span class="p">)[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">readt3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oidata_t3</span><span class="p">):</span>
        <span class="n">tlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">t3i</span> <span class="ow">in</span> <span class="n">oidata_t3</span><span class="p">:</span>
            <span class="n">u1</span> <span class="o">=</span> <span class="n">t3i</span><span class="o">.</span><span class="n">u1coord</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="n">t3i</span><span class="o">.</span><span class="n">v1coord</span>
            <span class="n">u2</span> <span class="o">=</span> <span class="n">t3i</span><span class="o">.</span><span class="n">u2coord</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="n">t3i</span><span class="o">.</span><span class="n">v2coord</span>
            <span class="n">uvs</span> <span class="o">=</span> <span class="p">[[</span><span class="n">u1</span><span class="p">,</span> <span class="n">v1</span><span class="p">],</span> <span class="p">[</span><span class="n">u2</span><span class="p">,</span> <span class="n">v2</span><span class="p">]]</span>
            <span class="n">Bm</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">u2</span><span class="o">+</span><span class="n">u1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">v2</span><span class="o">+</span><span class="n">v1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">Pm</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u2</span><span class="o">+</span><span class="n">u1</span><span class="p">,</span> <span class="n">v2</span><span class="o">+</span><span class="n">v1</span><span class="p">)</span><span class="o">*</span><span class="mf">180.</span><span class="o">/</span><span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
            <span class="k">for</span> <span class="n">uv</span> <span class="ow">in</span> <span class="n">uvs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">uv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">uv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">Bm</span><span class="p">:</span>
                    <span class="n">Bm</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">uv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">uv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">Pm</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">uv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">uv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">180.</span><span class="o">/</span><span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v1</span><span class="o">**</span><span class="mi">2</span><span class="p">)])</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v2</span><span class="o">**</span><span class="mi">2</span><span class="p">)])</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">])</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u2</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">])</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">t3i</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">])</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t3i</span><span class="o">.</span><span class="n">t3phi</span><span class="p">)])</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t3i</span><span class="o">.</span><span class="n">t3phierr</span><span class="p">)])</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">Bm</span><span class="p">])</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">Pm</span><span class="p">])</span>
        <span class="c"># tlist = _np.array(tlist)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t3B1</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">9</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t3B2</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">9</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t3PA1</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">[</span><span class="mi">2</span><span class="p">::</span><span class="mi">9</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t3PA2</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">[</span><span class="mi">3</span><span class="p">::</span><span class="mi">9</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t3lb</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">[</span><span class="mi">4</span><span class="p">::</span><span class="mi">9</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t3p</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">[</span><span class="mi">5</span><span class="p">::</span><span class="mi">9</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t3pe</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">[</span><span class="mi">6</span><span class="p">::</span><span class="mi">9</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t3Bm</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">[</span><span class="mi">7</span><span class="p">::</span><span class="mi">9</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t3Pm</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">[</span><span class="mi">8</span><span class="p">::</span><span class="mi">9</span><span class="p">])</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">readvis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oidata_vis</span><span class="p">):</span>
        <span class="n">tlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">vi</span> <span class="ow">in</span> <span class="n">oidata_vis</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">vi</span><span class="o">.</span><span class="n">ucoord</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">vi</span><span class="o">.</span><span class="n">vcoord</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)])</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">])</span>            
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">vi</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">])</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">visamp</span><span class="p">)])</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">visamperr</span><span class="p">)])</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">visphi</span><span class="p">)])</span>
            <span class="n">tlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">visphierr</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vB1</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">7</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vPA1</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">7</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vlb</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">[</span><span class="mi">2</span><span class="p">::</span><span class="mi">7</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">[</span><span class="mi">3</span><span class="p">::</span><span class="mi">7</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ver</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">[</span><span class="mi">4</span><span class="p">::</span><span class="mi">7</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vp</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">[</span><span class="mi">5</span><span class="p">::</span><span class="mi">7</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vpe</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">[</span><span class="mi">6</span><span class="p">::</span><span class="mi">7</span><span class="p">])</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">readhdrinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oidata_hdrinfo</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dateobs</span> <span class="o">=</span> <span class="n">oidata_hdrinfo</span><span class="o">.</span><span class="n">dateobs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">oidata_hdrinfo</span><span class="o">.</span><span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datereduc</span> <span class="o">=</span> <span class="n">oidata_hdrinfo</span><span class="o">.</span><span class="n">datereduc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mjd</span> <span class="o">=</span> <span class="n">oidata_hdrinfo</span><span class="o">.</span><span class="n">mjd</span>
        <span class="k">return</span>

<div class="viewcode-block" id="oiClass.clear"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.oiClass.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Clear observational info to be used by a model </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oifile</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oitype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;PIO&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v2</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v2e</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t3p</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t3pe</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">oitype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;AMB&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ve</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vp</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vpe</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span>
</div>
<div class="viewcode-block" id="oiClass.add_model"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.oiClass.add_model">[docs]</a>    <span class="k">def</span> <span class="nf">add_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imgs</span><span class="p">,</span> <span class="n">rpx</span><span class="p">,</span> <span class="n">PAdisk</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">oifile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">lbm</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Fill the class with modeled values from observational setup already</span>
<span class="sd">        read.</span>

<span class="sd">        ``imgs`` is and matrix(lb, n, m), where lb is the lambda dimension (</span>
<span class="sd">        optional). ``rpx`` is radians_per_pixel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oifile</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">iscube</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">imgs</span><span class="p">))</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">iscube</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">imgs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oitype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;PIO&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">lbm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">v2lbm</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lbm</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">t3lbm</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lbm</span><span class="p">)</span>
            <span class="c"># else:</span>
            <span class="c">#     self.v2lbm = _np.array([1.66e-6])</span>
            <span class="c">#     self.t3lbm = _np.array([1.66e-6])</span>
            <span class="c">#</span>
            <span class="n">tlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v2B</span><span class="p">)):</span>
                <span class="n">tlisti</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">lb</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">v2lb</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">iscube</span><span class="p">:</span>
                        <span class="n">img</span> <span class="o">=</span> <span class="n">imgs</span><span class="p">[</span><span class="n">_phc</span><span class="o">.</span><span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v2lbm</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="bp">True</span><span class="p">)]</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">fastnumvis</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v2B</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">v2PA</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rpx</span><span class="p">,</span> <span class="n">PAdisk</span><span class="o">=</span><span class="n">PAdisk</span><span class="p">)</span>
                    <span class="n">tlisti</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">tlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tlisti</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v2</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v2e</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">tlist</span><span class="p">))</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">NaN</span>
            <span class="c">#</span>
            <span class="n">tlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t3B1</span><span class="p">)):</span>
                <span class="n">tlisti</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">lb</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">t3lb</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">iscube</span><span class="p">:</span>
                        <span class="n">img</span> <span class="o">=</span> <span class="n">imgs</span><span class="p">[</span><span class="n">_phc</span><span class="o">.</span><span class="n">find_nearest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t3lb</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="bp">True</span><span class="p">)]</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">fastnumvis3</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t3B1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">t3B2</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">t3PA1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">t3PA2</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">rpx</span><span class="p">,</span>
                        <span class="n">PAdisk</span><span class="o">=</span><span class="n">PAdisk</span><span class="p">)</span>
                    <span class="n">tlisti</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">p</span><span class="p">])</span>
                <span class="n">tlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tlisti</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t3p</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tlist</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t3pe</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">tlist</span><span class="p">))</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">NaN</span>
        <span class="c">#</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">oitype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;AMB&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">lbm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vlbm</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lbm</span><span class="p">)</span> 
            <span class="c"># else:</span>
            <span class="c">#     self.vlbm = _np.array([2.21e-6])               </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vp</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span>

</div></div>
<div class="viewcode-block" id="readoifits"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.readoifits">[docs]</a><span class="k">def</span> <span class="nf">readoifits</span><span class="p">(</span><span class="n">oifile</span><span class="p">,</span> <span class="n">oitype</span><span class="o">=</span><span class="s">&#39;PIO&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Read the oifits files/oidata according to its oitype.</span>

<span class="sd">    Possible oitypes=[&quot;PIO&quot;, &quot;AMB&quot;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oifile</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
        <span class="n">oidata</span> <span class="o">=</span> <span class="n">_oifits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">oifile</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">oidata</span> <span class="o">=</span> <span class="n">_copy</span><span class="p">(</span><span class="n">oifile</span><span class="p">)</span>
        <span class="n">oifile</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">oitype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;PIO&#39;</span><span class="p">):</span>
        <span class="n">oic</span> <span class="o">=</span> <span class="n">oiClass</span><span class="p">(</span><span class="n">oitype</span><span class="p">,</span> <span class="n">oifile</span><span class="p">)</span>
        <span class="n">oic</span><span class="o">.</span><span class="n">readvis2</span><span class="p">(</span><span class="n">oidata</span><span class="o">.</span><span class="n">vis2</span><span class="p">)</span>
        <span class="n">oic</span><span class="o">.</span><span class="n">readt3</span><span class="p">(</span><span class="n">oidata</span><span class="o">.</span><span class="n">t3</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">oitype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;AMB&#39;</span><span class="p">):</span>
        <span class="n">oic</span> <span class="o">=</span> <span class="n">oiClass</span><span class="p">(</span><span class="n">oitype</span><span class="p">,</span> <span class="n">oifile</span><span class="p">)</span>
        <span class="n">oic</span><span class="o">.</span><span class="n">readvis</span><span class="p">(</span><span class="n">oidata</span><span class="o">.</span><span class="n">vis</span><span class="p">)</span>
        <span class="n">oic</span><span class="o">.</span><span class="n">readhdrinfo</span><span class="p">(</span><span class="n">oidata</span><span class="o">.</span><span class="n">hdrinfo</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;Invalid `oitype` in intt.readoifits&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">oic</span>

</div>
<div class="viewcode-block" id="plot_pionier"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.plot_pionier">[docs]</a><span class="k">def</span> <span class="nf">plot_pionier</span><span class="p">(</span><span class="n">loic</span><span class="p">,</span> <span class="n">oitype</span><span class="o">=</span><span class="s">&#39;PIO&#39;</span><span class="p">,</span> <span class="n">outname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
    <span class="n">PAs</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span> <span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;png&#39;</span><span class="p">],</span> <span class="n">lcor</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">lmk</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Plot a OIFITS files with VIS2 and CP information. </span>

<span class="sd">    ``loic`` is a list of oic classes.</span>

<span class="sd">    Only the first ``loi`` will have the *uv* plane coverage plotted.</span>

<span class="sd">    If ``PAs != [-180, 180]``, then a limited range of PAs will be plotted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">loic</span><span class="p">,</span> <span class="n">oiClass</span><span class="p">):</span>
        <span class="n">loic</span> <span class="o">=</span> <span class="p">[</span><span class="n">loic</span><span class="p">]</span>
    <span class="k">print</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">loic</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">oiClass</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lcor</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">lcor</span> <span class="o">=</span> <span class="p">[</span><span class="n">_phc</span><span class="o">.</span><span class="n">cycles</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loic</span><span class="p">))]</span>
    <span class="k">if</span> <span class="n">lmk</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">lmk</span> <span class="o">=</span> <span class="p">[</span><span class="n">_phc</span><span class="o">.</span><span class="n">cycles</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s">&#39;mk&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loic</span><span class="p">))]</span>
    <span class="n">lins</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="mf">3.</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cols</span><span class="p">,</span> <span class="n">lins</span><span class="p">]))</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">_gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">lins</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>
    <span class="n">axB1</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span> 
    <span class="n">axB2</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span> 
    <span class="n">axV</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span> 
    <span class="n">axC</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loic</span><span class="p">)):</span>
        <span class="n">oic</span> <span class="o">=</span> <span class="n">loic</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">axB1</span> <span class="o">=</span> <span class="n">uv_plot_ax</span><span class="p">(</span><span class="n">axB1</span><span class="p">,</span> <span class="n">oic</span><span class="p">,</span> <span class="n">PAs</span><span class="o">=</span><span class="n">PAs</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">,</span> <span class="n">lbd</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">axB2</span> <span class="o">=</span> <span class="n">uv_plot_ax</span><span class="p">(</span><span class="n">axB2</span><span class="p">,</span> <span class="n">oic</span><span class="p">,</span> <span class="n">PAs</span><span class="o">=</span><span class="n">PAs</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">lbd</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">axV</span> <span class="o">=</span> <span class="n">v2_plot_ax</span><span class="p">(</span><span class="n">axV</span><span class="p">,</span> <span class="n">oic</span><span class="p">,</span> <span class="n">PAs</span><span class="o">=</span><span class="n">PAs</span><span class="p">,</span> <span class="n">cor</span><span class="o">=</span><span class="n">lcor</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mk</span><span class="o">=</span><span class="n">lmk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">axC</span> <span class="o">=</span> <span class="n">t3_plot_ax</span><span class="p">(</span><span class="n">axC</span><span class="p">,</span> <span class="n">oic</span><span class="p">,</span> <span class="n">PAs</span><span class="o">=</span><span class="n">PAs</span><span class="p">,</span> <span class="n">cor</span><span class="o">=</span><span class="n">lcor</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mk</span><span class="o">=</span><span class="n">lmk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">outname</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">outname</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">dtflag</span><span class="p">()</span>
    <span class="n">_phc</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">figname</span><span class="o">=</span><span class="n">outname</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="t3_plot_ax"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.t3_plot_ax">[docs]</a><span class="k">def</span> <span class="nf">t3_plot_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">oic</span><span class="p">,</span> <span class="n">PAs</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span> <span class="n">cor</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">mk</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Axis plot of t3</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">PArv</span> <span class="o">=</span> <span class="n">reversePAs</span><span class="p">(</span><span class="n">PAs</span><span class="p">)</span>
    <span class="c">#</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="p">((</span><span class="n">oic</span><span class="o">.</span><span class="n">t3Pm</span> <span class="o">&gt;=</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">oic</span><span class="o">.</span><span class="n">t3Pm</span> <span class="o">&lt;=</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">|</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">oic</span><span class="o">.</span><span class="n">t3Pm</span> <span class="o">&gt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">oic</span><span class="o">.</span><span class="n">t3Pm</span> <span class="o">&lt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">oic</span><span class="o">.</span><span class="n">t3lb</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">oic</span><span class="o">.</span><span class="n">t3Bm</span><span class="o">/</span><span class="n">oic</span><span class="o">.</span><span class="n">v2lb</span><span class="p">[</span><span class="n">idx</span><span class="p">][:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">oic</span><span class="o">.</span><span class="n">t3p</span><span class="p">[</span><span class="n">idx</span><span class="p">][:,</span> <span class="n">i</span><span class="p">],</span> 
            <span class="n">yerr</span><span class="o">=</span><span class="n">oic</span><span class="o">.</span><span class="n">t3pe</span><span class="p">[</span><span class="n">idx</span><span class="p">][:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">mk</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cor</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>

</div>
<div class="viewcode-block" id="v2_plot_ax"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.v2_plot_ax">[docs]</a><span class="k">def</span> <span class="nf">v2_plot_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">oic</span><span class="p">,</span> <span class="n">PAs</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span> <span class="n">cor</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">mk</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Axis plot of v2 </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">PArv</span> <span class="o">=</span> <span class="n">reversePAs</span><span class="p">(</span><span class="n">PAs</span><span class="p">)</span>
    <span class="c">#</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="p">((</span><span class="n">oic</span><span class="o">.</span><span class="n">v2PA</span> <span class="o">&gt;=</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">oic</span><span class="o">.</span><span class="n">v2PA</span> <span class="o">&lt;=</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">|</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">oic</span><span class="o">.</span><span class="n">v2PA</span> <span class="o">&gt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">oic</span><span class="o">.</span><span class="n">v2PA</span> <span class="o">&lt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">oic</span><span class="o">.</span><span class="n">v2lb</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">oic</span><span class="o">.</span><span class="n">v2B</span><span class="o">/</span><span class="n">oic</span><span class="o">.</span><span class="n">v2lb</span><span class="p">[</span><span class="n">idx</span><span class="p">][:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">oic</span><span class="o">.</span><span class="n">v2</span><span class="p">[</span><span class="n">idx</span><span class="p">][:,</span> <span class="n">i</span><span class="p">],</span> 
            <span class="n">yerr</span><span class="o">=</span><span class="n">oic</span><span class="o">.</span><span class="n">v2e</span><span class="p">[</span><span class="n">idx</span><span class="p">][:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">mk</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cor</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>

</div>
<div class="viewcode-block" id="uv_plot_ax"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.uv_plot_ax">[docs]</a><span class="k">def</span> <span class="nf">uv_plot_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">oic</span><span class="p">,</span> <span class="n">PAs</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">lbd</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Axis plot of the observational baselines (u, v) plane. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">PArv</span> <span class="o">=</span> <span class="n">reversePAs</span><span class="p">(</span><span class="n">PAs</span><span class="p">)</span>
    <span class="c">#</span>
    <span class="k">if</span> <span class="n">oic</span><span class="o">.</span><span class="n">oitype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;PIO&#39;</span><span class="p">):</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">oic</span><span class="o">.</span><span class="n">v2B</span>
        <span class="n">PA</span> <span class="o">=</span> <span class="n">oic</span><span class="o">.</span><span class="n">v2PA</span>
        <span class="n">t2Bavg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">oic</span><span class="o">.</span><span class="n">v2tavg</span><span class="p">,</span> <span class="n">oic</span><span class="o">.</span><span class="n">v2Bavg</span><span class="p">))</span>
        <span class="n">tlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">t2Bavg</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">oic</span><span class="o">.</span><span class="n">v2t</span><span class="p">]</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">gradColor</span><span class="p">(</span><span class="n">tlist</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">oic</span><span class="o">.</span><span class="n">v2Bavg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span>
            <span class="n">oic</span><span class="o">.</span><span class="n">v2Bavg</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">oic</span><span class="o">.</span><span class="n">v2Bavg</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">cmapn</span><span class="o">=</span><span class="s">&#39;inferno_r&#39;</span><span class="p">)</span>
        <span class="n">lbds</span> <span class="o">=</span> <span class="n">oic</span><span class="o">.</span><span class="n">v2lb</span>
    <span class="k">elif</span> <span class="n">oic</span><span class="o">.</span><span class="n">oitype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;AMB&#39;</span><span class="p">):</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">oic</span><span class="o">.</span><span class="n">vB</span>
        <span class="n">PA</span> <span class="o">=</span> <span class="n">oic</span><span class="o">.</span><span class="n">vPA</span>
        <span class="n">lbds</span> <span class="o">=</span> <span class="n">oic</span><span class="o">.</span><span class="n">vlb</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">gradColor</span><span class="p">(</span><span class="n">oic</span><span class="o">.</span><span class="n">vB</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">lbd</span><span class="p">:</span>
        <span class="n">lbds</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">B</span><span class="p">))])</span>
    <span class="c">#</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="p">((</span><span class="n">PA</span> <span class="o">&gt;=</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">PA</span> <span class="o">&lt;=</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">|</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">PA</span> <span class="o">&gt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">PA</span> <span class="o">&lt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="p">)</span>
    <span class="c">#</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lbds</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">B</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PA</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span><span class="o">/</span><span class="n">lbds</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">B</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PA</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span><span class="o">/</span><span class="n">lbds</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">7</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">-</span><span class="n">u</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">7</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">gradColor</span><span class="p">(</span><span class="n">oic</span><span class="o">.</span><span class="n">v2Bavg</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">oic</span><span class="o">.</span><span class="n">v2Bavg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span>
            <span class="n">oic</span><span class="o">.</span><span class="n">v2Bavg</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">oic</span><span class="o">.</span><span class="n">v2Bavg</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">cmapn</span><span class="o">=</span><span class="s">&#39;inferno_r&#39;</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">oic</span><span class="o">.</span><span class="n">v2Bavg</span><span class="p">)):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">_Line2D</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> 
                <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">oic</span><span class="o">.</span><span class="n">v2tavg</span><span class="p">,</span> <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s">&#39;best&#39;</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
            <span class="n">framealpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
    <span class="c"># ax.xaxis.tick_top()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lbd</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">_mtick</span><span class="o">.</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%.0e</span><span class="s">&#39;</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">_mtick</span><span class="o">.</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%.0e</span><span class="s">&#39;</span><span class="p">))</span>
    <span class="c"># ax.locator_params(nbins=5)</span>
    <span class="k">return</span> <span class="n">ax</span>

</div>
<div class="viewcode-block" id="plot_uv_old"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.plot_uv_old">[docs]</a><span class="k">def</span> <span class="nf">plot_uv_old</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">oidata</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">PAs</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span> <span class="n">PAsrev</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> 
    <span class="n">PArv</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Plot uv map of a given oidata.vis &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">vis2</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">vis2</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">ucoord</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">vcoord</span>
        <span class="n">ulbd</span> <span class="o">=</span> <span class="n">u</span> <span class="o">/</span> <span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span>
        <span class="n">vlbd</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span>
        <span class="n">PA</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;unnamed&#39;</span>
        <span class="c"># [u,-u] = W &gt; E</span>
        <span class="c"># [-u,u] = E &lt; W</span>
        <span class="c"># label=label,</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">PA</span> <span class="o">&gt;=</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">PA</span> <span class="o">&lt;=</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">PAsrev</span> <span class="ow">and</span> 
            <span class="p">(</span><span class="n">PA</span> <span class="o">&gt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="n">PA</span> <span class="o">&lt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">ulbd</span><span class="p">,</span> <span class="o">-</span><span class="n">ulbd</span><span class="p">],</span> <span class="p">[</span><span class="n">vlbd</span><span class="p">,</span> <span class="o">-</span><span class="n">vlbd</span><span class="p">],</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> 
                <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span><span class="p">)])</span>
    <span class="n">f</span> <span class="o">=</span> <span class="mf">1.4</span><span class="o">*</span><span class="mf">5e7</span><span class="o">/</span><span class="mf">112.</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mf">84.06</span><span class="o">*</span><span class="n">f</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mf">111.96</span><span class="o">*</span><span class="n">f</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="n">length_includes_head</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">head_width</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="mf">111.96</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">f</span><span class="p">,</span> 
        <span class="n">head_length</span><span class="o">=</span><span class="mf">0.15</span><span class="o">*</span><span class="mf">111.96</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">f</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s">&#39;gray&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">u&#39;B$_{proj}$/$\lambda$&#39;</span><span class="p">)</span>
    <span class="c"># ax2 = ax.twiny()</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="c"># ax2.set_xlim(ax.get_xlim())</span>
    <span class="c"># ax.get_xaxis().set_ticklabels([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">tick_top</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">_mtick</span><span class="o">.</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%.0e</span><span class="s">&#39;</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">_mtick</span><span class="o">.</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%.0e</span><span class="s">&#39;</span><span class="p">))</span>
    <span class="c"># _plt.grid(b=True, linestyle=&#39;:&#39;)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">locator_params</span><span class="p">(</span><span class="n">nbins</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>

</div>
<span class="k">def</span> <span class="nf">plot_baseline</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">oidata</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">PAs</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span> <span class="n">PAsrev</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> 
    <span class="n">PArv</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="n">leg</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">vis2</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">vis2</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">ucoord</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">vcoord</span>
        <span class="n">PA</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;unnamed&#39;</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span><span class="p">)]</span>
        <span class="c"># [u,-u] = W &gt; E</span>
        <span class="c"># [-u,u] = E &lt; W</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">PA</span> <span class="o">&gt;=</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">PA</span> <span class="o">&lt;=</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">PAsrev</span> <span class="ow">and</span> 
            <span class="p">(</span><span class="n">PA</span> <span class="o">&gt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="n">PA</span> <span class="o">&lt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">leg</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">u</span><span class="p">,</span> <span class="o">-</span><span class="n">u</span><span class="p">],</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">],</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
                <span class="n">leg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">u</span><span class="p">,</span> <span class="o">-</span><span class="n">u</span><span class="p">],</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">],</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>  <span class="c"># label=label,</span>
        <span class="c"># names.append(vis2.target.target)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mf">84.06</span><span class="o">*</span><span class="n">f</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mf">111.96</span><span class="o">*</span><span class="n">f</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="n">length_includes_head</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">head_width</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="mf">111.96</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">f</span><span class="p">,</span> 
        <span class="n">head_length</span><span class="o">=</span><span class="mf">0.15</span><span class="o">*</span><span class="mf">111.96</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">f</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s">&#39;gray&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">)</span>
    <span class="c"># ax.plot([0], [0], &#39;o&#39;)</span>
    <span class="c"># names = list(_np.unique(names))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">tick_top</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_right</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s">&quot;right&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">u&#39;B$_{proj}$ (m)&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
    <span class="c"># _plt.grid(b=True, linestyle=&#39;:&#39;, alpha=alp)</span>
    <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">names</span><span class="p">)]</span>
        <span class="n">handles</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">handles</span><span class="p">)[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span> <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s">&#39;best&#39;</span><span class="p">,</span> 
            <span class="n">framealpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="c"># ax.yaxis.set_major_formatter(_mtick.FormatStrFormatter(&#39;%.0e&#39;))</span>
    <span class="c"># ax.xaxis.set_major_formatter(_mtick.FormatStrFormatter(&#39;%.0e&#39;))</span>
    <span class="c"># ax.ticklabel_format(useOffset=False)  # style=&#39;sci&#39; DO NOT WORK</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">locator_params</span><span class="p">(</span><span class="n">nbins</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>


<span class="c"># Other?</span>
<div class="viewcode-block" id="mapinterf"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.mapinterf">[docs]</a><span class="k">def</span> <span class="nf">mapinterf</span><span class="p">(</span><span class="n">modf</span><span class="p">,</span> <span class="n">im</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">obs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">iflx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">PA</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span> <span class="n">PAdisk</span><span class="o">=</span><span class="mf">90.</span><span class="p">,</span>
    <span class="n">quiet</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return Squared Visibilities (V2) and Diferential Phases (DP) for a given</span>
<span class="sd">    `hdust` map(s) file.</span>

<span class="sd">    If *.map file format, it takes `iflx` image layer.</span>

<span class="sd">    input: *.map(s) path (string), `dist` (float, parsecs)</span>

<span class="sd">    output: lbdc, V2, DP (float arrays) &quot;&quot;&quot;</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">obslist</span><span class="p">,</span> <span class="n">lbdc</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">readmap</span><span class="p">(</span><span class="n">modf</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="n">quiet</span><span class="p">)</span>
    <span class="n">pixsize</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">rad_per_pixel</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">pixsize</span> <span class="o">*</span> <span class="mf">6.96E10</span> <span class="o">/</span> <span class="p">(</span><span class="n">dist</span> <span class="o">*</span> <span class="mf">3.08567758E18</span><span class="p">))</span>
    <span class="n">npts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lbdc</span><span class="p">)</span>
    <span class="n">V2</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npts</span><span class="p">)</span>
    <span class="n">DP</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npts</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npts</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">im</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">im</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">iflx</span><span class="p">]</span>
        <span class="n">tmp</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">DP</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fastnumvis</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">lbdc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">PA</span><span class="p">,</span> <span class="n">rad_per_pixel</span><span class="p">,</span>
            <span class="n">PAdisk</span><span class="o">=</span><span class="n">PAdisk</span><span class="p">)</span>
        <span class="n">V2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">V</span><span class="o">**</span><span class="mi">2</span>
    <span class="c"># avg = (DP[0]+DP[-1])/2.</span>
    <span class="n">ssize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="o">.</span><span class="mo">05</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">DP</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ssize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ssize</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">medx0</span><span class="p">,</span> <span class="n">medx1</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">DP</span><span class="p">[:</span><span class="n">ssize</span><span class="p">]),</span> <span class="n">_np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">DP</span><span class="p">[</span><span class="o">-</span><span class="n">ssize</span><span class="p">:])</span>
    <span class="n">avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">medx0</span> <span class="o">+</span> <span class="n">medx1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="n">DP</span> <span class="o">=</span> <span class="n">DP</span> <span class="o">-</span> <span class="n">avg</span>
    <span class="c"># DP = _spt.linfit(lbdc, DP)-1.</span>
    <span class="c"># lbdc = _spt.air2vac(lbdc*1e4)*1e-4</span>
    <span class="k">return</span> <span class="n">lbdc</span><span class="p">,</span> <span class="n">V2</span><span class="p">,</span> <span class="n">DP</span>

</div>
<div class="viewcode-block" id="datinterf"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.datinterf">[docs]</a><span class="k">def</span> <span class="nf">datinterf</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">lbdc</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">im</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">obs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">iflx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">PA</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span> 
    <span class="n">PAdisk</span><span class="o">=</span><span class="mf">90.</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">normV2</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return Squared Visibilities (V2) and Diferential Phases (DP) for a given</span>
<span class="sd">    `hdust` data file.</span>

<span class="sd">    If *.map file format, it takes `iflx` image layer.</span>

<span class="sd">    input: data (np.ndarray), `dist` (float, parsecs)</span>

<span class="sd">    output: lbdc, V2, DP (float arrays) &quot;&quot;&quot;</span>
    <span class="n">pixsize</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">xmax</span><span class="p">[</span><span class="n">im</span><span class="p">]</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">rad_per_pixel</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">pixsize</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Rsun</span><span class="o">.</span><span class="n">cgs</span> <span class="o">/</span> <span class="p">(</span><span class="n">dist</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">cgs</span><span class="p">))</span>
    <span class="n">npts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lbdc</span><span class="p">)</span>
    <span class="n">V2</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npts</span><span class="p">)</span>
    <span class="n">DP</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npts</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npts</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">im</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">im</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">iflx</span><span class="p">]</span>
        <span class="n">tmp</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">DP</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fastnumvis</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">lbdc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">PA</span><span class="p">,</span> <span class="n">rad_per_pixel</span><span class="p">,</span>
            <span class="n">PAdisk</span><span class="o">=</span><span class="n">PAdisk</span><span class="p">)</span>
        <span class="n">V2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">V</span><span class="o">**</span><span class="mi">2</span>
    <span class="c"># avg = (DP[0]+DP[-1])/2.</span>
    <span class="n">ssize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="o">.</span><span class="mo">05</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">DP</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ssize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ssize</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">medx0</span><span class="p">,</span> <span class="n">medx1</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">DP</span><span class="p">[:</span><span class="n">ssize</span><span class="p">]),</span> <span class="n">_np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">DP</span><span class="p">[</span><span class="o">-</span><span class="n">ssize</span><span class="p">:])</span>
    <span class="n">avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">medx0</span> <span class="o">+</span> <span class="n">medx1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="n">DP</span> <span class="o">=</span> <span class="n">DP</span> <span class="o">-</span> <span class="n">avg</span>
    <span class="c"># DP = _spt.linfit(lbdc, DP)-1.</span>
    <span class="c"># lbdc = _spt.air2vac(lbdc*1e4)*1e-4</span>
    <span class="k">if</span> <span class="n">normV2</span><span class="p">:</span>
        <span class="n">V2</span> <span class="o">=</span> <span class="n">_linfit</span><span class="p">(</span><span class="n">lbdc</span><span class="p">,</span> <span class="n">V2</span><span class="p">,</span> <span class="n">ssize</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lbdc</span><span class="p">,</span> <span class="n">V2</span><span class="p">,</span> <span class="n">DP</span>

</div>
<div class="viewcode-block" id="dataphot"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.dataphot">[docs]</a><span class="k">def</span> <span class="nf">dataphot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">lbdc</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">im</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">obs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">iflx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">PA</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span> 
    <span class="n">PAdisk</span><span class="o">=</span><span class="mf">90.</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">diff</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">phiunit</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot; Return photocenter positions for a given `hdust` data file.</span>

<span class="sd">    If *.map file format, it takes `iflx` image layer.</span>

<span class="sd">    input: data (np.ndarray), `dist` (float, parsecs)</span>

<span class="sd">    output: lbdc, V2, DP (float arrays) &quot;&quot;&quot;</span>
    <span class="n">pixsize</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">xmax</span><span class="p">[</span><span class="n">im</span><span class="p">]</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">rad_per_pixel</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">pixsize</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Rsun</span><span class="o">.</span><span class="n">cgs</span> <span class="o">/</span> <span class="p">(</span><span class="n">dist</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">cgs</span><span class="p">))</span>
    <span class="n">npts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lbdc</span><span class="p">)</span>
    <span class="n">px</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npts</span><span class="p">)</span>
    <span class="n">py</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npts</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npts</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">im</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">im</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">iflx</span><span class="p">]</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">rotate_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">PA</span><span class="o">+</span><span class="mi">90</span><span class="o">-</span><span class="n">PAdisk</span><span class="p">)</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="o">+</span><span class="n">_np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="o">+</span><span class="n">_np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">px</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">_np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">py</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="n">_np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
        <span class="n">ssize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="o">.</span><span class="mo">05</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">px</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ssize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ssize</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">avg</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">px</span><span class="p">[:</span><span class="n">ssize</span><span class="p">]),</span> <span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">px</span><span class="p">[</span><span class="o">-</span><span class="n">ssize</span><span class="p">:])])</span>
        <span class="n">px</span> <span class="o">-=</span> <span class="n">avg</span>
        <span class="n">ssize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="o">.</span><span class="mo">05</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">py</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ssize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ssize</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">avg</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">py</span><span class="p">[:</span><span class="n">ssize</span><span class="p">]),</span> <span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">py</span><span class="p">[</span><span class="o">-</span><span class="n">ssize</span><span class="p">:])])</span>
        <span class="n">py</span> <span class="o">-=</span> <span class="n">avg</span>
    <span class="k">if</span> <span class="n">phiunit</span><span class="p">:</span>
        <span class="n">px</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">B</span><span class="o">/</span><span class="n">lbdc</span><span class="o">*</span><span class="mf">1e6</span><span class="o">*</span><span class="n">rad_per_pixel</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">py</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">B</span><span class="o">/</span><span class="n">lbdc</span><span class="o">*</span><span class="mf">1e6</span><span class="o">*</span><span class="n">rad_per_pixel</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">return</span> <span class="n">lbdc</span><span class="p">,</span> <span class="n">px</span><span class="p">,</span> <span class="n">py</span>

</div>
<div class="viewcode-block" id="plot_pio_res"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.plot_pio_res">[docs]</a><span class="k">def</span> <span class="nf">plot_pio_res</span><span class="p">(</span><span class="n">oidata</span><span class="p">,</span> <span class="n">modellist</span><span class="p">,</span> <span class="n">outname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;png&#39;</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">obsdeg</span><span class="o">=</span><span class="p">[</span><span class="mf">60.6</span><span class="p">],</span> <span class="n">distpc</span><span class="o">=</span><span class="mf">42.75</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">bindata</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
    <span class="n">PAs</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span> <span class="n">PAsrev</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">shv2sum</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Obs-Model comparison for PIONIER</span>

<span class="sd">    `legend`: ?</span>

<span class="sd">    `obsdeg`: ?</span>

<span class="sd">    `bindata`: ?</span>

<span class="sd">    `PArev`: Plot the reverse of the observed PAs</span>

<span class="sd">    `shv2sum`: ?</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Calculate the reverse PAs</span>
    <span class="k">if</span> <span class="n">PAsrev</span><span class="p">:</span>
        <span class="n">PArv</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">PArv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># PArv[0] == 0 must be -180!</span>
            <span class="n">PArv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">180</span>
        <span class="k">if</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># PArv[1] == 0 must be +180!</span>
            <span class="n">PArv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">PArv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">180</span>
    <span class="c"># Create array names and colors</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Blist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">vis2</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">vis2</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">ucoord</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">vcoord</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;unnamed&#39;</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="n">label</span><span class="p">]</span>
            <span class="n">Blist</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="n">Blist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Blist</span><span class="p">)):</span>
        <span class="n">Blist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">Blist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">names</span><span class="p">)[</span><span class="n">_np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">Blist</span><span class="p">)])</span>
    <span class="n">Blist</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">gradColor</span><span class="p">(</span><span class="n">Blist</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">Blist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">Blist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Blist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mf">0.1</span><span class="p">,</span> 
        <span class="n">cmapn</span><span class="o">=</span><span class="s">&#39;plasma_r&#39;</span><span class="p">)</span>
    <span class="c"># color = _phc.colors[names.index(label)]</span>
    <span class="c"># Create Plot</span>
    <span class="c"># fig, axs = _plt.subplots(3, 2)</span>
    <span class="c"># New plot creating</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">axs</span> <span class="o">=</span> <span class="p">[[[],</span> <span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
    <span class="n">ls</span><span class="p">,</span> <span class="n">cs</span> <span class="o">=</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">ls</span><span class="p">,</span> <span class="n">cs</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">ls</span><span class="p">,</span> <span class="n">cs</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">ls</span><span class="p">,</span> <span class="n">cs</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">ls</span><span class="p">,</span> <span class="n">cs</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">ls</span><span class="p">,</span> <span class="n">cs</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">ls</span><span class="p">,</span> <span class="n">cs</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="c"># Plot of axis 1 = uv (B/lbd) map</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_uv</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">oidata</span><span class="o">=</span><span class="n">oidata</span><span class="p">,</span> <span class="n">PAs</span><span class="o">=</span><span class="n">PAs</span><span class="p">,</span> <span class="n">PAsrev</span><span class="o">=</span><span class="n">PAsrev</span><span class="p">,</span> 
        <span class="n">PArv</span><span class="o">=</span><span class="n">PArv</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_baseline</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">oidata</span><span class="o">=</span><span class="n">oidata</span><span class="p">,</span> <span class="n">PAs</span><span class="o">=</span><span class="n">PAs</span><span class="p">,</span> 
        <span class="n">PAsrev</span><span class="o">=</span><span class="n">PAsrev</span><span class="p">,</span> <span class="n">PArv</span><span class="o">=</span><span class="n">PArv</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_v2_res</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">oidata</span><span class="o">=</span><span class="n">oidata</span><span class="p">,</span> 
        <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="n">modfiles</span><span class="o">=</span><span class="n">modellist</span><span class="p">,</span> <span class="n">obsdeg</span><span class="o">=</span><span class="n">obsdeg</span><span class="p">,</span> 
        <span class="n">dist</span><span class="o">=</span><span class="n">distpc</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span> <span class="n">PAs</span><span class="o">=</span><span class="n">PAs</span><span class="p">,</span> <span class="n">PAsrev</span><span class="o">=</span><span class="n">PAsrev</span><span class="p">,</span> <span class="n">PArv</span><span class="o">=</span><span class="n">PArv</span><span class="p">,</span> <span class="n">bindata</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
        <span class="n">quiet</span><span class="o">=</span><span class="n">quiet</span><span class="p">,</span> <span class="n">alp</span><span class="o">=.</span><span class="mi">675</span><span class="p">,</span> <span class="n">printsum</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_phi3_res</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">oidata</span><span class="o">=</span><span class="n">oidata</span><span class="p">,</span> 
        <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="n">modfiles</span><span class="o">=</span><span class="n">modellist</span><span class="p">,</span> <span class="n">obsdeg</span><span class="o">=</span><span class="n">obsdeg</span><span class="p">,</span> 
        <span class="n">dist</span><span class="o">=</span><span class="n">distpc</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span> <span class="n">PAs</span><span class="o">=</span><span class="n">PAs</span><span class="p">,</span> <span class="n">PAsrev</span><span class="o">=</span><span class="n">PAsrev</span><span class="p">,</span> <span class="n">PArv</span><span class="o">=</span><span class="n">PArv</span><span class="p">,</span> <span class="n">bindata</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
        <span class="n">quiet</span><span class="o">=</span><span class="n">quiet</span><span class="p">,</span> <span class="n">alp</span><span class="o">=.</span><span class="mi">675</span><span class="p">,</span> <span class="n">printsum</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c"># _plt.tight_layout()</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">())</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">())</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">())</span>

    <span class="n">_plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">outname</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">outname</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">dtflag</span><span class="p">()</span>
    <span class="n">_phc</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">figname</span><span class="o">=</span><span class="n">outname</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="plot_v2_img"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.plot_v2_img">[docs]</a><span class="k">def</span> <span class="nf">plot_v2_img</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">oidata</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">alp</span><span class="o">=.</span><span class="mi">75</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; IMG from LitPRO</span>

<span class="sd">    TODO: scales</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ms</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e8</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="c"># Loop in vis2 creating the following vectors</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">,</span> <span class="n">Blist</span><span class="p">,</span> <span class="n">PAlist</span><span class="p">,</span> <span class="n">lbd</span> <span class="o">=</span> <span class="p">([],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[])</span>
    <span class="k">for</span> <span class="n">vis2</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">vis2</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">ucoord</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">vcoord</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;unnamed&#39;</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">cycles</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">oidata</span><span class="o">.</span><span class="n">vis2</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">vis2</span><span class="p">))</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">PA</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
        <span class="c"># if (PA &gt;= PAs[0] and PA &lt;= PAs[1]) or (PAsrev and (PA &gt;= PArv[0]) and </span>
        <span class="c">#     PA &lt;= PArv[1]):</span>
            <span class="c"># if bindata &lt;= 0:</span>
        <span class="n">lbd</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">)</span>
        <span class="n">x</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">B</span><span class="o">/</span><span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">)</span>
        <span class="n">y</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">vis2data</span><span class="p">)</span>
        <span class="n">yerr</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">vis2err</span><span class="p">)</span>
        <span class="n">Blist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">B</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">))</span>
        <span class="n">PAlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">PA</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">,</span> 
            <span class="n">vis2</span><span class="o">.</span><span class="n">vis2data</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">vis2</span><span class="o">.</span><span class="n">vis2err</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> 
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="c"># # </span>
    <span class="n">fits</span> <span class="o">=</span> <span class="n">_pyfits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">fits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CDELT1&#39;</span><span class="p">]</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">fits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CDELT2&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">dx</span> <span class="o">!=</span> <span class="n">dy</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;# ERROR! Differential spatial scales for {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">img</span><span class="p">))</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">fits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CUNIT1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;deg&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">rad_per_pixel</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">_phc</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rad_per_pixel</span> <span class="o">=</span> <span class="n">dx</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">fits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="p">:]</span>
    <span class="n">V2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
        <span class="n">tmp</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">ph</span> <span class="o">=</span> <span class="n">fastnumvis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">lbd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Blist</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">PAlist</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> 
            <span class="n">rad_per_pixel</span><span class="p">,</span> <span class="n">PAdisk</span><span class="o">=</span><span class="mf">90.</span><span class="p">)</span>
        <span class="n">V2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">V2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&quot;d&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span><span class="p">,</span> <span class="n">V2</span>

</div>
<div class="viewcode-block" id="plot_t3_img"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.plot_t3_img">[docs]</a><span class="k">def</span> <span class="nf">plot_t3_img</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">oidata</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">alp</span><span class="o">=.</span><span class="mi">75</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; IMG from LitPRO</span>
<span class="sd">    </span>
<span class="sd">    TODO: scales</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ms</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e8</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="c"># Loop in vis2 creating the following vectors</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">,</span> <span class="n">Blist</span><span class="p">,</span> <span class="n">PAlist</span><span class="p">,</span> <span class="n">Bmax</span> <span class="o">=</span> <span class="p">([],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[])</span>
    <span class="k">for</span> <span class="n">t3</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">t3</span><span class="p">:</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">u1coord</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">v1coord</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">u2coord</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">v2coord</span>
        <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v2</span><span class="o">**</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">u1</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">u2</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v2</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">PA</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">))</span>
        <span class="n">PA</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">PA</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">))</span>
        <span class="n">Bmax</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
        <span class="n">lbsz</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">)</span>
        <span class="n">x</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">B</span><span class="o">/</span><span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">)</span>
        <span class="n">y</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">t3phi</span><span class="p">)</span>
        <span class="n">yerr</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">t3phierr</span><span class="p">)</span>
        <span class="n">B1</span><span class="p">,</span> <span class="n">B2</span> <span class="o">=</span> <span class="p">(</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v1</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">Blist</span><span class="o">.</span><span class="n">extend</span><span class="p">([[</span><span class="n">B1</span><span class="p">,</span> <span class="n">B2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lbsz</span><span class="p">)])</span>
        <span class="n">PA1</span><span class="p">,</span> <span class="n">PA2</span> <span class="o">=</span> <span class="p">(</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> 
            <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u2</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="p">)</span>
        <span class="n">PAlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([[</span><span class="n">PA1</span><span class="p">,</span> <span class="n">PA2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lbsz</span><span class="p">)])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> 
            <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="c"># # </span>
    <span class="n">fits</span> <span class="o">=</span> <span class="n">_pyfits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">fits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CDELT1&#39;</span><span class="p">]</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">fits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CDELT2&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">dx</span> <span class="o">!=</span> <span class="n">dy</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;# ERROR! Differential spatial scales for {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">img</span><span class="p">))</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">fits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CUNIT1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;deg&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">rad_per_pixel</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">_phc</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rad_per_pixel</span> <span class="o">=</span> <span class="n">dx</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">fits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">lblist</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Bmax</span><span class="p">)</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> 
    <span class="n">t3</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
        <span class="n">tmp</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">ph</span> <span class="o">=</span> <span class="n">fastnumvis3</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">lblist</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Blist</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">PAlist</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> 
            <span class="n">rad_per_pixel</span><span class="p">,</span> <span class="n">PAdisk</span><span class="o">=</span><span class="mf">90.</span><span class="p">)</span>
        <span class="n">t3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&quot;d&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span><span class="p">,</span> <span class="n">t3</span>

</div>
<div class="viewcode-block" id="plot_v2_res"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.plot_v2_res">[docs]</a><span class="k">def</span> <span class="nf">plot_v2_res</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">oidata</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">modfiles</span><span class="p">,</span> <span class="n">obsdeg</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
    <span class="n">dist</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">PAs</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span> <span class="n">PAsrev</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">PArv</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
    <span class="n">bindata</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">alp</span><span class="o">=.</span><span class="mi">75</span><span class="p">,</span> <span class="n">printsum</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; datas = models! </span>

<span class="sd">    `bindata` refers to vis2.wavelength.eff_wave!! In other words: the binning</span>
<span class="sd">    only works on simultaneous observations with different :math:`\lambda`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ms</span> <span class="o">=</span> <span class="mf">3.5</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e8</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="c"># Loop in vis2 creating the following vectors</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">,</span> <span class="n">Blist</span><span class="p">,</span> <span class="n">PAlist</span> <span class="o">=</span> <span class="p">([],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[])</span>
    <span class="k">for</span> <span class="n">vis2</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">vis2</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">ucoord</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">vcoord</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;unnamed&#39;</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span><span class="p">)]</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">PA</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">PA</span> <span class="o">&gt;=</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">PA</span> <span class="o">&lt;=</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">PAsrev</span> <span class="ow">and</span> <span class="p">(</span><span class="n">PA</span> <span class="o">&gt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> 
            <span class="n">PA</span> <span class="o">&lt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">bindata</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">x</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">)</span>
                <span class="n">y</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">vis2data</span><span class="p">)</span>
                <span class="n">yerr</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">vis2err</span><span class="p">)</span>
                <span class="n">Blist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">B</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">))</span>
                <span class="n">PAlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">PA</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">,</span> 
                    <span class="n">vis2</span><span class="o">.</span><span class="n">vis2data</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">vis2</span><span class="o">.</span><span class="n">vis2err</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> 
                    <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c"># Individual plot to keep each BASELINE color</span>
            <span class="k">if</span> <span class="n">bindata</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">binned</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">bindata</span><span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">,</span> 
                    <span class="n">vis2</span><span class="o">.</span><span class="n">vis2data</span><span class="p">,</span> <span class="n">bindata</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">vis2</span><span class="o">.</span><span class="n">vis2err</span><span class="p">)</span>  <span class="c"># xrange=xlim)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">binned</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">binned</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">yerr</span><span class="o">=</span><span class="n">binned</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> 
                    <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c"># Plotting models</span>
    <span class="k">if</span> <span class="n">obsdeg</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">obsdeg</span>
    <span class="n">mcolors</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">gradColor</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">modfiles</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="n">cmapn</span><span class="o">=</span><span class="s">&#39;Greens_r&#39;</span><span class="p">)</span>
    <span class="n">mcolors</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mcolors</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">mcolors</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;dimgray&#39;</span><span class="p">,</span> <span class="s">&#39;blue&#39;</span><span class="p">]</span>
    <span class="n">mcolors</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="s">&#39;red&#39;</span><span class="p">]</span>
    <span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">]</span>
    <span class="c"># mcolors = [&#39;red&#39;, &#39;green&#39;]</span>
    <span class="k">for</span> <span class="n">mod</span> <span class="ow">in</span> <span class="n">modfiles</span><span class="p">:</span>
        <span class="n">midx</span> <span class="o">=</span> <span class="n">modfiles</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">obslist</span><span class="p">,</span> <span class="n">lbdc</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">readmap</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="n">quiet</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="c"># It is just taking the length. Ignore the indexes</span>
        <span class="n">pixsize</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="c"># *60.*60.*1000.*180./_np.pi)</span>
        <span class="n">rad_per_pixel</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">pixsize</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Rsun</span><span class="o">.</span><span class="n">cgs</span> <span class="o">/</span> <span class="p">(</span><span class="n">dist</span> <span class="o">*</span> 
            <span class="n">_phc</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">cgs</span><span class="p">))</span>
        <span class="n">lblist</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Blist</span><span class="p">)</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> 
        <span class="k">for</span> <span class="n">deg</span> <span class="ow">in</span> <span class="n">obs</span><span class="p">:</span>
            <span class="n">V2</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ob</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">obslist</span><span class="p">[::</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">find_nearest</span><span class="p">(</span><span class="n">obslist</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="n">deg</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">obslist</span><span class="p">[::</span><span class="mi">2</span><span class="p">][</span><span class="n">ob</span><span class="p">]</span> <span class="o">-</span> <span class="n">deg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;# The difference of angles is bigger than 1 deg!!!&#39;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Input: {0:.1f}; Nearest model: {1:.1f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">deg</span><span class="p">,</span> <span class="n">obslist</span><span class="p">[::</span><span class="mi">2</span><span class="p">][</span><span class="n">ob</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
                <span class="n">j</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">lbdc</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">find_nearest</span><span class="p">(</span><span class="n">lbdc</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span> 
                    <span class="n">lblist</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lbdc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="mf">1e-6</span> <span class="o">-</span> <span class="n">lblist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="o">*</span><span class="mf">1e-6</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;# The difference of lambd is bigger than 0.1 um!!!&#39;</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Input: {0:.1f}; Nearest model: {1:.1f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">lblist</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lbdc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="mf">1e-6</span><span class="p">))</span>
                <span class="c"># lbcalc = lbdc[j]*1e-6</span>
                <span class="n">tmp</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">phvar</span> <span class="o">=</span> <span class="n">fastnumvis</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ob</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">lblist</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> 
                    <span class="n">Blist</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">PAlist</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rad_per_pixel</span><span class="p">,</span> <span class="n">PAdisk</span><span class="o">=</span><span class="p">(</span><span class="mf">216.9</span> <span class="o">+</span> <span class="mf">90.</span><span class="p">))</span>
                <span class="n">V2</span> <span class="o">+=</span> <span class="p">[</span><span class="n">V</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">fig2</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">imshowl</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ob</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">_phc</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig2</span><span class="p">,</span> <span class="n">figname</span><span class="o">=</span><span class="s">&#39;{0}_{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">mod</span><span class="p">),</span> 
                <span class="n">ob</span><span class="p">))</span>
            <span class="n">V2</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">V2</span><span class="p">)</span> 
            <span class="k">if</span> <span class="n">bindata</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">V2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">mcolors</span><span class="p">[</span><span class="n">midx</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
                    <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="n">midx</span><span class="p">])</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">V2</span><span class="p">)</span> <span class="o">/</span> <span class="n">yerr</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">mcolors</span><span class="p">[</span><span class="n">midx</span><span class="p">],</span>
                    <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="n">midx</span><span class="p">],</span> 
                    <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">printsum</span><span class="p">:</span>
                    <span class="n">chi2</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">chi2calc</span><span class="p">(</span><span class="n">V2</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">)</span>
                    <span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.87</span><span class="p">,</span> <span class="s">r&#39;$\sum={0:.1f}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chi2</span><span class="p">),</span> 
                        <span class="n">transform</span><span class="o">=</span><span class="n">ax2</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">printsum</span><span class="p">:</span>
                <span class="n">v2sum</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y</span> <span class="o">-</span> <span class="n">V2</span><span class="p">)</span> <span class="o">/</span> <span class="n">yerr</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">v2sum</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.87</span><span class="p">,</span> <span class="s">r&#39;$\sum={0:.1f}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v2sum</span><span class="p">),</span> 
                    <span class="n">transform</span><span class="o">=</span><span class="n">ax2</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="c"># Blim = ax3.get_xlim()</span>
    <span class="c"># ax4.set_xlim(Blim)</span>
    <span class="c"># ax1.xaxis.get_major_formatter().set_useOffset(False)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">_mtick</span><span class="o">.</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%.2e</span><span class="s">&#39;</span><span class="p">))</span>
    <span class="c"># ax3.get_xaxis().set_visible(False)</span>
    <span class="c"># ax4.get_xaxis().set_visible(False)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">u&#39;$V$ $^2$&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">u&#39;$V$ $^2$(data-mod)/err&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_right</span><span class="p">()</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s">&quot;right&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span><span class="p">,</span> <span class="n">ax2</span>

</div>
<div class="viewcode-block" id="plot_phi3_res"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.plot_phi3_res">[docs]</a><span class="k">def</span> <span class="nf">plot_phi3_res</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">oidata</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">modfiles</span><span class="p">,</span> <span class="n">obsdeg</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
    <span class="n">dist</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">PAs</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span> <span class="n">PAsrev</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">PArv</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
    <span class="n">bindata</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">alp</span><span class="o">=.</span><span class="mi">75</span><span class="p">,</span> <span class="n">printsum</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; modfiles = models! </span>

<span class="sd">    `bindata` refers to vis2.wavelength.eff_wave!! In other words: the binning</span>
<span class="sd">    only works on simultaneous observations with different :math:`\lambda`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ms</span> <span class="o">=</span> <span class="mf">3.5</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e8</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e8</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;black&#39;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">,</span> <span class="n">Blist</span><span class="p">,</span> <span class="n">PAlist</span><span class="p">,</span> <span class="n">Bmax</span> <span class="o">=</span> <span class="p">([],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[])</span>
    <span class="k">for</span> <span class="n">t3</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">t3</span><span class="p">:</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">u1coord</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">v1coord</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">u2coord</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">v2coord</span>
        <span class="c"># if _np.sqrt(u1**2 + v1**2) &gt; _np.sqrt(u2**2 + v2**2):</span>
        <span class="c">#     u = u1</span>
        <span class="c">#     v = v1</span>
        <span class="c"># else:</span>
        <span class="c">#     u = u2</span>
        <span class="c">#     v = v2</span>
        <span class="c"># B = _np.sqrt(u**2 + v**2)</span>
        <span class="c"># PA = _np.arctan2(u, v) * 180.0 / _np.pi</span>
        <span class="n">Bcompar</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">[</span><span class="n">u1</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">v1</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">u2</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">v2</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">u1</span><span class="o">+</span><span class="n">u2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">PAcompar</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">[</span><span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">v1</span><span class="p">),</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u2</span><span class="p">,</span> <span class="n">v2</span><span class="p">),</span> 
            <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u1</span><span class="o">+</span><span class="n">u2</span><span class="p">,</span> <span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="p">)]</span> <span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Bcompar</span> <span class="o">==</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Bcompar</span><span class="p">))</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">Bcompar</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">))</span>
        <span class="n">PA</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">PAcompar</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">PA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">PA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">PAs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">PAsrev</span> <span class="ow">and</span> <span class="n">PA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> 
            <span class="n">PArv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">PA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">Bmax</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
                <span class="n">lbsz</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">)</span>
                <span class="n">x</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">B</span><span class="o">/</span><span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">)</span>
                <span class="n">y</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">t3phi</span><span class="p">)</span>
                <span class="n">yerr</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">t3phierr</span><span class="p">)</span>
                <span class="n">B1</span><span class="p">,</span> <span class="n">B2</span> <span class="o">=</span> <span class="p">(</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v1</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
                <span class="n">Blist</span><span class="o">.</span><span class="n">extend</span><span class="p">([[</span><span class="n">B1</span><span class="p">,</span> <span class="n">B2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lbsz</span><span class="p">)])</span>
                <span class="n">PA1</span><span class="p">,</span> <span class="n">PA2</span> <span class="o">=</span> <span class="p">(</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> 
                    <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u2</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="p">)</span>
                <span class="n">PAlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([[</span><span class="n">PA1</span><span class="p">,</span> <span class="n">PA2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lbsz</span><span class="p">)])</span>
    <span class="k">if</span> <span class="n">bindata</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">binned</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">bindata</span><span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">,</span> <span class="n">t3</span><span class="o">.</span><span class="n">t3phi</span><span class="p">,</span> 
            <span class="n">bindata</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">t3</span><span class="o">.</span><span class="n">t3phierr</span><span class="p">,</span> <span class="nb">xrange</span><span class="o">=</span><span class="n">xlim</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">binned</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">binned</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">yerr</span><span class="o">=</span><span class="n">binned</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> 
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="n">mcolors</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">gradColor</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">modfiles</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="n">cmapn</span><span class="o">=</span><span class="s">&#39;Greens_r&#39;</span><span class="p">)</span>
    <span class="n">mcolors</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mcolors</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">mcolors</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;dimgray&#39;</span><span class="p">,</span> <span class="s">&#39;blue&#39;</span><span class="p">]</span>
    <span class="n">mcolors</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="s">&#39;red&#39;</span><span class="p">]</span>
    <span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">]</span>
    <span class="c"># mcolors = [&#39;red&#39;, &#39;green&#39;]</span>
    <span class="k">if</span> <span class="n">obsdeg</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">obsdeg</span>
    <span class="k">for</span> <span class="n">mod</span> <span class="ow">in</span> <span class="n">modfiles</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">modfiles</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">obslist</span><span class="p">,</span> <span class="n">lbdc</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">readmap</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="n">quiet</span><span class="p">)</span>
        <span class="c"># It is just taking the length. Ignore the indexes</span>
        <span class="n">pixsize</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="c"># *60.*60.*1000.*180./_np.pi)</span>
        <span class="n">rad_per_pixel</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span> <span class="n">pixsize</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Rsun</span><span class="o">.</span><span class="n">cgs</span> <span class="o">/</span> <span class="p">(</span><span class="n">dist</span> <span class="o">*</span> 
            <span class="n">_phc</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">cgs</span><span class="p">))</span>
        <span class="n">lblist</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Bmax</span><span class="p">)</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> 
        <span class="k">for</span> <span class="n">deg</span> <span class="ow">in</span> <span class="n">obs</span><span class="p">:</span>
            <span class="n">t3m</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ob</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">obslist</span><span class="p">[::</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">find_nearest</span><span class="p">(</span><span class="n">obslist</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="n">deg</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">obslist</span><span class="p">[::</span><span class="mi">2</span><span class="p">][</span><span class="n">ob</span><span class="p">]</span> <span class="o">-</span> <span class="n">deg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;# The difference of angles is bigger than 1 deg!!!&#39;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Input: {0:.1f}; Nearest model: {1:.1f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">deg</span><span class="p">,</span> <span class="n">obslist</span><span class="p">[::</span><span class="mi">2</span><span class="p">][</span><span class="n">ob</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
                <span class="n">j</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">lbdc</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">find_nearest</span><span class="p">(</span><span class="n">lbdc</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span> 
                    <span class="n">lblist</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lbdc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="mf">1e-6</span> <span class="o">-</span> <span class="n">lblist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="o">*</span><span class="mf">1e-6</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;# The difference of lambd is bigger than 0.1 um!!!&#39;</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Input: {0:.1f}; Nearest model: {1:.1f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">lblist</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lbdc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="mf">1e-6</span><span class="p">))</span>
                <span class="c"># lcalc = lbdc[j] * 1e-6</span>
                <span class="n">tmp</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">phvar</span> <span class="o">=</span> <span class="n">fastnumvis3</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ob</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">lblist</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> 
                    <span class="n">Blist</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">PAlist</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rad_per_pixel</span><span class="p">,</span> <span class="n">PAdisk</span><span class="o">=</span><span class="p">(</span><span class="mf">216.9</span> <span class="o">+</span> <span class="mf">90.</span><span class="p">))</span>
                <span class="n">t3m</span> <span class="o">+=</span> <span class="p">[</span><span class="n">phvar</span><span class="p">]</span>
            <span class="n">t3m</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t3m</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bindata</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t3m</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">mcolors</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">t3m</span><span class="p">)</span> <span class="o">/</span> <span class="n">yerr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">mcolors</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
                    <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> 
                    <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>  <span class="c"># alpha=.6,</span>
                <span class="k">if</span> <span class="n">printsum</span><span class="p">:</span>
                    <span class="n">chi2</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">chi2calc</span><span class="p">(</span><span class="n">t3m</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">)</span>
                    <span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.87</span><span class="p">,</span> <span class="s">r&#39;$\sum={0:.1f}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chi2</span><span class="p">),</span> 
                        <span class="n">transform</span><span class="o">=</span><span class="n">ax2</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">binned</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">bindata</span><span class="p">(</span><span class="n">Bmax</span> <span class="o">/</span> <span class="n">lbds</span><span class="p">,</span> <span class="n">t3m</span><span class="p">,</span> <span class="n">bindata</span><span class="p">,</span> <span class="nb">xrange</span><span class="o">=</span><span class="n">xlim</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">binned</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">binned</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">mcolors</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">9</span><span class="p">)</span>
                <span class="n">binned</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">bindata</span><span class="p">(</span><span class="n">Bmax</span> <span class="o">/</span> <span class="n">lbds</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">t3m</span><span class="p">)</span> <span class="o">/</span> <span class="n">yerr</span><span class="p">,</span> <span class="n">bindata</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">binned</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">binned</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">mcolors</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>  
                    <span class="c"># alpha=.6,                </span>
    <span class="c"># ax5.get_xaxis().set_ticklabels([])</span>
    <span class="c"># labels = ax5.get_yticks().tolist()</span>
    <span class="c"># labels[-1] = &#39;&#39;</span>
    <span class="c"># ax5.set_yticklabels(labels)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="c"># ymax = _np.max(_np.abs(ax5.get_ylim()))</span>
    <span class="c"># ax5.set_ylim([-1.05 * ymax, 1.05 * ymax])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">u&#39;B$_{proj}$/$\lambda$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">u&#39;$\phi_{123}$ (deg.)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_right</span><span class="p">()</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s">&quot;right&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">u&#39;B$_{proj}$/$\lambda$&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">u&#39;$\phi_{123}$(data-mod)/err&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span><span class="p">,</span> <span class="n">ax2</span>

</div>
<div class="viewcode-block" id="plot_pionier_res"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.plot_pionier_res">[docs]</a><span class="k">def</span> <span class="nf">plot_pionier_res</span><span class="p">(</span><span class="n">oidata</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">outname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;png&#39;</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">obs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mf">42.75</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">bindata</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
    <span class="n">PArange</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span> <span class="n">PArr</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">shv2sum</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;  Obs-Model comparison for PIONIER</span>

<span class="sd">    model, obs are lists</span>
<span class="sd">    dist is a number</span>
<span class="sd">    `PArange` is in deg., from -180 to 180.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># PArange = _np.array(PArange)*2*_np.pi/180</span>
    <span class="n">v2sum</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">if</span> <span class="n">outname</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">outname</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">dtflag</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">PArr</span><span class="p">:</span>
        <span class="n">PArv</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">PArange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">PArv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">PArange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># PArv[0] == 0 must be -180!</span>
            <span class="n">PArv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">PArange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">180</span>
        <span class="k">if</span> <span class="n">PArange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># PArv[1] == 0 must be +180!</span>
            <span class="n">PArv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">PArange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">PArv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">PArange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">180</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>  <span class="c"># figsize=(5.6,8))</span>
    <span class="n">alp</span> <span class="o">=</span> <span class="o">.</span><span class="mi">75</span>
    <span class="n">ms</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c"># markersize</span>
    <span class="c"># xloc = _plt.MaxNLocator(6)</span>
    <span class="c"># ax0 = display info</span>
    <span class="c"># ax0 = fig.add_subplot(211)</span>
    <span class="c"># ax0.axis(&#39;off&#39;)</span>
    <span class="c"># hdrinfo = oidata.hdrinfo.returninfo()</span>
    <span class="c"># for i in range(4):</span>
        <span class="c"># ax0.text(0., .8-.2*i, hdrinfo[i])</span>
    <span class="c"># ax1 = uvplane/lambda</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">321</span><span class="p">)</span>
    <span class="n">colorid</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">vis2</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">vis2</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">ucoord</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">vcoord</span>
        <span class="n">ulbd</span> <span class="o">=</span> <span class="n">u</span> <span class="o">/</span> <span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span>
        <span class="n">vlbd</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span>
        <span class="n">PA</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;unnamed&#39;</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="n">label</span><span class="p">]</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span><span class="p">)]</span>
        <span class="c"># colorid = _np.mod(colorid+1, len(phc.colors))</span>
        <span class="c"># [u,-u] = W &gt; E</span>
        <span class="c"># [-u,u] = E &lt; W</span>
        <span class="c"># label=label,</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">PA</span> <span class="o">&gt;=</span> <span class="n">PArange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">PA</span> <span class="o">&lt;=</span> <span class="n">PArange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">PArr</span> <span class="ow">and</span> 
            <span class="p">(</span><span class="n">PA</span> <span class="o">&gt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="n">PA</span> <span class="o">&lt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">ulbd</span><span class="p">,</span> <span class="o">-</span><span class="n">ulbd</span><span class="p">],</span> <span class="p">[</span><span class="n">vlbd</span><span class="p">,</span> <span class="o">-</span><span class="n">vlbd</span><span class="p">],</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
    <span class="c"># ax1.xaxis.tick_top()</span>
    <span class="c"># ax1.xaxis.set_major_formatter(mtick.FormatStrFormatter(&#39;%.2e&#39;))</span>
    <span class="c"># names = list(_np.unique(names))</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">u&#39;B$_{proj}$/$\lambda$&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="c"># if legend: ax1.legend(prop={&#39;size&#39;:8},numpoints=1,bbox_to_anchor=(-0.25,</span>
        <span class="c"># 1.0))</span>
    <span class="c"># ax2 = uvplane</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">322</span><span class="p">)</span>
    <span class="n">colorid</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">leg</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">vis2</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">vis2</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">ucoord</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">vcoord</span>
        <span class="n">PA</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;unnamed&#39;</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span><span class="p">)]</span>
        <span class="c"># color = phc.colors[colorid]</span>
        <span class="c"># colorid = _np.mod(colorid+1, len(phc.colors))</span>
        <span class="c"># [u,-u] = W &gt; E</span>
        <span class="c"># [-u,u] = E &lt; W</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">PA</span> <span class="o">&gt;=</span> <span class="n">PArange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">PA</span> <span class="o">&lt;=</span> <span class="n">PArange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">PArr</span> <span class="ow">and</span> 
            <span class="p">(</span><span class="n">PA</span> <span class="o">&gt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="n">PA</span> <span class="o">&lt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">leg</span><span class="p">:</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">u</span><span class="p">,</span> <span class="o">-</span><span class="n">u</span><span class="p">],</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">],</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
                <span class="n">leg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">u</span><span class="p">,</span> <span class="o">-</span><span class="n">u</span><span class="p">],</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">],</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>  <span class="c"># label=label,</span>
        <span class="c"># names.append(vis2.target.target)</span>
    <span class="c"># names = list(_np.unique(names))</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">tick_top</span><span class="p">()</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">u&#39;B$_{proj}$ (m)&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span> <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">framealpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c"># ax3 = VIS2 vs. B</span>
    <span class="c"># ax4 = VIS2 vs. PA</span>
    <span class="c"># names = []</span>
    <span class="n">colorid</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">mcolors</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;black&#39;</span><span class="p">,</span> <span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="s">&#39;blue&#39;</span><span class="p">]</span>
    <span class="n">plotid</span> <span class="o">=</span> <span class="mi">323</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">plotid</span><span class="p">)</span>
    <span class="n">plotid</span> <span class="o">=</span> <span class="mi">324</span>
    <span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">plotid</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e8</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;ax4&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">vis2</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">vis2</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">ucoord</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">vcoord</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;unnamed&#39;</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span><span class="p">)]</span>
        <span class="c"># color = phc.colors[colorid]</span>
        <span class="c"># colorid = _np.mod(colorid + 1, len(phc.colors))</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">PA</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">PA</span> <span class="o">&gt;=</span> <span class="n">PArange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">PA</span> <span class="o">&lt;=</span> <span class="n">PArange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">PArr</span> <span class="ow">and</span> 
            <span class="p">(</span><span class="n">PA</span> <span class="o">&gt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="n">PA</span> <span class="o">&lt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">bindata</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">,</span> 
                    <span class="n">vis2</span><span class="o">.</span><span class="n">vis2data</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">vis2</span><span class="o">.</span><span class="n">vis2err</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> 
                    <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">binned</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">bindata</span><span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">,</span> 
                    <span class="n">vis2</span><span class="o">.</span><span class="n">vis2data</span><span class="p">,</span> <span class="n">bindata</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">vis2</span><span class="o">.</span><span class="n">vis2err</span><span class="p">,</span> <span class="nb">xrange</span><span class="o">=</span><span class="n">xlim</span><span class="p">)</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">binned</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">binned</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">yerr</span><span class="o">=</span><span class="n">binned</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> 
                    <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
            <span class="c"># , label=label)</span>
        <span class="c"># _np.arctan(self.ucoord / self.vcoord) * 180.0 / _np.pi % 180.0</span>
        <span class="k">if</span> <span class="n">obs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">obs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">mod</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">obslist</span><span class="p">,</span> <span class="n">lbdc</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">readmap</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="n">quiet</span><span class="p">)</span>
            <span class="n">pixsize</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="c"># *60.*60.*1000.*180./_np.pi)</span>
            <span class="n">rad_per_pixel</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span>
                <span class="n">pixsize</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Rsun</span><span class="o">.</span><span class="n">cgs</span> <span class="o">/</span> <span class="p">(</span><span class="n">dist</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">cgs</span><span class="p">))</span>
            <span class="n">V2</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">lbds</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">ob</span> <span class="ow">in</span> <span class="n">obs</span><span class="p">:</span>
                    <span class="n">lbd</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="n">lbdc</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">find_nearest</span><span class="p">(</span><span class="n">lbdc</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">lbd</span><span class="p">))</span>
                    <span class="c"># lbcalc = lbdc[j]*1e-6</span>
                    <span class="n">lbcalc</span> <span class="o">=</span> <span class="n">lbd</span>
                    <span class="n">tmp</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">phvar</span> <span class="o">=</span> <span class="n">fastnumvis</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ob</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">lbcalc</span><span class="p">,</span> 
                        <span class="n">B</span><span class="p">,</span> <span class="n">PA</span><span class="p">,</span> <span class="n">rad_per_pixel</span><span class="p">,</span> <span class="n">PAdisk</span><span class="o">=</span><span class="p">(</span><span class="mf">216.9</span> <span class="o">+</span> <span class="mf">90.</span><span class="p">))</span>
                    <span class="n">V2</span> <span class="o">+=</span> <span class="p">[</span><span class="n">V</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">lbds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">lbcalc</span><span class="p">]</span>
            <span class="n">lbds</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lbds</span><span class="p">)</span>
            <span class="c"># V2 = _np.array(V2)+(.0875e-8*B/lbds-.026)</span>
            <span class="n">V2</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">V2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">.</span><span class="mf">0875e-8</span> <span class="o">*</span> <span class="n">B</span> <span class="o">/</span> <span class="n">lbds</span> <span class="o">-</span> <span class="o">.</span><span class="mo">026</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">PA</span> <span class="o">&gt;=</span> <span class="n">PArange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">PA</span> <span class="o">&lt;=</span> <span class="n">PArange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">PArr</span> <span class="ow">and</span> 
                <span class="p">(</span><span class="n">PA</span> <span class="o">&gt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="n">PA</span> <span class="o">&lt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">bindata</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">v2sum</span> <span class="o">+=</span> <span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">vis2data</span> <span class="o">-</span> <span class="n">V2</span><span class="p">)</span> <span class="o">/</span> <span class="n">vis2</span><span class="o">.</span><span class="n">vis2err</span>
                    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="n">lbds</span><span class="p">,</span> <span class="n">V2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">mcolors</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">)</span>
                    <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="n">lbds</span><span class="p">,</span> <span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">vis2data</span> <span class="o">-</span> <span class="n">V2</span><span class="p">)</span> <span class="o">/</span> <span class="n">vis2</span><span class="o">.</span><span class="n">vis2err</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">mcolors</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">binned</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">bindata</span><span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="n">lbds</span><span class="p">,</span> <span class="n">V2</span><span class="p">,</span> <span class="n">bindata</span><span class="p">,</span> <span class="nb">xrange</span><span class="o">=</span><span class="n">xlim</span><span class="p">)</span>
                    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">binned</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">binned</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">mcolors</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">)</span>
                    <span class="n">binned</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">bindata</span><span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="n">lbds</span><span class="p">,</span> <span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">vis2data</span> <span class="o">-</span> <span class="n">V2</span><span class="p">)</span> <span class="o">/</span> 
                        <span class="n">vis2</span><span class="o">.</span><span class="n">vis2err</span><span class="p">,</span> <span class="n">bindata</span><span class="p">,</span> <span class="nb">xrange</span><span class="o">=</span><span class="n">xlim</span><span class="p">)</span>
                    <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">binned</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">binned</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">mcolors</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="c"># marker=&#39;s&#39;,</span>
    <span class="n">Blim</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">Blim</span><span class="p">)</span>
    <span class="c"># ax1.xaxis.get_major_formatter().set_useOffset(False)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">_mtick</span><span class="o">.</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%.2e</span><span class="s">&#39;</span><span class="p">))</span>
    <span class="c"># ax3.get_xaxis().set_visible(False)</span>
    <span class="c"># ax4.get_xaxis().set_visible(False)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
    <span class="n">PAlim</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">]</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">u&#39;$V$ $^2$&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">u&#39;$V$ $^2$(data-mod)/err&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">shv2sum</span><span class="p">:</span>
        <span class="n">v2sum</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v2sum</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">v2sum</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.87</span><span class="p">,</span> <span class="s">r&#39;$\sum={0:.1f}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v2sum</span><span class="p">),</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax4</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
        <span class="c"># ax4.text(0.4, 0.8, &#39;ADS&#39;, transform=ax4.transAxes)</span>
    <span class="c"># ax5 = T3PHI vs. B</span>
    <span class="c"># ax6 = T3PHI vs. PA</span>
    <span class="c"># names = []</span>
    <span class="n">colorid</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">plotid</span> <span class="o">=</span> <span class="mi">325</span>
    <span class="n">ax5</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">plotid</span><span class="p">)</span>
    <span class="n">plotid</span> <span class="o">=</span> <span class="mi">326</span>
    <span class="n">ax6</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">plotid</span><span class="p">)</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Blim</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">ax6</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Blim</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;ax6&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">t3</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">t3</span><span class="p">:</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">u1coord</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">v1coord</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">u2coord</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">v2coord</span>
        <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v2</span><span class="o">**</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">u1</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">u2</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v2</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">PA</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">))</span>
        <span class="n">PA</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">PA</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">))</span>
        <span class="c"># idx = _np.where(PA &lt; 0)</span>
        <span class="c"># PA[idx] = PA[idx]+180</span>
        <span class="c"># if (t3.station[0] and t3.station[1]):</span>
            <span class="c"># label = t3.station[0].sta_name + t3.station[1].sta_name</span>
        <span class="c"># else:</span>
            <span class="c"># label = &#39;unnamed&#39;</span>
        <span class="c"># color = names.index(label)</span>
        <span class="c"># color = phc.colors[colorid]</span>
        <span class="c"># colorid = _np.mod(colorid + 1, len(phc.colors))</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;Black&#39;</span>
        <span class="c"># y = _np.repeat(t3.t3phi, len(t3.wavelength.eff_wave))</span>
        <span class="c"># yerr = _np.repeat(t3.t3phierr, len(t3.wavelength.eff_wave))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">t3phi</span>
        <span class="n">yerr</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">t3phierr</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">PA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">PArange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">PA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">PArange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">PArr</span> <span class="ow">and</span> 
            <span class="n">PA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">PA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">bindata</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">ax5</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">binned</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">bindata</span><span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> 
                    <span class="n">bindata</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span> <span class="nb">xrange</span><span class="o">=</span><span class="n">xlim</span><span class="p">)</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">ax5</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">binned</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">binned</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">yerr</span><span class="o">=</span><span class="n">binned</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> 
                    <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
            <span class="c"># , label=label)</span>
        <span class="k">if</span> <span class="n">obs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">obs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">mod</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">obslist</span><span class="p">,</span> <span class="n">lbdc</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">readmap</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">pixsize</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="c"># *60.*60.*1000.*180./_np.pi)</span>
            <span class="n">rad_per_pixel</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span>
                <span class="n">pixsize</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Rsun</span><span class="o">.</span><span class="n">cgs</span> <span class="o">/</span> <span class="p">(</span><span class="n">dist</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">cgs</span><span class="p">))</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v1</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v2</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">PA</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span>
                <span class="n">u2</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">Bmax</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">PAmax</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">t3m</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">lbds</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">ob</span> <span class="ow">in</span> <span class="n">obs</span><span class="p">:</span>
                    <span class="n">lbd</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="n">lbdc</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">find_nearest</span><span class="p">(</span><span class="n">lbdc</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">lbd</span><span class="p">))</span>
                    <span class="n">lcalc</span> <span class="o">=</span> <span class="n">lbdc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e-6</span>
                    <span class="n">lcalc</span> <span class="o">=</span> <span class="n">lbd</span>
                    <span class="n">tmp</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">phvar</span> <span class="o">=</span> <span class="n">fastnumvis3</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ob</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">lcalc</span><span class="p">,</span> 
                        <span class="n">B</span><span class="p">,</span> <span class="n">PA</span><span class="p">,</span> <span class="n">rad_per_pixel</span><span class="p">,</span> <span class="n">PAdisk</span><span class="o">=</span><span class="p">(</span><span class="mf">216.9</span> <span class="o">+</span> <span class="mf">90.</span><span class="p">))</span>
                    <span class="n">t3m</span> <span class="o">+=</span> <span class="p">[</span><span class="n">phvar</span><span class="p">]</span>
                    <span class="n">Bmax</span> <span class="o">+=</span> <span class="p">[</span><span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">B</span><span class="p">)]</span>
                    <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">==</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">PAmax</span> <span class="o">+=</span> <span class="p">[</span><span class="n">PA</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">PAmax</span> <span class="o">+=</span> <span class="p">[</span><span class="n">PA</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                    <span class="n">lbds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">lcalc</span><span class="p">]</span>
            <span class="n">Bmax</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Bmax</span><span class="p">)</span>
            <span class="n">lbds</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lbds</span><span class="p">)</span>
            <span class="n">t3m</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t3m</span><span class="p">)</span>
            <span class="n">PAmax</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">PAmax</span><span class="p">)</span>
            <span class="c"># print PAmax</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">PA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">PArange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">PA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">PArange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">PArr</span> <span class="ow">and</span> 
                <span class="n">PA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">PA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">PArv</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">bindata</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">ax5</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Bmax</span> <span class="o">/</span> <span class="n">lbds</span><span class="p">,</span> <span class="n">t3m</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">mcolors</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">9</span><span class="p">)</span>
                    <span class="n">ax6</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Bmax</span> <span class="o">/</span> <span class="n">lbds</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">t3m</span><span class="p">)</span> <span class="o">/</span> <span class="n">yerr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">mcolors</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
                        <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>  <span class="c"># alpha=.6,</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">binned</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">bindata</span><span class="p">(</span><span class="n">Bmax</span> <span class="o">/</span> <span class="n">lbds</span><span class="p">,</span> <span class="n">t3m</span><span class="p">,</span> <span class="n">bindata</span><span class="p">,</span> <span class="nb">xrange</span><span class="o">=</span><span class="n">xlim</span><span class="p">)</span>
                    <span class="n">ax5</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">binned</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">binned</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">mcolors</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">9</span><span class="p">)</span>
                    <span class="n">binned</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">bindata</span><span class="p">(</span><span class="n">Bmax</span> <span class="o">/</span> <span class="n">lbds</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">t3m</span><span class="p">)</span> <span class="o">/</span> <span class="n">yerr</span><span class="p">,</span> <span class="n">bindata</span><span class="p">)</span>
                    <span class="n">ax6</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">binned</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">binned</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">mcolors</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>  
                        <span class="c"># alpha=.6,                </span>
    <span class="c"># ax5.get_xaxis().set_ticklabels([])</span>
    <span class="c"># labels = ax5.get_yticks().tolist()</span>
    <span class="c"># labels[-1] = &#39;&#39;</span>
    <span class="c"># ax5.set_yticklabels(labels)</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">Blim</span><span class="p">)</span>
    <span class="n">ax6</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">Blim</span><span class="p">)</span>
    <span class="n">ymax</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ax5</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()))</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">1.05</span> <span class="o">*</span> <span class="n">ymax</span><span class="p">,</span> <span class="mf">1.05</span> <span class="o">*</span> <span class="n">ymax</span><span class="p">])</span>
    <span class="n">ax6</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">u&#39;B$_{proj}$/$\lambda$&#39;</span><span class="p">)</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">u&#39;$\phi_{123}$ (deg.)&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax5</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="n">ax6</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">u&#39;B$_{proj}$/$\lambda$&#39;</span><span class="p">)</span>
    <span class="n">ax6</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">u&#39;$\phi_{123}$(data-mod)/err&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax6</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">ax6</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="c"># SAVING</span>
    <span class="c"># dir, name = _phc.trimpathname(ffile)</span>
    <span class="c"># name = _phc.rmext(name)</span>
    <span class="c"># _plt.savefig(&#39;hdt/{}_{}.png&#39;.format(hdrinfo[0], hdrinfo[2]),</span>
        <span class="c"># transparent=True)</span>
    <span class="c"># _plt.locator_params(axis = &#39;x&#39;, nbins = 7)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
        <span class="n">left</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.96</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.09</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=.</span><span class="mo">00</span><span class="mi">9</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=.</span><span class="mi">32</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;asdhasduhasd&#39;</span><span class="p">)</span>
    <span class="n">_phc</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">figname</span><span class="o">=</span><span class="n">outname</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="plot_oifits"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.plot_oifits">[docs]</a><span class="k">def</span> <span class="nf">plot_oifits</span><span class="p">(</span><span class="n">oidata</span><span class="p">,</span> <span class="n">ffile</span><span class="o">=</span><span class="s">&#39;last_run&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;png&#39;</span><span class="p">],</span> <span class="nb">xrange</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">legend</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Standard observational log for AMBER</span>

<span class="sd">    If the file starts with &quot;PRODUCT_&quot;, it searchs for the specs in the &quot;AVG&quot;</span>
<span class="sd">    folder.</span>

<span class="sd">    (One could write this info into the fits file. Since I&#39;ve only tested the</span>
<span class="sd">    reading features of the `oifits` routine, I prefered do it this way).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># If it is a PRODUCT ffile, tries to load the AVG spec.</span>
    <span class="n">specfile</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">ffile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;_PRO/PRODUCT&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">dateobs</span> <span class="o">=</span> <span class="n">ffile</span><span class="p">[</span><span class="n">ffile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;_20&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">ffile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;_20&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">20</span><span class="p">]</span>
        <span class="n">dateobs2</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">strrep</span><span class="p">(</span><span class="n">dateobs</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">dateobs2</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">strrep</span><span class="p">(</span><span class="n">dateobs2</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="s">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">specfile</span> <span class="o">=</span> <span class="n">ffile</span><span class="p">[:</span><span class="n">ffile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;_PRO/PRODUCT_&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;_SPEC&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span>\
            <span class="s">&#39;/*{0}*_OIDATA_AVG.fits*&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dateobs</span><span class="p">)</span>
        <span class="n">specfile</span> <span class="o">=</span> <span class="n">_glob</span><span class="p">(</span><span class="n">specfile</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">specfile</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">specfile</span> <span class="o">=</span> <span class="n">ffile</span><span class="p">[:</span><span class="n">ffile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;_PRO/PRODUCT_&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;_SPEC&#39;</span><span class="p">,</span>
                <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;/*{0}*_OIDATA_AVG.fits*&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dateobs2</span><span class="p">)</span>
            <span class="n">specfile</span> <span class="o">=</span> <span class="n">_glob</span><span class="p">(</span><span class="n">specfile</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">specfile</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">specfile</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;# ERROR! This is a PRO oifits and the AVG file was &#39;</span> <span class="o">+</span>
            <span class="s">&#39;not found!&#39;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">ffile</span><span class="p">[:</span><span class="n">ffile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;_PRO/PRODUCT_&#39;</span><span class="p">)]</span> <span class="o">+</span> <span class="p">(</span><span class="s">&#39;/*{0}*_OIDATA_&#39;</span> <span class="o">+</span>
        <span class="s">&#39;AVG.fits*&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dateobs</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">specfile</span> <span class="o">=</span> <span class="n">specfile</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">specoidata</span> <span class="o">=</span> <span class="n">_oifits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">specfile</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="c"># print(&#39;# {0} file read!!!&#39;.format(specfile))</span>
            <span class="n">oidata</span><span class="o">.</span><span class="n">amberspec</span> <span class="o">=</span> <span class="n">specoidata</span><span class="o">.</span><span class="n">amberspec</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="n">oidata</span><span class="o">.</span><span class="n">amberspec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">vis</span> <span class="o">=</span> <span class="n">oidata</span><span class="o">.</span><span class="n">vis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">oidata</span><span class="o">.</span><span class="n">vis</span><span class="p">)):</span>
                    <span class="n">oidata</span><span class="o">.</span><span class="n">amberspec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="n">oidata</span><span class="o">.</span><span class="n">vis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">wavelength</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;# ERROR! spec and vis sizes are different for {0}&#39;</span><span class="o">.</span>
                <span class="n">format</span><span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">trimpathname</span><span class="p">(</span><span class="n">ffile</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="c">#</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">5.6</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">alp</span> <span class="o">=</span> <span class="o">.</span><span class="mi">75</span>
    <span class="c"># xloc = _plt.MaxNLocator(6)</span>
    <span class="c"># ax0 = display info</span>
    <span class="n">ax0</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">521</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
    <span class="n">hdrinfo</span> <span class="o">=</span> <span class="n">oidata</span><span class="o">.</span><span class="n">hdrinfo</span><span class="o">.</span><span class="n">returninfo</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span> <span class="o">-</span> <span class="o">.</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="n">hdrinfo</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="c"># ax2 = uvplane.</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">522</span><span class="p">)</span>
    <span class="n">colorid</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">vis</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">vis</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">xrange</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1e6</span> <span class="o">*</span> <span class="n">vis</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">[</span>
                <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">flag</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">)],</span> <span class="n">xmax</span><span class="p">))</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1e6</span> <span class="o">*</span> <span class="n">vis</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">[</span>
                <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">flag</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">)],</span> <span class="n">xmin</span><span class="p">))</span>
            <span class="nb">xrange</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">ucoord</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">vcoord</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> <span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;unnamed&#39;</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">colorid</span><span class="p">]</span>
        <span class="n">colorid</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">colorid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span>
        <span class="c"># [u,-u] = W &gt; E</span>
        <span class="c"># [-u,u] = E &lt; W</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="n">u</span><span class="p">,</span> <span class="n">u</span><span class="p">],</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">],</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">tick_top</span><span class="p">()</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span> <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
    <span class="c"># ax3 = dif.phases, RIGHT COLUMN</span>
    <span class="n">plotid</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">colorid</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">yrange</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">vis</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">vis</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">visphi</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">diff</span> <span class="o">&gt;</span> <span class="n">yrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">yrange</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">diff</span><span class="p">,</span> <span class="n">diff</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">vis</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">vis</span><span class="p">:</span>
        <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="o">*</span><span class="n">plotid</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> <span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;unnamed&#39;</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">colorid</span><span class="p">]</span>
        <span class="n">colorid</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">colorid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="mf">1e6</span> <span class="o">*</span> <span class="n">vis</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">,</span> <span class="n">vis</span><span class="o">.</span><span class="n">visphi</span><span class="p">,</span>
            <span class="n">vis</span><span class="o">.</span><span class="n">visphierr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">xrange</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">u&#39;$\phi$ (deg.)&#39;</span><span class="p">)</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">names</span><span class="p">))</span>
        <span class="c"># title = names.pop()</span>
        <span class="c"># for name in names:</span>
        <span class="c">#    title += &#39;, %s&#39;%(name)</span>
        <span class="c"># ax1.set_title(title)</span>
        <span class="c"># ax1.set_ylabel(&#39;Differential phase&#39;)</span>
        <span class="n">plotid</span> <span class="o">+=</span> <span class="mi">2</span>
        <span class="c"># ax3.get_xaxis().set_visible(False)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="c"># ax5 = closure phases</span>
    <span class="c"># plotid = (5,2,10)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">colorid</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">for</span> <span class="n">t3</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">t3</span><span class="p">:</span>
        <span class="n">ax5</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">t3</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>  <span class="n">t3</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> <span class="n">t3</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> \
                <span class="n">t3</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;unnamed&#39;</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">colorid</span><span class="p">]</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">ax5</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="mf">1e6</span> <span class="o">*</span> <span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">,</span> <span class="n">t3</span><span class="o">.</span><span class="n">t3phi</span><span class="p">,</span>
        <span class="n">t3</span><span class="o">.</span><span class="n">t3phierr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
        <span class="n">ax5</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">xrange</span><span class="p">)</span>
        <span class="c"># diff = _np.max(_np.abs(t3.t3phi))</span>
        <span class="c"># yrange2 = [-diff, diff]</span>
        <span class="n">ax5</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">names</span><span class="p">))</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">u&#39;Closure $\phi$ (deg.)&#39;</span><span class="p">)</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Wavelength ($\mu$m)&#39;</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span> <span class="n">ax5</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_majorticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">35</span> <span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="c"># ax4 = visibilities, LEFT COLUMN</span>
    <span class="n">plotid</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">colorid</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">yrange</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">vis</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">vis2</span><span class="p">:</span>
        <span class="n">yrange</span> <span class="o">=</span> <span class="p">[</span> <span class="n">_np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">yrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">vis2data</span><span class="p">)]),</span>
        <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">yrange</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">vis2data</span><span class="p">)])</span> <span class="p">]</span>
    <span class="k">if</span> <span class="n">yrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.1</span><span class="p">:</span>
        <span class="n">yrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.1</span>
    <span class="k">if</span> <span class="n">yrange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">yrange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">yrange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">vis</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">vis2</span><span class="p">:</span>
        <span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="o">*</span><span class="n">plotid</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> <span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;unnamed&#39;</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">colorid</span><span class="p">]</span>
        <span class="n">colorid</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">colorid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">ax4</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="mf">1e6</span> <span class="o">*</span> <span class="n">vis</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">,</span> <span class="n">vis</span><span class="o">.</span><span class="n">vis2data</span><span class="p">,</span>
            <span class="n">vis</span><span class="o">.</span><span class="n">vis2err</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">names</span><span class="p">))</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yrange</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">xrange</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">u&#39;V$^{2}$&#39;</span><span class="p">)</span>
        <span class="c"># title = names.pop()</span>
        <span class="c"># for name in names:</span>
            <span class="c"># title += &#39;, %s&#39;%(name)</span>
        <span class="c"># ax1.set_title(title)</span>
        <span class="c"># ax1.set_ylabel(&#39;Differential phase&#39;)</span>
        <span class="c"># plotid += 2</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="c"># ax1 = Line profile</span>
    <span class="k">if</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>
        <span class="n">colorid</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">amberspec</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;unnamed&#39;</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">colorid</span><span class="p">]</span>
            <span class="c"># x,y,yerr = linfit(1e6*spec.wavelength.eff_wave, spec.spectrum,</span>
                <span class="c"># yerr=spec.spectrumerr)</span>
            <span class="c"># ax1.errorbar(x, y, yerr, label=label, color=color)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="mf">1e6</span> <span class="o">*</span> <span class="n">spec</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">_linfit</span><span class="p">(</span><span class="mf">1e6</span> <span class="o">*</span> <span class="n">spec</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">,</span> <span class="n">spec</span><span class="o">.</span><span class="n">spectrum</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
            <span class="n">colorid</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">colorid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span>
            <span class="c"># [-u,u] = W &gt; E</span>
            <span class="c"># [u,-u] = E &lt; W</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Wavelength ($\mu$m)&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">xrange</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Norm. flux&#39;</span><span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span> <span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_majorticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">35</span> <span class="p">)</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="n">_phc</span><span class="o">.</span><span class="n">outfld</span><span class="p">()</span>
    <span class="nb">dir</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">trimpathname</span><span class="p">(</span><span class="n">ffile</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">rmext</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="c"># _plt.savefig(&#39;hdt/{}_{}.png&#39;.format(hdrinfo[0], hdrinfo[2]), </span>
        <span class="c"># transparent=True)</span>
    <span class="c"># _plt.locator_params(axis = &#39;x&#39;, nbins = 7)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
        <span class="n">left</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.96</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.09</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=.</span><span class="mo">00</span><span class="mi">9</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=.</span><span class="mi">32</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">suf</span> <span class="ow">in</span> <span class="n">fmt</span><span class="p">:</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;hdt/{0}.{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">suf</span><span class="p">),</span> <span class="n">transparent</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="Disk"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.Disk">[docs]</a><span class="k">class</span> <span class="nc">Disk</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; To compute Vieira&#39;s models.</span>

<span class="sd">    `lbd` in cm (np.array. If None, default value from _phc.BBlbd), `barz2` is </span>
<span class="sd">    the mean value of the square atomic number, `Td` isothermal disk </span>
<span class="sd">    temperature, `fion` is the ionization fraction, mu (:math:`\mu`) is the </span>
<span class="sd">    mean particle weight (mH units), `gb` is the...</span>

<span class="sd">    `Ms` is the stellar mass (Msun). &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lbd</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mo">001</span><span class="p">],</span> <span class="n">barz2</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">Td</span><span class="o">=</span><span class="mf">12120.</span><span class="p">,</span> <span class="n">fion</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> 
        <span class="n">mu</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">gb</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="mf">2.8e-11</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; kappa class initialiser &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lbd</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lbd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Td</span> <span class="o">=</span> <span class="n">Td</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">barz2</span> <span class="o">=</span> <span class="n">barz2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fion</span> <span class="o">=</span> <span class="n">fion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">rho</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span>
        <span class="k">if</span> <span class="n">gb</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># 1e4 = cm to micron</span>
            <span class="n">gb</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">_phc</span><span class="o">.</span><span class="n">gbf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Td</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lbd</span> <span class="o">*</span> <span class="mf">1e4</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gb</span> <span class="o">=</span> <span class="n">gb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

<div class="viewcode-block" id="Disk.update"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.Disk.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Opacity expression from Brussaard &amp; van de Hulst (1962) &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kappa</span> <span class="o">=</span> <span class="mf">3.692e8</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">_np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">_phc</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">cgs</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">cgs</span> <span class="o">/</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">lbd</span> <span class="o">/</span> <span class="n">_phc</span><span class="o">.</span><span class="n">kB</span><span class="o">.</span><span class="n">cgs</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">Td</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">barz2</span> <span class="o">*</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">Td</span><span class="o">**-.</span><span class="mi">5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lbd</span> <span class="o">/</span> <span class="n">_phc</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">cgs</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fion</span> <span class="o">*</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span> <span class="o">/</span> <span class="n">_phc</span><span class="o">.</span><span class="n">mH</span><span class="o">.</span><span class="n">cgs</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gb</span><span class="p">)</span>       
    <span class="c"># End of class</span>

</div></div>
<div class="viewcode-block" id="I"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.I">[docs]</a><span class="k">def</span> <span class="nf">I</span><span class="p">(</span><span class="n">Disk</span><span class="p">,</span> <span class="n">Ms</span><span class="o">=</span><span class="mf">7.7</span><span class="p">,</span> <span class="n">Teff</span><span class="o">=</span><span class="mf">20200.</span><span class="p">,</span> <span class="n">Rs</span><span class="o">=</span><span class="mf">4.94</span><span class="p">,</span> <span class="n">iang</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">bm2n</span><span class="o">=-</span><span class="mf">5.5</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="mf">5e-3</span><span class="p">,</span> 
    <span class="n">Rmax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">px</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">bartau</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; I is the specific intensity of the star plus an isothermal disk. The </span>
<span class="sd">    effects of limb-darkening, stellar rotation and circumstellar extinction </span>
<span class="sd">    are neglected. Image constructed from LOWER origin.</span>

<span class="sd">    Disk: `lbd` is determined in Disk (lambda vector in cm). </span>

<span class="sd">    `Teff` is the stellar effective temperature (K). All derived quantities are </span>
<span class="sd">    based on this value, but the stellar emission, that is corrected by the </span>
<span class="sd">    `fBBcor` function.</span>

<span class="sd">    `Rs`, the stellar (equatorial) radius (Rsun).</span>

<span class="sd">    `iang`, inclination angle (deg).</span>

<span class="sd">    `bm2n` is the :math:`-2n+\beta &lt; 0` value. </span>

<span class="sd">    `fmin`, minimum flux at the semi-major axis as fraction of the thick disk </span>
<span class="sd">    flux.</span>

<span class="sd">    `Rmax`, maximum radius of the images.</span>

<span class="sd">    METHOD: If `Rmax` is None, then Rmax of the image is automatically </span>
<span class="sd">    calculated where Athin is equal to `fmin * BBlbd(Tdisk)` at the longest </span>
<span class="sd">    (vector last position) wavelength. Else, the `Rmax` value is taken.</span>
<span class="sd">    `Rmax` goes to all wavelengths. </span>

<span class="sd">    `px`, image side in pixels (squared output).</span>

<span class="sd">    `bartau` = if None, 1.3 is considered. Otherwise, it is a vector with same </span>
<span class="sd">    dimensions of `Disk.lbd`. See that `bartau` do not changes the </span>
<span class="sd">    emission in Eq. 12(c, Vieira+2015).</span>

<span class="sd">    OUTPUT: (squared) images(len(lbd), px, px). The flux unit per pixel is </span>
<span class="sd">    `BBlbd(Teff*fBBcor(Teff))` (cgs), in an area of pixelsize**2. </span>
<span class="sd">    (`pixelsize` info is printed).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># &quot;&quot;&quot; The vertical optical depth. &quot;&quot;&quot; </span>
    <span class="c"># Sound speed for and ideal mono-particle gas (gamma=5/3.)</span>
    <span class="n">csound</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Disk</span><span class="o">.</span><span class="n">Td</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">kB</span><span class="o">.</span><span class="n">cgs</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mf">3.</span> <span class="o">/</span> <span class="n">Disk</span><span class="o">.</span><span class="n">mu</span> <span class="o">/</span> <span class="n">_phc</span><span class="o">.</span><span class="n">mH</span><span class="o">.</span><span class="n">cgs</span><span class="p">)</span>
    <span class="c"># H0 = csound*(G*Ms)**-.5 (A.5, Faes thesis)</span>
    <span class="c"># H0 = csound*(_phc.G.cgs*Ms*_phc.Msun.cgs)**-.5</span>
    <span class="n">H0</span> <span class="o">=</span> <span class="n">csound</span> <span class="o">*</span> \
        <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">_phc</span><span class="o">.</span><span class="n">Rsun</span><span class="o">.</span><span class="n">cgs</span> <span class="o">*</span> <span class="n">Rs</span><span class="p">)</span><span class="o">**</span><span class="mf">3.</span> <span class="o">/</span> <span class="n">_phc</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">cgs</span> <span class="o">/</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Msun</span><span class="o">.</span><span class="n">cgs</span> <span class="o">/</span> <span class="n">Ms</span><span class="p">)</span>
    <span class="n">tau0</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">H0</span> <span class="o">*</span> <span class="n">Disk</span><span class="o">.</span><span class="n">kappa</span>

    <span class="n">fTd</span> <span class="o">=</span> <span class="n">Disk</span><span class="o">.</span><span class="n">Td</span> <span class="o">/</span> <span class="n">Teff</span>
    <span class="n">lbd</span> <span class="o">=</span> <span class="n">Disk</span><span class="o">.</span><span class="n">lbd</span> 
    <span class="n">iang</span> <span class="o">=</span> <span class="n">iang</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>

    <span class="n">BBstar</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">BBlbd</span><span class="p">(</span><span class="n">Teff</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">fBBcor</span><span class="p">(</span><span class="n">Teff</span><span class="p">),</span> <span class="n">lbd</span><span class="o">=</span><span class="n">lbd</span><span class="p">)</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">BBlbd</span><span class="p">(</span><span class="n">Teff</span> <span class="o">*</span> <span class="n">fTd</span><span class="p">,</span> <span class="n">lbd</span><span class="o">=</span><span class="n">lbd</span><span class="p">)</span> <span class="o">/</span> <span class="n">BBstar</span>
    <span class="k">if</span> <span class="n">lbd</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">bartau</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lbd</span><span class="p">))</span> <span class="o">+</span> <span class="o">.</span><span class="mi">3</span>
        <span class="n">lbd</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-8</span>  <span class="c"># Angs -&gt; cm</span>
    <span class="k">elif</span> <span class="n">bartau</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">bartau</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lbd</span><span class="p">))</span> <span class="o">+</span> <span class="o">.</span><span class="mi">3</span>

    <span class="c"># barR in Stellar Radius</span>
    <span class="n">barR</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">_np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">tau0</span> <span class="o">/</span> <span class="n">bartau</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">iang</span><span class="p">))</span> <span class="o">/</span> <span class="n">bm2n</span><span class="p">)</span>
    <span class="c"># in barR units, ie, Rs</span>
    <span class="k">if</span> <span class="n">Rmax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">Rmax</span> <span class="o">=</span> <span class="n">barR</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">fmin</span> <span class="o">/</span> <span class="n">bartau</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">F</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">bm2n</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Model info (cgs units):</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">_tab</span><span class="o">.</span><span class="n">tabulate</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lbd</span><span class="p">,</span> <span class="n">Disk</span><span class="o">.</span><span class="n">kappa</span><span class="p">,</span> <span class="n">tau0</span><span class="p">,</span> <span class="n">barR</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;lambda&#39;</span><span class="p">,</span> <span class="s">&#39;kappa&#39;</span><span class="p">,</span> <span class="s">&#39;tau0&#39;</span><span class="p">,</span> <span class="s">&#39;barR (R*)&#39;</span><span class="p">]))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"># H0 = {0:.3e}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">H0</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Rmax = {0:.2f} R*&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Rmax</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;# pixelsize: {0:.3f} R*&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">Rmax</span><span class="o">/</span><span class="n">px</span><span class="p">))</span>
    <span class="c"># Create map structure</span>
    <span class="n">xaxis</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">Rmax</span><span class="p">,</span> <span class="n">Rmax</span><span class="p">,</span> <span class="n">px</span><span class="p">)</span>
    <span class="n">yaxis</span> <span class="o">=</span> <span class="n">xaxis</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">iang</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">yaxis</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y2</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">xaxis</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">Rrs</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">False</span><span class="p">:</span>
    <span class="c"># if True:</span>
        <span class="c"># Soh para o ultimo lambda...</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">bartau</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">F</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">R</span> <span class="o">/</span> <span class="n">barR</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="n">bm2n</span>
        <span class="n">image</span><span class="p">[</span><span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">R</span> <span class="o">&lt;=</span> <span class="n">barR</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span> <span class="o">=</span> <span class="n">bartau</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">F</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">image</span><span class="p">[</span><span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">R</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c"># Where Y&gt;0 e R &lt; Rstar, put the star</span>
        <span class="n">image</span><span class="p">[</span><span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">Rrs</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Y2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c"># Where the disk is tenuous...</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">Rrs</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Y2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">R</span> <span class="o">&gt;=</span> <span class="n">barR</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">image</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># Para todos os lambdas...</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">lbd</span><span class="p">),</span> <span class="n">px</span><span class="p">,</span> <span class="n">px</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lbd</span><span class="p">)):</span>
            <span class="c"># image[i] = bartau[i] * F[i] * (R / barR[i])**bm2n</span>
            <span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">R</span> <span class="o">/</span> <span class="n">barR</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="n">bm2n</span>
            <span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">R</span> <span class="o">&lt;=</span> <span class="n">barR</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">R</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="c"># Where Y&gt;0 e R &lt; Rstar, put the star</span>
            <span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">Rrs</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Y2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="c"># Where the disk is tenuous...</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">Rrs</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Y2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">R</span> <span class="o">&gt;=</span> <span class="n">barR</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">image</span>


<span class="c"># Old</span></div>
<div class="viewcode-block" id="plot_pionier_old"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.plot_pionier_old">[docs]</a><span class="k">def</span> <span class="nf">plot_pionier_old</span><span class="p">(</span><span class="n">oidata</span><span class="p">,</span> <span class="n">ffile</span><span class="o">=</span><span class="s">&#39;last_run&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;png&#39;</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">obs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;  Standard observational log for PIONIER</span>

<span class="sd">    obs is a list</span>
<span class="sd">    dist is a number</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>  <span class="c"># figsize=(5.6,8))</span>
    <span class="n">alp</span> <span class="o">=</span> <span class="o">.</span><span class="mi">75</span>
    <span class="n">ms</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c"># markersize</span>
    <span class="c"># xloc = _plt.MaxNLocator(6)</span>
    <span class="c"># ax0 = display info</span>
    <span class="c"># ax0 = fig.add_subplot(211)</span>
    <span class="c"># ax0.axis(&#39;off&#39;)</span>
    <span class="c"># hdrinfo = oidata.hdrinfo.returninfo()</span>
    <span class="c"># for i in range(4):</span>
        <span class="c"># ax0.text(0., .8-.2*i, hdrinfo[i])</span>
    <span class="c"># ax1 = uvplane/lambda</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">321</span><span class="p">)</span>
    <span class="n">colorid</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">vis2</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">vis2</span><span class="p">:</span>
        <span class="n">ulbd</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">ucoord</span> <span class="o">/</span> <span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span>
        <span class="n">vlbd</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">vcoord</span> <span class="o">/</span> <span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;unnamed&#39;</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">+=</span> <span class="p">[</span><span class="n">label</span><span class="p">]</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span><span class="p">)]</span>
        <span class="c"># colorid = _np.mod(colorid+1, len(phc.colors))</span>
        <span class="c"># [u,-u] = W &gt; E</span>
        <span class="c"># [-u,u] = E &lt; W</span>
        <span class="c"># label=label,</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">ulbd</span><span class="p">,</span> <span class="o">-</span><span class="n">ulbd</span><span class="p">],</span> <span class="p">[</span><span class="n">vlbd</span><span class="p">,</span> <span class="o">-</span><span class="n">vlbd</span><span class="p">],</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
    <span class="c"># ax1.xaxis.tick_top()</span>
    <span class="c"># ax1.xaxis.set_major_formatter(mtick.FormatStrFormatter(&#39;%.2e&#39;))</span>
    <span class="c"># names = list(_np.unique(names))</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">u&#39;B$_{proj}$/$\lambda$&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="c"># if legend: ax1.legend(prop={&#39;size&#39;:8},numpoints=1,bbox_to_</span>
        <span class="c"># anchor=(-0.25, 1.0))</span>
    <span class="c"># ax2 = uvplane</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">322</span><span class="p">)</span>
    <span class="n">colorid</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">leg</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">vis2</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">vis2</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">ucoord</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">vcoord</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;unnamed&#39;</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span><span class="p">)]</span>
        <span class="c"># color = phc.colors[colorid]</span>
        <span class="c"># colorid = _np.mod(colorid+1, len(phc.colors))</span>
        <span class="c"># [u,-u] = W &gt; E</span>
        <span class="c"># [-u,u] = E &lt; W</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">leg</span><span class="p">:</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">u</span><span class="p">,</span> <span class="o">-</span><span class="n">u</span><span class="p">],</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">],</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
            <span class="n">leg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">u</span><span class="p">,</span> <span class="o">-</span><span class="n">u</span><span class="p">],</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">],</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>  <span class="c"># label=label,</span>
        <span class="c"># names.append(vis2.target.target)</span>
    <span class="c"># names = list(_np.unique(names))</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">tick_top</span><span class="p">()</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">u&#39;B$_{proj}$ (m)&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span> <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
    <span class="c"># ax3 = VIS2 vs. B</span>
    <span class="c"># ax4 = VIS2 vs. PA</span>
    <span class="c"># names = []</span>
    <span class="n">colorid</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">plotid</span> <span class="o">=</span> <span class="mi">323</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">plotid</span><span class="p">)</span>
    <span class="n">plotid</span> <span class="o">=</span> <span class="mi">324</span>
    <span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">plotid</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">vis2</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">vis2</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">ucoord</span> <span class="o">/</span> <span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">vcoord</span> <span class="o">/</span> <span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;unnamed&#39;</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span><span class="p">)]</span>
        <span class="c"># color = phc.colors[colorid]</span>
        <span class="c"># colorid = _np.mod(colorid + 1, len(phc.colors))</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
        <span class="n">vis2</span><span class="o">.</span><span class="n">vis2data</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">vis2</span><span class="o">.</span><span class="n">vis2err</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
            <span class="c"># , label=label)</span>
        <span class="c"># _np.arctan(self.ucoord / self.vcoord) * 180.0 / _np.pi % 180.0</span>
        <span class="n">PAobs</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
        <span class="c"># idx = _np.where(PAobs &lt; 0)</span>
        <span class="c"># PAobs[idx] = PAobs[idx]+180</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">ax4</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">PAobs</span><span class="p">,</span>
        <span class="n">vis2</span><span class="o">.</span><span class="n">vis2data</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">vis2</span><span class="o">.</span><span class="n">vis2err</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
        <span class="c"># , label=label)</span>
    <span class="n">Blim</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c"># res = 20</span>
        <span class="c"># V2 = _np.empty(res)</span>
        <span class="k">for</span> <span class="n">mod</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">obs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">obslist</span><span class="p">,</span> <span class="n">lbdc</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">readmap</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
            <span class="n">pixsize</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
            <span class="c"># *60.*60.*1000.*180./_np.pi)</span>
            <span class="n">rad_per_pixel</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span>
                <span class="n">pixsize</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Rsun</span><span class="o">.</span><span class="n">cgs</span> <span class="o">/</span> <span class="p">(</span><span class="n">dist</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">cgs</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">vis2</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">vis2</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> <span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;unnamed&#39;</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span><span class="p">)]</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">ucoord</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">vcoord</span>
                <span class="n">B</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">PA</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
                <span class="n">avlbd</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">)</span>
                <span class="n">V2</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">lbds</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">ob</span> <span class="ow">in</span> <span class="n">obs</span><span class="p">:</span>
                        <span class="n">lbd</span> <span class="o">=</span> <span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">j</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">lbdc</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">find_nearest</span><span class="p">(</span><span class="n">lbdc</span> <span class="o">*</span>
                                <span class="mf">1e-6</span><span class="p">,</span> <span class="n">lbd</span><span class="p">))</span>
                        <span class="c"># print lbdc[j]*1e-6-lbd</span>
                        <span class="n">lbcalc</span> <span class="o">=</span> <span class="n">lbdc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e-6</span>
                        <span class="n">lbcalc</span> <span class="o">=</span> <span class="n">lbd</span>
                        <span class="n">tmp</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">phvar</span> <span class="o">=</span> <span class="n">fastnumvis</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">ob</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
                            <span class="n">lbcalc</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">PA</span><span class="p">,</span> <span class="n">rad_per_pixel</span><span class="p">,</span> <span class="n">PAdisk</span><span class="o">=</span><span class="p">(</span><span class="mf">216.9</span> <span class="o">+</span> <span class="mf">90.</span><span class="p">))</span>
                        <span class="n">V2</span> <span class="o">+=</span> <span class="p">[</span><span class="n">V</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
                        <span class="n">lbds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">lbcalc</span><span class="p">]</span>
                <span class="c"># ax3.plot(B/vis2.wavelength.eff_wave, V2, color=&#39;purple&#39;,</span>
                    <span class="c"># alpha=.3)</span>
                <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="n">lbds</span><span class="p">,</span> <span class="n">V2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;purple&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">PA</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lbds</span><span class="p">)),</span> <span class="n">V2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;purple&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
                <span class="c"># lbd = phc.find_nearest(lbdc*1e-6,avlbd)</span>
                <span class="c"># j = list(lbdc*1e-6).index(lbd)</span>
                <span class="c"># Bs = _np.linspace(Blim[0]*lbd, Blim[1]*lbd, res)</span>
                <span class="c"># for i in range(res):</span>
                    <span class="c"># tmp, V2[i], phvar = fastnumvis(data[0,0,j,:,:], lbd,</span>
                        <span class="c"># Bs[i], PA, rad_per_pixel, PAdisk=36.9+90)</span>
                <span class="c"># ax3.plot(Bs/lbd, V2**2, color=color)</span>
                <span class="c"># print Bs/lbd</span>
                <span class="c"># print V2</span>
                <span class="c"># a = raw_input(&#39;asdads&#39;)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">Blim</span><span class="p">)</span>
    <span class="c"># ax1.xaxis.get_major_formatter().set_useOffset(False)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">_mtick</span><span class="o">.</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%.2e</span><span class="s">&#39;</span><span class="p">))</span>
    <span class="c"># ax3.get_xaxis().set_visible(False)</span>
    <span class="c"># ax4.get_xaxis().set_visible(False)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
    <span class="n">PAlim</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">]</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">u&#39;$V$ $^2$&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">u&#39;$V$ $^2$&#39;</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="c"># ax5 = T3PHI vs. B</span>
    <span class="c"># ax6 = T3PHI vs. PA</span>
    <span class="c"># names = []</span>
    <span class="n">colorid</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">plotid</span> <span class="o">=</span> <span class="mi">325</span>
    <span class="n">ax5</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">plotid</span><span class="p">)</span>
    <span class="n">plotid</span> <span class="o">=</span> <span class="mi">326</span>
    <span class="n">ax6</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">plotid</span><span class="p">)</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Blim</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">ax6</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">PAlim</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">t3</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">t3</span><span class="p">:</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">u1coord</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">v1coord</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">u2coord</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">v2coord</span>
        <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v2</span><span class="o">**</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">u1</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">u2</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v2</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">PA</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">))</span>
        <span class="n">PA</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">PA</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">))</span>
        <span class="c"># idx = _np.where(PA &lt; 0)</span>
        <span class="c"># PA[idx] = PA[idx]+180</span>
        <span class="c"># if (t3.station[0] and t3.station[1]):</span>
            <span class="c"># label = t3.station[0].sta_name + t3.station[1].sta_name</span>
        <span class="c"># else:</span>
            <span class="c"># label = &#39;unnamed&#39;</span>
        <span class="c"># color = names.index(label)</span>
        <span class="c"># color = phc.colors[colorid]</span>
        <span class="c"># colorid = _np.mod(colorid + 1, len(phc.colors))</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;Black&#39;</span>
        <span class="c"># y = _np.repeat(t3.t3phi, len(t3.wavelength.eff_wave))</span>
        <span class="c"># yerr = _np.repeat(t3.t3phierr, len(t3.wavelength.eff_wave))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">t3phi</span>
        <span class="n">yerr</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">t3phierr</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">ax5</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>  <span class="c"># , label=label)</span>
        <span class="c"># , label=label)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">ax6</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
            <span class="n">PA</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">mod</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">obs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">obslist</span><span class="p">,</span> <span class="n">lbdc</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">readmap</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
            <span class="n">pixsize</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
            <span class="c"># *60.*60.*1000.*180./_np.pi)</span>
            <span class="n">rad_per_pixel</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span>
                <span class="n">pixsize</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Rsun</span><span class="o">.</span><span class="n">cgs</span> <span class="o">/</span> <span class="p">(</span><span class="n">dist</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">cgs</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">t3</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">t3</span><span class="p">:</span>
                <span class="n">u1</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">u1coord</span>
                <span class="n">v1</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">v1coord</span>
                <span class="n">u2</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">u2coord</span>
                <span class="n">v2</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">v2coord</span>
                <span class="n">B</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v1</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v2</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
                <span class="n">PA</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                    <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u2</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                <span class="n">Bmax</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">PAmax</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">t3m</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">lbds</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">ob</span> <span class="ow">in</span> <span class="n">obs</span><span class="p">:</span>
                        <span class="n">lbd</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">j</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">lbdc</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">find_nearest</span><span class="p">(</span><span class="n">lbdc</span> <span class="o">*</span>
                            <span class="mf">1e-6</span><span class="p">,</span> <span class="n">lbd</span><span class="p">))</span>
                        <span class="n">lcalc</span> <span class="o">=</span> <span class="n">lbdc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e-6</span>
                        <span class="n">lcalc</span> <span class="o">=</span> <span class="n">lbd</span>
                        <span class="n">tmp</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">phvar</span> <span class="o">=</span> <span class="n">fastnumvis3</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">ob</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
                            <span class="n">lcalc</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">PA</span><span class="p">,</span> <span class="n">rad_per_pixel</span><span class="p">,</span> <span class="n">PAdisk</span><span class="o">=</span><span class="p">(</span><span class="mf">216.9</span> <span class="o">+</span> <span class="mf">90.</span><span class="p">))</span>
                        <span class="n">t3m</span> <span class="o">+=</span> <span class="p">[</span><span class="n">phvar</span><span class="p">]</span>
                        <span class="n">Bmax</span> <span class="o">+=</span> <span class="p">[</span><span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">B</span><span class="p">)]</span>
                        <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">==</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                            <span class="n">PAmax</span> <span class="o">+=</span> <span class="p">[</span><span class="n">PA</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">PAmax</span> <span class="o">+=</span> <span class="p">[</span><span class="n">PA</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                        <span class="n">lbds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">lcalc</span><span class="p">]</span>
                <span class="n">Bmax</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Bmax</span><span class="p">)</span>
                <span class="n">lbds</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lbds</span><span class="p">)</span>
                <span class="n">t3m</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t3m</span><span class="p">)</span>
                <span class="n">PAmax</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">PAmax</span><span class="p">)</span>
                <span class="n">ax5</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Bmax</span> <span class="o">/</span> <span class="n">lbds</span><span class="p">,</span> <span class="n">t3m</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;purple&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">9</span><span class="p">)</span>
                <span class="n">ax6</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">PAmax</span><span class="p">,</span> <span class="n">t3m</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;purple&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">6</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span>
                    <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="c"># ax5.get_xaxis().set_ticklabels([])</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">Blim</span><span class="p">)</span>
    <span class="n">ax6</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">PAlim</span><span class="p">)</span>
    <span class="n">ymax</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ax5</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()))</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">1.05</span> <span class="o">*</span> <span class="n">ymax</span><span class="p">,</span> <span class="mf">1.05</span> <span class="o">*</span> <span class="n">ymax</span><span class="p">])</span>
    <span class="n">ax6</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">1.05</span> <span class="o">*</span> <span class="n">ymax</span><span class="p">,</span> <span class="mf">1.05</span> <span class="o">*</span> <span class="n">ymax</span><span class="p">])</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">u&#39;B$_{proj}$/$\lambda$&#39;</span><span class="p">)</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">u&#39;$\phi_{123}$ (deg.)&#39;</span><span class="p">)</span>
    <span class="n">ax5</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="n">ax6</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">u&#39;$PA$ (deg.)&#39;</span><span class="p">)</span>
    <span class="n">ax6</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">u&#39;$\phi_{123}$ (deg.)&#39;</span><span class="p">)</span>
    <span class="n">ax6</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alp</span><span class="p">)</span>
    <span class="c"># SAVING</span>
    <span class="nb">dir</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">trimpathname</span><span class="p">(</span><span class="n">ffile</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">rmext</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="c"># _plt.savefig(&#39;hdt/{}_{}.png&#39;.format(hdrinfo[0], hdrinfo[2]),</span>
        <span class="c"># transparent=True)</span>
    <span class="c"># _plt.locator_params(axis = &#39;x&#39;, nbins = 7)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.96</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.09</span><span class="p">,</span>
        <span class="n">hspace</span><span class="o">=.</span><span class="mo">00</span><span class="mi">9</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=.</span><span class="mi">32</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;hdt&#39;</span><span class="p">):</span>
        <span class="n">_os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;mkdir hdt&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">suf</span> <span class="ow">in</span> <span class="n">fmt</span><span class="p">:</span>
        <span class="n">_plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;hdt/{0}.{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">suf</span><span class="p">),</span> <span class="n">transparent</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="printinfo"><a class="viewcode-back" href="../../interftools.html#pyhdust.interftools.printinfo">[docs]</a><span class="k">def</span> <span class="nf">printinfo</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">extract</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Print AMBER OIFITS observational info.</span>

<span class="sd">    If `extract` is False, output is:</span>
<span class="sd">    - DATE-OBS, MJD, Target, B1, PA1, B2, PA2, B3, PA3.</span>

<span class="sd">    If True, output is:</span>
<span class="sd">    - [DATE-OBS, MJD, Target, B1, PA1, B2, PA2, B3, PA3], WAVE, DPlist, V2list</span>

<span class="sd">    Where, DPlist = [DP1, eDP1, DP2, eDP2, DP3, eDP3] and V2list = [V2_1, </span>
<span class="sd">    eV2_1, V2_2, eV2_2, V2_3, eV2_3].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">oidata</span> <span class="o">=</span> <span class="n">_oifits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="s">&#39;True&#39;</span><span class="p">)</span>
    <span class="n">info</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">oidata</span><span class="o">.</span><span class="n">hdrinfo</span><span class="o">.</span><span class="n">returninfo</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">extract</span><span class="p">:</span>
        <span class="n">wav</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">info2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">info3</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">info4</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">vis</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">vis</span><span class="p">:</span>
            <span class="n">fact</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="n">PA</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">ucoord</span><span class="p">,</span> <span class="n">vis</span><span class="o">.</span><span class="n">vcoord</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">%</span> <span class="mf">360.0</span>
            <span class="k">if</span> <span class="n">PA</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">:</span>
                <span class="n">PA</span> <span class="o">=</span> <span class="n">PA</span> <span class="o">%</span> <span class="mi">180</span>
                <span class="n">fact</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span>
            <span class="n">info2</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;{0:.1f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">ucoord</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                                                <span class="n">vis</span><span class="o">.</span><span class="n">vcoord</span><span class="o">**</span><span class="mi">2</span><span class="p">))]</span>
            <span class="n">info2</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;{0:.1f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PA</span><span class="p">)]</span>
            <span class="n">wav</span> <span class="o">+=</span> <span class="p">[</span><span class="mf">1e6</span> <span class="o">*</span> <span class="n">vis</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">]</span>
            <span class="n">info3</span> <span class="o">+=</span> <span class="p">[</span><span class="n">fact</span> <span class="o">*</span> <span class="n">vis</span><span class="o">.</span><span class="n">visphi</span><span class="p">,</span> <span class="n">vis</span><span class="o">.</span><span class="n">visphierr</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">vis2</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">vis2</span><span class="p">:</span>
            <span class="n">info4</span> <span class="o">+=</span> <span class="p">[</span><span class="n">vis2</span><span class="o">.</span><span class="n">vis2data</span><span class="p">,</span> <span class="n">vis2</span><span class="o">.</span><span class="n">vis2err</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="mi">2</span><span class="p">][:</span><span class="mi">10</span><span class="p">],</span> <span class="s">&#39;{0:.7f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> \
            <span class="n">info2</span><span class="p">,</span> <span class="n">wav</span><span class="p">,</span> <span class="n">info3</span><span class="p">,</span> <span class="n">info4</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">info2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">vis</span> <span class="ow">in</span> <span class="n">oidata</span><span class="o">.</span><span class="n">vis</span><span class="p">:</span>
            <span class="n">info2</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;{0:.1f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">ucoord</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> 
                <span class="n">vis</span><span class="o">.</span><span class="n">vcoord</span><span class="o">**</span><span class="mi">2</span><span class="p">))]</span>
            <span class="c"># info2+= [&#39;{0:.1f}&#39;.format(_np.arctan2(vis.ucoord , vis.vcoord) *</span>
                <span class="c"># 180.0 / _np.pi % 180.0)]</span>
            <span class="n">info2</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;{0:.1f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">ucoord</span><span class="p">,</span> <span class="n">vis</span><span class="o">.</span><span class="n">vcoord</span><span class="p">)</span> <span class="o">*</span>
                <span class="mf">180.0</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">%</span> <span class="mf">180.0</span><span class="p">)]</span>
            <span class="c"># print vis.ucoord, vis.vcoord        </span>
        <span class="k">return</span> <span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="mi">2</span><span class="p">][:</span><span class="mi">10</span><span class="p">],</span> <span class="s">&#39;{0:.7f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">info2</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Python tools for the BeACoN group Beta documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li>
          <li><a href="../pyhdust.html" >pyhdust</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015-2016, D. Moser.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>