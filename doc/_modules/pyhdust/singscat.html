<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pyhdust.singscat &mdash; Python tools for the BeACoN group Beta documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     'Beta',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Python tools for the BeACoN group Beta documentation" href="../../index.html" />
    <link rel="up" title="pyhdust" href="../pyhdust.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Python tools for the BeACoN group Beta documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li>
          <li><a href="../pyhdust.html" accesskey="U">pyhdust</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pyhdust.singscat</h1><div class="highlight"><pre>
<span class="c"># -*- coding:utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;PyHdust *singscat* module: Single Scatering Dumbbell+disk model. </span>

<span class="sd">This release contains a simplified version of the one applied to Sigma Ori E in </span>
<span class="sd">Carciofi+2013.</span>

<span class="sd">| VARIABLES:</span>
<span class="sd">|    BLOB</span>
<span class="sd">|    - i</span>
<span class="sd">|    - Rstar</span>
<span class="sd">|    - Blob diam.</span>
<span class="sd">|    - Blob dist. (center)</span>
<span class="sd">|    - n_e</span>
<span class="sd">|</span>
<span class="sd">|    DISK</span>
<span class="sd">|    - n_d</span>
<span class="sd">|    - Disk length (assumed centered at blob dist.)</span>
<span class="sd">|    - Disk height</span>
<span class="sd">|    - Angle between stellar rotation and magnetic field (disk inclination)</span>
<span class="sd">|</span>
<span class="sd">|    OBSERVATIONAL</span>
<span class="sd">|    - Pis = Qis + Uis</span>
<span class="sd">|    - Theta_sky</span>
<span class="sd">|    - Delta phase from photometry</span>
<span class="sd">|</span>
<span class="sd">|    CALCULATIONS</span>
<span class="sd">|    - n0 = blob resolution (n0**3)</span>
<span class="sd">|    - phases</span>
<span class="sd">|    - dh = disk height step</span>
<span class="sd">|    - ddr = disk radius steps</span>
<span class="sd">|    - dphi = disk angle step</span>

<span class="sd">:license: GNU GPL v3.0  https://github.com/danmoser/pyhdust/blob/master/LICENSE </span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span> <span class="kn">as</span> <span class="nn">_os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">_np</span>
<span class="kn">import</span> <span class="nn">time</span> <span class="kn">as</span> <span class="nn">_time</span>
<span class="kn">import</span> <span class="nn">pyhdust</span> <span class="kn">as</span> <span class="nn">_hdt</span>
<span class="kn">import</span> <span class="nn">pyhdust.jdcal</span> <span class="kn">as</span> <span class="nn">_jdcal</span>
<span class="kn">import</span> <span class="nn">pyhdust.poltools</span> <span class="kn">as</span> <span class="nn">_polt</span>
<span class="kn">import</span> <span class="nn">pyhdust.phc</span> <span class="kn">as</span> <span class="nn">_phc</span>
<span class="kn">import</span> <span class="nn">pyhdust.triangle</span> <span class="kn">as</span> <span class="nn">_triangle</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">_plt</span>
    <span class="kn">import</span> <span class="nn">emcee</span> <span class="kn">as</span> <span class="nn">_emcee</span>
    <span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">percentileofscore</span> <span class="k">as</span> <span class="n">_perct</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Warning! matplotlib, scipy and/or emcee module not installed!!!&#39;</span><span class="p">)</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s">&quot;Daniel Moser&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s">&quot;dmfaes@gmail.com&quot;</span>

<span class="c"># PHYSICAL CONSTANTS VARS ###</span>
<span class="n">_sigT</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">sigT</span><span class="o">.</span><span class="n">cgs</span>  <span class="c"># cm^2 = Thomson cross section</span>


<div class="viewcode-block" id="diskcoords"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.diskcoords">[docs]</a><span class="k">def</span> <span class="nf">diskcoords</span><span class="p">(</span><span class="n">pdk</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; ### DISK geom. ### &quot;&quot;&quot;</span>
    <span class="c"># Qis,Uis,ne,phi0,ths,iang,fact = pob</span>
    <span class="n">rdi</span><span class="p">,</span> <span class="n">rdf</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">ned</span><span class="p">,</span> <span class="n">dh</span><span class="p">,</span> <span class="n">ddr</span><span class="p">,</span> <span class="n">dphi</span> <span class="o">=</span> <span class="n">pdk</span>

    <span class="n">dvarr</span> <span class="o">=</span> <span class="p">(</span><span class="n">rdf</span> <span class="o">-</span> <span class="n">rdi</span><span class="p">)</span> <span class="o">/</span> <span class="n">ddr</span>
    <span class="n">varrD</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ddr</span><span class="p">,</span> <span class="n">dh</span><span class="p">,</span> <span class="n">dphi</span><span class="p">))</span>
    <span class="n">thD</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ddr</span><span class="p">,</span> <span class="n">dh</span><span class="p">,</span> <span class="n">dphi</span><span class="p">))</span>
    <span class="n">phiD</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ddr</span><span class="p">,</span> <span class="n">dh</span><span class="p">,</span> <span class="n">dphi</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ddr</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dh</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dphi</span><span class="p">):</span>
                <span class="n">varrD</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdi</span> <span class="o">+</span> <span class="n">dvarr</span> <span class="o">*</span> <span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ddr</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>
                <span class="n">thD</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">90.</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>  <span class="c"># TODO</span>
                <span class="n">phiD</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
                    <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">dphi</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">dphi</span><span class="p">)[</span><span class="n">k</span><span class="p">]</span>

    <span class="n">varrD</span> <span class="o">=</span> <span class="n">varrD</span><span class="p">[</span><span class="o">~</span><span class="n">_np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">varrD</span><span class="p">)]</span>
    <span class="n">phiD</span> <span class="o">=</span> <span class="n">phiD</span><span class="p">[</span><span class="o">~</span><span class="n">_np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">phiD</span><span class="p">)]</span>
    <span class="n">thD</span> <span class="o">=</span> <span class="n">thD</span><span class="p">[</span><span class="o">~</span><span class="n">_np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">thD</span><span class="p">)]</span>

    <span class="p">(</span><span class="n">xD</span><span class="p">,</span> <span class="n">yD</span><span class="p">,</span> <span class="n">zD</span><span class="p">)</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">sph2cart</span><span class="p">(</span><span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD</span><span class="p">)</span>
    <span class="p">(</span><span class="n">xD</span><span class="p">,</span> <span class="n">yD</span><span class="p">,</span> <span class="n">zD</span><span class="p">)</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">cart_rot</span><span class="p">(</span><span class="n">xD</span><span class="p">,</span> <span class="n">yD</span><span class="p">,</span> <span class="n">zD</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
    <span class="p">(</span><span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD</span><span class="p">)</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">cart2sph</span><span class="p">(</span><span class="n">xD</span><span class="p">,</span> <span class="n">yD</span><span class="p">,</span> <span class="n">zD</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD</span>

</div>
<div class="viewcode-block" id="stokesD"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.stokesD">[docs]</a><span class="k">def</span> <span class="nf">stokesD</span><span class="p">(</span><span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD</span><span class="p">,</span> <span class="n">pst</span><span class="p">,</span> <span class="n">pob</span><span class="p">,</span> <span class="n">pdk</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; ### STOKES CALC given DISK ### &quot;&quot;&quot;</span>
    <span class="n">rs</span><span class="p">,</span> <span class="n">diamb</span><span class="p">,</span> <span class="n">distb</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">occult</span> <span class="o">=</span> <span class="n">pst</span>
    <span class="n">Qis</span><span class="p">,</span> <span class="n">Uis</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">phi0</span><span class="p">,</span> <span class="n">ths</span><span class="p">,</span> <span class="n">iang</span><span class="p">,</span> <span class="n">fact</span> <span class="o">=</span> <span class="n">pob</span>
    <span class="n">rdi</span><span class="p">,</span> <span class="n">rdf</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">ned</span><span class="p">,</span> <span class="n">dh</span><span class="p">,</span> <span class="n">ddr</span><span class="p">,</span> <span class="n">dphi</span> <span class="o">=</span> <span class="n">pdk</span>

    <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">sph2cart</span><span class="p">(</span><span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD</span><span class="p">)</span>
    <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">cart_rot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">iang</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>

    <span class="n">dV</span> <span class="o">=</span> <span class="n">H</span> <span class="o">*</span> <span class="n">varrD</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">dphi</span> <span class="o">*</span> <span class="n">H</span> <span class="o">/</span> <span class="n">dh</span>  <span class="c"># TODO</span>
    <span class="n">rl</span> <span class="o">=</span> <span class="p">(</span><span class="n">rdf</span> <span class="o">-</span> <span class="n">rdi</span><span class="p">)</span> <span class="o">/</span> <span class="n">ddr</span>
    <span class="n">P0</span> <span class="o">=</span> <span class="mf">3.</span> <span class="o">/</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">ned</span> <span class="o">*</span> <span class="n">_sigT</span> <span class="o">*</span> <span class="n">rl</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">rs</span> <span class="o">/</span> <span class="n">varrD</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span>
        <span class="p">(</span><span class="n">rs</span> <span class="o">/</span> <span class="n">varrD</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">dphi</span> <span class="o">*</span> <span class="n">varrD</span> <span class="o">*</span> <span class="n">H</span> <span class="o">/</span> <span class="n">dh</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">varrD</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">cosX</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">iang</span><span class="p">)</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">thD</span><span class="p">)</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phiD</span><span class="p">)</span> <span class="o">+</span> \
        <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">iang</span><span class="p">)</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">thD</span><span class="p">)</span>
    <span class="c"># Ii = _np.zeros(len(varr))+1./(len(varr)*2)</span>
    <span class="n">Ii</span> <span class="o">=</span> <span class="n">P0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">cosX</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">Qi</span> <span class="o">=</span> <span class="n">P0</span> <span class="o">*</span> <span class="p">(</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">varrD</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="n">varrD</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
    <span class="n">Ui</span> <span class="o">=</span> <span class="n">P0</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">/</span> <span class="n">varrD</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
    <span class="n">Pi</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Qi</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Ui</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="c"># Occultation ##</span>
    <span class="k">if</span> <span class="n">occult</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span> 
        <span class="n">ind</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">rs</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">z</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">Qi</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">Ui</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">Pi</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">Ii</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">rs</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">z</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">Ii</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ii</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">rs</span> <span class="o">/</span> <span class="n">varrD</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">ned</span> <span class="o">*</span> <span class="n">_sigT</span> <span class="o">*</span> 
            <span class="n">rl</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">dphi</span> <span class="o">*</span> <span class="n">varrD</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">*</span> <span class="n">H</span> <span class="o">/</span> <span class="n">dh</span><span class="p">)</span> <span class="o">/</span> \
            <span class="p">(</span><span class="n">varrD</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">4.</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">return</span> <span class="n">Ii</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">fact</span> <span class="o">*</span> <span class="n">Pi</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">fact</span> <span class="o">*</span> <span class="n">Qi</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">fact</span> <span class="o">*</span> <span class="n">Ui</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>    

</div>
<div class="viewcode-block" id="modcycleF"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.modcycleF">[docs]</a><span class="k">def</span> <span class="nf">modcycleF</span><span class="p">(</span><span class="n">varr</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">phi_0</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD_0</span><span class="p">,</span> <span class="n">phiT</span><span class="p">,</span> <span class="n">pst</span><span class="p">,</span> <span class="n">pob</span><span class="p">,</span> <span class="n">pdk</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; modcycleF &quot;&quot;&quot;</span>
    <span class="c"># pst = [rs,diamb,distb,n0,occult]</span>
    <span class="n">rs</span><span class="p">,</span> <span class="n">diamb</span><span class="p">,</span> <span class="n">distb</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">occult</span> <span class="o">=</span> <span class="n">pst</span>
    <span class="c"># pob = [Qis,Uis,ne,phi0,ths,iang,fact]</span>
    <span class="n">Qis</span><span class="p">,</span> <span class="n">Uis</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">phi0</span><span class="p">,</span> <span class="n">ths</span><span class="p">,</span> <span class="n">iang</span><span class="p">,</span> <span class="n">fact</span> <span class="o">=</span> <span class="n">pob</span>
    <span class="n">rdi</span><span class="p">,</span> <span class="n">rdf</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">ned</span><span class="p">,</span> <span class="n">dh</span><span class="p">,</span> <span class="n">ddr</span><span class="p">,</span> <span class="n">dphi</span> <span class="o">=</span> <span class="n">pdk</span>
    <span class="c">#</span>
    <span class="n">nT</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phiT</span><span class="p">)</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nT</span><span class="p">)</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nT</span><span class="p">)</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nT</span><span class="p">)</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nT</span><span class="p">)</span>
    <span class="c"># (varr,th,phi_0,n3) = geogen(pst)</span>
    <span class="c"># (varrD,thD,phiD_0) = diskcoords(pdk)</span>
    <span class="n">xD</span><span class="p">,</span> <span class="n">yD</span><span class="p">,</span> <span class="n">zD</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">sph2cart</span><span class="p">(</span><span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD_0</span><span class="p">)</span>
    <span class="c">#</span>
    <span class="c"># phib blobs in position phibi ##</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">xD</span> <span class="o">-</span> <span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">yD</span> <span class="o">-</span> <span class="n">distb</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">zD</span> <span class="o">-</span> <span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">diamb</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>\
        <span class="o">|</span> <span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">xD</span> <span class="o">-</span> <span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">yD</span> <span class="o">+</span> <span class="n">distb</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">zD</span> <span class="o">-</span> <span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">diamb</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
    <span class="n">varrD</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">thD</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">phiD_0</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">varrD</span> <span class="o">=</span> <span class="n">varrD</span><span class="p">[</span><span class="o">~</span><span class="n">_np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">varrD</span><span class="p">)]</span>
    <span class="n">phiD_0</span> <span class="o">=</span> <span class="n">phiD_0</span><span class="p">[</span><span class="o">~</span><span class="n">_np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">phiD_0</span><span class="p">)]</span>
    <span class="n">thD</span> <span class="o">=</span> <span class="n">thD</span><span class="p">[</span><span class="o">~</span><span class="n">_np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">thD</span><span class="p">)]</span>
    <span class="c">#</span>
    <span class="n">phib</span> <span class="o">=</span> <span class="p">[</span><span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">nT</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phiT</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nT</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">phibi</span> <span class="ow">in</span> <span class="n">phib</span><span class="p">:</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">phi_0</span> <span class="o">+</span> <span class="n">phibi</span> <span class="o">+</span> <span class="n">phiT</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">phi0</span>
            <span class="p">(</span><span class="n">Ii</span><span class="p">,</span> <span class="n">Pi</span><span class="p">,</span> <span class="n">Qi</span><span class="p">,</span> <span class="n">Ui</span><span class="p">)</span> <span class="o">=</span> <span class="n">stokes</span><span class="p">(</span><span class="n">varr</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">pst</span><span class="p">,</span> <span class="n">pob</span><span class="p">)</span>
            <span class="n">I</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">Ii</span>
            <span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">Pi</span>
            <span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">Qi</span>
            <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">Ui</span>
            <span class="n">phiD</span> <span class="o">=</span> <span class="n">phiD_0</span> <span class="o">+</span> <span class="n">phiT</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">phi0</span>
            <span class="p">(</span><span class="n">Ii</span><span class="p">,</span> <span class="n">Pi</span><span class="p">,</span> <span class="n">Qi</span><span class="p">,</span> <span class="n">Ui</span><span class="p">)</span> <span class="o">=</span> <span class="n">stokesD</span><span class="p">(</span><span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD</span><span class="p">,</span> <span class="n">pst</span><span class="p">,</span> <span class="n">pob</span><span class="p">,</span> <span class="n">pdk</span><span class="p">)</span>
            <span class="n">I</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">Ii</span>
            <span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">Pi</span>
            <span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">Qi</span>
            <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">Ui</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">Q0check</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">I</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">n3</span>

</div>
<div class="viewcode-block" id="modcycleD"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.modcycleD">[docs]</a><span class="k">def</span> <span class="nf">modcycleD</span><span class="p">(</span><span class="n">phiT</span><span class="p">,</span> <span class="n">pst</span><span class="p">,</span> <span class="n">pob</span><span class="p">,</span> <span class="n">pdk</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; modcycleD &quot;&quot;&quot;</span>
    <span class="c"># pst = [rs,diamb,distb,n0,occult]</span>
    <span class="n">rs</span><span class="p">,</span> <span class="n">diamb</span><span class="p">,</span> <span class="n">distb</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">occult</span> <span class="o">=</span> <span class="n">pst</span>
    <span class="c"># pob = [Qis,Uis,ne,phi0,ths,iang,fact]</span>
    <span class="n">Qis</span><span class="p">,</span> <span class="n">Uis</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">phi0</span><span class="p">,</span> <span class="n">ths</span><span class="p">,</span> <span class="n">iang</span><span class="p">,</span> <span class="n">fact</span> <span class="o">=</span> <span class="n">pob</span>
    <span class="n">rdi</span><span class="p">,</span> <span class="n">rdf</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">ned</span><span class="p">,</span> <span class="n">dh</span><span class="p">,</span> <span class="n">ddr</span><span class="p">,</span> <span class="n">dphi</span> <span class="o">=</span> <span class="n">pdk</span>
    <span class="c">#</span>
    <span class="n">nT</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phiT</span><span class="p">)</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nT</span><span class="p">)</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nT</span><span class="p">)</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nT</span><span class="p">)</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nT</span><span class="p">)</span>
    <span class="p">(</span><span class="n">varr</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">phi_0</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span> <span class="o">=</span> <span class="n">geogen</span><span class="p">(</span><span class="n">pst</span><span class="p">)</span>
    <span class="p">(</span><span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD_0</span><span class="p">)</span> <span class="o">=</span> <span class="n">diskcoords</span><span class="p">(</span><span class="n">pdk</span><span class="p">)</span>
    <span class="n">xD</span><span class="p">,</span> <span class="n">yD</span><span class="p">,</span> <span class="n">zD</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">sph2cart</span><span class="p">(</span><span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD_0</span><span class="p">)</span>
    <span class="c">#</span>
    <span class="c"># phib blobs in position phibi ##</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">xD</span> <span class="o">-</span> <span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">yD</span> <span class="o">-</span> <span class="n">distb</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">zD</span> <span class="o">-</span> <span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">diamb</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>\
        <span class="o">|</span> <span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">xD</span> <span class="o">-</span> <span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">yD</span> <span class="o">+</span> <span class="n">distb</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">zD</span> <span class="o">-</span> <span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">diamb</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
    <span class="n">varrD</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">thD</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">phiD_0</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">varrD</span> <span class="o">=</span> <span class="n">varrD</span><span class="p">[</span><span class="o">~</span><span class="n">_np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">varrD</span><span class="p">)]</span>
    <span class="n">phiD_0</span> <span class="o">=</span> <span class="n">phiD_0</span><span class="p">[</span><span class="o">~</span><span class="n">_np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">phiD_0</span><span class="p">)]</span>
    <span class="n">thD</span> <span class="o">=</span> <span class="n">thD</span><span class="p">[</span><span class="o">~</span><span class="n">_np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">thD</span><span class="p">)]</span>
    <span class="c">#</span>
    <span class="n">phib</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span>
    <span class="n">nT</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phiT</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nT</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">phibi</span> <span class="ow">in</span> <span class="n">phib</span><span class="p">:</span>
            <span class="n">phiD</span> <span class="o">=</span> <span class="n">phiD_0</span> <span class="o">+</span> <span class="n">phiT</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">phi0</span>
            <span class="p">(</span><span class="n">Ii</span><span class="p">,</span> <span class="n">Pi</span><span class="p">,</span> <span class="n">Qi</span><span class="p">,</span> <span class="n">Ui</span><span class="p">)</span> <span class="o">=</span> <span class="n">stokesD</span><span class="p">(</span><span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD</span><span class="p">,</span> <span class="n">pst</span><span class="p">,</span> <span class="n">pob</span><span class="p">,</span> <span class="n">pdk</span><span class="p">)</span>
            <span class="n">I</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">Ii</span>
            <span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">Pi</span>
            <span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">Qi</span>
            <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">Ui</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">Q0check</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">I</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">n3</span>

</div>
<div class="viewcode-block" id="geogen"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.geogen">[docs]</a><span class="k">def</span> <span class="nf">geogen</span><span class="p">(</span><span class="n">pst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; ### BLOB dVs ### &quot;&quot;&quot;</span>
    <span class="c"># pst = [rs,diamb,distb,n0,occult]</span>
    <span class="n">rs</span><span class="p">,</span> <span class="n">diamb</span><span class="p">,</span> <span class="n">distb</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">occult</span> <span class="o">=</span> <span class="n">pst</span>
    <span class="c">#</span>
    <span class="n">dr</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">diamb</span> <span class="o">/</span> <span class="n">n0</span>  <span class="c"># 2xblobdiameter</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">distb</span> <span class="o">+</span> <span class="n">dr</span> <span class="o">*</span> <span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">n0</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">n0</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">dr</span> <span class="o">*</span> <span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">n0</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">n0</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">dz</span> <span class="o">=</span> <span class="n">dr</span> <span class="o">*</span> <span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">n0</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">n0</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>
    <span class="c">#</span>
    <span class="n">varr</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n0</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">n0</span><span class="p">))</span>
    <span class="n">th</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n0</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">n0</span><span class="p">))</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n0</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">n0</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n0</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n0</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n0</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">dx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">distb</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dy</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> \
                    <span class="n">diamb</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">:</span>
                    <span class="n">varr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dy</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">th</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">dz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">varr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>                 
                    <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">dy</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">dx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">varr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">th</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">nan</span>
    <span class="c">#</span>
    <span class="n">varr</span> <span class="o">=</span> <span class="n">varr</span><span class="p">[</span><span class="o">~</span><span class="n">_np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">varr</span><span class="p">)]</span>
    <span class="n">th</span> <span class="o">=</span> <span class="n">th</span><span class="p">[</span><span class="o">~</span><span class="n">_np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">th</span><span class="p">)]</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="o">~</span><span class="n">_np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">phi</span><span class="p">)]</span>
    <span class="n">n3</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">varr</span><span class="p">)</span>  <span class="c"># n**3 is final blob V division</span>
    <span class="k">return</span> <span class="n">varr</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">n3</span>

</div>
<div class="viewcode-block" id="stokes"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.stokes">[docs]</a><span class="k">def</span> <span class="nf">stokes</span><span class="p">(</span><span class="n">varr</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">pst</span><span class="p">,</span> <span class="n">pob</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; ### STOKES CALC given BLOB dVs ### &quot;&quot;&quot;</span>
    <span class="c"># pst = [rs,diamb,distb,n0,occult]</span>
    <span class="n">rs</span><span class="p">,</span> <span class="n">diamb</span><span class="p">,</span> <span class="n">distb</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">occult</span> <span class="o">=</span> <span class="n">pst</span>
    <span class="c"># pob = [Qis,Uis,ne,phi0,ths,iang,fact]</span>
    <span class="n">Qis</span><span class="p">,</span> <span class="n">Uis</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">phi0</span><span class="p">,</span> <span class="n">ths</span><span class="p">,</span> <span class="n">iang</span><span class="p">,</span> <span class="n">fact</span> <span class="o">=</span> <span class="n">pob</span>
    <span class="c">#</span>
    <span class="c"># x = varr*_np.sin(th)*_np.cos(phi)</span>
    <span class="c"># y = varr*(_np.cos(iang)*_np.sin(th)*_np.sin(phi)+_np.sin(iang)*_</span>
        <span class="c"># np.cos(th))</span>
    <span class="c"># z = varr*(-_np.sin(iang)*_np.sin(th)*_np.sin(phi)+_np.cos(iang)*_</span>
        <span class="c"># np.cos(th))</span>
    <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">sph2cart</span><span class="p">(</span><span class="n">varr</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
    <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">cart_rot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">iang</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
    <span class="c">#</span>
    <span class="n">rl</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">n3</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">diamb</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="c"># P0 = (rs/varr)**2*sigT*ne*rl*3./16./_np.pi*(rl**2./4/_np.pi/rs**2.)</span>
    <span class="n">P0</span> <span class="o">=</span> <span class="mf">3.</span> <span class="o">/</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">ne</span> <span class="o">*</span> <span class="n">_sigT</span> <span class="o">*</span> <span class="n">rl</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">rs</span> <span class="o">/</span> <span class="n">varr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> \
        <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">rs</span> <span class="o">/</span> <span class="n">varr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">rl</span> <span class="o">/</span> <span class="n">varr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">cosX</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">iang</span><span class="p">)</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">+</span> \
        <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">iang</span><span class="p">)</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span>
    <span class="c"># Ii = _np.zeros(len(varr))+1./(len(varr)*2)</span>
    <span class="n">Ii</span> <span class="o">=</span> <span class="n">P0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">cosX</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">Qi</span> <span class="o">=</span> <span class="n">P0</span> <span class="o">*</span> <span class="p">(</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">varr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="n">varr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
    <span class="n">Ui</span> <span class="o">=</span> <span class="n">P0</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">/</span> <span class="n">varr</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
    <span class="n">Pi</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Qi</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Ui</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="c"># Occultation ##</span>
    <span class="k">if</span> <span class="n">occult</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span> 
        <span class="n">ind</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">rs</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">z</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">Qi</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">Ui</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">Pi</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">Ii</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">rs</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">z</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">Ii</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ii</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">rs</span> <span class="o">/</span> <span class="n">varr</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span>
            <span class="n">ne</span> <span class="o">*</span> <span class="n">_sigT</span> <span class="o">*</span> <span class="n">rl</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">rl</span><span class="o">**</span><span class="mf">2.</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">varr</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">**</span><span class="mf">2.</span><span class="p">)</span>
        <span class="c"># ind = _np.where(z&lt;0) and _np.where(x**2+y**2 &lt; rs**2)</span>
        <span class="c"># Qi[ind] = 0</span>
        <span class="c"># Ui[ind] = 0</span>
        <span class="c"># Pi[ind] = 0</span>
        <span class="c"># Ii[ind] = 0</span>
        <span class="c"># ind = _np.where(z&gt;0) and _np.where(x**2+y**2 &lt; rs**2)</span>
        <span class="c"># Ii[ind] = Ii[ind] - (rs/varr[ind])**2*(_np.exp(-ne*sigT*rl))*</span>
            <span class="c"># (rl**2./4/_np.pi/varr[ind]**2.)</span>
    <span class="k">return</span> <span class="o">.</span><span class="mi">5</span> <span class="o">+</span> <span class="n">Ii</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">fact</span> <span class="o">*</span> <span class="n">Pi</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">fact</span> <span class="o">*</span> <span class="n">Qi</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">fact</span> <span class="o">*</span> <span class="n">Ui</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="modcycle"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.modcycle">[docs]</a><span class="k">def</span> <span class="nf">modcycle</span><span class="p">(</span><span class="n">phiT</span><span class="p">,</span> <span class="n">pst</span><span class="p">,</span> <span class="n">pob</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; ### ONE MODEL CALC ### &quot;&quot;&quot;</span>
    <span class="c"># pst = [rs,diamb,distb,n0,occult]</span>
    <span class="c"># rs,diamb,distb,n0,occult = pst</span>
    <span class="c"># pob = [Qis,Uis,ne,phi0,ths,iang,fact]</span>
    <span class="n">Qis</span><span class="p">,</span> <span class="n">Uis</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">phi0</span><span class="p">,</span> <span class="n">ths</span><span class="p">,</span> <span class="n">iang</span><span class="p">,</span> <span class="n">fact</span> <span class="o">=</span> <span class="n">pob</span>
    <span class="c">#</span>
    <span class="n">nT</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phiT</span><span class="p">)</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nT</span><span class="p">)</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nT</span><span class="p">)</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nT</span><span class="p">)</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nT</span><span class="p">)</span>
    <span class="c"># phib blobs in position phibi ##</span>
    <span class="n">phib</span> <span class="o">=</span> <span class="p">[</span><span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
    <span class="p">(</span><span class="n">varr</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">phi_0</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span> <span class="o">=</span> <span class="n">geogen</span><span class="p">(</span><span class="n">pst</span><span class="p">)</span>
    <span class="n">nT</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phiT</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nT</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">phibi</span> <span class="ow">in</span> <span class="n">phib</span><span class="p">:</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">phi_0</span> <span class="o">+</span> <span class="n">phibi</span> <span class="o">+</span> <span class="n">phiT</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">phi0</span>
            <span class="p">(</span><span class="n">Ii</span><span class="p">,</span> <span class="n">Pi</span><span class="p">,</span> <span class="n">Qi</span><span class="p">,</span> <span class="n">Ui</span><span class="p">)</span> <span class="o">=</span> <span class="n">stokes</span><span class="p">(</span><span class="n">varr</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">pst</span><span class="p">,</span> <span class="n">pob</span><span class="p">)</span>
            <span class="n">I</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">Ii</span>
            <span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">Pi</span>
            <span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">Qi</span>
            <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">Ui</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">Q0check</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">I</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">n3</span>

</div>
<div class="viewcode-block" id="errorcalc"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.errorcalc">[docs]</a><span class="k">def</span> <span class="nf">errorcalc</span><span class="p">(</span><span class="n">pst</span><span class="p">,</span> <span class="n">pob</span><span class="p">,</span> <span class="n">dobs</span><span class="p">,</span> <span class="n">pdk</span><span class="p">,</span> <span class="n">phiobs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; error calc &quot;&quot;&quot;</span>
    <span class="n">rdi</span><span class="p">,</span> <span class="n">rdf</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">ned</span><span class="p">,</span> <span class="n">dh</span><span class="p">,</span> <span class="n">ddr</span><span class="p">,</span> <span class="n">dphi</span> <span class="o">=</span> <span class="n">pdk</span>
    <span class="n">Qis</span><span class="p">,</span> <span class="n">Uis</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">phi0</span><span class="p">,</span> <span class="n">ths</span><span class="p">,</span> <span class="n">iang</span><span class="p">,</span> <span class="n">fact</span> <span class="o">=</span> <span class="n">pob</span>
    <span class="n">Qobs</span><span class="p">,</span> <span class="n">Uobs</span><span class="p">,</span> <span class="n">sigobs</span> <span class="o">=</span> <span class="n">dobs</span>
    <span class="p">(</span><span class="n">varr</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">phi_0</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span> <span class="o">=</span> <span class="n">geogen</span><span class="p">(</span><span class="n">pst</span><span class="p">)</span>
    <span class="p">(</span><span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD_0</span><span class="p">)</span> <span class="o">=</span> <span class="n">diskcoords</span><span class="p">(</span><span class="n">pdk</span><span class="p">)</span>
    <span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span> <span class="o">=</span> <span class="n">modcycleF</span><span class="p">(</span>
        <span class="n">varr</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">phi_0</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD_0</span><span class="p">,</span> <span class="n">phiobs</span><span class="p">,</span> <span class="n">pst</span><span class="p">,</span> <span class="n">pob</span><span class="p">,</span> <span class="n">pdk</span><span class="p">)</span>
    <span class="c">#</span>
    <span class="p">(</span><span class="n">Qobc</span><span class="p">,</span> <span class="n">Uobc</span><span class="p">)</span> <span class="o">=</span> <span class="n">mod2obs</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">pob</span><span class="p">)</span>
    <span class="p">(</span><span class="n">Qchi2</span><span class="p">,</span> <span class="n">Uchi2</span><span class="p">)</span> <span class="o">=</span> <span class="n">chi2calc</span><span class="p">(</span><span class="n">Qobc</span><span class="p">,</span> <span class="n">Uobc</span><span class="p">,</span> <span class="n">dobs</span><span class="p">)</span>
    <span class="n">chi2min</span> <span class="o">=</span> <span class="n">Qchi2</span> <span class="o">+</span> <span class="n">Uchi2</span>
    <span class="c">#</span>
    <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">:</span>
        <span class="n">Qis0</span> <span class="o">=</span> <span class="n">Qis</span>
        <span class="n">Uis0</span> <span class="o">=</span> <span class="n">Uis</span>
        <span class="n">ne0</span> <span class="o">=</span> <span class="n">ne</span>
        <span class="n">ths0</span> <span class="o">=</span> <span class="n">ths</span>
        <span class="n">phi00</span> <span class="o">=</span> <span class="n">phi0</span>
        <span class="n">ned0</span> <span class="o">=</span> <span class="n">ned</span>
        <span class="n">alpha0</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="c">#</span>
        <span class="p">(</span><span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD_0</span><span class="p">)</span> <span class="o">=</span> <span class="n">diskcoords</span><span class="p">(</span><span class="n">pdk</span><span class="p">)</span>
        <span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span> <span class="o">=</span> <span class="n">modcycleF</span><span class="p">(</span>
            <span class="n">varr</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">phi_0</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD_0</span><span class="p">,</span> <span class="n">phiobs</span><span class="p">,</span> <span class="n">pst</span><span class="p">,</span> <span class="n">pob</span><span class="p">,</span> <span class="n">pdk</span><span class="p">)</span>
        <span class="n">chi2</span> <span class="o">=</span> <span class="n">chi2min</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">step</span>
        <span class="k">while</span> <span class="n">chi2</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">chi2min</span><span class="p">:</span>
            <span class="n">Qis</span> <span class="o">=</span> <span class="n">Qis</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="o">.</span><span class="mo">005</span><span class="p">)</span>
            <span class="n">pob</span> <span class="o">=</span> <span class="p">[</span><span class="n">Qis</span><span class="p">,</span> <span class="n">Uis</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">phi0</span><span class="p">,</span> <span class="n">ths</span><span class="p">,</span> <span class="n">iang</span><span class="p">,</span> <span class="n">fact</span><span class="p">]</span>
            <span class="p">(</span><span class="n">Qobc</span><span class="p">,</span> <span class="n">Uobc</span><span class="p">)</span> <span class="o">=</span> <span class="n">mod2obs</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">pob</span><span class="p">)</span>
            <span class="p">(</span><span class="n">Qchi2</span><span class="p">,</span> <span class="n">Uchi2</span><span class="p">)</span> <span class="o">=</span> <span class="n">chi2calc</span><span class="p">(</span><span class="n">Qobc</span><span class="p">,</span> <span class="n">Uobc</span><span class="p">,</span> <span class="n">dobs</span><span class="p">)</span>
            <span class="n">chi2</span> <span class="o">=</span> <span class="n">Qchi2</span> <span class="o">+</span> <span class="n">Uchi2</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">step</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Finished Qis! </span><span class="si">%s</span><span class="s">, </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Qis</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
        <span class="n">Qis</span> <span class="o">=</span> <span class="n">Qis0</span>
        <span class="n">pob</span> <span class="o">=</span> <span class="p">[</span><span class="n">Qis</span><span class="p">,</span> <span class="n">Uis</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">phi0</span><span class="p">,</span> <span class="n">ths</span><span class="p">,</span> <span class="n">iang</span><span class="p">,</span> <span class="n">fact</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="n">chi2</span> <span class="o">=</span> <span class="n">chi2min</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">step</span>
        <span class="k">while</span> <span class="n">chi2</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">chi2min</span><span class="p">:</span>
            <span class="n">Uis</span> <span class="o">=</span> <span class="n">Uis</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="o">.</span><span class="mo">005</span><span class="p">)</span>
            <span class="n">pob</span> <span class="o">=</span> <span class="p">[</span><span class="n">Qis</span><span class="p">,</span> <span class="n">Uis</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">phi0</span><span class="p">,</span> <span class="n">ths</span><span class="p">,</span> <span class="n">iang</span><span class="p">,</span> <span class="n">fact</span><span class="p">]</span>
            <span class="p">(</span><span class="n">Qobc</span><span class="p">,</span> <span class="n">Uobc</span><span class="p">)</span> <span class="o">=</span> <span class="n">mod2obs</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">pob</span><span class="p">)</span>
            <span class="p">(</span><span class="n">Qchi2</span><span class="p">,</span> <span class="n">Uchi2</span><span class="p">)</span> <span class="o">=</span> <span class="n">chi2calc</span><span class="p">(</span><span class="n">Qobc</span><span class="p">,</span> <span class="n">Uobc</span><span class="p">,</span> <span class="n">dobs</span><span class="p">)</span>
            <span class="n">chi2</span> <span class="o">=</span> <span class="n">Qchi2</span> <span class="o">+</span> <span class="n">Uchi2</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">step</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Finished Uis! </span><span class="si">%s</span><span class="s">, </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Uis</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
        <span class="n">Uis</span> <span class="o">=</span> <span class="n">Uis0</span>
        <span class="n">pob</span> <span class="o">=</span> <span class="p">[</span><span class="n">Qis</span><span class="p">,</span> <span class="n">Uis</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">phi0</span><span class="p">,</span> <span class="n">ths</span><span class="p">,</span> <span class="n">iang</span><span class="p">,</span> <span class="n">fact</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="n">chi2</span> <span class="o">=</span> <span class="n">chi2min</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">step</span>
        <span class="k">while</span> <span class="n">chi2</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">chi2min</span> <span class="o">/</span> <span class="mf">1.17741</span><span class="p">:</span>
            <span class="n">ne</span> <span class="o">=</span> <span class="n">ne</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="o">.</span><span class="mo">05</span><span class="p">)</span>
            <span class="n">pob</span> <span class="o">=</span> <span class="p">[</span><span class="n">Qis</span><span class="p">,</span> <span class="n">Uis</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">phi0</span><span class="p">,</span> <span class="n">ths</span><span class="p">,</span> <span class="n">iang</span><span class="p">,</span> <span class="n">fact</span><span class="p">]</span>
            <span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span> <span class="o">=</span> <span class="n">modcycleF</span><span class="p">(</span>
                <span class="n">varr</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">phi_0</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD_0</span><span class="p">,</span> <span class="n">phiobs</span><span class="p">,</span> <span class="n">pst</span><span class="p">,</span> <span class="n">pob</span><span class="p">,</span> <span class="n">pdk</span><span class="p">)</span>
            <span class="p">(</span><span class="n">Qobc</span><span class="p">,</span> <span class="n">Uobc</span><span class="p">)</span> <span class="o">=</span> <span class="n">mod2obs</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">pob</span><span class="p">)</span>
            <span class="p">(</span><span class="n">Qchi2</span><span class="p">,</span> <span class="n">Uchi2</span><span class="p">)</span> <span class="o">=</span> <span class="n">chi2calc</span><span class="p">(</span><span class="n">Qobc</span><span class="p">,</span> <span class="n">Uobc</span><span class="p">,</span> <span class="n">dobs</span><span class="p">)</span>
            <span class="n">chi2</span> <span class="o">=</span> <span class="n">Qchi2</span> <span class="o">+</span> <span class="n">Uchi2</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">step</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Finished ne! </span><span class="si">%s</span><span class="s">, </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ne</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
        <span class="n">ne</span> <span class="o">=</span> <span class="n">ne0</span>
        <span class="n">pob</span> <span class="o">=</span> <span class="p">[</span><span class="n">Qis</span><span class="p">,</span> <span class="n">Uis</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">phi0</span><span class="p">,</span> <span class="n">ths</span><span class="p">,</span> <span class="n">iang</span><span class="p">,</span> <span class="n">fact</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="n">chi2</span> <span class="o">=</span> <span class="n">chi2min</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">step</span>
        <span class="k">while</span> <span class="n">chi2</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">chi2min</span> <span class="o">/</span> <span class="mf">1.17741</span><span class="p">:</span>
            <span class="n">ths</span> <span class="o">=</span> <span class="n">ths</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="o">.</span><span class="mo">005</span><span class="p">)</span>
            <span class="n">pob</span> <span class="o">=</span> <span class="p">[</span><span class="n">Qis</span><span class="p">,</span> <span class="n">Uis</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">phi0</span><span class="p">,</span> <span class="n">ths</span><span class="p">,</span> <span class="n">iang</span><span class="p">,</span> <span class="n">fact</span><span class="p">]</span>
            <span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span> <span class="o">=</span> <span class="n">modcycleF</span><span class="p">(</span>
                <span class="n">varr</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">phi_0</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD_0</span><span class="p">,</span> <span class="n">phiobs</span><span class="p">,</span> <span class="n">pst</span><span class="p">,</span> <span class="n">pob</span><span class="p">,</span> <span class="n">pdk</span><span class="p">)</span>
            <span class="p">(</span><span class="n">Qobc</span><span class="p">,</span> <span class="n">Uobc</span><span class="p">)</span> <span class="o">=</span> <span class="n">mod2obs</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">pob</span><span class="p">)</span>
            <span class="p">(</span><span class="n">Qchi2</span><span class="p">,</span> <span class="n">Uchi2</span><span class="p">)</span> <span class="o">=</span> <span class="n">chi2calc</span><span class="p">(</span><span class="n">Qobc</span><span class="p">,</span> <span class="n">Uobc</span><span class="p">,</span> <span class="n">dobs</span><span class="p">)</span>
            <span class="n">chi2</span> <span class="o">=</span> <span class="n">Qchi2</span> <span class="o">+</span> <span class="n">Uchi2</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">step</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Finished ths! </span><span class="si">%.1f</span><span class="s">, </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ths</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
        <span class="n">ths</span> <span class="o">=</span> <span class="n">ths0</span>
        <span class="n">pob</span> <span class="o">=</span> <span class="p">[</span><span class="n">Qis</span><span class="p">,</span> <span class="n">Uis</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">phi0</span><span class="p">,</span> <span class="n">ths</span><span class="p">,</span> <span class="n">iang</span><span class="p">,</span> <span class="n">fact</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="n">chi2</span> <span class="o">=</span> <span class="n">chi2min</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">step</span>
        <span class="k">while</span> <span class="n">chi2</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">chi2min</span> <span class="o">/</span> <span class="mf">1.17741</span><span class="p">:</span>
            <span class="n">phi0</span> <span class="o">=</span> <span class="n">phi0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="o">.</span><span class="mo">005</span><span class="p">)</span>
            <span class="n">pob</span> <span class="o">=</span> <span class="n">Qis</span><span class="p">,</span> <span class="n">Uis</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">phi0</span><span class="p">,</span> <span class="n">ths</span><span class="p">,</span> <span class="n">iang</span><span class="p">,</span> <span class="n">fact</span>
            <span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span> <span class="o">=</span> <span class="n">modcycleF</span><span class="p">(</span>
                <span class="n">varr</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">phi_0</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD_0</span><span class="p">,</span> <span class="n">phiobs</span><span class="p">,</span> <span class="n">pst</span><span class="p">,</span> <span class="n">pob</span><span class="p">,</span> <span class="n">pdk</span><span class="p">)</span>
            <span class="p">(</span><span class="n">Qobc</span><span class="p">,</span> <span class="n">Uobc</span><span class="p">)</span> <span class="o">=</span> <span class="n">mod2obs</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">pob</span><span class="p">)</span>
            <span class="p">(</span><span class="n">Qchi2</span><span class="p">,</span> <span class="n">Uchi2</span><span class="p">)</span> <span class="o">=</span> <span class="n">chi2calc</span><span class="p">(</span><span class="n">Qobc</span><span class="p">,</span> <span class="n">Uobc</span><span class="p">,</span> <span class="n">dobs</span><span class="p">)</span>
            <span class="n">chi2</span> <span class="o">=</span> <span class="n">Qchi2</span> <span class="o">+</span> <span class="n">Uchi2</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">step</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Finished phi0! </span><span class="si">%.3f</span><span class="s">, </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">phi0</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
        <span class="n">phi0</span> <span class="o">=</span> <span class="n">phi00</span>
        <span class="n">pob</span> <span class="o">=</span> <span class="p">[</span><span class="n">Qis</span><span class="p">,</span> <span class="n">Uis</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">phi0</span><span class="p">,</span> <span class="n">ths</span><span class="p">,</span> <span class="n">iang</span><span class="p">,</span> <span class="n">fact</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="n">chi2</span> <span class="o">=</span> <span class="n">chi2min</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">step</span>
        <span class="k">while</span> <span class="n">chi2</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">chi2min</span> <span class="o">/</span> <span class="mf">1.17741</span><span class="p">:</span>
            <span class="n">ned</span> <span class="o">=</span> <span class="n">ned</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="o">.</span><span class="mo">005</span><span class="p">)</span>
            <span class="n">pdk</span> <span class="o">=</span> <span class="p">[</span><span class="n">rdi</span><span class="p">,</span> <span class="n">rdf</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">ned</span><span class="p">,</span> <span class="n">dh</span><span class="p">,</span> <span class="n">ddr</span><span class="p">,</span> <span class="n">dphi</span><span class="p">]</span>
            <span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span> <span class="o">=</span> <span class="n">modcycleF</span><span class="p">(</span>
                <span class="n">varr</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">phi_0</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD_0</span><span class="p">,</span> <span class="n">phiobs</span><span class="p">,</span> <span class="n">pst</span><span class="p">,</span> <span class="n">pob</span><span class="p">,</span> <span class="n">pdk</span><span class="p">)</span>
            <span class="p">(</span><span class="n">Qobc</span><span class="p">,</span> <span class="n">Uobc</span><span class="p">)</span> <span class="o">=</span> <span class="n">mod2obs</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">pob</span><span class="p">)</span>
            <span class="p">(</span><span class="n">Qchi2</span><span class="p">,</span> <span class="n">Uchi2</span><span class="p">)</span> <span class="o">=</span> <span class="n">chi2calc</span><span class="p">(</span><span class="n">Qobc</span><span class="p">,</span> <span class="n">Uobc</span><span class="p">,</span> <span class="n">dobs</span><span class="p">)</span>
            <span class="n">chi2</span> <span class="o">=</span> <span class="n">Qchi2</span> <span class="o">+</span> <span class="n">Uchi2</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">step</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Finished ned! </span><span class="si">%.2e</span><span class="s">, </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ned</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
        <span class="n">ned</span> <span class="o">=</span> <span class="n">ned0</span>
        <span class="n">pdk</span> <span class="o">=</span> <span class="p">[</span><span class="n">rdi</span><span class="p">,</span> <span class="n">rdf</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">ned</span><span class="p">,</span> <span class="n">dh</span><span class="p">,</span> <span class="n">ddr</span><span class="p">,</span> <span class="n">dphi</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="n">chi2</span> <span class="o">=</span> <span class="n">chi2min</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">step</span>
        <span class="k">while</span> <span class="n">chi2</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">chi2min</span> <span class="o">/</span> <span class="mf">1.17741</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="o">.</span><span class="mo">05</span><span class="p">)</span>
            <span class="n">pdk</span> <span class="o">=</span> <span class="p">[</span><span class="n">rdi</span><span class="p">,</span> <span class="n">rdf</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">ned</span><span class="p">,</span> <span class="n">dh</span><span class="p">,</span> <span class="n">ddr</span><span class="p">,</span> <span class="n">dphi</span><span class="p">]</span>
            <span class="p">(</span><span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD_0</span><span class="p">)</span> <span class="o">=</span> <span class="n">diskcoords</span><span class="p">(</span><span class="n">pdk</span><span class="p">)</span>
            <span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span> <span class="o">=</span> <span class="n">modcycleF</span><span class="p">(</span>
                <span class="n">varr</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">phi_0</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD_0</span><span class="p">,</span> <span class="n">phiobs</span><span class="p">,</span> <span class="n">pst</span><span class="p">,</span> <span class="n">pob</span><span class="p">,</span> <span class="n">pdk</span><span class="p">)</span>
            <span class="p">(</span><span class="n">Qobc</span><span class="p">,</span> <span class="n">Uobc</span><span class="p">)</span> <span class="o">=</span> <span class="n">mod2obs</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">pob</span><span class="p">)</span>
            <span class="p">(</span><span class="n">Qchi2</span><span class="p">,</span> <span class="n">Uchi2</span><span class="p">)</span> <span class="o">=</span> <span class="n">chi2calc</span><span class="p">(</span><span class="n">Qobc</span><span class="p">,</span> <span class="n">Uobc</span><span class="p">,</span> <span class="n">dobs</span><span class="p">)</span>
            <span class="n">chi2</span> <span class="o">=</span> <span class="n">Qchi2</span> <span class="o">+</span> <span class="n">Uchi2</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">step</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Finished alpha! </span><span class="si">%.3f</span><span class="s">, </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha0</span>
        <span class="n">pdk</span> <span class="o">=</span> <span class="p">[</span><span class="n">rdi</span><span class="p">,</span> <span class="n">rdf</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">ned</span><span class="p">,</span> <span class="n">dh</span><span class="p">,</span> <span class="n">ddr</span><span class="p">,</span> <span class="n">dphi</span><span class="p">]</span>
    <span class="k">return</span> 

</div>
<div class="viewcode-block" id="QUang"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.QUang">[docs]</a><span class="k">def</span> <span class="nf">QUang</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; ### Q,U angles ### &quot;&quot;&quot;</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Q</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">Q</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-34</span>
    <span class="n">ang</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">U</span> <span class="o">/</span> <span class="n">Q</span><span class="p">)</span>
    <span class="c">#</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Q</span> <span class="o">&lt;=</span> <span class="mf">0.</span><span class="p">)</span>
    <span class="n">ang</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">ang</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">+</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">Q</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">U</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">ang</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">ang</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">ang</span> <span class="o">=</span> <span class="n">ang</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="c"># ind = _np.where(ang &gt;= _np.pi)</span>
    <span class="c"># ang[ind] = ang[ind] - _np.pi</span>
    <span class="k">if</span> <span class="nb">filter</span><span class="p">:</span>
        <span class="n">avg</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span>
        <span class="n">avg</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">find_nearest</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">3.</span> <span class="o">/</span> <span class="mi">4</span><span class="p">],</span> <span class="n">avg</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">ang</span> <span class="o">-</span> <span class="n">avg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">2.</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">ang</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">ang</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">-</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">ang</span> <span class="o">-</span> <span class="n">avg</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">2.</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">ang</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">ang</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">+</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">return</span> <span class="n">ang</span>

</div>
<div class="viewcode-block" id="mod2obs"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.mod2obs">[docs]</a><span class="k">def</span> <span class="nf">mod2obs</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">pob</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; ### MODEL TO OBSERV ### &quot;&quot;&quot;</span>
    <span class="c"># pst = [rs,diamb,distb,n0,occult]</span>
    <span class="c"># rs,diamb,distb,n0,occult = pst</span>
    <span class="c"># pob = [Qis,Uis,ne,phi0,ths,iang,fact]</span>
    <span class="n">Qis</span><span class="p">,</span> <span class="n">Uis</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">phi0</span><span class="p">,</span> <span class="n">ths</span><span class="p">,</span> <span class="n">iang</span><span class="p">,</span> <span class="n">fact</span> <span class="o">=</span> <span class="n">pob</span>
    <span class="c"># dobs = [phiobs,Qobs,Uobs,sigobs]</span>
    <span class="c"># phiobs,Qobs,Uobs,sigobs = dobs</span>

    <span class="n">ang</span> <span class="o">=</span> <span class="n">QUang</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">)</span>
    <span class="n">Qobc</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Q</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">U</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ang</span> <span class="o">+</span> <span class="n">ths</span><span class="p">))</span>
    <span class="n">Uobc</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Q</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">U</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ang</span> <span class="o">+</span> <span class="n">ths</span><span class="p">))</span>         
    <span class="n">Qobc</span> <span class="o">=</span> <span class="n">Qobc</span> <span class="o">+</span> <span class="n">Qis</span>
    <span class="n">Uobc</span> <span class="o">=</span> <span class="n">Uobc</span> <span class="o">+</span> <span class="n">Uis</span>
    <span class="k">return</span> <span class="n">Qobc</span><span class="p">,</span> <span class="n">Uobc</span>

</div>
<div class="viewcode-block" id="obs2mod"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.obs2mod">[docs]</a><span class="k">def</span> <span class="nf">obs2mod</span><span class="p">(</span><span class="n">pob</span><span class="p">,</span> <span class="n">dobs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; ### MODEL TO OBSERV ### &quot;&quot;&quot;</span>
    <span class="c"># pst = [rs,diamb,distb,n0,occult]</span>
    <span class="c"># rs,diamb,distb,n0,occult = pst</span>
    <span class="c"># pob = [Qis,Uis,ne,phi0,ths,iang]</span>
    <span class="n">Qis</span><span class="p">,</span> <span class="n">Uis</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">phi0</span><span class="p">,</span> <span class="n">ths</span><span class="p">,</span> <span class="n">iang</span><span class="p">,</span> <span class="n">fact</span> <span class="o">=</span> <span class="n">pob</span>
    <span class="c"># dobs = [phiobs,Qobs,Uobs,sigobs]</span>
    <span class="n">Qobs</span><span class="p">,</span> <span class="n">Uobs</span><span class="p">,</span> <span class="n">sigobs</span> <span class="o">=</span> <span class="n">dobs</span>

    <span class="n">Qcob</span> <span class="o">=</span> <span class="n">Qobs</span> <span class="o">-</span> <span class="n">Qis</span>
    <span class="n">Ucob</span> <span class="o">=</span> <span class="n">Uobs</span> <span class="o">-</span> <span class="n">Uis</span>
    <span class="n">ang</span> <span class="o">=</span> <span class="n">QUang</span><span class="p">(</span><span class="n">Qcob</span><span class="p">,</span> <span class="n">Ucob</span><span class="p">)</span>
    <span class="n">Qcob</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Qcob</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Ucob</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ang</span> <span class="o">-</span> <span class="n">ths</span><span class="p">))</span>
    <span class="n">Ucob</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Qcob</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Ucob</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ang</span> <span class="o">-</span> <span class="n">ths</span><span class="p">))</span>         
    <span class="k">return</span> <span class="n">Qcob</span><span class="p">,</span> <span class="n">Ucob</span>

</div>
<div class="viewcode-block" id="chi2calc_old"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.chi2calc_old">[docs]</a><span class="k">def</span> <span class="nf">chi2calc_old</span><span class="p">(</span><span class="n">Qobc</span><span class="p">,</span> <span class="n">Uobc</span><span class="p">,</span> <span class="n">dobs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; ### CHI2 CALC given Pobs and Pobc ### &quot;&quot;&quot;</span>
    <span class="n">Qobs</span><span class="p">,</span> <span class="n">Uobs</span><span class="p">,</span> <span class="n">sigobs</span> <span class="o">=</span> <span class="n">dobs</span>
    <span class="n">Qchi2</span> <span class="o">=</span> <span class="p">(</span><span class="n">Qobc</span> <span class="o">-</span> <span class="n">Qobs</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">sigobs</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">Uchi2</span> <span class="o">=</span> <span class="p">(</span><span class="n">Uobc</span> <span class="o">-</span> <span class="n">Uobs</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">sigobs</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">Qchi2</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">Uchi2</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sigobs</span><span class="p">)</span> <span class="o">-</span> <span class="mf">7.</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>\
        <span class="p">(</span><span class="n">Qchi2</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">Uchi2</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sigobs</span><span class="p">)</span> <span class="o">-</span> <span class="mf">7.</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

</div>
<div class="viewcode-block" id="chi2calc"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.chi2calc">[docs]</a><span class="k">def</span> <span class="nf">chi2calc</span><span class="p">(</span><span class="n">Qobc</span><span class="p">,</span> <span class="n">Uobc</span><span class="p">,</span> <span class="n">dobs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; ### CHI2 CALC given Pobs and Pobc ### &quot;&quot;&quot;</span>
    <span class="n">Qobs</span><span class="p">,</span> <span class="n">Uobs</span><span class="p">,</span> <span class="n">sigobs</span> <span class="o">=</span> <span class="n">dobs</span>
    <span class="n">Qchi2</span> <span class="o">=</span> <span class="p">(</span><span class="n">Qobc</span> <span class="o">-</span> <span class="n">Qobs</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">sigobs</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">Uobc</span> <span class="o">-</span> <span class="n">Uobs</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">sigobs</span><span class="o">**</span><span class="mi">2</span> 
    <span class="k">return</span> <span class="n">Qchi2</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sigobs</span><span class="p">)</span> <span class="o">-</span> <span class="mf">7.</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>\
        <span class="n">Qchi2</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sigobs</span><span class="p">)</span> <span class="o">-</span> <span class="mf">7.</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

</div>
<div class="viewcode-block" id="Q0check"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.Q0check">[docs]</a><span class="k">def</span> <span class="nf">Q0check</span><span class="p">(</span><span class="n">Q</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; ### Q0 check ### &quot;&quot;&quot;</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Q</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">Q</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="mf">1e-34</span>
    <span class="k">return</span> <span class="n">Q</span>

</div>
<div class="viewcode-block" id="extend"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.extend">[docs]</a><span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="n">phiT</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; extend &quot;&quot;&quot;</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="p">(</span><span class="n">phiT</span> <span class="o">&gt;</span> <span class="mf">0.8</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">phiT</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">phiT</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1.</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">phiT</span><span class="p">))</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Q</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">Q</span><span class="p">))</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">U</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">U</span><span class="p">))</span>
    <span class="n">ind2</span> <span class="o">=</span> <span class="p">(</span><span class="n">phiT</span> <span class="o">&lt;</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">phiT</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span>
    <span class="n">phiT</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">phiT</span><span class="p">,</span> <span class="n">phiT</span><span class="p">[</span><span class="n">ind2</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Q</span><span class="p">,</span> <span class="n">Q</span><span class="p">[</span><span class="n">ind2</span><span class="p">]))</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">U</span><span class="p">,</span> <span class="n">U</span><span class="p">[</span><span class="n">ind2</span><span class="p">]))</span>
    <span class="c">#</span>
    <span class="n">ang</span> <span class="o">=</span> <span class="n">QUang</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="mf">90.</span>
    <span class="c">#</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Q</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">U</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="c">#</span>
    <span class="n">extmtx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span> <span class="p">(</span><span class="n">phiT</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="o">-</span><span class="n">Q</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">ang</span> <span class="p">))</span><span class="o">.</span><span class="n">T</span>
    <span class="n">_np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s">&#39;mod.txt&#39;</span><span class="p">,</span> <span class="n">extmtx</span><span class="p">)</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="poly_curve_output"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.poly_curve_output">[docs]</a><span class="k">def</span> <span class="nf">poly_curve_output</span><span class="p">(</span><span class="n">best_params</span><span class="p">,</span> <span class="n">errors</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Terminal fit output</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;&#39;&#39;        MCMC fitting:       &#39;&#39;&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">15</span> <span class="o">+</span> <span class="s">&#39; Fitted parameters &#39;</span> <span class="o">+</span> <span class="s">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">15</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">sig</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">best_params</span><span class="p">,</span> <span class="n">errors</span><span class="p">):</span>
            <span class="c"># print(&quot;{:e} +- {:e}&quot; .format(value, sig))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">sig</span><span class="p">)</span>
    <span class="k">return</span>    

</div>
<div class="viewcode-block" id="phsort"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.phsort">[docs]</a><span class="k">def</span> <span class="nf">phsort</span><span class="p">(</span><span class="n">ph</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; sort by phases &quot;&quot;&quot;</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ph</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="extdata"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.extdata">[docs]</a><span class="k">def</span> <span class="nf">extdata</span><span class="p">(</span><span class="n">ph</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; extend data for phases &quot;&quot;&quot;</span>
    <span class="n">ph</span><span class="p">,</span> <span class="n">P</span> <span class="o">=</span> <span class="n">phsort</span><span class="p">(</span><span class="n">ph</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ph</span> <span class="o">&gt;</span> <span class="o">.</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">phadd0</span> <span class="o">=</span> <span class="n">ph</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1.</span>
    <span class="n">Padd0</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ph</span> <span class="o">&lt;</span> <span class="o">.</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">phadd</span> <span class="o">=</span> <span class="n">ph</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.</span>
    <span class="n">Padd</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">_np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">phadd0</span><span class="p">,</span> <span class="n">ph</span><span class="p">,</span> <span class="n">phadd</span><span class="p">)),</span> <span class="n">_np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Padd0</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">Padd</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="BlobDiskMod"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.BlobDiskMod">[docs]</a><span class="k">class</span> <span class="nc">BlobDiskMod</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Class BlobDiskMod doc</span>

<span class="sd">    Definicoes:</span>

<span class="sd">        -fases sempre entre 0-1</span>
<span class="sd">        -phiin = phiobs-phi0 = phimod</span>
<span class="sd">        -phiobs = phimod+phi0</span>
<span class="sd">        -Q1 = Qobs-Qis</span>
<span class="sd">        -Qobs = Qmod+Qis</span>
<span class="sd">        -Q2 = Pobs**2*_np.cos(2*(ang-ths))</span>
<span class="sd">        -Q2obs = Pmod**2*_np.cos(2*(angmod+ths))</span>

<span class="sd">        *Pobs = Raw Data</span>
<span class="sd">        *P1 = Raw Data - P_IS</span>
<span class="sd">        *P2 = P1 * rot(ths)</span>
<span class="sd">        *Pmod = intrinsic mod (phi = linspace)</span>
<span class="sd">        *Pmodobs = observed mod (phi = linspace)</span>
<span class="sd">        *Psetobs = observed mod (phi = phiobs)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tgt</span><span class="o">=</span><span class="s">&#39;sori&#39;</span><span class="p">,</span> <span class="n">rs</span><span class="o">=</span><span class="mf">4.28</span><span class="p">,</span> <span class="n">diamb</span><span class="o">=</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">,</span> <span class="n">distb</span><span class="o">=</span><span class="mf">2.4</span><span class="p">,</span> <span class="n">n0</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">ne</span><span class="o">=</span><span class="mf">1e12</span><span class="p">,</span> <span class="n">iang</span><span class="o">=</span><span class="mf">75.</span><span class="p">,</span> <span class="n">dlt0</span><span class="o">=-</span><span class="mf">0.17</span><span class="p">,</span> <span class="n">ths</span><span class="o">=</span><span class="mf">150.3</span><span class="p">,</span> <span class="n">Qis</span><span class="o">=-</span><span class="mf">0.350</span><span class="p">,</span> <span class="n">Uis</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span>
        <span class="n">rdi</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">rdf</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">Hd</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span> <span class="n">dh</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ddr</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dphi</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">ned</span><span class="o">=</span><span class="mf">2.7e12</span><span class="p">,</span> 
        <span class="n">nbins</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">outname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">hasdata</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Class initialiser &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tgt</span> <span class="o">=</span> <span class="n">tgt</span>
        <span class="k">if</span> <span class="n">outname</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outname</span> <span class="o">=</span> <span class="n">tgt</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outname</span> <span class="o">=</span> <span class="n">outname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="c"># star-fixed parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rs</span> <span class="o">=</span> <span class="n">rs</span> <span class="o">*</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Rsun</span><span class="o">.</span><span class="n">cgs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diamb</span> <span class="o">=</span> <span class="n">diamb</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distb</span> <span class="o">=</span> <span class="n">distb</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n0</span> <span class="o">=</span> <span class="n">n0</span>
        <span class="c"># star-variable parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ne</span> <span class="o">=</span> <span class="n">ne</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iang</span> <span class="o">=</span> <span class="n">iang</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iang</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlt0</span> <span class="o">=</span> <span class="n">dlt0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlt0</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ths</span> <span class="o">=</span> <span class="n">ths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ths</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Qis</span> <span class="o">=</span> <span class="n">Qis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Uis</span> <span class="o">=</span> <span class="n">Uis</span>
        <span class="c"># disk</span>
        <span class="k">if</span> <span class="n">rdi</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rdi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distb</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">diamb</span> <span class="o">/</span> <span class="mf">2.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rdi</span> <span class="o">=</span> <span class="n">rdi</span>
        <span class="k">if</span> <span class="n">rdf</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distb</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">diamb</span> <span class="o">/</span> <span class="mf">2.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rdf</span> <span class="o">=</span> <span class="n">rdf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Hd</span> <span class="o">=</span> <span class="n">Hd</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alphad</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dh</span> <span class="o">=</span> <span class="n">dh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddr</span> <span class="o">=</span> <span class="n">ddr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dphi</span> <span class="o">=</span> <span class="n">dphi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ned</span> <span class="o">=</span> <span class="n">ned</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbins</span> <span class="o">=</span> <span class="n">nbins</span>
        <span class="k">if</span> <span class="n">hasdata</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setobs</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setRmPis</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setRot</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">80</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setmod</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">hasdata</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setbin</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span>

<div class="viewcode-block" id="BlobDiskMod.setobs"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.BlobDiskMod.setobs">[docs]</a>    <span class="k">def</span> <span class="nf">setobs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; It reads the `tgt.log` file inside path and sets the observation</span>
<span class="sd">        variables ph0 and Period (from light-curve database) and phiobs, Pobs,</span>
<span class="sd">        Qobs, Uobs, sigP, sigth and angobs from polarimetry. </span>

<span class="sd">        `r` applies the filtraobs with this ratio. &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">lmags</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span>
            <span class="s">&#39;{0}/refs/pol_mags.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_hdt</span><span class="o">.</span><span class="n">hdtpath</span><span class="p">()),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;{0}/{1}.log&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tgt</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Qobs</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Uobs</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigP</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigth</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Warning! Invalid {0} log file. Nothing done.&#39;</span><span class="o">.</span>
                <span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tgt</span><span class="p">))</span>
        <span class="c">#</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&#39;{0}/{1}.log&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tgt</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">fromarrays</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">names</span><span class="o">=</span><span class="s">&#39;MJD,night,filt,</span><span class="se">\</span>
<span class="s">        calc,ang.ref,dth,P,Q,U,th,sigP,sigQU,sigth&#39;</span><span class="p">,</span> <span class="n">formats</span><span class="o">=</span><span class="s">&#39;f8,a7,a1,f8,f8,f8,f8,</span><span class="se">\</span>
<span class="s">        f8,f8,f8,f8,f8,f8&#39;</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;filt&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;v&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">_polt</span><span class="o">.</span><span class="n">filtraobs</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lmags</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">tgt</span><span class="p">)</span>
        <span class="n">Period</span><span class="p">,</span> <span class="n">ph0</span> <span class="o">=</span> <span class="n">lmags</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Period</span> <span class="o">=</span> <span class="n">Period</span>
        <span class="n">ph0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ph0</span><span class="p">)</span> <span class="o">-</span> <span class="n">_jdcal</span><span class="o">.</span><span class="n">MJD_0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ph0</span> <span class="o">=</span> <span class="n">ph0</span>
        <span class="c">#</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;MJD&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ph0</span>
        <span class="n">phase</span> <span class="o">/=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Period</span><span class="p">)</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">modf</span><span class="p">(</span><span class="n">phase</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">phase</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;# EWrr!&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">=</span> <span class="n">phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Pobs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;P&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Qobs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;Q&#39;</span><span class="p">]</span>   
        <span class="bp">self</span><span class="o">.</span><span class="n">Uobs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;U&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angobs</span> <span class="o">=</span> <span class="n">QUang</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Qobs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Uobs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigP</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;sigP&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigth</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;sigth&#39;</span><span class="p">]</span>
        <span class="k">return</span>
</div>
<div class="viewcode-block" id="BlobDiskMod.getobs"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.BlobDiskMod.getobs">[docs]</a>    <span class="k">def</span> <span class="nf">getobs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; print obs. info &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phiin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pobs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Qobs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Uobs</span><span class="p">,</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">angobs</span>
</div>
<div class="viewcode-block" id="BlobDiskMod.setRmPis"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.BlobDiskMod.setRmPis">[docs]</a>    <span class="k">def</span> <span class="nf">setRmPis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Remove P_IS &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Q1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Qobs</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Qis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">U1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Uobs</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Uis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P1</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">U1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ang1</span> <span class="o">=</span> <span class="n">QUang</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">U1</span><span class="p">)</span>
        <span class="k">return</span>
</div>
<div class="viewcode-block" id="BlobDiskMod.getRmPis"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.BlobDiskMod.getRmPis">[docs]</a>    <span class="k">def</span> <span class="nf">getRmPis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; print rmP_IS &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">U1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ang1</span>
</div>
<div class="viewcode-block" id="BlobDiskMod.setRot"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.BlobDiskMod.setRot">[docs]</a>    <span class="k">def</span> <span class="nf">setRot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; setRot &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Q2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P1</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ang1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">trad</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">U2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P1</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ang1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">trad</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P2</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">U2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ang2</span> <span class="o">=</span> <span class="n">QUang</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">U2</span><span class="p">)</span>
        <span class="c"># print(self.tgt, _np.average(self.U2), self.ths)</span>
        <span class="k">return</span>
</div>
<div class="viewcode-block" id="BlobDiskMod.getRot"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.BlobDiskMod.getRot">[docs]</a>    <span class="k">def</span> <span class="nf">getRot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; setRot &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">U2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ang2</span>
</div>
<div class="viewcode-block" id="BlobDiskMod.setmod"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.BlobDiskMod.setmod">[docs]</a>    <span class="k">def</span> <span class="nf">setmod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set mod &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phimod</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">80</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phimodobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phimod</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmodrad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phimod</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">pst</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">diamb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">distb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n0</span><span class="p">,</span> <span class="bp">True</span><span class="p">]</span>
        <span class="n">pdk</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rdi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Hd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alphad</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ned</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dphi</span><span class="p">]</span>
        <span class="p">(</span><span class="n">varr</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">phi_0</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span> <span class="o">=</span> <span class="n">geogen</span><span class="p">(</span><span class="n">pst</span><span class="p">)</span>
        <span class="p">(</span><span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD_0</span><span class="p">)</span> <span class="o">=</span> <span class="n">diskcoords</span><span class="p">(</span><span class="n">pdk</span><span class="p">)</span>
        <span class="n">pob</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ne</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">irad</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span>
        <span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">Pmod</span><span class="p">,</span> <span class="n">Qmod</span><span class="p">,</span> <span class="n">Umod</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span> <span class="o">=</span> <span class="n">modcycleF</span><span class="p">(</span><span class="n">varr</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">phi_0</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> 
            <span class="n">phiD_0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pmodrad</span><span class="p">,</span> <span class="n">pst</span><span class="p">,</span> <span class="n">pob</span><span class="p">,</span> <span class="n">pdk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Qmod</span> <span class="o">=</span> <span class="n">Qmod</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Umod</span> <span class="o">=</span> <span class="n">Umod</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Pmod</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Qmod</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Umod</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angmod</span> <span class="o">=</span> <span class="n">QUang</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Qmod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Umod</span><span class="p">)</span>
        <span class="n">pob</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Qis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Uis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ne</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dlt0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trad</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">irad</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span>
        <span class="c"># (I,Pmod,Qmod,Umod,n3) = modcycleF(varr,th,phi_0,n3,varrD,thD,phiD_0,</span>
            <span class="c"># self.pmodrad,pst,pob,pdk)</span>
        <span class="c"># (Qobc,Uobc) = mod2obs(Qmod,Umod,pob)</span>
        <span class="p">(</span><span class="n">Qobc</span><span class="p">,</span> <span class="n">Uobc</span><span class="p">)</span> <span class="o">=</span> <span class="n">mod2obs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Qmod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Umod</span><span class="p">,</span> <span class="n">pob</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Qmodobs</span> <span class="o">=</span> <span class="n">Qobc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Umodobs</span> <span class="o">=</span> <span class="n">Uobc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Pmodobs</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Qmodobs</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Umodobs</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angmodobs</span> <span class="o">=</span> <span class="n">QUang</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Qmodobs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Umodobs</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phisetin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psetrad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phisetin</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">pst</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">diamb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">distb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n0</span><span class="p">,</span> <span class="bp">True</span><span class="p">]</span>
        <span class="n">pdk</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rdi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Hd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alphad</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ned</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dh</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dphi</span><span class="p">]</span>
        <span class="p">(</span><span class="n">varr</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">phi_0</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span> <span class="o">=</span> <span class="n">geogen</span><span class="p">(</span><span class="n">pst</span><span class="p">)</span>
        <span class="p">(</span><span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD_0</span><span class="p">)</span> <span class="o">=</span> <span class="n">diskcoords</span><span class="p">(</span><span class="n">pdk</span><span class="p">)</span>
        <span class="n">pob</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ne</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">irad</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span>
        <span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">Pmod</span><span class="p">,</span> <span class="n">Qtmp</span><span class="p">,</span> <span class="n">Utmp</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span> <span class="o">=</span> <span class="n">modcycleF</span><span class="p">(</span><span class="n">varr</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">phi_0</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> 
            <span class="n">phiD_0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">psetrad</span><span class="p">,</span> <span class="n">pst</span><span class="p">,</span> <span class="n">pob</span><span class="p">,</span> <span class="n">pdk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Qsetin</span> <span class="o">=</span> <span class="n">Qtmp</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Usetin</span> <span class="o">=</span> <span class="n">Utmp</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Psetin</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Qsetin</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Usetin</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">pob</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Qis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Uis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ne</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dlt0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trad</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">irad</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span>
        <span class="c"># (I,Pmod,Qmod,Umod,n3) = modcycleF(varr,th,phi_0,n3,varrD,thD,phiD_0,</span>
            <span class="c"># self.pmodrad,pst,pob,pdk)</span>
        <span class="c"># (Qobc,Uobc) = mod2obs(Qmod,Umod,pob)</span>
        <span class="p">(</span><span class="n">Qobc</span><span class="p">,</span> <span class="n">Uobc</span><span class="p">)</span> <span class="o">=</span> <span class="n">mod2obs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Qsetin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Usetin</span><span class="p">,</span> <span class="n">pob</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Qsetobs</span> <span class="o">=</span> <span class="n">Qobc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Usetobs</span> <span class="o">=</span> <span class="n">Uobc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Psetobs</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Qsetobs</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Usetobs</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angsetobs</span> <span class="o">=</span> <span class="n">QUang</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Qsetobs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Usetobs</span><span class="p">)</span>        
        <span class="k">return</span>
</div>
<div class="viewcode-block" id="BlobDiskMod.getmod"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.BlobDiskMod.getmod">[docs]</a>    <span class="k">def</span> <span class="nf">getmod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; print mod &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">phimodobs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phimod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pmod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Qmod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Umod</span><span class="p">,</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">angmod</span>
</div>
<div class="viewcode-block" id="BlobDiskMod.setbin"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.BlobDiskMod.setbin">[docs]</a>    <span class="k">def</span> <span class="nf">setbin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nbins</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set bin &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbins</span> <span class="o">=</span> <span class="n">nbins</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbins</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outname</span> <span class="o">+=</span> <span class="s">&#39;_binned&#39;</span>
            <span class="n">phiobsB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pobs</span><span class="p">,</span> <span class="n">sigPB</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">bindata</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pobs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbins</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sigP</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Qobs</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">bindata</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Qobs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbins</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sigP</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Uobs</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">bindata</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Uobs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbins</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sigP</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigP</span> <span class="o">=</span> <span class="n">sigPB</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigth</span> <span class="o">=</span> <span class="n">_phc</span><span class="o">.</span><span class="n">bindata</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbins</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sigth</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">=</span> <span class="n">phiobsB</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setRmPis</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setRot</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setmod</span><span class="p">()</span>
        <span class="c"># else:</span>
            <span class="c"># print(&#39;# Warning! Invalid `nbins` value. Nothing done.&#39;)</span>
        <span class="k">return</span>
</div>
<div class="viewcode-block" id="BlobDiskMod.calcavgU0"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.BlobDiskMod.calcavgU0">[docs]</a>    <span class="k">def</span> <span class="nf">calcavgU0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calcavgU0 &quot;&quot;&quot;</span>
        <span class="n">lths</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">1801</span><span class="p">)</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
        <span class="c"># lths = _np.linspace(0,90,9001)*_np.pi/180.</span>
        <span class="n">avgU</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">thmin</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">ths</span> <span class="ow">in</span> <span class="n">lths</span><span class="p">:</span>
            <span class="n">Qrot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P1</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ang1</span> <span class="o">-</span> <span class="n">ths</span><span class="p">))</span>
            <span class="n">Urot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P1</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ang1</span> <span class="o">-</span> <span class="n">ths</span><span class="p">))</span>
            <span class="n">avg</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">wg_avg_and_std</span><span class="p">(</span><span class="n">Urot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigP</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">avg</span> <span class="o">&lt;</span> <span class="n">avgU</span><span class="p">:</span>
                <span class="n">avgU</span> <span class="o">=</span> <span class="n">avg</span>
                <span class="n">thmin</span> <span class="o">=</span> <span class="n">ths</span>
        <span class="c"># Qrot = _np.sqrt(Qin**2+Uin**2)*_np.cos(2*(ang-thmin))</span>
        <span class="c"># Urot = _np.sqrt(Qin**2+Uin**2)*_np.sin(2*(ang-thmin))</span>
        <span class="c"># Prot = _np.sqrt(Qrot**2+Urot**2)</span>
        <span class="c"># angrot = QUang(Qrot,Urot)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ths</span> <span class="o">=</span> <span class="n">thmin</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trad</span> <span class="o">=</span> <span class="n">thmin</span>
        <span class="k">return</span>

</div></div>
<div class="viewcode-block" id="plotPolISrot"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.plotPolISrot">[docs]</a><span class="k">def</span> <span class="nf">plotPolISrot</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; plot pol IS Rot &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
        <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c"># , sharey=True)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">)</span>

    <span class="c"># a.phiobs += -a.phi0</span>
    <span class="c"># a.phimodobs += -a.phi0</span>
    <span class="n">df</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">+</span> <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Pobs</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">+</span>
                 <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;P&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">+</span> <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Qobs</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">+</span>
                 <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Q&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">+</span> <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Uobs</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">+</span>
                 <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;U&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax0b</span> <span class="o">=</span> <span class="n">ax0</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
    <span class="n">ax0b</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">+</span> <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">angobs</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> 
        <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">+</span> <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigth</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;^&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">+</span> <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">P1</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">+</span>
                 <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;P&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">+</span> <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Q1</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">+</span>
                 <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Q&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">+</span> <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">U1</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">+</span>
                 <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;U&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax1b</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
    <span class="n">ax1b</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">+</span> <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">ang1</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
        <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">+</span> <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigth</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;^&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>

    <span class="c"># lths = _np.linspace(0,180,1801)*_np.pi/180.</span>
    <span class="c"># lths = _np.linspace(0,90,901)*_np.pi/180.</span>
    <span class="c"># avgU = _np.inf</span>
    <span class="c"># thmin = 0.</span>
    <span class="c"># for ths in lths:</span>
        <span class="c"># Qrot = _np.sqrt(Qin**2+Uin**2)*_np.cos(2*(ang-ths))</span>
        <span class="c"># Urot = _np.sqrt(Qin**2+Uin**2)*_np.sin(2*(ang-ths))</span>
        <span class="c"># avg = _np.abs(phc.wg_avg_and_std(Urot, sigP)[0])</span>
        <span class="c"># if avg &lt; avgU:</span>
            <span class="c"># avgU = avg</span>
            <span class="c"># thmin = ths</span>
    <span class="c"># Qrot = _np.sqrt(Qin**2+Uin**2)*_np.cos(2*(ang-thmin))</span>
    <span class="c"># Urot = _np.sqrt(Qin**2+Uin**2)*_np.sin(2*(ang-thmin))</span>
    <span class="c"># Prot = _np.sqrt(Qrot**2+Urot**2)</span>
    <span class="c"># angrot = QUang(Qrot,Urot)</span>
    <span class="c"># idx = _np.where(angrot &gt; 3./4*_np.pi)</span>
    <span class="c"># angrot[idx] = angrot[idx]-_np.pi</span>
    <span class="c"># idx = _np.where(angrot &lt; -3./4*_np.pi)</span>
    <span class="c"># angrot[idx] = angrot[idx]+_np.pi</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">+</span> <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">P2</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">+</span>
                 <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;P&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">+</span> <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Q2</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">+</span>
                 <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Q&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">+</span> <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">U2</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">+</span>
                 <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;U&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax2b</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
    <span class="n">ax2b</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">+</span> <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">ang2</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
        <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">+</span> <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigth</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;^&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="c"># ax2b.plot([-0.2,1.2], [0,0], color=&#39;k&#39;, ls=&#39;:&#39;)</span>

    <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phimodobs</span> <span class="o">+</span> <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Pmodobs</span><span class="p">),</span>
             <span class="n">label</span><span class="o">=</span><span class="s">&#39;P&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phimodobs</span> <span class="o">+</span> <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Qmodobs</span><span class="p">),</span>
             <span class="n">label</span><span class="o">=</span><span class="s">&#39;Q&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phimodobs</span> <span class="o">+</span> <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Umodobs</span><span class="p">),</span>
             <span class="n">label</span><span class="o">=</span><span class="s">&#39;U&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-.</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">])</span>
    <span class="n">ax0b</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phimodobs</span> <span class="o">+</span> <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">angmodobs</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
              <span class="n">color</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">)</span>

    <span class="c"># ax1.plot(*extdata(a.phimodobs+df, a.Pmodobs), label=&#39;P&#39;, color=&#39;r&#39;, </span>
        <span class="c"># marker=&#39;&#39;, ls=&#39;-&#39;)</span>
    <span class="c"># ax1.plot(*extdata(a.phimodobs+df, a.Qmodobs), label=&#39;Q&#39;, color=&#39;k&#39;, </span>
        <span class="c"># marker=&#39;&#39;, ls=&#39;-&#39;)</span>
    <span class="c"># ax1.plot(*extdata(a.phimodobs+df, a.Umodobs), label=&#39;U&#39;, color=&#39;b&#39;, </span>
        <span class="c"># marker=&#39;&#39;, ls=&#39;-&#39;)</span>
    <span class="c"># ax1.set_xlim([-.2,1.2])</span>
    <span class="c"># ax1b.plot(*extdata(a.phimodobs+df, a.angmodobs*180/_np.pi), color=&#39;g&#39;, </span>
        <span class="c"># marker=&#39;&#39;, ls=&#39;-&#39;)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phimodobs</span> <span class="o">+</span> <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Pmod</span><span class="p">),</span>
             <span class="n">label</span><span class="o">=</span><span class="s">&#39;P&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phimodobs</span> <span class="o">+</span> <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Qmod</span><span class="p">),</span>
             <span class="n">label</span><span class="o">=</span><span class="s">&#39;Q&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phimodobs</span> <span class="o">+</span> <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Umod</span><span class="p">),</span>
             <span class="n">label</span><span class="o">=</span><span class="s">&#39;U&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-.</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">])</span>
    <span class="n">ax2b</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phimodobs</span> <span class="o">+</span> <span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">angmod</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
              <span class="n">color</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">)</span>

    <span class="c"># ax2.legend()</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=.</span><span class="mi">96</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=.</span><span class="mo">06</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=.</span><span class="mo">00</span><span class="mi">8</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">nbins</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">tgt</span><span class="p">)</span>
        <span class="n">figname</span> <span class="o">=</span> <span class="s">&#39;{0}_PisRot.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">outname</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">tgt</span> <span class="o">+</span> <span class="s">&#39; (binned)&#39;</span><span class="p">)</span>
        <span class="n">figname</span> <span class="o">=</span> <span class="s">&#39;{0}_binned_PisRot.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">outname</span><span class="p">)</span>
    <span class="c">#</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c"># plt.close()</span>
    <span class="c"># print a.tgt, thmin*180/_np.pi, 180-thmin*180/_np.pi, </span>
        <span class="c"># _np.average(ang)*180/_np.pi, _np.average(angin)*180/_np.pi, </span>
        <span class="c"># _np.average(angrot)*180/_np.pi</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="QUplots"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.QUplots">[docs]</a><span class="k">def</span> <span class="nf">QUplots</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; QU plots &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>  <span class="c"># , sharey=True)</span>

    <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
        <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">Qis</span><span class="p">],</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">Uis</span><span class="p">],</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mo">033</span><span class="p">],</span> <span class="n">xerr</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mo">033</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
        <span class="n">a</span><span class="o">.</span><span class="n">Qobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Uobs</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">sigP</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">sigP</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Qmodobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Umodobs</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;$Q$ (%)&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;$U$ (%)&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
        <span class="n">a</span><span class="o">.</span><span class="n">Q2</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">U2</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">sigP</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">sigP</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Qmod</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Umod</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;$Q$ (%)&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;$U$ (%)&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">nbins</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">tgt</span><span class="p">)</span>
        <span class="n">figname</span> <span class="o">=</span> <span class="s">&#39;{0}_QU.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">outname</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">tgt</span> <span class="o">+</span> <span class="s">&#39; (binned)&#39;</span><span class="p">)</span>
        <span class="n">figname</span> <span class="o">=</span> <span class="s">&#39;{0}_binned_QU.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">outname</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="chi2f"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.chi2f">[docs]</a><span class="k">def</span> <span class="nf">chi2f</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">p_info</span><span class="p">,</span> <span class="n">tgt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; chi2f &quot;&quot;&quot;</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p_info</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">p_info</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span>
    <span class="c">#</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_info</span><span class="p">)</span> <span class="p">):</span>
        <span class="k">if</span> <span class="n">p_info</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">p_info</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">p_info</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">p_info</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">c2nfact</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">c2Pisfact</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">chi2</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">return</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">chi2</span><span class="p">)</span> <span class="o">-</span> <span class="n">c2nfact</span> <span class="o">-</span> <span class="n">c2Pisfact</span>
    <span class="c">#</span>
    <span class="n">iang</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">phi0</span><span class="p">,</span> <span class="n">ths</span><span class="p">,</span> <span class="n">Qis</span><span class="p">,</span> <span class="n">Uis</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">ned</span> <span class="o">=</span> <span class="n">p_info</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">thmin</span> <span class="o">=</span> <span class="n">ths</span>
    <span class="n">lths</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">1801</span><span class="p">)</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
    <span class="n">avgU</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">P1</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">tgt</span><span class="o">.</span><span class="n">Qobs</span> <span class="o">-</span> <span class="n">Qis</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">tgt</span><span class="o">.</span><span class="n">Uobs</span> <span class="o">-</span> <span class="n">Uis</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ang1</span> <span class="o">=</span> <span class="n">QUang</span><span class="p">((</span><span class="n">tgt</span><span class="o">.</span><span class="n">Qobs</span> <span class="o">-</span> <span class="n">Qis</span><span class="p">),</span> <span class="p">(</span><span class="n">tgt</span><span class="o">.</span><span class="n">Uobs</span> <span class="o">-</span> <span class="n">Uis</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">ths</span> <span class="ow">in</span> <span class="n">lths</span><span class="p">:</span>
        <span class="n">Urot</span> <span class="o">=</span> <span class="n">P1</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ang1</span> <span class="o">-</span> <span class="n">ths</span><span class="p">))</span>
        <span class="n">avg</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">wg_avg_and_std</span><span class="p">(</span><span class="n">Urot</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">sigP</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">avg</span> <span class="o">&lt;</span> <span class="n">avgU</span><span class="p">:</span>
            <span class="n">avgU</span> <span class="o">=</span> <span class="n">avg</span>
            <span class="n">thmin</span> <span class="o">=</span> <span class="n">ths</span>
    <span class="c"># if thmin &lt; p_info[3][0] or thmin &gt; p_info[3][2]:</span>
        <span class="c"># c2nfact = 1</span>
        <span class="c"># c2Pisfact = 1</span>
        <span class="c"># chi2 = _np.inf</span>
        <span class="c"># print thmin</span>
        <span class="c"># return -0.5*(chi2)-c2nfact-c2Pisfact</span>
    <span class="c">#</span>
    <span class="n">pst</span> <span class="o">=</span> <span class="p">[</span><span class="n">tgt</span><span class="o">.</span><span class="n">rs</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">diamb</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">distb</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">n0</span><span class="p">,</span> <span class="bp">True</span><span class="p">]</span>
    <span class="n">pdk</span> <span class="o">=</span> <span class="p">[</span><span class="n">tgt</span><span class="o">.</span><span class="n">rdi</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">rdf</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">Hd</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">alphad</span><span class="p">,</span>
        <span class="n">tgt</span><span class="o">.</span><span class="n">ned</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">dh</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">ddr</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">dphi</span><span class="p">]</span>
    <span class="p">(</span><span class="n">varr</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">phi_0</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span> <span class="o">=</span> <span class="n">geogen</span><span class="p">(</span><span class="n">pst</span><span class="p">)</span>
    <span class="p">(</span><span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD_0</span><span class="p">)</span> <span class="o">=</span> <span class="n">diskcoords</span><span class="p">(</span><span class="n">pdk</span><span class="p">)</span>
    <span class="c"># pob = [0.,0.,ne,0.,0.,iang,1.]</span>
    <span class="c"># (I,P,Qsetin,Usetin,n3) = modcycleF(varr,th,phi_0,n3,varrD,thD,phiD_0,</span>
        <span class="c"># tgt.phiobs*2*_np.pi-phi0,pst,pob,pdk)</span>
    <span class="n">pob</span> <span class="o">=</span> <span class="p">[</span><span class="n">Qis</span><span class="p">,</span> <span class="n">Uis</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">phi0</span><span class="p">,</span> <span class="n">thmin</span><span class="p">,</span> <span class="n">iang</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span>
    <span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">Qsetobs</span><span class="p">,</span> <span class="n">Usetobs</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span> <span class="o">=</span> <span class="n">modcycleF</span><span class="p">(</span><span class="n">varr</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">phi_0</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> 
        <span class="n">phiD_0</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">pst</span><span class="p">,</span> <span class="n">pob</span><span class="p">,</span> <span class="n">pdk</span><span class="p">)</span>
    <span class="n">Qsetobs</span> <span class="o">*=</span> <span class="mf">100.</span>
    <span class="n">Usetobs</span> <span class="o">*=</span> <span class="mf">100.</span>
    <span class="p">(</span><span class="n">Qobc</span><span class="p">,</span> <span class="n">Uobc</span><span class="p">)</span> <span class="o">=</span> <span class="n">mod2obs</span><span class="p">(</span><span class="n">Qsetobs</span><span class="p">,</span> <span class="n">Usetobs</span><span class="p">,</span> <span class="n">pob</span><span class="p">)</span>
    <span class="n">dobs</span> <span class="o">=</span> <span class="p">[</span><span class="n">tgt</span><span class="o">.</span><span class="n">Qobs</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">Uobs</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">sigP</span><span class="p">]</span>
    <span class="p">(</span><span class="n">Qchi2</span><span class="p">,</span> <span class="n">Uchi2</span><span class="p">)</span> <span class="o">=</span> <span class="n">chi2calc</span><span class="p">(</span><span class="n">Qobc</span><span class="p">,</span> <span class="n">Uobc</span><span class="p">,</span> <span class="n">dobs</span><span class="p">)</span>
    <span class="n">chi2</span> <span class="o">=</span> <span class="n">Qchi2</span> <span class="o">+</span> <span class="n">Uchi2</span>
    <span class="c">#</span>
    <span class="c"># dobs = [tgt.Qsetin, tgt.Uobs, tgt.sigP]</span>
    <span class="c"># (Qchi2,Uchi2) = chi2calc(Qobc,Uobc,dobs)</span>
    <span class="c"># chi2 = Qchi2+Uchi2i2</span>
    <span class="c">#</span>
    <span class="c"># 3/8.*(0.5*(_np.log10(p_info[7,2]/ned))+(_np.log10(p_info[1,2]/ne)))</span>
    <span class="n">c2nfact</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="c"># .5*(_np.abs(Qis-Qis0)/_np.abs(Qis0)+_np.abs(Uis-Uis0)/_np.abs(Uis0))</span>
    <span class="n">c2Pisfact</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="c"># print -0.5*(chi2), c2nfact, c2Pisfact</span>
    <span class="k">return</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">chi2</span><span class="p">)</span> <span class="o">-</span> <span class="n">c2nfact</span> <span class="o">-</span> <span class="n">c2Pisfact</span>

</div>
<div class="viewcode-block" id="chi2fin"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.chi2fin">[docs]</a><span class="k">def</span> <span class="nf">chi2fin</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">p_info</span><span class="p">,</span> <span class="n">tgt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; chi2f &quot;&quot;&quot;</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p_info</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">p_info</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span>
    <span class="c">#</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_info</span><span class="p">)</span> <span class="p">):</span>
        <span class="k">if</span> <span class="n">p_info</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">p_info</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">p_info</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">p_info</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">c2nfact</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">c2Pisfact</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">chi2</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">return</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">chi2</span><span class="p">)</span> <span class="o">-</span> <span class="n">c2nfact</span> <span class="o">-</span> <span class="n">c2Pisfact</span>
    <span class="c">#</span>
    <span class="n">iang</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="n">phi0</span><span class="p">,</span> <span class="n">ths</span><span class="p">,</span> <span class="n">Qis</span><span class="p">,</span> <span class="n">Uis</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">ned</span> <span class="o">=</span> <span class="n">p_info</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">thmin</span> <span class="o">=</span> <span class="n">ths</span>
    <span class="n">lths</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">1801</span><span class="p">)</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
    <span class="n">avgU</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">P1</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">tgt</span><span class="o">.</span><span class="n">Qobs</span> <span class="o">-</span> <span class="n">Qis</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">tgt</span><span class="o">.</span><span class="n">Uobs</span> <span class="o">-</span> <span class="n">Uis</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ang1</span> <span class="o">=</span> <span class="n">QUang</span><span class="p">((</span><span class="n">tgt</span><span class="o">.</span><span class="n">Qobs</span> <span class="o">-</span> <span class="n">Qis</span><span class="p">),</span> <span class="p">(</span><span class="n">tgt</span><span class="o">.</span><span class="n">Uobs</span> <span class="o">-</span> <span class="n">Uis</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">ths</span> <span class="ow">in</span> <span class="n">lths</span><span class="p">:</span>
        <span class="n">Urot</span> <span class="o">=</span> <span class="n">P1</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ang1</span> <span class="o">-</span> <span class="n">ths</span><span class="p">))</span>
        <span class="n">avg</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">_phc</span><span class="o">.</span><span class="n">wg_avg_and_std</span><span class="p">(</span><span class="n">Urot</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">sigP</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">avg</span> <span class="o">&lt;</span> <span class="n">avgU</span><span class="p">:</span>
            <span class="n">avgU</span> <span class="o">=</span> <span class="n">avg</span>
            <span class="n">thmin</span> <span class="o">=</span> <span class="n">ths</span>
    <span class="c"># if thmin &lt; p_info[3][0] or thmin &gt; p_info[3][2]:</span>
        <span class="c"># c2nfact = 1</span>
        <span class="c"># c2Pisfact = 1</span>
        <span class="c"># chi2 = _np.inf</span>
        <span class="c"># print thmin</span>
        <span class="c"># return -0.5*(chi2)-c2nfact-c2Pisfact</span>
    <span class="c">#</span>
    <span class="n">pst</span> <span class="o">=</span> <span class="p">[</span><span class="n">tgt</span><span class="o">.</span><span class="n">rs</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">diamb</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">distb</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">n0</span><span class="p">,</span> <span class="bp">True</span><span class="p">]</span>
    <span class="n">pdk</span> <span class="o">=</span> <span class="p">[</span><span class="n">tgt</span><span class="o">.</span><span class="n">rdi</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">rdf</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">Hd</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">alphad</span><span class="p">,</span>
        <span class="n">tgt</span><span class="o">.</span><span class="n">ned</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">dh</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">ddr</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">dphi</span><span class="p">]</span>
    <span class="p">(</span><span class="n">varr</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">phi_0</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span> <span class="o">=</span> <span class="n">geogen</span><span class="p">(</span><span class="n">pst</span><span class="p">)</span>
    <span class="p">(</span><span class="n">varrD</span><span class="p">,</span> <span class="n">thD</span><span class="p">,</span> <span class="n">phiD_0</span><span class="p">)</span> <span class="o">=</span> <span class="n">diskcoords</span><span class="p">(</span><span class="n">pdk</span><span class="p">)</span>
    <span class="n">pob</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">ne</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">iang</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span>
    <span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">Qsetin</span><span class="p">,</span> <span class="n">Usetin</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span> <span class="o">=</span> <span class="n">modcycleF</span><span class="p">(</span><span class="n">varr</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">phi_0</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">varrD</span><span class="p">,</span>
     <span class="n">thD</span><span class="p">,</span> <span class="n">phiD_0</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">phiobs</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">phi0</span><span class="p">,</span> <span class="n">pst</span><span class="p">,</span> <span class="n">pob</span><span class="p">,</span> <span class="n">pdk</span><span class="p">)</span>
    <span class="n">Qsetin</span> <span class="o">*=</span> <span class="mi">100</span>
    <span class="n">Usetin</span> <span class="o">*=</span> <span class="mi">100</span>
    <span class="n">U2</span> <span class="o">=</span> <span class="n">P1</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ang1</span> <span class="o">-</span> <span class="n">thmin</span><span class="p">))</span>
    <span class="n">Q2</span> <span class="o">=</span> <span class="n">P1</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ang1</span> <span class="o">-</span> <span class="n">thmin</span><span class="p">))</span>
    <span class="n">dobs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Q2</span><span class="p">,</span> <span class="n">U2</span><span class="p">,</span> <span class="n">tgt</span><span class="o">.</span><span class="n">sigP</span><span class="p">]</span>
    <span class="p">(</span><span class="n">Qchi2</span><span class="p">,</span> <span class="n">Uchi2</span><span class="p">)</span> <span class="o">=</span> <span class="n">chi2calc</span><span class="p">(</span><span class="n">Qsetin</span><span class="p">,</span> <span class="n">Usetin</span><span class="p">,</span> <span class="n">dobs</span><span class="p">)</span>
    <span class="n">chi2</span> <span class="o">=</span> <span class="n">Qchi2</span> <span class="o">+</span> <span class="n">Uchi2</span>
    <span class="c">#</span>
    <span class="c"># pob = [Qis,Uis,ne,phi0,thmin,iang,1.]</span>
    <span class="c"># (I,P,Qsetobs,Usetobs,n3) = modcycleF(varr,th,phi_0,n3,varrD,thD,phiD_0,</span>
        <span class="c"># tgt.phiobs*2*_np.pi,pst,pob,pdk)</span>
    <span class="c"># Qsetobs *= 100.</span>
    <span class="c"># Usetobs *= 100.</span>
    <span class="c"># (Qobc,Uobc) = mod2obs(Qsetobs,Usetobs,pob)</span>
    <span class="c"># dobs = [tgt.Qobs, tgt.Uobs, tgt.sigP]</span>
    <span class="c"># (Qchi2,Uchi2) = chi2calc(Qobc,Uobc,dobs)</span>
    <span class="c"># chi2 = Qchi2+Uchi2</span>
    <span class="c">#</span>
    <span class="c"># 3/8.*(0.5*(_np.log10(p_info[7,2]/ned))+(_np.log10(p_info[1,2]/ne)))</span>
    <span class="n">c2nfact</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="c"># .5*(_np.abs(Qis-Qis0)/_np.abs(Qis0)+_np.abs(Uis-Uis0)/_np.abs(Uis0))</span>
    <span class="n">c2Pisfact</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="c"># print -0.5*(chi2), c2nfact, c2Pisfact</span>
    <span class="k">return</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">chi2</span><span class="p">)</span> <span class="o">-</span> <span class="n">c2nfact</span> <span class="o">-</span> <span class="n">c2Pisfact</span>

</div>
<div class="viewcode-block" id="plotResiduals"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.plotResiduals">[docs]</a><span class="k">def</span> <span class="nf">plotResiduals</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Residuals &quot;&quot;&quot;</span>
    <span class="n">ms</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax0</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="c">#</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-.</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Pobs</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span><span class="p">)</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;P&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Qobs</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span><span class="p">)</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Q&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Uobs</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span><span class="p">)</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;U&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Pol. (%)&#39;</span><span class="p">)</span>
    <span class="c"># ax0.set_xlabel(&#39;$\phi$&#39;)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
<span class="c">#</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Psetobs</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;P&#39;</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Qsetobs</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Q&#39;</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Usetobs</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;U&#39;</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
<span class="c">#</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-.</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Pobs</span> <span class="o">-</span> <span class="n">a</span><span class="o">.</span><span class="n">Psetobs</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;P&#39;</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;^&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Qobs</span> <span class="o">-</span> <span class="n">a</span><span class="o">.</span><span class="n">Qsetobs</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Q&#39;</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;^&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Uobs</span> <span class="o">-</span> <span class="n">a</span><span class="o">.</span><span class="n">Usetobs</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;U&#39;</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;^&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Residual (Obs.-Model)&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;$\phi$&#39;</span><span class="p">)</span>
<span class="c">#</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-.</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">P2</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span><span class="p">)</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;P&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Q2</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span><span class="p">)</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Q&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">U2</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span><span class="p">)</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;U&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Pol. (%)&#39;</span><span class="p">)</span>
    <span class="c"># ax0.set_xlabel(&#39;$\phi$&#39;)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
<span class="c">#</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Psetin</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;P&#39;</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Qsetin</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Q&#39;</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Usetin</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;U&#39;</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
<span class="c">#</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-.</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">P2</span> <span class="o">-</span> <span class="n">a</span><span class="o">.</span><span class="n">Psetin</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;P&#39;</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;^&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Q2</span> <span class="o">-</span> <span class="n">a</span><span class="o">.</span><span class="n">Qsetin</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Q&#39;</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;^&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">U2</span> <span class="o">-</span> <span class="n">a</span><span class="o">.</span><span class="n">Usetin</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;U&#39;</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;^&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Residual (Obs.-Model)&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;$\phi$&#39;</span><span class="p">)</span>
<span class="c">#</span>
    <span class="c"># ax2.set_xlim([-.2,1.2])</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Raw data&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Intrinsic polarization&#39;</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
        <span class="n">top</span><span class="o">=.</span><span class="mi">95</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=.</span><span class="mi">096</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=.</span><span class="mo">01</span><span class="p">,</span> <span class="n">left</span><span class="o">=.</span><span class="mi">09</span><span class="p">,</span> <span class="n">right</span><span class="o">=.</span><span class="mi">95</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=.</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;{0}_press2.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">outname</span><span class="p">),</span> <span class="n">transparent</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c"># _plt.close()</span>
    <span class="k">return</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="plotCaribe"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.plotCaribe">[docs]</a><span class="k">def</span> <span class="nf">plotCaribe</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Plot Caribe &quot;&quot;&quot;</span>
    <span class="n">ms</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="c"># fig, ((ax0, ax2), (ax1, ax3))  = _plt.subplots(2,2, figsize=(5,7), </span>
        <span class="c"># sharex=True)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax0</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="c">#</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-.</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Pobs</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span><span class="p">)</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;P&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Qobs</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span><span class="p">)</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Q&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Uobs</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span><span class="p">)</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;U&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Pol. (%)&#39;</span><span class="p">)</span>
    <span class="c"># ax0.set_xlabel(&#39;$\phi$&#39;)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
<span class="c">#</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">angobs</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> 
        <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigth</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;PA&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;^&#39;</span><span class="p">,</span> 
        <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;PA (deg.)&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;$\phi$&#39;</span><span class="p">)</span>
<span class="c">#</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-.</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">P2</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;P&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Q2</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Q&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">U2</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;U&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">_np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">U2</span><span class="p">),</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">P2</span><span class="p">)])</span>
<span class="c">#</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phimodobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Pmod</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;P&#39;</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phimodobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Qmod</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Q&#39;</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phimodobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Umod</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;U&#39;</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
<span class="c">#</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Pol. (%)&#39;</span><span class="p">)</span>
    <span class="c"># ax2.set_xlabel(&#39;$\phi$&#39;)</span>
<span class="c">#</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-.</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phimodobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">angmod</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
             <span class="n">color</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
<span class="c">#</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">ang2</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> 
        <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigth</span> <span class="o">*</span> <span class="mi">45</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;PA&#39;</span><span class="p">,</span> 
        <span class="n">color</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;^&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;PA (deg.)&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;$\phi$&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span>
        <span class="p">[</span><span class="n">_np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">ang2</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">ang2</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)])</span>
<span class="c">#</span>
    <span class="c"># ax2.set_xlim([-.2,1.2])</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Raw data&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Intrinsic polarization&#39;</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
        <span class="n">top</span><span class="o">=.</span><span class="mi">95</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=.</span><span class="mi">096</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=.</span><span class="mo">01</span><span class="p">,</span> <span class="n">left</span><span class="o">=.</span><span class="mi">09</span><span class="p">,</span> <span class="n">right</span><span class="o">=.</span><span class="mi">95</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=.</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;{0}_press1.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">outname</span><span class="p">),</span> <span class="n">transparent</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c"># _plt.close()</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="plotClean"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.plotClean">[docs]</a><span class="k">def</span> <span class="nf">plotClean</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">angopt1</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Plot Clean &quot;&quot;&quot;</span>
    <span class="n">ms</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="c"># fig, ((ax0, ax2), (ax1, ax3))  = _plt.subplots(2,2, figsize=(5,7), </span>
        <span class="c"># sharex=True)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax0</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">_plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="c">#</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-.</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Pobs</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span><span class="p">)</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;P&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Qobs</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span><span class="p">)</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Q&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Uobs</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span><span class="p">)</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;U&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Pol. (%)&#39;</span><span class="p">)</span>
    <span class="c"># ax0.set_xlabel(&#39;$\phi$&#39;)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
<span class="c">#</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">angobs</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> 
        <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigth</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;PA&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;^&#39;</span><span class="p">,</span> 
        <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;PA (deg.)&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;$\phi$&#39;</span><span class="p">)</span>
<span class="c">#</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-.</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">P2</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;P&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Q2</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Q&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">U2</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sigP</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;U&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="c"># ax2.set_ylim([_np.min(a.U2),_np.max(a.P2)])</span>
<span class="c">#</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Pol. (%)&#39;</span><span class="p">)</span>
    <span class="c"># ax2.set_xlabel(&#39;$\phi$&#39;)</span>
<span class="c">#</span>
    <span class="n">ang</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">ang2</span>
    <span class="k">if</span> <span class="n">angopt1</span><span class="p">:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ang</span> <span class="o">&gt;</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">ang</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-=</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-.</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="o">*</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span> <span class="n">ang</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">extdata</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">phiobs</span><span class="p">,</span>
        <span class="n">a</span><span class="o">.</span><span class="n">sigth</span> <span class="o">*</span> <span class="mi">45</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;PA&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;^&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> 
        <span class="n">markersize</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;PA (deg.)&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;$\phi$&#39;</span><span class="p">)</span>
    <span class="c"># ax3.set_ylim([_np.min(a.ang2*180/_np.pi),_np.max(a.ang2*180/_np.pi)])</span>
<span class="c">#</span>
    <span class="c"># ax2.set_xlim([-.2,1.2])</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Raw data&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Intrinsic polarization&#39;</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
        <span class="n">top</span><span class="o">=.</span><span class="mi">95</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=.</span><span class="mi">096</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=.</span><span class="mo">01</span><span class="p">,</span> <span class="n">left</span><span class="o">=.</span><span class="mi">09</span><span class="p">,</span> <span class="n">right</span><span class="o">=.</span><span class="mi">95</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=.</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;{0}_press3.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">outname</span><span class="p">),</span> <span class="n">transparent</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c"># _plt.close()</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="mcmc"><a class="viewcode-back" href="../../singscat.html#pyhdust.singscat.mcmc">[docs]</a><span class="k">def</span> <span class="nf">mcmc</span><span class="p">(</span><span class="n">tgt</span><span class="p">,</span> <span class="n">p_info</span><span class="p">,</span> <span class="n">birun</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">emrun</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">nd_walk</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">savesteps</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    | tgt = target (sst.BlobDiskMod class)</span>
<span class="sd">    | p_info = parameters info matrix </span>
<span class="sd">    |</span>
<span class="sd">    | birun = burn-in steps</span>
<span class="sd">    | emrun = emcee run steps </span>
<span class="sd">    | nd_walk = nwalkers = nd_walk*ndim</span>

<span class="sd">    Returns a sst.BlodDiskMod as best-fit and the emcee smampler:</span>
<span class="sd">        bestfit, sampler </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Build the parameters to be minimized</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p_info</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">p0val</span> <span class="o">=</span> <span class="n">p_info</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span>
    <span class="c"># Choose an initial set of positions for the walkers.</span>
    <span class="n">ndim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p0val</span><span class="p">)</span>
    <span class="c"># We&#39;ll sample with X (nwalkers; 250) walkers.</span>
    <span class="n">nwalkers</span> <span class="o">=</span> <span class="n">ndim</span> <span class="o">*</span> <span class="n">nd_walk</span>
    <span class="c"># Choose an initial set of positions for the walkers.</span>
    <span class="k">if</span> <span class="bp">False</span><span class="p">:</span>
        <span class="n">p0sig</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_info</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span> <span class="o">-</span> <span class="n">p_info</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">ind</span><span class="p">])</span> <span class="o">/</span> <span class="mf">6.</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">p0val</span><span class="p">,</span> <span class="n">p0sig</span><span class="p">,</span> <span class="n">ndim</span><span class="p">)</span>
                       <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">)])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">p_info</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">ind</span><span class="p">],</span> 
            <span class="n">p_info</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">][</span><span class="n">ind</span><span class="p">],</span> <span class="n">ndim</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">)])</span>
    <span class="c"># Initialize the sampler with the chosen specs.</span>
    <span class="n">sampler</span> <span class="o">=</span> <span class="n">_emcee</span><span class="o">.</span><span class="n">EnsembleSampler</span><span class="p">(</span>
        <span class="n">nwalkers</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">chi2f</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">p_info</span><span class="p">,</span> <span class="n">tgt</span><span class="p">],</span> <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">)</span>
    <span class="c"># Run a burn-in.</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Burning-in ...&quot;</span><span class="p">)</span>
    <span class="n">pos</span><span class="p">,</span> <span class="n">prob</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">birun</span><span class="p">)</span>
    <span class="c"># Reset the chain to remove the burn-in samples.</span>
    <span class="n">sampler</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="c"># Starting from the final position in the burn-in chain, sample for 1500</span>
    <span class="c"># steps. (rstate0 is the state of the internal random number generator)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Running MCMC ...&quot;</span><span class="p">)</span>
    <span class="n">localtime</span> <span class="o">=</span> <span class="n">_time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">_time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">savesteps</span><span class="p">:</span>
        <span class="n">filename2</span> <span class="o">=</span> <span class="s">&#39;r_mcmc</span><span class="si">%d%02d%02d</span><span class="s">_</span><span class="si">%02d%02d</span><span class="s">.txt&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">localtime</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">f0</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename2</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">f0</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s">&#39;# R_MCMC walkers=</span><span class="si">%d</span><span class="s"> iterations=</span><span class="si">%d</span><span class="s"> parameters=</span><span class="se">\n</span><span class="s"># &#39;</span> <span class="o">%</span>
            <span class="p">(</span><span class="n">nwalkers</span><span class="p">,</span> <span class="n">emrun</span><span class="p">))</span>
        <span class="n">f0</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span> <span class="s">&#39;</span><span class="si">%d</span><span class="se">\t</span><span class="s">&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">)</span> 
        <span class="n">f0</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span> <span class="s">&#39;lnprob</span><span class="se">\n</span><span class="s">&#39;</span> <span class="p">)</span> 
        <span class="n">f0</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c"># </span>
    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="n">emrun</span><span class="p">,</span> <span class="n">rstate0</span><span class="o">=</span><span class="n">state</span><span class="p">):</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">prob</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">savesteps</span><span class="p">:</span>
            <span class="n">f_handle</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="n">filename2</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">)</span>
            <span class="n">_np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span> <span class="n">f_handle</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">pos</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">prob</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="p">)</span>
            <span class="n">f_handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>        
    <span class="c"># </span>
    <span class="c"># Print out the mean acceptance fraction. </span>
    <span class="n">af</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">acceptance_fraction</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Mean acceptance fraction:&quot;</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">af</span><span class="p">))</span>
    <span class="c"># Get the index with the highest probability</span>
    <span class="n">maxprob_index</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span>
    <span class="c"># Get the best parameters and their respective errors</span>
    <span class="n">params_fit</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="n">maxprob_index</span><span class="p">]</span>
    <span class="n">errors_fit</span> <span class="o">=</span> <span class="p">[</span><span class="n">sampler</span><span class="o">.</span><span class="n">flatchain</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">ndim</span><span class="p">)</span> <span class="p">]</span>
    <span class="c"># ~ print(&quot;# Best fit ...&quot;)</span>
    <span class="c"># ~ print(&#39;# 1 == Fixed; &#39;,p_info[:,-1])</span>
    <span class="c"># ~ print(&#39;# chi2_red = &#39;,_np.max(prob)*-2)</span>
    <span class="n">p_info</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">params_fit</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p_info</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span>
    <span class="n">err</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors_fit</span>
    <span class="n">fact</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="mf">180.</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mf">180.</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">180.</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">outmtx</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span> <span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_info</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">fact</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="o">*</span> <span class="n">fact</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">outmtx</span><span class="p">)):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">outmtx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="n">bestfit</span> <span class="o">=</span> <span class="n">BlobDiskMod</span><span class="p">(</span><span class="n">tgt</span><span class="o">=</span><span class="n">tgt</span><span class="o">.</span><span class="n">tgt</span><span class="p">,</span> <span class="n">rs</span><span class="o">=</span><span class="n">tgt</span><span class="o">.</span><span class="n">rs</span> <span class="o">/</span> <span class="n">_phc</span><span class="o">.</span><span class="n">Rsun</span><span class="o">.</span><span class="n">cgs</span><span class="p">,</span> 
        <span class="n">diamb</span><span class="o">=</span><span class="n">tgt</span><span class="o">.</span><span class="n">diamb</span> <span class="o">/</span> <span class="n">tgt</span><span class="o">.</span><span class="n">rs</span><span class="p">,</span> <span class="n">distb</span><span class="o">=</span><span class="n">tgt</span><span class="o">.</span><span class="n">distb</span> <span class="o">/</span> <span class="n">tgt</span><span class="o">.</span><span class="n">rs</span><span class="p">,</span> <span class="n">n0</span><span class="o">=</span><span class="n">tgt</span><span class="o">.</span><span class="n">n0</span><span class="p">,</span> 
        <span class="n">ne</span><span class="o">=</span><span class="n">p_info</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">iang</span><span class="o">=</span><span class="n">p_info</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> 
        <span class="n">dlt0</span><span class="o">=</span><span class="n">p_info</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">ths</span><span class="o">=</span><span class="n">p_info</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
        <span class="n">Qis</span><span class="o">=</span><span class="n">p_info</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="n">Uis</span><span class="o">=</span><span class="n">p_info</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span> <span class="n">rdi</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">rdf</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">Hd</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> 
        <span class="n">alpha</span><span class="o">=</span><span class="n">p_info</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">dh</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ddr</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dphi</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> 
        <span class="n">ned</span><span class="o">=</span><span class="n">p_info</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="mi">7</span><span class="p">],</span> <span class="n">path</span><span class="o">=</span><span class="n">tgt</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

    <span class="n">bestfit</span><span class="o">.</span><span class="n">outname</span> <span class="o">=</span> <span class="n">tgt</span><span class="o">.</span><span class="n">outname</span>

    <span class="n">distrib</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">chain</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ndim</span><span class="p">))</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s">r&#39;$i$ (rad)&#39;</span><span class="p">,</span> <span class="s">r&#39;$n_e$ (cm$^{-3}$)&#39;</span><span class="p">,</span> 
        <span class="s">r&#39;$\delta$ (rad)&#39;</span><span class="p">,</span> <span class="s">r&#39;$\theta$ (rad)&#39;</span><span class="p">,</span> <span class="s">r&#39;$Q_{IS}$ (%)&#39;</span><span class="p">,</span> <span class="s">r&#39;$U_{IS}$ (%)&#39;</span><span class="p">,</span> 
        <span class="s">r&#39;$\alpha$ (rad)&#39;</span><span class="p">,</span> <span class="s">r&#39;$n_e^d$ (cm$^{-3}$)&#39;</span><span class="p">])[</span><span class="n">ind</span><span class="p">])</span>

    <span class="n">figure</span> <span class="o">=</span> <span class="n">_triangle</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">distrib</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> 
        <span class="n">truths</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">distrib</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">quantiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.84</span><span class="p">],</span>
        <span class="n">show_titles</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">title_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">},</span> 
        <span class="n">label_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">},</span> <span class="n">title_fmt</span><span class="o">=</span><span class="s">&#39;.3f&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;{0}, median($\chi^2_{{red}}$)= {1:.2f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tgt</span><span class="o">.</span><span class="n">tgt</span><span class="p">,</span> 
        <span class="n">_np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mi">2</span><span class="p">))</span>
    <span class="c"># figure.gca().annotate(&quot;{0}, median($\chi^2_{{red}}$)= {1:.2f}&quot;.</span>
        <span class="c"># format(tgt.tgt, _np.median(prob)*-2), xy=(0.5, 1.0), </span>
        <span class="c"># xycoords=&quot;figure fraction&quot;,xytext=(0, -5), </span>
        <span class="c"># textcoords=&quot;offset points&quot;,ha=&quot;center&quot;, va=&quot;top&quot;, fontsize=20)</span>
    <span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="s">&#39;{0}_triangle{1}.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bestfit</span><span class="o">.</span><span class="n">outname</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">transparent</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="s">&#39;{0}_triangle{1}.eps&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bestfit</span><span class="o">.</span><span class="n">outname</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">transparent</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">dif</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ndim</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">):</span>
        <span class="n">dif</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_perct</span><span class="p">(</span><span class="n">distrib</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">params_fit</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="mf">100.</span> <span class="o">-</span> <span class="o">.</span><span class="mi">5</span>
    <span class="n">figure</span> <span class="o">=</span> <span class="n">_triangle</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">distrib</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">truths</span><span class="o">=</span><span class="n">params_fit</span><span class="p">,</span> 
        <span class="n">quantiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.84</span><span class="p">],</span> <span class="n">qtdiff</span><span class="o">=</span><span class="n">dif</span><span class="p">,</span> <span class="n">show_titles</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
        <span class="n">title_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">},</span> <span class="n">label_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">},</span> 
        <span class="n">title_fmt</span><span class="o">=</span><span class="s">&#39;.3f&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;{0}, $\chi^2_{{red}}$= {1:.2f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tgt</span><span class="o">.</span><span class="n">tgt</span><span class="p">,</span> <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mi">2</span><span class="p">))</span>
    <span class="c"># figure.gca().annotate(&quot;{0}, $\chi^2_{{red}}$= {1:.2f}&quot;.format(tgt.tgt, </span>
        <span class="c"># _np.max(prob)*-2), xy=(0.5, 1.0), xycoords=&quot;figure fraction&quot;,</span>
        <span class="c"># xytext=(0, -5), textcoords=&quot;offset points&quot;,ha=&quot;center&quot;, va=&quot;top&quot;, </span>
        <span class="c"># fontsize=20)</span>
    <span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="s">&#39;{0}_triangle{1}.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bestfit</span><span class="o">.</span><span class="n">outname</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">transparent</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="s">&#39;{0}_triangle{1}.eps&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bestfit</span><span class="o">.</span><span class="n">outname</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">transparent</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">_plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">f0</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;{0}_triangle.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bestfit</span><span class="o">.</span><span class="n">outname</span><span class="p">),</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">outmtx</span><span class="p">)):</span>
        <span class="n">f0</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">outmtx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">f0</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">bestfit</span><span class="p">,</span> <span class="n">sampler</span><span class="p">,</span> <span class="n">params_fit</span><span class="p">,</span> <span class="n">prob</span><span class="p">,</span> <span class="n">pos</span>


<span class="c"># MAIN ###</span></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Python tools for the BeACoN group Beta documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li>
          <li><a href="../pyhdust.html" >pyhdust</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015-2016, D. Moser.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>