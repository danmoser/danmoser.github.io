<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pyhdust.oifits &mdash; Python tools for the BeACoN group Beta documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     'Beta',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Python tools for the BeACoN group Beta documentation" href="../../index.html" />
    <link rel="up" title="pyhdust" href="../pyhdust.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Python tools for the BeACoN group Beta documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li>
          <li><a href="../pyhdust.html" accesskey="U">pyhdust</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pyhdust.oifits</h1><div class="highlight"><pre>
<span class="c"># -*- coding:utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;PyHdust auxiliary module: third-part module for reading/writing OIFITS </span>
<span class="sd">files.</span>

<span class="sd">I made some modifications, but I keep the original README below.</span>

<span class="sd">This module is NOT related to the OIFITS Python module provided at</span>
<span class="sd">http://www.mrao.cam.ac.uk/research/OAS/oi_data/oifits.html</span>
<span class="sd">It is a (better) alternative.</span>

<span class="sd">To open an existing OIFITS file, use the oifits.open(filename)</span>
<span class="sd">function.  This will return an oifits object with the following</span>
<span class="sd">members (any of which can be empty dictionaries or numpy arrays):</span>

<span class="sd">   array: a dictionary of interferometric arrays, as defined by the</span>
<span class="sd">   OI_ARRAY tables.  The dictionary key is the name of the array</span>
<span class="sd">   (ARRNAME).</span>

<span class="sd">   target: a numpy array of targets, as defined by the rows of the</span>
<span class="sd">   OI_TARGET table.</span>

<span class="sd">   wavelength: a dictionary of wavelength tables (OI_WAVELENGTH).  The</span>
<span class="sd">   dictionary key is the name of the instrument/settings (INSNAME).</span>

<span class="sd">   vis, vis2 and t3: numpy arrays of objects containing all the</span>
<span class="sd">   measurement information.  Each list member corresponds to a row in</span>
<span class="sd">   an OI_VIS/OI_VIS2/OI_T3 table.</span>

<span class="sd">This module makes an ad-hoc, backwards-compatible change to the OIFITS</span>
<span class="sd">revision 1 standard originally described by Pauls et al., 2005, PASP,</span>
<span class="sd">117, 1255.  The OI_VIS and OI_VIS2 tables in OIFITS files produced by</span>
<span class="sd">this file contain two additional columns for the correlated flux,</span>
<span class="sd">CFLUX and CFLUXERR , which are arrays with a length corresponding to</span>
<span class="sd">the number of wavelength elements (just as VISAMP/VIS2DATA).</span>

<span class="sd">The main purpose of this module is to allow easy access to your OIFITS</span>
<span class="sd">data within Python, where you can then analyze it in any way you want.</span>
<span class="sd">As of version 0.3, the module can now be used to create OIFITS files</span>
<span class="sd">from scratch without serious pain.  Be warned, creating an array table</span>
<span class="sd">from scratch is probably like nailing jelly to a tree.  In a future</span>
<span class="sd">verison this will become easier.</span>

<span class="sd">The module also provides a simple mechanism for combining multiple</span>
<span class="sd">oifits objects, achieved by using the &#39;+&#39; operator on two oifits</span>
<span class="sd">objects: result = a + b.  The result can then be written to a file</span>
<span class="sd">using result.save(filename).</span>

<span class="sd">Many of the parameters and their meanings are not specifically</span>
<span class="sd">documented here.  However, the nomenclature mirrors that of the OIFITS</span>
<span class="sd">standard, so it is recommended to use this module with the PASP</span>
<span class="sd">reference above in hand.</span>

<span class="sd">Beginning with version 0.3, the OI_VIS/OI_VIS2/OI_T3 classes now use</span>
<span class="sd">masked arrays for convenience, where the mask is defined via the</span>
<span class="sd">&#39;flag&#39; member of these classes.  Beware of the following subtlety: as</span>
<span class="sd">before, the array data are accessed via (for example) OI_VIS.visamp;</span>
<span class="sd">however, OI_VIS.visamp is just a method which constructs (on the fly)</span>
<span class="sd">a masked array from OI_VIS._visamp, which is where the data are</span>
<span class="sd">actually stored.  This is done transparently, and the data can be</span>
<span class="sd">accessed and modified transparently via the &quot;visamp&quot; hidden attribute.</span>
<span class="sd">The same goes for correlated fluxes, differential/closure phases,</span>
<span class="sd">triple products, etc.  See the notes on the individual classes for a</span>
<span class="sd">list of all the &quot;hidden&quot; attributes.</span>

<span class="sd">Example of OIfits merge (same target):</span>

<span class="sd">.. code:: python</span>

<span class="sd">    import pyhdust.oifits as oifits</span>
<span class="sd">    oidata1 = oifits.open(&#39;file1.fits&#39;)</span>
<span class="sd">    oidata2 = oifits.open(&#39;file2.fits&#39;)</span>
<span class="sd">    oifits.matchtargetbyname = True</span>
<span class="sd">    merge = oidata1 + oidata2</span>
<span class="sd">    oimerge.save(&#39;merged.fits&#39;)</span>

<span class="sd">:co-author: Daniel Moser</span>
<span class="sd">:license: Copyright 2014 Paul Boley</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pyfits</span> <span class="kn">as</span> <span class="nn">_pyfits</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="kn">as</span> <span class="nn">_datetime</span>
<span class="kn">import</span> <span class="nn">copy</span> <span class="kn">as</span> <span class="nn">_copy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">_np</span>
<span class="kn">import</span> <span class="nn">numbers</span> <span class="kn">as</span> <span class="nn">_numbers</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s">&quot;Paul Boley&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s">&quot;boley@mpia-hd.mpg.de&quot;</span>

<span class="n">_mjdzero</span> <span class="o">=</span> <span class="n">_datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1858</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span>

<span class="n">matchtargetbyname</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">matchstationbyname</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">refdate</span> <span class="o">=</span> <span class="n">_datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_plurals</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;s&#39;</span>
    <span class="k">return</span> <span class="s">&#39;&#39;</span>


<span class="k">def</span> <span class="nf">_array_eq</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="s">&quot;Test whether all the elements of two arrays are equal.&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="n">a</span> <span class="o">!=</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="n">a</span> <span class="o">!=</span> <span class="n">b</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_angpoint</span><span class="p">(</span><span class="nb">float</span><span class="p">):</span>

    <span class="s">&quot;Convenience object for representing angles.&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="n">angle</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;_angpoint(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="o">.</span><span class="n">__repr__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%g</span><span class="s"> degrees&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">angle</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>    

    <span class="k">def</span> <span class="nf">asdms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the value as a string in dms format,</span>
<span class="sd">        e.g. +25:30:22.55.  Useful for declination.&quot;&quot;&quot;</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span>
        <span class="k">if</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">negative</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">angle</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">negative</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">degrees</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">minutes</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">angle</span> <span class="o">-</span> <span class="n">degrees</span><span class="p">)</span> <span class="o">*</span> <span class="mf">60.0</span><span class="p">)</span>
        <span class="n">seconds</span> <span class="o">=</span> <span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="n">degrees</span> <span class="o">-</span> <span class="n">minutes</span> <span class="o">/</span> <span class="mf">60.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">3600.0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">negative</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;-</span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">:</span><span class="si">%05.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">degrees</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;+</span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">:</span><span class="si">%05.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">degrees</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__repr__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">ashms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the value as a string in hms format,</span>
<span class="sd">        e.g. 5:12:17.21.  Useful for right ascension.&quot;&quot;&quot;</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">*</span> <span class="mf">24.0</span> <span class="o">/</span> <span class="mf">360.0</span>

        <span class="n">hours</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">minutes</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">angle</span> <span class="o">-</span> <span class="n">hours</span><span class="p">)</span> <span class="o">*</span> <span class="mf">60.0</span><span class="p">)</span>
        <span class="n">seconds</span> <span class="o">=</span> <span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="n">hours</span> <span class="o">-</span> <span class="n">minutes</span> <span class="o">/</span> <span class="mf">60.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">3600.0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;</span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">:</span><span class="si">%05.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hours</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__repr__</span><span class="p">()</span>


<div class="viewcode-block" id="getDate"><a class="viewcode-back" href="../../oifits.html#pyhdust.oifits.getDate">[docs]</a><span class="k">def</span> <span class="nf">getDate</span><span class="p">(</span><span class="n">hdu</span><span class="p">,</span> <span class="n">hdulist</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Get the header value of DATE-OBS from a hdu.</span>
<span class="sd">    If it is not valid, take it from &quot;hdulist[0]&quot;.</span>

<span class="sd">    DEFINITION: The date of the observation, in the format specified in the</span>
<span class="sd">    FITS Standard.  The old date format was &#39;yy/mm/dd&#39; and may be used only</span>
<span class="sd">    for dates from 1900 through 1999.  The new Y2K compliant date format is</span>
<span class="sd">    &#39;yyyy-mm-dd&#39; or &#39;yyyy-mm-ddTHH:MM:SS[.sss]&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">header</span> <span class="o">=</span> <span class="n">hdu</span><span class="o">.</span><span class="n">header</span>
    <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;DATE-OBS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;DATE-OBS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">header0</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">header0</span><span class="p">[</span><span class="s">&#39;DATE-OBS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
    <span class="c">#</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">date</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">date</span><span class="p">[</span><span class="mi">2</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span>
    <span class="c">#</span>
    <span class="k">return</span> <span class="n">date</span>

</div>
<span class="k">class</span> <span class="nc">HDRINFO</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">mjd</span><span class="p">,</span> <span class="n">dateobs</span><span class="p">,</span> <span class="n">datereduc</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mjd</span> <span class="o">=</span> <span class="n">mjd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dateobs</span> <span class="o">=</span> <span class="n">dateobs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datereduc</span> <span class="o">=</span> <span class="n">datereduc</span>

    <span class="k">def</span> <span class="nf">returninfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mjd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dateobs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">datereduc</span>


<span class="k">class</span> <span class="nc">OI_TARGET</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">raep0</span><span class="p">,</span> <span class="n">decep0</span><span class="p">,</span> <span class="n">equinox</span><span class="o">=</span><span class="mf">2000.0</span><span class="p">,</span> <span class="n">ra_err</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> 
        <span class="n">dec_err</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">sysvel</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">veltyp</span><span class="o">=</span><span class="s">&#39;TOPCENT&#39;</span><span class="p">,</span> <span class="n">veldef</span><span class="o">=</span><span class="s">&#39;OPTICAL&#39;</span><span class="p">,</span> <span class="n">pmra</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> 
        <span class="n">pmdec</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">pmra_err</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">pmdec_err</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">parallax</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">para_err</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> 
        <span class="n">spectyp</span><span class="o">=</span><span class="s">&#39;UNKNOWN&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raep0</span> <span class="o">=</span> <span class="n">_angpoint</span><span class="p">(</span><span class="n">raep0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decep0</span> <span class="o">=</span> <span class="n">_angpoint</span><span class="p">(</span><span class="n">decep0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">equinox</span> <span class="o">=</span> <span class="n">equinox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ra_err</span> <span class="o">=</span> <span class="n">ra_err</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dec_err</span> <span class="o">=</span> <span class="n">dec_err</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sysvel</span> <span class="o">=</span> <span class="n">sysvel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">veltyp</span> <span class="o">=</span> <span class="n">veltyp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">veldef</span> <span class="o">=</span> <span class="n">veldef</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmra</span> <span class="o">=</span> <span class="n">pmra</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmdec</span> <span class="o">=</span> <span class="n">pmdec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmra_err</span> <span class="o">=</span> <span class="n">pmra_err</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmdec_err</span> <span class="o">=</span> <span class="n">pmdec_err</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parallax</span> <span class="o">=</span> <span class="n">parallax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para_err</span> <span class="o">=</span> <span class="n">para_err</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectyp</span> <span class="o">=</span> <span class="n">spectyp</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">target</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raep0</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">raep0</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">decep0</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">decep0</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">equinox</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">equinox</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ra_err</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">ra_err</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dec_err</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">dec_err</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sysvel</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">sysvel</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">veltyp</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">veltyp</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">veldef</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">veldef</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pmra</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">pmra</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pmdec</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">pmdec</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pmra_err</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">pmra_err</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pmdec_err</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">pmdec_err</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parallax</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">parallax</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">para_err</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">para_err</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectyp</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">spectyp</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> (</span><span class="si">%g</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">raep0</span><span class="o">.</span><span class="n">ashms</span><span class="p">(),</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">decep0</span><span class="o">.</span><span class="n">asdms</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">equinox</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">OI_WAVELENGTH</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eff_wave</span><span class="p">,</span> <span class="n">eff_band</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eff_wave</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">eff_wave</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">eff_band</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">eff_band</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">eff_wave</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eff_band</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">eff_band</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">_array_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">))</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">_array_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eff_band</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">eff_band</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s"> wavelength</span><span class="si">%s</span><span class="s"> (</span><span class="si">%.3g</span><span class="s">-</span><span class="si">%.3g</span><span class="s"> um)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">),</span> 
            <span class="n">_plurals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">)),</span> <span class="mf">1e6</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">),</span> <span class="mf">1e6</span> <span class="o">*</span> 
            <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>


<div class="viewcode-block" id="AMBER_SPECTRUM"><a class="viewcode-back" href="../../oifits.html#pyhdust.oifits.AMBER_SPECTRUM">[docs]</a><span class="k">class</span> <span class="nc">AMBER_SPECTRUM</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot; Class for AMBER_SPECTRUM</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">interfspec</span><span class="p">,</span> <span class="n">interfspecerr</span><span class="p">,</span>
        <span class="n">spectrum</span><span class="p">,</span> <span class="n">spectrumerr</span><span class="p">,</span> <span class="n">eff_wave</span><span class="p">,</span> <span class="n">eff_band</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="n">wavelength</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eff_wave</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">eff_wave</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">eff_band</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">eff_band</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">eff_wave</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eff_band</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">eff_band</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interfspec</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">interfspec</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interfspecerr</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">interfspecerr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spectrum</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spectrum</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spectrumerr</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">spectrumerr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>       

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">_array_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">))</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">_array_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">))</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">_array_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interfspec</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">interfspec</span><span class="p">))</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">_array_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interfspecerr</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">interfspecerr</span><span class="p">))</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">_array_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">spectrum</span><span class="p">))</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">_array_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectrumerr</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">spectrumerr</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrname</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attrname</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;spectrum&#39;</span><span class="p">,</span> <span class="s">&#39;spectrumerr&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">attrname</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">attrname</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrname</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attrname</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;spectrum&#39;</span><span class="p">,</span> <span class="s">&#39;spectrumerr&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">attrname</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">attrname</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s"> wavelength</span><span class="si">%s</span><span class="s"> (</span><span class="si">%.3g</span><span class="s">-</span><span class="si">%.3g</span><span class="s"> um)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">),</span> 
            <span class="n">_plurals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">)),</span> <span class="mf">1e6</span> <span class="o">*</span> <span class="n">_np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">),</span> <span class="mf">1e6</span> <span class="o">*</span> 
            <span class="n">_np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="OI_VIS"><a class="viewcode-back" href="../../oifits.html#pyhdust.oifits.OI_VIS">[docs]</a><span class="k">class</span> <span class="nc">OI_VIS</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for storing visibility amplitude and differential phase data.</span>
<span class="sd">    To access the data, use the following hidden attributes:</span>

<span class="sd">    visamp, visamperr, visphi, visphierr, flag;</span>
<span class="sd">    and possibly cflux, cfluxerr.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeobs</span><span class="p">,</span> <span class="n">int_time</span><span class="p">,</span> <span class="n">visamp</span><span class="p">,</span> <span class="n">visamperr</span><span class="p">,</span> <span class="n">visphi</span><span class="p">,</span> <span class="n">visphierr</span><span class="p">,</span>
        <span class="n">flag</span><span class="p">,</span> <span class="n">ucoord</span><span class="p">,</span> <span class="n">vcoord</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">station</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> 
        <span class="bp">None</span><span class="p">),</span> <span class="n">cflux</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cfluxerr</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeobs</span> <span class="o">=</span> <span class="n">timeobs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="n">wavelength</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">int_time</span> <span class="o">=</span> <span class="n">int_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visamp</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">visamp</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visamperr</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">visamperr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visphi</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">visphi</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visphierr</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">visphierr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cflux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cflux</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cflux</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cflux</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">cfluxerr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cfluxerr</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cfluxerr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cfluxerr</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ucoord</span> <span class="o">=</span> <span class="n">ucoord</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vcoord</span> <span class="o">=</span> <span class="n">vcoord</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station</span> <span class="o">=</span> <span class="n">station</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeobs</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">timeobs</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">target</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">int_time</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">int_time</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ucoord</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">ucoord</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vcoord</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">vcoord</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">station</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">_array_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visamp</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">visamp</span><span class="p">))</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">_array_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visamperr</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">visamperr</span><span class="p">))</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">_array_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visphi</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">visphi</span><span class="p">))</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">_array_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visphierr</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">visphierr</span><span class="p">))</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">_array_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">flag</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrname</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attrname</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;visamp&#39;</span><span class="p">,</span> <span class="s">&#39;visamperr&#39;</span><span class="p">,</span> <span class="s">&#39;visphi&#39;</span><span class="p">,</span> <span class="s">&#39;visphierr&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">attrname</span><span class="p">],</span> 
                <span class="n">mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">attrname</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;cflux&#39;</span><span class="p">,</span> <span class="s">&#39;cfluxerr&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">attrname</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">attrname</span><span class="p">],</span> 
                    <span class="n">mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">attrname</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrname</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attrname</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;visamp&#39;</span><span class="p">,</span> <span class="s">&#39;visamperr&#39;</span><span class="p">,</span> <span class="s">&#39;visphi&#39;</span><span class="p">,</span> <span class="s">&#39;visphierr&#39;</span><span class="p">,</span> <span class="s">&#39;cflux&#39;</span><span class="p">,</span> 
            <span class="s">&#39;cfluxerr&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">attrname</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">attrname</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">meanvis</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visamp</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">baselinename</span> <span class="o">=</span> <span class="s">&#39; (&#39;</span> <span class="o">+</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">baselinename</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">return</span> <span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s%s</span><span class="s">: </span><span class="si">%d</span><span class="s"> point</span><span class="si">%s</span><span class="s"> (</span><span class="si">%d</span><span class="s"> masked), B = </span><span class="si">%5.1f</span><span class="s"> m, PA = </span><span class="si">%5.1f</span><span class="s"> &#39;</span> <span class="o">+</span>
            <span class="s">&#39;deg, &lt;V&gt; = </span><span class="si">%4.2g</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeobs</span><span class="o">.</span>
                <span class="n">strftime</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%F</span><span class="s"> %T&#39;</span><span class="p">),</span> <span class="n">baselinename</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visamp</span><span class="p">),</span> 
                <span class="n">_plurals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visamp</span><span class="p">)),</span> <span class="n">_np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="p">),</span> 
                <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ucoord</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcoord</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> 
                <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ucoord</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcoord</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">%</span> <span class="mf">180.0</span><span class="p">,</span> 
                <span class="n">meanvis</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="OI_VIS2"><a class="viewcode-back" href="../../oifits.html#pyhdust.oifits.OI_VIS2">[docs]</a><span class="k">class</span> <span class="nc">OI_VIS2</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for storing squared visibility amplitude data.</span>
<span class="sd">    To access the data, use the following hidden attributes:</span>

<span class="sd">    vis2data, vis2err</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeobs</span><span class="p">,</span> <span class="n">int_time</span><span class="p">,</span> <span class="n">vis2data</span><span class="p">,</span> <span class="n">vis2err</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">ucoord</span><span class="p">,</span> 
        <span class="n">vcoord</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">station</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeobs</span> <span class="o">=</span> <span class="n">timeobs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="n">wavelength</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">int_time</span> <span class="o">=</span> <span class="n">int_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vis2data</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vis2data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vis2err</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vis2err</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ucoord</span> <span class="o">=</span> <span class="n">ucoord</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vcoord</span> <span class="o">=</span> <span class="n">vcoord</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station</span> <span class="o">=</span> <span class="n">station</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeobs</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">timeobs</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">target</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">int_time</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">int_time</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ucoord</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">ucoord</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vcoord</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">vcoord</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">station</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">_array_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis2data</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">vis2data</span><span class="p">))</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">_array_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis2err</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">vis2err</span><span class="p">))</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">_array_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">flag</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrname</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attrname</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;vis2data&#39;</span><span class="p">,</span> <span class="s">&#39;vis2err&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">attrname</span><span class="p">],</span> 
                <span class="n">mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">attrname</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrname</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attrname</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;vis2data&#39;</span><span class="p">,</span> <span class="s">&#39;vis2err&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">attrname</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">attrname</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">meanvis</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis2data</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">baselinename</span> <span class="o">=</span> <span class="s">&#39; (&#39;</span> <span class="o">+</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">baselinename</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">return</span> <span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s%s</span><span class="s">: </span><span class="si">%d</span><span class="s"> point</span><span class="si">%s</span><span class="s"> (</span><span class="si">%d</span><span class="s"> masked), B = </span><span class="si">%5.1f</span><span class="s"> m, PA = </span><span class="si">%5.1f</span><span class="s"> &#39;</span> <span class="o">+</span>
            <span class="s">&#39;deg, &lt;V^2&gt; = </span><span class="si">%4.2g</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">timeobs</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%F</span><span class="s"> %T&#39;</span><span class="p">),</span> <span class="n">baselinename</span><span class="p">,</span> 
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis2data</span><span class="p">),</span> <span class="n">_plurals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis2data</span><span class="p">)),</span>
                <span class="n">_np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="p">),</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ucoord</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcoord</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> 
                <span class="n">_np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ucoord</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcoord</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">_np</span><span class="o">.</span><span class="n">pi</span> <span class="o">%</span> <span class="mf">180.0</span><span class="p">,</span>
                <span class="n">meanvis</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="OI_T3"><a class="viewcode-back" href="../../oifits.html#pyhdust.oifits.OI_T3">[docs]</a><span class="k">class</span> <span class="nc">OI_T3</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for storing triple product and closure phase data.</span>
<span class="sd">    To access the data, use the following hidden attributes:</span>

<span class="sd">    t3amp, t3amperr, t3phi, t3phierr</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeobs</span><span class="p">,</span> <span class="n">int_time</span><span class="p">,</span> <span class="n">t3amp</span><span class="p">,</span> <span class="n">t3amperr</span><span class="p">,</span> <span class="n">t3phi</span><span class="p">,</span> <span class="n">t3phierr</span><span class="p">,</span> 
        <span class="n">flag</span><span class="p">,</span> <span class="n">u1coord</span><span class="p">,</span> <span class="n">v1coord</span><span class="p">,</span> <span class="n">u2coord</span><span class="p">,</span> <span class="n">v2coord</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> 
        <span class="n">array</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">station</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeobs</span> <span class="o">=</span> <span class="n">timeobs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="n">wavelength</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">int_time</span> <span class="o">=</span> <span class="n">int_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t3amp</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t3amp</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t3amperr</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t3amperr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t3phi</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t3phi</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t3phierr</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t3phierr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u1coord</span> <span class="o">=</span> <span class="n">u1coord</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v1coord</span> <span class="o">=</span> <span class="n">v1coord</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u2coord</span> <span class="o">=</span> <span class="n">u2coord</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v2coord</span> <span class="o">=</span> <span class="n">v2coord</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station</span> <span class="o">=</span> <span class="n">station</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeobs</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">timeobs</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">target</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">int_time</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">int_time</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u1coord</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">u1coord</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v1coord</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">v1coord</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u2coord</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">u2coord</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v2coord</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">v2coord</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">station</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">_array_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t3amp</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">t3amp</span><span class="p">))</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">_array_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t3amperr</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">t3amperr</span><span class="p">))</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">_array_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t3phi</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">t3phi</span><span class="p">))</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">_array_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t3phierr</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">t3phierr</span><span class="p">))</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">_array_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">flag</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrname</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attrname</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;t3amp&#39;</span><span class="p">,</span> <span class="s">&#39;t3amperr&#39;</span><span class="p">,</span> <span class="s">&#39;t3phi&#39;</span><span class="p">,</span> <span class="s">&#39;t3phierr&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">attrname</span><span class="p">],</span> 
                <span class="n">mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">attrname</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrname</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attrname</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;vis2data&#39;</span><span class="p">,</span> <span class="s">&#39;vis2err&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">attrname</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">attrname</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">meant3</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t3amp</span><span class="p">[</span><span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flag</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">)])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">baselinename</span> <span class="o">=</span> <span class="s">&#39; (&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="p">[</span>
                <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">baselinename</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">return</span> <span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s%s</span><span class="s">: </span><span class="si">%d</span><span class="s"> point</span><span class="si">%s</span><span class="s"> (</span><span class="si">%d</span><span class="s"> masked), B = </span><span class="si">%5.1f</span><span class="s">m, </span><span class="si">%5.1f</span><span class="s">m, &lt;T3&gt; &quot;</span> <span class="o">+</span>
            <span class="s">&quot;= </span><span class="si">%4.2g</span><span class="s">&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeobs</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%F</span><span class="s"> %T&#39;</span><span class="p">),</span> 
                <span class="n">baselinename</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t3amp</span><span class="p">),</span> <span class="n">_plurals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t3amp</span><span class="p">)),</span> 
                <span class="n">_np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="p">),</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u1coord</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">v1coord</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u2coord</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">v2coord</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">meant3</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="OI_STATION"><a class="viewcode-back" href="../../oifits.html#pyhdust.oifits.OI_STATION">[docs]</a><span class="k">class</span> <span class="nc">OI_STATION</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot; This class corresponds to a single row (i.e. single</span>
<span class="sd">    station/telescope) of an OI_ARRAY table.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tel_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sta_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">diameter</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
        <span class="n">staxyz</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tel_name</span> <span class="o">=</span> <span class="n">tel_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">=</span> <span class="n">sta_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diameter</span> <span class="o">=</span> <span class="n">diameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">staxyz</span> <span class="o">=</span> <span class="n">staxyz</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tel_name</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">tel_name</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">sta_name</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diameter</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">diameter</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">_array_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">staxyz</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">staxyz</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s"> (</span><span class="si">%g</span><span class="s"> m)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sta_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tel_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">diameter</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="OI_ARRAY"><a class="viewcode-back" href="../../oifits.html#pyhdust.oifits.OI_ARRAY">[docs]</a><span class="k">class</span> <span class="nc">OI_ARRAY</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;Contains all the data for a single OI_ARRAY table.  Note the</span>
<span class="sd">    hidden convenience attributes latitude, longitude, and altitude.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">arrxyz</span><span class="p">,</span> <span class="n">stations</span><span class="o">=</span><span class="p">()):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrxyz</span> <span class="o">=</span> <span class="n">arrxyz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">stations</span><span class="p">:</span>
            <span class="n">tel_name</span><span class="p">,</span> <span class="n">sta_name</span><span class="p">,</span> <span class="n">sta_index</span><span class="p">,</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">staxyz</span> <span class="o">=</span> <span class="n">station</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">station</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="p">,</span> <span class="n">OI_STATION</span><span class="p">(</span>
                <span class="n">tel_name</span><span class="o">=</span><span class="n">tel_name</span><span class="p">,</span> <span class="n">sta_name</span><span class="o">=</span><span class="n">sta_name</span><span class="p">,</span> <span class="n">diameter</span><span class="o">=</span><span class="n">diameter</span><span class="p">,</span>
                <span class="n">staxyz</span><span class="o">=</span><span class="n">staxyz</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="n">equal</span> <span class="o">=</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">_array_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arrxyz</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">arrxyz</span><span class="p">)))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">equal</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="c"># If position appears to be the same, check that the stations</span>
        <span class="c"># (and ordering) are also the same</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">station</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrname</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attrname</span> <span class="o">==</span> <span class="s">&#39;latitude&#39;</span><span class="p">:</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">arrxyz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">_angpoint</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arrxyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">radius</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> 
                <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">attrname</span> <span class="o">==</span> <span class="s">&#39;longitude&#39;</span><span class="p">:</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">arrxyz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
            <span class="n">xylen</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arrxyz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrxyz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_angpoint</span><span class="p">(</span><span class="n">_np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arrxyz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">xylen</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> 
                <span class="n">_np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">attrname</span> <span class="o">==</span> <span class="s">&#39;altitude&#39;</span><span class="p">:</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">arrxyz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">radius</span> <span class="o">-</span> <span class="mf">6378100.0</span>  
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">attrname</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%g</span><span class="s"> m, </span><span class="si">%d</span><span class="s"> station</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">asdms</span><span class="p">(),</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">asdms</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">altitude</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="p">),</span> 
            <span class="n">_plurals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="p">)))</span>

<div class="viewcode-block" id="OI_ARRAY.info"><a class="viewcode-back" href="../../oifits.html#pyhdust.oifits.OI_ARRAY.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print the array&#39;s center coordinates.  If verbosity &gt;= 1,</span>
<span class="sd">        print information about each station.&quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;   </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">station</span><span class="p">))</span>
</div>
    <span class="k">def</span> <span class="nf">get_station_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">station</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">station</span>

        <span class="k">raise</span> <span class="ne">LookupError</span><span class="p">(</span><span class="s">&#39;No such station </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

</div>
<span class="k">class</span> <span class="nc">oifits</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amberspec</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vis</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vis2</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t3</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hdrinfo</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Consistently combine two separate oifits objects.  Note</span>
<span class="sd">        that targets can be matched by name only (e.g. if coordinates</span>
<span class="sd">        differ) by setting oifits.matchtargetbyname to True.  The same</span>
<span class="sd">        goes for stations of the array (controlled by</span>
<span class="sd">        oifits.matchstationbyname)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">_numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;# Warning! Ignoring number sum with oifits!!!&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span> 

        <span class="c"># Don&#39;t do anything if the two oifits objects are not CONSISTENT!</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isconsistent</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">other</span><span class="o">.</span><span class="n">isconsistent</span><span class="p">():</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;oifits objects are not consistent, bailing.&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">new</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">wavelength</span><span class="p">):</span>
            <span class="n">wavelengthmap</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">new</span><span class="o">.</span><span class="n">wavelength</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">wavelength</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">new</span><span class="o">.</span><span class="n">wavelength</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">wavelength</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Wavelength tables have the same key &#39;</span> <span class="o">+</span> 
                        <span class="s">&#39;but differing contents.&#39;</span><span class="p">)</span>
                <span class="n">wavelengthmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">wavelength</span><span class="p">[</span><span class="n">key</span><span class="p">])]</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">wavelength</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">target</span><span class="p">):</span>
            <span class="n">targetmap</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">otarget</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">target</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ntarget</span> <span class="ow">in</span> <span class="n">new</span><span class="o">.</span><span class="n">target</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">matchtargetbyname</span> <span class="ow">and</span> <span class="n">ntarget</span><span class="o">.</span><span class="n">target</span> <span class="o">==</span> <span class="n">otarget</span><span class="o">.</span><span class="n">target</span><span class="p">:</span>
                        <span class="n">targetmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">otarget</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ntarget</span>
                        <span class="k">break</span>
                    <span class="k">elif</span> <span class="n">ntarget</span> <span class="o">==</span> <span class="n">otarget</span><span class="p">:</span>
                        <span class="n">targetmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">otarget</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ntarget</span>
                        <span class="k">break</span>
                    <span class="k">elif</span> <span class="n">ntarget</span><span class="o">.</span><span class="n">target</span> <span class="o">==</span> <span class="n">otarget</span><span class="o">.</span><span class="n">target</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Found a target with a matching name, but &#39;</span> 
                            <span class="s">&#39;some differences in the target specification. &#39;</span>
                            <span class="s">&#39;Creating a new target. Set oifits.&#39;</span>
                            <span class="s">&#39;matchtargetbyname to True to override this &#39;</span>
                            <span class="s">&#39;behavior.&#39;</span><span class="p">)</span>
                <span class="c"># If &#39;id(otarget)&#39; is not in targetmap, then this is a new</span>
                <span class="c"># target and should be added to the array of targets</span>
                <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">otarget</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">targetmap</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">newkey</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">newkey</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">target</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">otarget</span><span class="p">)</span>
                    <span class="n">new</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
                    <span class="n">targetmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">otarget</span><span class="p">)]</span> <span class="o">=</span> <span class="n">target</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
            <span class="n">stationmap</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">arraymap</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">otharray</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">arraymap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">otharray</span><span class="p">)]</span> <span class="o">=</span> <span class="n">key</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">new</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="c"># If arrays have the same name but seem to differ, try</span>
                <span class="c"># to combine the two (by including the union of both</span>
                <span class="c"># sets of stations)</span>
                <span class="k">for</span> <span class="n">othsta</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">station</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">newsta</span> <span class="ow">in</span> <span class="n">new</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">station</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">newsta</span> <span class="o">==</span> <span class="n">othsta</span><span class="p">:</span>
                            <span class="n">stationmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">othsta</span><span class="p">)]</span> <span class="o">=</span> <span class="n">newsta</span>
                            <span class="k">break</span>
                        <span class="k">elif</span> <span class="n">matchstationbyname</span> <span class="ow">and</span> <span class="n">newsta</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">==</span> \
                            <span class="n">othsta</span><span class="o">.</span><span class="n">sta_name</span><span class="p">:</span>
                            <span class="n">stationmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">othsta</span><span class="p">)]</span> <span class="o">=</span> <span class="n">newsta</span>
                            <span class="k">break</span>
                        <span class="k">elif</span> <span class="n">newsta</span><span class="o">.</span><span class="n">sta_name</span> <span class="o">==</span> <span class="n">othsta</span><span class="o">.</span><span class="n">sta_name</span> <span class="ow">and</span> <span class="ow">not</span> \
                            <span class="n">matchstationbyname</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Stations have matching names &#39;</span> <span class="o">+</span>
                                <span class="s">&#39;but conflicting data.&#39;</span><span class="p">)</span>
                    <span class="c"># If &#39;id(othsta)&#39; is not in the stationmap</span>
                    <span class="c"># dictionary, then this is a new station and</span>
                    <span class="c"># should be added to the current array</span>
                    <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">othsta</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stationmap</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">newsta</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">othsta</span><span class="p">)</span>
                        <span class="n">new</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">station</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">new</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">station</span><span class="p">,</span> <span class="n">newsta</span><span class="p">)</span>
                        <span class="n">stationmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">othsta</span><span class="p">)]</span> <span class="o">=</span> <span class="n">newsta</span>
                        <span class="c"># Make sure that staxyz of the new station is relative</span>
                        <span class="c"># to the new array center</span>
                        <span class="n">newsta</span><span class="o">.</span><span class="n">staxyz</span> <span class="o">=</span> <span class="n">othsta</span><span class="o">.</span><span class="n">staxyz</span> <span class="o">-</span> \
                            <span class="n">other</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">arrxyz</span> <span class="o">+</span> <span class="n">new</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">arrxyz</span>

        <span class="k">for</span> <span class="n">vis</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">vis</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">vis</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new</span><span class="o">.</span><span class="n">vis</span><span class="p">:</span>
                <span class="n">newvis</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">vis</span><span class="p">)</span>
                <span class="c"># The wavelength, target, array and station objects</span>
                <span class="c"># should point to the appropriate objects inside the</span>
                <span class="c"># &#39;new&#39; structure</span>
                <span class="n">newvis</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="n">wavelengthmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)]</span>
                <span class="n">newvis</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">targetmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">target</span><span class="p">)]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
                    <span class="n">newvis</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">arraymap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">array</span><span class="p">)]]</span>
                    <span class="n">newvis</span><span class="o">.</span><span class="n">station</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
                    <span class="n">newvis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">stationmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
                    <span class="n">newvis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">stationmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
                <span class="n">new</span><span class="o">.</span><span class="n">vis</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">vis</span><span class="p">,</span> <span class="n">newvis</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">vis2</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">vis2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">vis2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new</span><span class="o">.</span><span class="n">vis2</span><span class="p">:</span>
                <span class="n">newvis2</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">vis2</span><span class="p">)</span>
                <span class="c"># The wavelength, target, array and station objects</span>
                <span class="c"># should point to the appropriate objects inside the</span>
                <span class="c"># &#39;new&#39; structure</span>
                <span class="n">newvis2</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="n">wavelengthmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)]</span>
                <span class="n">newvis2</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">targetmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">target</span><span class="p">)]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
                    <span class="n">newvis2</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">arraymap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">array</span><span class="p">)]]</span>
                    <span class="n">newvis2</span><span class="o">.</span><span class="n">station</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
                    <span class="n">newvis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">stationmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
                    <span class="n">newvis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">stationmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
                <span class="n">new</span><span class="o">.</span><span class="n">vis2</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">vis2</span><span class="p">,</span> <span class="n">newvis2</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">t3</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">t3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t3</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new</span><span class="o">.</span><span class="n">t3</span><span class="p">:</span>
                <span class="n">newt3</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">t3</span><span class="p">)</span>
                <span class="c"># The wavelength, target, array and station objects</span>
                <span class="c"># should point to the appropriate objects inside the</span>
                <span class="c"># &#39;new&#39; structure</span>
                <span class="n">newt3</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="n">wavelengthmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)]</span>
                <span class="n">newt3</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">targetmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">target</span><span class="p">)]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
                    <span class="n">newt3</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">arraymap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">array</span><span class="p">)]]</span>
                    <span class="n">newt3</span><span class="o">.</span><span class="n">station</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
                    <span class="n">newt3</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">stationmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
                    <span class="n">newt3</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">stationmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
                    <span class="n">newt3</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">stationmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span>
                <span class="n">new</span><span class="o">.</span><span class="n">t3</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">t3</span><span class="p">,</span> <span class="n">newt3</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amberspec</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">amberspec</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">vis</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis2</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">vis2</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">or</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t3</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">t3</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">isvalid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns True of the oifits object is both consistent (as</span>
<span class="sd">        determined by isconsistent()) and conforms to the OIFITS</span>
<span class="sd">        standard (according to Pauls et al., 2005, PASP, 117, 1255).&quot;&quot;&quot;</span>

        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isconsistent</span><span class="p">():</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;oifits object is not consistent&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;No OI_TARGET data&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;No OI_WAVELENGTH data&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">amberspec</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;No AMBER_SPECTRUM data&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">wavelength</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_band</span><span class="p">):</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;eff_wave and eff_band are of different &quot;</span> <span class="o">+</span> 
                        <span class="s">&quot;lengths for wavelength table&quot;</span><span class="p">)</span>  <span class="c"># &#39;%s&#39;&quot; % key)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">vis2</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">t3</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s">&#39;Need to have atleast one measurement table (vis, vis2 or t3)&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">vis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="p">:</span>
            <span class="n">nwave</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_band</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">visamp</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nwave</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">visamperr</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nwave</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">visphi</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nwave</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">visphierr</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nwave</span><span class="p">)</span> <span class="ow">or</span>\
                    <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">flag</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nwave</span><span class="p">):</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Data size mismatch for visibility measurement&quot;</span> <span class="o">+</span> 
                    <span class="s">&quot;0x</span><span class="si">%x</span><span class="s"> (wavelength table has a length of </span><span class="si">%d</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="p">),</span> 
                    <span class="n">nwave</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">vis2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vis2</span><span class="p">:</span>
            <span class="n">nwave</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_band</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">vis2data</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nwave</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">vis2err</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nwave</span><span class="p">)</span> \
                <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">flag</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nwave</span><span class="p">):</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Data size mismatch for visibility^2 &quot;</span> <span class="o">+</span> 
                    <span class="s">&quot;measurement 0x</span><span class="si">%x</span><span class="s"> (wavelength table has a length of </span><span class="si">%d</span><span class="s">)&quot;</span> <span class="o">%</span> 
                    <span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="p">),</span> <span class="n">nwave</span><span class="p">))</span>                                  
        <span class="k">for</span> <span class="n">t3</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">t3</span><span class="p">:</span>
            <span class="n">nwave</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_band</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">t3amp</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nwave</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">t3amperr</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nwave</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">t3phi</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nwave</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">t3phierr</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nwave</span><span class="p">)</span> <span class="ow">or</span> \
                    <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">flag</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nwave</span><span class="p">):</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Data size mismatch for visibility measurement&quot;</span> <span class="o">+</span> 
                    <span class="s">&quot; 0x</span><span class="si">%x</span><span class="s"> (wavelength table has a length of </span><span class="si">%d</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="p">),</span> 
                    <span class="n">nwave</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">warnings</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;*** </span><span class="si">%d</span><span class="s"> warning</span><span class="si">%s</span><span class="s">:&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">),</span> 
                <span class="n">_plurals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">))))</span>
            <span class="k">for</span> <span class="n">warning</span> <span class="ow">in</span> <span class="n">warnings</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;  &#39;</span> <span class="o">+</span> <span class="n">warning</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;*** </span><span class="si">%d</span><span class="s"> ERROR</span><span class="si">%s</span><span class="s">:&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">),</span> 
                <span class="n">_plurals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">))</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
            <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;  &#39;</span> <span class="o">+</span> <span class="n">error</span><span class="p">)</span>

        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">isconsistent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns True if the object is entirely self-contained,</span>
<span class="sd">        i.e. all cross-references to wavelength tables, arrays,</span>
<span class="sd">        stations etc. in the measurements refer to elements which are</span>
<span class="sd">        stored in the oifits object.  Note that an oifits object can</span>
<span class="sd">        be &#39;consistent&#39; in this sense without being &#39;valid&#39; as checked</span>
<span class="sd">        by isvalid().&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">vis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">vis</span><span class="o">.</span><span class="n">array</span> <span class="ow">and</span> <span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">array</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;A visibility measurement (0x</span><span class="si">%x</span><span class="s">) refers to an array &#39;</span>
                    <span class="s">&#39;which is not inside the main oifits object.&#39;</span> <span class="o">%</span> <span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> 
                <span class="n">vis</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">station</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> 
                    <span class="ow">not</span> <span class="ow">in</span> <span class="n">vis</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">station</span><span class="p">))):</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;A visibility measurement (0x</span><span class="si">%x</span><span class="s">) refers to a station&#39;</span>
                    <span class="s">&#39; which is not inside the main oifits object.&#39;</span> <span class="o">%</span> <span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="n">vis</span><span class="o">.</span><span class="n">wavelength</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;A visibility measurement (0x</span><span class="si">%x</span><span class="s">) refers to a &#39;</span>
                    <span class="s">&#39;wavelength table which is not inside the main oifits &#39;</span>
                    <span class="s">&#39;object.&#39;</span> <span class="o">%</span> <span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="n">vis</span><span class="o">.</span><span class="n">target</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;A visibility measurement (0x</span><span class="si">%x</span><span class="s">) refers to a target &#39;</span>
                    <span class="s">&#39;which is not inside the main oifits object.&#39;</span> <span class="o">%</span> <span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">False</span>

        <span class="k">for</span> <span class="n">vis2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vis2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">vis2</span><span class="o">.</span><span class="n">array</span> <span class="ow">and</span> <span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">array</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;A visibility^2 measurement (0x</span><span class="si">%x</span><span class="s">) refers to an array &#39;</span>
                    <span class="s">&#39;which is not inside the main oifits object.&#39;</span> <span class="o">%</span> <span class="nb">id</span><span class="p">(</span><span class="n">vis2</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> 
                <span class="n">vis2</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">station</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">vis2</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> 
                <span class="ow">not</span> <span class="ow">in</span> <span class="n">vis2</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">station</span><span class="p">))):</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;A visibility^2 measurement (0x</span><span class="si">%x</span><span class="s">) refers to a station &#39;</span>
                    <span class="s">&#39;which is not inside the main oifits object.&#39;</span> <span class="o">%</span> <span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="n">vis2</span><span class="o">.</span><span class="n">wavelength</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;A visibility^2 measurement (0x</span><span class="si">%x</span><span class="s">) refers to a &#39;</span>
                    <span class="s">&#39;wavelength table which is not inside the main oifits &#39;</span>
                    <span class="s">&#39;object.&#39;</span> <span class="o">%</span> <span class="nb">id</span><span class="p">(</span><span class="n">vis2</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="n">vis2</span><span class="o">.</span><span class="n">target</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;A visibility^2 measurement (0x</span><span class="si">%x</span><span class="s">) refers to a target &#39;</span>
                    <span class="s">&#39;which is not inside the main oifits object.&#39;</span> <span class="o">%</span> <span class="nb">id</span><span class="p">(</span><span class="n">vis2</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">False</span>

        <span class="k">for</span> <span class="n">t3</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">t3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t3</span><span class="o">.</span><span class="n">array</span> <span class="ow">and</span> <span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">array</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;A closure phase measurement (0x</span><span class="si">%x</span><span class="s">) refers to an array &#39;</span>
                    <span class="s">&#39;which is not inside the main oifits object.&#39;</span> <span class="o">%</span> <span class="nb">id</span><span class="p">(</span><span class="n">t3</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">t3</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">t3</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">station</span><span class="p">))</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">t3</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">station</span><span class="p">))</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">t3</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">station</span><span class="p">))):</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;A closure phase measurement (0x</span><span class="si">%x</span><span class="s">) refers to a station &#39;</span>
                    <span class="s">&#39;which is not inside the main oifits object.&#39;</span> <span class="o">%</span> <span class="nb">id</span><span class="p">(</span><span class="n">t3</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;A closure phase measurement (0x</span><span class="si">%x</span><span class="s">) refers to a &#39;</span>
                    <span class="s">&#39;wavelength table which is not inside the main oifits &#39;</span>
                    <span class="s">&#39;object.&#39;</span> <span class="o">%</span> <span class="nb">id</span><span class="p">(</span><span class="n">t3</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="n">t3</span><span class="o">.</span><span class="n">target</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;A closure phase measurement (0x</span><span class="si">%x</span><span class="s">) refers to a target &#39;</span>
                    <span class="s">&#39;which is not inside the main oifits object.&#39;</span> <span class="o">%</span> <span class="nb">id</span><span class="p">(</span><span class="n">t3</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print out a summary of the contents of the oifits object.</span>
<span class="sd">        Set recursive=True to obtain more specific information about</span>
<span class="sd">        each of the individual components, and verbose to an integer</span>
<span class="sd">        to increase the verbosity level.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">:</span>
            <span class="n">wavelengths</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;======================================================&quot;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;SUMMARY OF WAVELENGTH TABLES&quot;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;======================================================&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">wavelengths</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39;: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">[</span><span class="n">key</span><span class="p">])))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s"> wavelength table</span><span class="si">%s</span><span class="s"> with </span><span class="si">%d</span><span class="s"> wavelength</span><span class="si">%s</span><span class="s"> in total&quot;</span> <span class="o">%</span> 
                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">),</span> <span class="n">_plurals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)),</span> 
                    <span class="n">wavelengths</span><span class="p">,</span> <span class="n">_plurals</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;======================================================&quot;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;SUMMARY OF TARGET TABLES&quot;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;======================================================&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">:</span>
                    <span class="n">target</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s"> target</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">),</span> 
                <span class="n">_plurals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">))))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
            <span class="n">stations</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;======================================================&quot;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;SUMMARY OF ARRAY TABLES&quot;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;======================================================&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="n">stations</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">station</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s"> array</span><span class="si">%s</span><span class="s"> with </span><span class="si">%d</span><span class="s"> station</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">),</span> 
                <span class="n">_plurals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">)),</span> <span class="n">stations</span><span class="p">,</span> <span class="n">_plurals</span><span class="p">(</span><span class="n">stations</span><span class="p">)))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;======================================================&quot;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;SUMMARY OF VISIBILITY MEASUREMENTS&quot;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;======================================================&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">vis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="p">:</span>
                    <span class="n">vis</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s"> visibility measurement</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="p">),</span> 
                <span class="n">_plurals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="p">))))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vis2</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;======================================================&quot;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;SUMMARY OF VISIBILITY^2 MEASUREMENTS&quot;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;======================================================&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">vis2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vis2</span><span class="p">:</span>
                    <span class="n">vis2</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s"> visibility^2 measurement</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis2</span><span class="p">),</span> 
                <span class="n">_plurals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis2</span><span class="p">))))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">t3</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;======================================================&quot;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;SUMMARY OF T3 MEASUREMENTS&quot;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;======================================================&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">t3</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">t3</span><span class="p">:</span>
                    <span class="n">t3</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s"> closure phase measurement</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t3</span><span class="p">),</span> 
                <span class="n">_plurals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t3</span><span class="p">))))</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write the contents of the oifits object to a file in OIFITS</span>
<span class="sd">        format.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isconsistent</span><span class="p">():</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;oifits object is not consistent, refusing to go further&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">hdulist</span> <span class="o">=</span> <span class="n">_pyfits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">()</span>
        <span class="n">hdu</span> <span class="o">=</span> <span class="n">_pyfits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">()</span>
        <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s">&#39;DATE&#39;</span><span class="p">,</span> <span class="n">_datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span>
            <span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%F</span><span class="s">&#39;</span><span class="p">),</span> <span class="n">comment</span><span class="o">=</span><span class="s">&#39;Creation date&#39;</span><span class="p">)</span>
        <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">add_comment</span><span class="p">(</span><span class="s">&#39;Written by a modified OIFITS Python module&#39;</span><span class="p">)</span>  
            <span class="c"># version %s&#39; % __version__)</span>
        <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">add_comment</span><span class="p">(</span><span class="s">&#39;http://j.mp/pyhdust&#39;</span><span class="p">)</span>

        <span class="n">wavelengthmap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">hdulist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hdu</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">insname</span><span class="p">,</span> <span class="n">wavelength</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">wavelengthmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)]</span> <span class="o">=</span> <span class="n">insname</span>
            <span class="n">hdu</span> <span class="o">=</span> <span class="n">_pyfits</span><span class="o">.</span><span class="n">new_table</span><span class="p">(</span><span class="n">_pyfits</span><span class="o">.</span><span class="n">ColDefs</span><span class="p">((</span>
                <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;EFF_WAVE&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1E&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;METERS&#39;</span><span class="p">,</span> 
                    <span class="n">array</span><span class="o">=</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="p">),</span>
                <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;EFF_BAND&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1E&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;METERS&#39;</span><span class="p">,</span> 
                    <span class="n">array</span><span class="o">=</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_band</span><span class="p">)</span>
            <span class="p">)))</span>
            <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s">&#39;EXTNAME&#39;</span><span class="p">,</span> <span class="s">&#39;OI_WAVELENGTH&#39;</span><span class="p">)</span>
            <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="s">&#39;OI_REVN&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;Revision number of the table definition&#39;</span><span class="p">)</span>
            <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="s">&#39;INSNAME&#39;</span><span class="p">,</span> <span class="n">insname</span><span class="p">,</span> <span class="s">&#39;Name of detector, for cross-referencing&#39;</span><span class="p">)</span>
            <span class="n">hdulist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hdu</span><span class="p">)</span>

        <span class="n">targetmap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">target_id</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">target</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">raep0</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">decep0</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">equinox</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ra_err</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">dec_err</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">sysvel</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">veltyp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">veldef</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">pmra</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">pmdec</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">pmra_err</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">pmdec_err</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">parallax</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">para_err</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">spectyp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">targ</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">targetmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">targ</span><span class="p">)]</span> <span class="o">=</span> <span class="n">key</span>
                <span class="n">target_id</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">target</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targ</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
                <span class="n">raep0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targ</span><span class="o">.</span><span class="n">raep0</span><span class="p">)</span>
                <span class="n">decep0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targ</span><span class="o">.</span><span class="n">decep0</span><span class="p">)</span>
                <span class="n">equinox</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targ</span><span class="o">.</span><span class="n">equinox</span><span class="p">)</span>
                <span class="n">ra_err</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targ</span><span class="o">.</span><span class="n">ra_err</span><span class="p">)</span>
                <span class="n">dec_err</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targ</span><span class="o">.</span><span class="n">dec_err</span><span class="p">)</span>
                <span class="n">sysvel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targ</span><span class="o">.</span><span class="n">sysvel</span><span class="p">)</span>
                <span class="n">veltyp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targ</span><span class="o">.</span><span class="n">veltyp</span><span class="p">)</span>
                <span class="n">veldef</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targ</span><span class="o">.</span><span class="n">veldef</span><span class="p">)</span>
                <span class="n">pmra</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targ</span><span class="o">.</span><span class="n">pmra</span><span class="p">)</span>
                <span class="n">pmdec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targ</span><span class="o">.</span><span class="n">pmdec</span><span class="p">)</span>
                <span class="n">pmra_err</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targ</span><span class="o">.</span><span class="n">pmra_err</span><span class="p">)</span>
                <span class="n">pmdec_err</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targ</span><span class="o">.</span><span class="n">pmdec_err</span><span class="p">)</span>
                <span class="n">parallax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targ</span><span class="o">.</span><span class="n">parallax</span><span class="p">)</span>
                <span class="n">para_err</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targ</span><span class="o">.</span><span class="n">para_err</span><span class="p">)</span>
                <span class="n">spectyp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targ</span><span class="o">.</span><span class="n">spectyp</span><span class="p">)</span>

            <span class="n">hdu</span> <span class="o">=</span> <span class="n">_pyfits</span><span class="o">.</span><span class="n">new_table</span><span class="p">(</span><span class="n">_pyfits</span><span class="o">.</span><span class="n">ColDefs</span><span class="p">((</span>
                <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;TARGET_ID&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1I&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">target_id</span><span class="p">),</span>
                <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;TARGET&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;16A&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">target</span><span class="p">),</span>
                <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s">&#39;RAEP0&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;DEGREES&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">raep0</span><span class="p">),</span>
                <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s">&#39;DECEP0&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;DEGREES&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">decep0</span><span class="p">),</span>
                <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s">&#39;EQUINOX&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1E&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;YEARS&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">equinox</span><span class="p">),</span>
                <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s">&#39;RA_ERR&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;DEGREES&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">ra_err</span><span class="p">),</span>
                <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s">&#39;DEC_ERR&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;DEGREES&#39;</span><span class="p">,</span> 
                    <span class="n">array</span><span class="o">=</span><span class="n">dec_err</span><span class="p">),</span>
                <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s">&#39;SYSVEL&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;M/S&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">sysvel</span><span class="p">),</span>
                <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;VELTYP&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;A8&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">veltyp</span><span class="p">),</span>
                <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;VELDEF&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;A8&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">veldef</span><span class="p">),</span>
                <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s">&#39;PMRA&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;DEG/YR&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">pmra</span><span class="p">),</span>
                <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s">&#39;PMDEC&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;DEG/YR&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">pmdec</span><span class="p">),</span>
                <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s">&#39;PMRA_ERR&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;DEG/YR&#39;</span><span class="p">,</span> 
                    <span class="n">array</span><span class="o">=</span><span class="n">pmra_err</span><span class="p">),</span>
                <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s">&#39;PMDEC_ERR&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;DEG/YR&#39;</span><span class="p">,</span> 
                    <span class="n">array</span><span class="o">=</span><span class="n">pmdec_err</span><span class="p">),</span>
                <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s">&#39;PARALLAX&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1E&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;DEGREES&#39;</span><span class="p">,</span> 
                    <span class="n">array</span><span class="o">=</span><span class="n">parallax</span><span class="p">),</span>
                <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s">&#39;PARA_ERR&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1E&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;DEGREES&#39;</span><span class="p">,</span> 
                    <span class="n">array</span><span class="o">=</span><span class="n">para_err</span><span class="p">),</span>
                <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;SPECTYP&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;16A&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">spectyp</span><span class="p">)</span>
            <span class="p">)))</span>
            <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s">&#39;EXTNAME&#39;</span><span class="p">,</span> <span class="s">&#39;OI_TARGET&#39;</span><span class="p">)</span>
            <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="s">&#39;OI_REVN&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;Revision number of the table definition&#39;</span><span class="p">)</span>
            <span class="n">hdulist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hdu</span><span class="p">)</span>

        <span class="n">arraymap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">stationmap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">arrname</span><span class="p">,</span> <span class="n">array</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">arraymap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">array</span><span class="p">)]</span> <span class="o">=</span> <span class="n">arrname</span>
            <span class="n">tel_name</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">sta_name</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">sta_index</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">diameter</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">staxyz</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">station</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">station</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">station</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">stationmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">station</span><span class="p">)]</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="n">tel_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">station</span><span class="o">.</span><span class="n">tel_name</span><span class="p">)</span>
                    <span class="n">sta_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">station</span><span class="o">.</span><span class="n">sta_name</span><span class="p">)</span>
                    <span class="n">sta_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">diameter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">station</span><span class="o">.</span><span class="n">diameter</span><span class="p">)</span>
                    <span class="n">staxyz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">station</span><span class="o">.</span><span class="n">staxyz</span><span class="p">)</span>
                <span class="n">hdu</span> <span class="o">=</span> <span class="n">_pyfits</span><span class="o">.</span><span class="n">new_table</span><span class="p">(</span><span class="n">_pyfits</span><span class="o">.</span><span class="n">ColDefs</span><span class="p">((</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="s">&#39;TEL_NAME&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;16A&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">tel_name</span><span class="p">),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="s">&#39;STA_NAME&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;16A&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">sta_name</span><span class="p">),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="s">&#39;STA_INDEX&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1I&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">sta_index</span><span class="p">),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="s">&#39;DIAMETER&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;METERS&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1E&#39;</span><span class="p">,</span> 
                        <span class="n">array</span><span class="o">=</span><span class="n">diameter</span><span class="p">),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="s">&#39;STAXYZ&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;METERS&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;3D&#39;</span><span class="p">,</span> 
                        <span class="n">array</span><span class="o">=</span><span class="n">staxyz</span><span class="p">)</span>
                <span class="p">)))</span>
            <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s">&#39;EXTNAME&#39;</span><span class="p">,</span> <span class="s">&#39;OI_ARRAY&#39;</span><span class="p">)</span>
            <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="s">&#39;OI_REVN&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;Revision number of the table definition&#39;</span><span class="p">)</span>
            <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s">&#39;ARRNAME&#39;</span><span class="p">,</span> <span class="n">arrname</span><span class="p">,</span> 
                <span class="n">comment</span><span class="o">=</span><span class="s">&#39;Array name, for cross-referencing&#39;</span><span class="p">)</span>
            <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s">&#39;FRAME&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s">&#39;Coordinate frame&#39;</span><span class="p">)</span>
            <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s">&#39;ARRAYX&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">arrxyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                <span class="n">comment</span><span class="o">=</span><span class="s">&#39;Array center x coordinate (m)&#39;</span><span class="p">)</span>
            <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s">&#39;ARRAYY&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">arrxyz</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                <span class="n">comment</span><span class="o">=</span><span class="s">&#39;Array center y coordinate (m)&#39;</span><span class="p">)</span>
            <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s">&#39;ARRAYZ&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">arrxyz</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> 
                <span class="n">comment</span><span class="o">=</span><span class="s">&#39;Array center z coordinate (m)&#39;</span><span class="p">)</span>
            <span class="n">hdulist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hdu</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="c"># The tables are grouped by ARRNAME and INSNAME -- all</span>
            <span class="c"># observations which have the same ARRNAME and INSNAME are</span>
            <span class="c"># put into a single FITS binary table.</span>
            <span class="n">tables</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">vis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="p">:</span>
                <span class="n">nwave</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="o">.</span><span class="n">size</span>
                <span class="k">if</span> <span class="n">vis</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">arraymap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">array</span><span class="p">)],</span> 
                        <span class="n">wavelengthmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">wavelengthmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)])</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tables</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">tables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">tables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;target_id&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;time&#39;</span><span class="p">:</span> <span class="p">[],</span> 
                    <span class="s">&#39;mjd&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;int_time&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;visamp&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;visamperr&#39;</span><span class="p">:</span> <span class="p">[],</span> 
                        <span class="s">&#39;visphi&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;visphierr&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;cflux&#39;</span><span class="p">:</span> <span class="p">[],</span> 
                        <span class="s">&#39;cfluxerr&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;ucoord&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;vcoord&#39;</span><span class="p">:</span> <span class="p">[],</span> 
                        <span class="s">&#39;sta_index&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;flag&#39;</span><span class="p">:</span> <span class="p">[]}</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;target_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targetmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">target</span><span class="p">)])</span>
                <span class="k">if</span> <span class="n">vis</span><span class="o">.</span><span class="n">timeobs</span><span class="p">:</span>
                    <span class="n">time</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">timeobs</span> <span class="o">-</span> <span class="n">refdate</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="mf">24.0</span> <span class="o">*</span> <span class="mf">3600.0</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>
                    <span class="n">mjd</span> <span class="o">=</span> <span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">timeobs</span> <span class="o">-</span> <span class="n">_mjdzero</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> \
                        <span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">timeobs</span> <span class="o">-</span> <span class="n">_mjdzero</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span> <span class="o">/</span> <span class="mf">3600.0</span> <span class="o">/</span> <span class="mf">24.0</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;mjd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mjd</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;mjd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;int_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">int_time</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nwave</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;visamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">visamp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;visamperr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">visamperr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;visphi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">visphi</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;visphierr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">visphierr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;flag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">flag</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">vis</span><span class="o">.</span><span class="n">cflux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="s">&#39;cflux&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">cflux</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="s">&#39;cflux&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">vis</span><span class="o">.</span><span class="n">cfluxerr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="s">&#39;cfluxerr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">cfluxerr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="s">&#39;cfluxerr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;visamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">visamp</span><span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;visamperr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">visamperr</span><span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;visphi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">visphi</span><span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;visphierr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">visphierr</span><span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;flag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">flag</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">vis</span><span class="o">.</span><span class="n">cflux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="s">&#39;cflux&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">cflux</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cflux</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nwave</span><span class="p">)</span>
                        <span class="n">cflux</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">None</span>
                        <span class="n">data</span><span class="p">[</span><span class="s">&#39;cflux&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cflux</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">vis</span><span class="o">.</span><span class="n">cfluxerr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="s">&#39;cfluxerr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">cfluxerr</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cfluxerr</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nwave</span><span class="p">)</span>
                        <span class="n">cfluxerr</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">None</span>
                        <span class="n">data</span><span class="p">[</span><span class="s">&#39;cfluxerr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cfluxerr</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;ucoord&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">ucoord</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;vcoord&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">vcoord</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;sta_index&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">stationmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span> 
                        <span class="n">stationmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">])]])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;sta_index&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tables</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">tables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">nwave</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">eff_wave</span><span class="o">.</span><span class="n">size</span>

                <span class="n">hdu</span> <span class="o">=</span> <span class="n">_pyfits</span><span class="o">.</span><span class="n">new_table</span><span class="p">(</span><span class="n">_pyfits</span><span class="o">.</span><span class="n">ColDefs</span><span class="p">([</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;TARGET_ID&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1I&#39;</span><span class="p">,</span> 
                        <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;target_id&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;TIME&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;SECONDS&#39;</span><span class="p">,</span> 
                        <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;MJD&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;DAY&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> 
                        <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;mjd&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;INT_TIME&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> 
                        <span class="n">unit</span><span class="o">=</span><span class="s">&#39;SECONDS&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;int_time&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;VISAMP&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">D&#39;</span> <span class="o">%</span> <span class="n">nwave</span><span class="p">,</span> 
                        <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;visamp&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;VISAMPERR&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">D&#39;</span> <span class="o">%</span> <span class="n">nwave</span><span class="p">,</span> 
                        <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;visamperr&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;VISPHI&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;DEGREES&#39;</span><span class="p">,</span> 
                        <span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">D&#39;</span> <span class="o">%</span> <span class="n">nwave</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;visphi&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;VISPHIERR&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;DEGREES&#39;</span><span class="p">,</span> 
                        <span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">D&#39;</span> <span class="o">%</span> <span class="n">nwave</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;visphierr&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;CFLUX&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">D&#39;</span> <span class="o">%</span> 
                        <span class="n">nwave</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;cflux&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;CFLUXERR&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">D&#39;</span> <span class="o">%</span>
                        <span class="n">nwave</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;cfluxerr&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;UCOORD&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;METERS&#39;</span><span class="p">,</span> 
                        <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;ucoord&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;VCOORD&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;METERS&#39;</span><span class="p">,</span> 
                        <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;vcoord&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;STA_INDEX&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;2I&#39;</span><span class="p">,</span> 
                        <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;sta_index&#39;</span><span class="p">],</span> <span class="n">null</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;FLAG&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">L&#39;</span> <span class="o">%</span> <span class="n">nwave</span><span class="p">)</span>
                <span class="p">]))</span>

                <span class="c"># Setting the data of logical field via the</span>
                <span class="c"># _pyfits.Column call above with length &gt; 1 (eg</span>
                <span class="c"># format=&#39;171L&#39; above) seems to be broken, atleast as</span>
                <span class="c"># of PyFITS 2.2.2</span>
                <span class="n">hdu</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;FLAG&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setfield</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;flag&#39;</span><span class="p">],</span> <span class="nb">bool</span><span class="p">)</span>
                <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s">&#39;EXTNAME&#39;</span><span class="p">,</span> <span class="s">&#39;OI_VIS&#39;</span><span class="p">)</span>
                <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="s">&#39;OI_REVN&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;Revision number of the table definition&#39;</span><span class="p">)</span>
                <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s">&#39;DATE-OBS&#39;</span><span class="p">,</span> <span class="n">refdate</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%F</span><span class="s">&#39;</span><span class="p">),</span> 
                    <span class="n">comment</span><span class="o">=</span><span class="s">&#39;Zero-point for table (UTC)&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                        <span class="s">&#39;ARRNAME&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;Identifies corresponding OI_ARRAY&#39;</span><span class="p">)</span>
                <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s">&#39;INSNAME&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                    <span class="s">&#39;Identifies corresponding OI_WAVELENGTH table&#39;</span><span class="p">)</span>
                <span class="n">hdulist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hdu</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vis2</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">tables</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">vis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vis2</span><span class="p">:</span>
                <span class="n">nwave</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="o">.</span><span class="n">size</span>
                <span class="k">if</span> <span class="n">vis</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">arraymap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">array</span><span class="p">)],</span> 
                        <span class="n">wavelengthmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">wavelengthmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)])</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tables</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">tables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">tables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;target_id&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;time&#39;</span><span class="p">:</span> <span class="p">[],</span> 
                    <span class="s">&#39;mjd&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;int_time&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;vis2data&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;vis2err&#39;</span><span class="p">:</span> <span class="p">[],</span> 
                        <span class="s">&#39;ucoord&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;vcoord&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;sta_index&#39;</span><span class="p">:</span> <span class="p">[],</span> 
                        <span class="s">&#39;flag&#39;</span><span class="p">:</span> <span class="p">[]}</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;target_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targetmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">target</span><span class="p">)])</span>
                <span class="k">if</span> <span class="n">vis</span><span class="o">.</span><span class="n">timeobs</span><span class="p">:</span>
                    <span class="n">time</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">timeobs</span> <span class="o">-</span> <span class="n">refdate</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="mf">24.0</span> <span class="o">*</span> <span class="mf">3600.0</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>
                    <span class="n">mjd</span> <span class="o">=</span> <span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">timeobs</span> <span class="o">-</span> <span class="n">_mjdzero</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> \
                        <span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">timeobs</span> <span class="o">-</span> <span class="n">_mjdzero</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span> <span class="o">/</span> <span class="mf">3600.0</span> <span class="o">/</span> <span class="mf">24.0</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;mjd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mjd</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;mjd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;int_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">int_time</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nwave</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;vis2data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">vis2data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;vis2err&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">vis2err</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;flag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">flag</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;vis2data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">vis2data</span><span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;vis2err&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">vis2err</span><span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;flag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">flag</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;ucoord&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">ucoord</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;vcoord&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">vcoord</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;sta_index&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">stationmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span> 
                        <span class="n">stationmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">])]])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;sta_index&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tables</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">tables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">nwave</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">eff_wave</span><span class="o">.</span><span class="n">size</span>

                <span class="n">hdu</span> <span class="o">=</span> <span class="n">_pyfits</span><span class="o">.</span><span class="n">new_table</span><span class="p">(</span><span class="n">_pyfits</span><span class="o">.</span><span class="n">ColDefs</span><span class="p">([</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;TARGET_ID&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1I&#39;</span><span class="p">,</span> 
                        <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;target_id&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;TIME&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;SECONDS&#39;</span><span class="p">,</span> 
                        <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;MJD&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;DAY&#39;</span><span class="p">,</span> 
                        <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;mjd&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;INT_TIME&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> 
                        <span class="n">unit</span><span class="o">=</span><span class="s">&#39;SECONDS&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;int_time&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;VIS2DATA&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">D&#39;</span> <span class="o">%</span>
                        <span class="n">nwave</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;vis2data&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;VIS2ERR&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">D&#39;</span> <span class="o">%</span>
                        <span class="n">nwave</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;vis2err&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;UCOORD&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;METERS&#39;</span><span class="p">,</span> 
                        <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;ucoord&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;VCOORD&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;METERS&#39;</span><span class="p">,</span> 
                        <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;vcoord&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;STA_INDEX&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;2I&#39;</span><span class="p">,</span> 
                        <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;sta_index&#39;</span><span class="p">],</span> <span class="n">null</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;FLAG&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">L&#39;</span> <span class="o">%</span> <span class="n">nwave</span><span class="p">,</span> 
                        <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;flag&#39;</span><span class="p">])</span>
                <span class="p">]))</span>
                <span class="c"># Setting the data of logical field via the</span>
                <span class="c"># _pyfits.Column call above with length &gt; 1 (eg</span>
                <span class="c"># format=&#39;171L&#39; above) seems to be broken, atleast as</span>
                <span class="c"># of PyFITS 2.2.2</span>
                <span class="n">hdu</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;FLAG&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setfield</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;flag&#39;</span><span class="p">],</span> <span class="nb">bool</span><span class="p">)</span>
                <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s">&#39;EXTNAME&#39;</span><span class="p">,</span> <span class="s">&#39;OI_VIS2&#39;</span><span class="p">)</span>
                <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s">&#39;OI_REVN&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> 
                    <span class="s">&#39;Revision number of the table definition&#39;</span><span class="p">)</span>
                <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s">&#39;DATE-OBS&#39;</span><span class="p">,</span> <span class="n">refdate</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%F</span><span class="s">&#39;</span><span class="p">),</span> 
                    <span class="n">comment</span><span class="o">=</span><span class="s">&#39;Zero-point for table (UTC)&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s">&#39;ARRNAME&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                        <span class="s">&#39;Identifies corresponding OI_ARRAY&#39;</span><span class="p">)</span>
                <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s">&#39;INSNAME&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                    <span class="s">&#39;Identifies corresponding OI_WAVELENGTH table&#39;</span><span class="p">)</span>
                <span class="n">hdulist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hdu</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">t3</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">tables</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">t3</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">t3</span><span class="p">:</span>
                <span class="n">nwave</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="o">.</span><span class="n">eff_wave</span><span class="o">.</span><span class="n">size</span>
                <span class="k">if</span> <span class="n">t3</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">arraymap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">array</span><span class="p">)],</span> 
                        <span class="n">wavelengthmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">wavelengthmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)])</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tables</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">tables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">tables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;target_id&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;time&#39;</span><span class="p">:</span> <span class="p">[],</span> 
                        <span class="s">&#39;mjd&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;int_time&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;t3amp&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;t3amperr&#39;</span><span class="p">:</span> <span class="p">[],</span>
                        <span class="s">&#39;t3phi&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;t3phierr&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;u1coord&#39;</span><span class="p">:</span> <span class="p">[],</span> 
                        <span class="s">&#39;v1coord&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;u2coord&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;v2coord&#39;</span><span class="p">:</span> <span class="p">[],</span>
                        <span class="s">&#39;sta_index&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;flag&#39;</span><span class="p">:</span> <span class="p">[]}</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;target_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targetmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">target</span><span class="p">)])</span>
                <span class="k">if</span> <span class="n">t3</span><span class="o">.</span><span class="n">timeobs</span><span class="p">:</span>
                    <span class="n">time</span> <span class="o">=</span> <span class="n">t3</span><span class="o">.</span><span class="n">timeobs</span> <span class="o">-</span> <span class="n">refdate</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="mf">24.0</span> <span class="o">*</span> <span class="mf">3600.0</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>
                    <span class="n">mjd</span> <span class="o">=</span> <span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">timeobs</span> <span class="o">-</span> <span class="n">_mjdzero</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> \
                        <span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">timeobs</span> <span class="o">-</span> <span class="n">_mjdzero</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span> <span class="o">/</span> <span class="mf">3600.0</span> <span class="o">/</span> <span class="mf">24.0</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;mjd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mjd</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;mjd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;int_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">int_time</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nwave</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;t3amp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">t3amp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;t3amperr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">t3amperr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;t3phi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">t3phi</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;t3phierr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">t3phierr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;flag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">flag</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;t3amp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">t3amp</span><span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;t3amperr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">t3amperr</span><span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;t3phi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">t3phi</span><span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;t3phierr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">t3phierr</span><span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;flag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">flag</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;u1coord&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">u1coord</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;v1coord&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">v1coord</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;u2coord&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">u2coord</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;v2coord&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">v2coord</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">t3</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">t3</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">t3</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;sta_index&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">stationmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span> 
                        <span class="n">stationmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">])],</span> 
                        <span class="n">stationmap</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="mi">2</span><span class="p">])]])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;sta_index&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tables</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">tables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">nwave</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">eff_wave</span><span class="o">.</span><span class="n">size</span>

                <span class="n">hdu</span> <span class="o">=</span> <span class="n">_pyfits</span><span class="o">.</span><span class="n">new_table</span><span class="p">(</span><span class="n">_pyfits</span><span class="o">.</span><span class="n">ColDefs</span><span class="p">((</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="s">&#39;TARGET_ID&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1I&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;target_id&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="s">&#39;TIME&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;SECONDS&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="s">&#39;MJD&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;DAY&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;mjd&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="s">&#39;INT_TIME&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;SECONDS&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;int_time&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;T3AMP&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">D&#39;</span> <span class="o">%</span>
                                   <span class="n">nwave</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;t3amp&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;T3AMPERR&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">D&#39;</span> <span class="o">%</span>
                                   <span class="n">nwave</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;t3amperr&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;T3PHI&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">D&#39;</span> <span class="o">%</span>
                                   <span class="n">nwave</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;DEGREES&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;t3phi&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;T3PHIERR&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">D&#39;</span> <span class="o">%</span>
                                   <span class="n">nwave</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;DEGREES&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;t3phierr&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="s">&#39;U1COORD&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;METERS&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;u1coord&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="s">&#39;V1COORD&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;METERS&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;v1coord&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="s">&#39;U2COORD&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;METERS&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;u2coord&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="s">&#39;V2COORD&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;METERS&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;v2coord&#39;</span><span class="p">]),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="s">&#39;STA_INDEX&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;3I&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;sta_index&#39;</span><span class="p">],</span> <span class="n">null</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span>
                    <span class="n">_pyfits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;FLAG&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">L&#39;</span> <span class="o">%</span>
                                   <span class="n">nwave</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;flag&#39;</span><span class="p">])</span>
                <span class="p">)))</span>
                <span class="c"># Setting the data of logical field via the</span>
                <span class="c"># _pyfits.Column call above with length &gt; 1 (eg</span>
                <span class="c"># format=&#39;171L&#39; above) seems to be broken, atleast as</span>
                <span class="c"># of PyFITS 2.2.2</span>
                <span class="n">hdu</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;FLAG&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setfield</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;flag&#39;</span><span class="p">],</span> <span class="nb">bool</span><span class="p">)</span>
                <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s">&#39;EXTNAME&#39;</span><span class="p">,</span> <span class="s">&#39;OI_T3&#39;</span><span class="p">)</span>
                <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="s">&#39;OI_REVN&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;Revision number of the table definition&#39;</span><span class="p">)</span>
                <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="s">&#39;DATE-OBS&#39;</span><span class="p">,</span> <span class="n">refdate</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%F</span><span class="s">&#39;</span><span class="p">),</span> <span class="s">&#39;Zero-point for table (UTC)&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                        <span class="s">&#39;ARRNAME&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;Identifies corresponding OI_ARRAY&#39;</span><span class="p">)</span>
                <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="s">&#39;INSNAME&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;Identifies corresponding OI_WAVELENGTH table&#39;</span><span class="p">)</span>
                <span class="n">hdulist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hdu</span><span class="p">)</span>

        <span class="n">hdulist</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">clobber</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<div class="viewcode-block" id="open"><a class="viewcode-back" href="../../oifits.html#pyhdust.oifits.open">[docs]</a><span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Open an OIFITS file.&quot;&quot;&quot;</span>

    <span class="n">newobj</span> <span class="o">=</span> <span class="n">oifits</span><span class="p">()</span>
    <span class="n">targetmap</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">sta_indices</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Opening </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
    <span class="n">hdulist</span> <span class="o">=</span> <span class="n">_pyfits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="c"># First get all the OI_TARGET, OI_WAVELENGTH and OI_ARRAY tables</span>
    <span class="k">for</span> <span class="n">hdu</span> <span class="ow">in</span> <span class="n">hdulist</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">hdu</span><span class="o">.</span><span class="n">header</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">hdu</span><span class="o">.</span><span class="n">data</span>
        <span class="k">if</span> <span class="n">hdu</span> <span class="o">==</span> <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">hdrobj</span><span class="p">,</span> <span class="n">hdrmjd</span><span class="p">,</span> <span class="n">hdrobs</span><span class="p">,</span> <span class="n">hdrdat</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s">&#39;OBJECT&#39;</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                <span class="n">hdrobj</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;OBJECT&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">hdrobj</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;OBJECT&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s">&#39;HIERARCH ESO OBS TARG NAME&#39;</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                        <span class="n">hdrobj</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;HIERARCH ESO OBS TARG NAME&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s">&#39;MJD-OBS&#39;</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                <span class="n">hdrmjd</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;MJD-OBS&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s">&#39;DATE-OBS&#39;</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                <span class="n">hdrobs</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;DATE-OBS&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s">&#39;DATE&#39;</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                <span class="n">hdrdat</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;DATE&#39;</span><span class="p">]</span>
            <span class="n">newobj</span><span class="o">.</span><span class="n">hdrinfo</span> <span class="o">=</span> <span class="n">HDRINFO</span><span class="p">(</span><span class="n">hdrobj</span><span class="p">,</span> <span class="n">hdrmjd</span><span class="p">,</span> <span class="n">hdrobs</span><span class="p">,</span> <span class="n">hdrdat</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hdu</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;OI_WAVELENGTH&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">newobj</span><span class="o">.</span><span class="n">wavelength</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">newobj</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">insname</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;INSNAME&#39;</span><span class="p">]</span>
            <span class="n">newobj</span><span class="o">.</span><span class="n">wavelength</span><span class="p">[</span><span class="n">insname</span><span class="p">]</span> <span class="o">=</span> <span class="n">OI_WAVELENGTH</span><span class="p">(</span>
                <span class="n">data</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;EFF_WAVE&#39;</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;EFF_BAND&#39;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">hdu</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;OI_TARGET&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">target_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;TARGET_ID&#39;</span><span class="p">]</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">OI_TARGET</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;TARGET&#39;</span><span class="p">],</span> <span class="n">raep0</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;RAEP0&#39;</span><span class="p">],</span> <span class="n">decep0</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;DECEP0&#39;</span><span class="p">],</span>
                                   <span class="n">equinox</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;EQUINOX&#39;</span><span class="p">],</span> <span class="n">ra_err</span><span class="o">=</span><span class="n">row</span><span class="p">[</span>
                                       <span class="s">&#39;RA_ERR&#39;</span><span class="p">],</span> <span class="n">dec_err</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;DEC_ERR&#39;</span><span class="p">],</span>
                                   <span class="n">sysvel</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;SYSVEL&#39;</span><span class="p">],</span> <span class="n">veltyp</span><span class="o">=</span><span class="n">row</span><span class="p">[</span>
                                       <span class="s">&#39;VELTYP&#39;</span><span class="p">],</span> <span class="n">veldef</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;VELDEF&#39;</span><span class="p">],</span>
                                   <span class="n">pmra</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;PMRA&#39;</span><span class="p">],</span> <span class="n">pmdec</span><span class="o">=</span><span class="n">row</span><span class="p">[</span>
                                       <span class="s">&#39;PMDEC&#39;</span><span class="p">],</span> <span class="n">pmra_err</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;PMRA_ERR&#39;</span><span class="p">],</span>
                                   <span class="n">pmdec_err</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;PMDEC_ERR&#39;</span><span class="p">],</span> <span class="n">parallax</span><span class="o">=</span><span class="n">row</span><span class="p">[</span>
                                       <span class="s">&#39;PARALLAX&#39;</span><span class="p">],</span>
                                   <span class="n">para_err</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;PARA_ERR&#39;</span><span class="p">],</span> <span class="n">spectyp</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;SPECTYP&#39;</span><span class="p">])</span>
                <span class="n">newobj</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newobj</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
                <span class="n">targetmap</span><span class="p">[</span><span class="n">target_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
        <span class="k">elif</span> <span class="n">hdu</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;OI_ARRAY&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">newobj</span><span class="o">.</span><span class="n">array</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">newobj</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">arrname</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;ARRNAME&#39;</span><span class="p">]</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;FRAME&#39;</span><span class="p">]</span>
            <span class="n">arrxyz</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;ARRAYX&#39;</span><span class="p">],</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;ARRAYY&#39;</span><span class="p">],</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;ARRAYZ&#39;</span><span class="p">]])</span>
            <span class="n">newobj</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">arrname</span><span class="p">]</span> <span class="o">=</span> <span class="n">OI_ARRAY</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">arrxyz</span><span class="p">,</span> <span class="n">stations</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
            <span class="c"># Save the sta_index for each array, as we will need it</span>
            <span class="c"># later to match measurements to stations</span>
            <span class="n">sta_indices</span><span class="p">[</span><span class="n">arrname</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;sta_index&#39;</span><span class="p">)</span>

    <span class="c"># Then get any science measurements</span>
    <span class="k">for</span> <span class="n">hdu</span> <span class="ow">in</span> <span class="n">hdulist</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">hdu</span><span class="o">.</span><span class="n">header</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">hdu</span><span class="o">.</span><span class="n">data</span>
        <span class="k">if</span> <span class="n">hdu</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;OI_VIS&#39;</span><span class="p">,</span> <span class="s">&#39;OI_VIS2&#39;</span><span class="p">,</span> <span class="s">&#39;OI_T3&#39;</span><span class="p">,</span> <span class="s">&#39;AMBER_SPECTRUM&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s">&#39;ARRNAME&#39;</span> <span class="ow">in</span> <span class="n">header</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">arrname</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;ARRNAME&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">arrname</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">arrname</span> <span class="ow">and</span> <span class="n">newobj</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
                <span class="n">array</span> <span class="o">=</span> <span class="n">newobj</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">arrname</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">array</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">wavelength</span> <span class="o">=</span> <span class="n">newobj</span><span class="o">.</span><span class="n">wavelength</span><span class="p">[</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;INSNAME&#39;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">hdu</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;OI_VIS&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">date</span> <span class="o">=</span> <span class="n">getDate</span><span class="p">(</span><span class="n">hdu</span><span class="p">,</span> <span class="n">hdulist</span><span class="p">)</span>
                <span class="n">timeobs</span> <span class="o">=</span> <span class="n">_datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="n">date</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">+</span> <span class="n">_datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span>
                        <span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;TIME&#39;</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
                <span class="n">int_time</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;INT_TIME&#39;</span><span class="p">)</span>
                <span class="n">visamp</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;VISAMP&#39;</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">visamperr</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;VISAMPERR&#39;</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">visphi</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;VISPHI&#39;</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">visphierr</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;VISPHIERR&#39;</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="s">&#39;CFLUX&#39;</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                    <span class="n">cflux</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;CFLUX&#39;</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cflux</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">if</span> <span class="s">&#39;CFLUXERR&#39;</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                    <span class="n">cfluxerr</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;CFLUXERR&#39;</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cfluxerr</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;FLAG&#39;</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">ucoord</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;UCOORD&#39;</span><span class="p">)</span>
                <span class="n">vcoord</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;VCOORD&#39;</span><span class="p">)</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">targetmap</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;TARGET_ID&#39;</span><span class="p">)]</span>
                <span class="k">if</span> <span class="n">array</span><span class="p">:</span>
                    <span class="n">sta_index</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;STA_INDEX&#39;</span><span class="p">)</span>
                    <span class="n">s1</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="n">sta_indices</span><span class="p">[</span><span class="n">arrname</span><span class="p">]</span> <span class="o">==</span> <span class="n">sta_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">s2</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="n">sta_indices</span><span class="p">[</span><span class="n">arrname</span><span class="p">]</span> <span class="o">==</span> <span class="n">sta_index</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">station</span> <span class="o">=</span> <span class="p">[</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">station</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
                <span class="n">newobj</span><span class="o">.</span><span class="n">vis</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newobj</span><span class="o">.</span><span class="n">vis</span><span class="p">,</span> <span class="n">OI_VIS</span><span class="p">(</span><span class="n">timeobs</span><span class="o">=</span><span class="n">timeobs</span><span class="p">,</span> 
                    <span class="n">int_time</span><span class="o">=</span><span class="n">int_time</span><span class="p">,</span> <span class="n">visamp</span><span class="o">=</span><span class="n">visamp</span><span class="p">,</span> <span class="n">visamperr</span><span class="o">=</span><span class="n">visamperr</span><span class="p">,</span> 
                    <span class="n">visphi</span><span class="o">=</span><span class="n">visphi</span><span class="p">,</span> <span class="n">visphierr</span><span class="o">=</span><span class="n">visphierr</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="n">flag</span><span class="p">,</span> 
                    <span class="n">ucoord</span><span class="o">=</span><span class="n">ucoord</span><span class="p">,</span> <span class="n">vcoord</span><span class="o">=</span><span class="n">vcoord</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span> 
                    <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">array</span><span class="p">,</span> <span class="n">station</span><span class="o">=</span><span class="n">station</span><span class="p">,</span> <span class="n">cflux</span><span class="o">=</span><span class="n">cflux</span><span class="p">,</span>
                    <span class="n">cfluxerr</span><span class="o">=</span><span class="n">cfluxerr</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">hdu</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;OI_VIS2&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">date</span> <span class="o">=</span> <span class="n">getDate</span><span class="p">(</span><span class="n">hdu</span><span class="p">,</span> <span class="n">hdulist</span><span class="p">)</span>
                <span class="n">timeobs</span> <span class="o">=</span> <span class="n">_datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="n">date</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">+</span> <span class="n">_datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span>
                        <span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;TIME&#39;</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
                <span class="n">int_time</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;INT_TIME&#39;</span><span class="p">)</span>
                <span class="n">vis2data</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;VIS2DATA&#39;</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">vis2err</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;VIS2ERR&#39;</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;FLAG&#39;</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">ucoord</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;UCOORD&#39;</span><span class="p">)</span>
                <span class="n">vcoord</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;VCOORD&#39;</span><span class="p">)</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">targetmap</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;TARGET_ID&#39;</span><span class="p">)]</span>
                <span class="k">if</span> <span class="n">array</span><span class="p">:</span>
                    <span class="n">sta_index</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;STA_INDEX&#39;</span><span class="p">)</span>
                    <span class="n">s1</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="n">sta_indices</span><span class="p">[</span><span class="n">arrname</span><span class="p">]</span> <span class="o">==</span> <span class="n">sta_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">s2</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="n">sta_indices</span><span class="p">[</span><span class="n">arrname</span><span class="p">]</span> <span class="o">==</span> <span class="n">sta_index</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">station</span> <span class="o">=</span> <span class="p">[</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">station</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
                <span class="n">newobj</span><span class="o">.</span><span class="n">vis2</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newobj</span><span class="o">.</span><span class="n">vis2</span><span class="p">,</span> <span class="n">OI_VIS2</span><span class="p">(</span><span class="n">timeobs</span><span class="o">=</span><span class="n">timeobs</span><span class="p">,</span> 
                    <span class="n">int_time</span><span class="o">=</span><span class="n">int_time</span><span class="p">,</span> <span class="n">vis2data</span><span class="o">=</span><span class="n">vis2data</span><span class="p">,</span> <span class="n">vis2err</span><span class="o">=</span><span class="n">vis2err</span><span class="p">,</span> 
                    <span class="n">flag</span><span class="o">=</span><span class="n">flag</span><span class="p">,</span> <span class="n">ucoord</span><span class="o">=</span><span class="n">ucoord</span><span class="p">,</span> <span class="n">vcoord</span><span class="o">=</span><span class="n">vcoord</span><span class="p">,</span> 
                    <span class="n">wavelength</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">array</span><span class="p">,</span>
                    <span class="n">station</span><span class="o">=</span><span class="n">station</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">hdu</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;OI_T3&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">date</span> <span class="o">=</span> <span class="n">getDate</span><span class="p">(</span><span class="n">hdu</span><span class="p">,</span> <span class="n">hdulist</span><span class="p">)</span>
                <span class="n">timeobs</span> <span class="o">=</span> <span class="n">_datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="n">date</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">+</span> <span class="n">_datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span>
                        <span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;TIME&#39;</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
                <span class="n">int_time</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;INT_TIME&#39;</span><span class="p">)</span>
                <span class="n">t3amp</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;T3AMP&#39;</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">t3amperr</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;T3AMPERR&#39;</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">t3phi</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;T3PHI&#39;</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">t3phierr</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;T3PHIERR&#39;</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;FLAG&#39;</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">u1coord</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;U1COORD&#39;</span><span class="p">)</span>
                <span class="n">v1coord</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;V1COORD&#39;</span><span class="p">)</span>
                <span class="n">u2coord</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;U2COORD&#39;</span><span class="p">)</span>
                <span class="n">v2coord</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;V2COORD&#39;</span><span class="p">)</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">targetmap</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;TARGET_ID&#39;</span><span class="p">)]</span>
                <span class="k">if</span> <span class="n">array</span><span class="p">:</span>
                    <span class="n">sta_index</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;STA_INDEX&#39;</span><span class="p">)</span>
                    <span class="n">s1</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="n">sta_indices</span><span class="p">[</span><span class="n">arrname</span><span class="p">]</span> <span class="o">==</span> <span class="n">sta_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">s2</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="n">sta_indices</span><span class="p">[</span><span class="n">arrname</span><span class="p">]</span> <span class="o">==</span> <span class="n">sta_index</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">s3</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="n">sta_indices</span><span class="p">[</span><span class="n">arrname</span><span class="p">]</span> <span class="o">==</span> <span class="n">sta_index</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">station</span> <span class="o">=</span> <span class="p">[</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">station</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
                <span class="n">newobj</span><span class="o">.</span><span class="n">t3</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newobj</span><span class="o">.</span><span class="n">t3</span><span class="p">,</span> <span class="n">OI_T3</span><span class="p">(</span><span class="n">timeobs</span><span class="o">=</span><span class="n">timeobs</span><span class="p">,</span> 
                    <span class="n">int_time</span><span class="o">=</span><span class="n">int_time</span><span class="p">,</span> <span class="n">t3amp</span><span class="o">=</span><span class="n">t3amp</span><span class="p">,</span> <span class="n">t3amperr</span><span class="o">=</span><span class="n">t3amperr</span><span class="p">,</span> 
                    <span class="n">t3phi</span><span class="o">=</span><span class="n">t3phi</span><span class="p">,</span> <span class="n">t3phierr</span><span class="o">=</span><span class="n">t3phierr</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="n">flag</span><span class="p">,</span> <span class="n">u1coord</span><span class="o">=</span><span class="n">u1coord</span><span class="p">,</span>
                    <span class="n">v1coord</span><span class="o">=</span><span class="n">v1coord</span><span class="p">,</span> <span class="n">u2coord</span><span class="o">=</span><span class="n">u2coord</span><span class="p">,</span> <span class="n">v2coord</span><span class="o">=</span><span class="n">v2coord</span><span class="p">,</span> 
                    <span class="n">wavelength</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">array</span><span class="p">,</span> 
                    <span class="n">station</span><span class="o">=</span><span class="n">station</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">hdu</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;AMBER_SPECTRUM&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;AMBER SPEC INFO read&#39;</span><span class="p">)</span>
            <span class="n">dataAS0</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">dataASf</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">dataAS0err</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">dataASferr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">dataAS0</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataAS0</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;SPECTRUM&#39;</span><span class="p">])</span>
                <span class="n">dataAS0err</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataAS0err</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;SPECTRUM&#39;</span><span class="p">])</span>
            <span class="n">dataAS0</span> <span class="o">=</span> <span class="n">dataAS0</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">dataAS0err</span> <span class="o">=</span> <span class="n">dataAS0err</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">dataASf</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataASf</span><span class="p">,</span> <span class="n">dataAS0</span><span class="p">[</span><span class="n">i</span><span class="p">::</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">dataASferr</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataASferr</span><span class="p">,</span> <span class="n">dataAS0err</span><span class="p">[</span><span class="n">i</span><span class="p">::</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">dataASf</span> <span class="o">=</span> <span class="n">dataASf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">dataASferr</span> <span class="o">=</span> <span class="n">dataASferr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="c"># datanames = data.names</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="c"># if &#39;EFF_BAND&#39; in datanames:</span>
                <span class="n">newobj</span><span class="o">.</span><span class="n">amberspec</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newobj</span><span class="o">.</span><span class="n">amberspec</span><span class="p">,</span> 
                    <span class="n">AMBER_SPECTRUM</span><span class="p">(</span><span class="n">eff_wave</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;EFF_WAVE&#39;</span><span class="p">),</span> 
                        <span class="n">eff_band</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;EFF_BAND&#39;</span><span class="p">),</span> <span class="n">wavelength</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span> 
                        <span class="n">interfspec</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;INTERF_SPECTRUM&#39;</span><span class="p">),</span>
                        <span class="n">interfspecerr</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#39;INTERF_SPECTRUM_ERROR&#39;</span><span class="p">),</span>
                        <span class="n">spectrum</span><span class="o">=</span><span class="n">dataASf</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">spectrumerr</span><span class="o">=</span><span class="n">dataASferr</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

    <span class="n">hdulist</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
        <span class="n">newobj</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">newobj</span>

<span class="c"># MAIN ###</span></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Python tools for the BeACoN group Beta documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li>
          <li><a href="../pyhdust.html" >pyhdust</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015-2016, D. Moser.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>