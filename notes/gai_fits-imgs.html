<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.12: http://docutils.sourceforge.net/" />
<title>FITS images header and coordinates</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7614 2013-02-21 15:55:51Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
<style type="text/css">

/*body {
   width: 1000px;
   margin-left: auto;
   margin-right: auto;
}
*/
table {
    margin: 0 auto;
    text-align: center;
    border-collapse: collapse;
    vertical-align: center;
    valig: center;
}

th,
td {
    padding: 5px;
    vertical-align: middle;
    /*text-align: left;*/
    /*border-bottom: 1px solid #ddd;*/
}

tr:nth-child(even) {
    background-color: #e6e6e6
}

tr:hover {
    background-color: #bfbfbf
}

.strike {
  text-decoration: line-through;
}

p {
    max-width: 1000px;
    text-align: justify;
    text-justify: inter-word;
} 

li {
    max-width: 1000px;
    text-align: justify;
    text-justify: inter-word;
}

</style>
</head>
<body>
<div class="document" id="fits-images-header-and-coordinates">
<h1 class="title">FITS images header and coordinates</h1>

<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of contents</p>
<ul class="simple">
<li><a class="reference internal" href="#aplpy" id="id1">APLpy</a></li>
<li><a class="reference internal" href="#fits-and-wcs" id="id2">FITS and WCS</a><ul>
<li><a class="reference internal" href="#intro" id="id3">Intro</a></li>
<li><a class="reference internal" href="#the-fits-header" id="id4">The FITS header</a><ul>
<li><a class="reference internal" href="#fits-header-example" id="id5">FITS Header example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#coordinates-and-projections" id="id6">Coordinates and projections</a></li>
<li><a class="reference internal" href="#fits-header-and-the-wcs" id="id7">FITS Header and the WCS</a></li>
<li><a class="reference internal" href="#wcs-keywords-basics" id="id8">WCS Keywords basics</a></li>
<li><a class="reference internal" href="#wcs-rotation" id="id9">WCS rotation</a></li>
<li><a class="reference internal" href="#alma-ost-requeriments" id="id10">ALMA OST requeriments</a></li>
<li><a class="reference internal" href="#from-an-image-to-alma" id="id11">From an image to ALMA!</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="aplpy">
<h1><a class="toc-backref" href="#id1">APLpy</a></h1>
<p>To make beautiful plots with Python: <a class="reference external" href="https://aplpy.github.io">https://aplpy.github.io</a></p>
</div>
<div class="section" id="fits-and-wcs">
<h1><a class="toc-backref" href="#id2">FITS and WCS</a></h1>
<div class="section" id="intro">
<h2><a class="toc-backref" href="#id3">Intro</a></h2>
<p>FITS header &lt; <strong>FITS format</strong> from <em>IAU FITS Working Group</em>!</p>
<p>Official reference documentation: <a class="reference external" href="http://fits.gsfc.nasa.gov/fits_standard.html">http://fits.gsfc.nasa.gov/fits_standard.html</a></p>
</div>
<div class="section" id="the-fits-header">
<h2><a class="toc-backref" href="#id4">The FITS header</a></h2>
<p>It's the astronomical standard metadata! Specifies all useful information associate with
your data (obtaining conditions, reducing history, etc).</p>
<p>The header is a table with three possible fields:</p>
<ul>
<li><p class="first">Keyword; Value; Comment</p>
<blockquote>
<ul class="simple">
<li><em>Keywords</em> must start with a text character.</li>
<li><em>Value</em> can be of multiple types (interger, float, string).</li>
<li>[Optional] <em>Comment</em> text.</li>
</ul>
</blockquote>
</li>
</ul>
<div class="section" id="fits-header-example">
<h3><a class="toc-backref" href="#id5">FITS Header example</a></h3>
<pre class="code literal-block">
SIMPLE  =                    T / Standard FITS format
BITPIX  =                   16 / Number of bits for each pixel
NAXIS   =                    2 / Number of axes in frame
NAXIS1  =                 2148 / Number of pixels per row
NAXIS2  =                 4100 / Number of rows
BUNIT   = 'ADU     '           / Unit of original pixel value
CTYPE1  = 'pixel   '           / Pixel coordinate system
CTYPE2  = 'pixel   '           / Pixel coordinate system
CRPIX1  =                    1 / Reference pixel in axis1
CRVAL1  =                    1 / Physical value of the reference pixel
CDELT1  =                    1 / Size projected into a detector pixel in axis1
CRPIX2  =                    1 / Reference pixel in axis2
CRVAL2  =                    1 / Physical value of the reference pixel
CDELT2  =                    1 / Size projected into a detector pixel in axis2
...
OBJECT  = ' BD+28.4211 '       / Target Description
DATA-TYP= 'OBJECT  '           / Characteristics of this data
RA      = '21:51:12.055'       / RA of the tracked pos. on the slit guide pos.
DEC     = '+28:51:38.72'       / Dec of the tracked pos. on the slit guide pos.
...
</pre>
</div>
</div>
<div class="section" id="coordinates-and-projections">
<h2><a class="toc-backref" href="#id6">Coordinates and projections</a></h2>
<p>FITS conventions has been defined to specify the physical, or world, coordinates to be attached to each pixel of an N-dimensional image (<a class="reference external" href="http://fits.gsfc.nasa.gov/fits_wcs.html">http://fits.gsfc.nasa.gov/fits_wcs.html</a>)</p>
<p>Paper I (units and world coordinates).</p>
<p>Paper II: celestianl coordinates and projection [!] schemes.</p>
<img alt="../figs/gai_fits-imgs_Lab3World_projections.jpg" class="align-center" src="../figs/gai_fits-imgs_Lab3World_projections.jpg" style="width: 1024px;" />
<img alt="../figs/gai_fits-imgs_map-projections.jpg" class="align-center" src="../figs/gai_fits-imgs_map-projections.jpg" style="width: 800px;" />
<img alt="../figs/gai_fits-imgs_skymap_sp_493.gif" class="align-center" src="../figs/gai_fits-imgs_skymap_sp_493.gif" style="width: 1024px;" />
</div>
<div class="section" id="fits-header-and-the-wcs">
<h2><a class="toc-backref" href="#id7">FITS Header and the WCS</a></h2>
<p>World Coordinate System (WCS) keywords in the header of a FITS or IRAF image file define the relationship between pixel coordinates in the image and sky coordinates.</p>
<p>There are 25 projections of the proposed FITS WCS standard (<a class="reference external" href="http://tdc-www.harvard.edu/wcstools/wcstools.wcs.html">http://tdc-www.harvard.edu/wcstools/wcstools.wcs.html</a>):</p>
<blockquote>
<ul class="simple">
<li>AZP: Zenithal (Azimuthal) Perspective</li>
<li>SZP: Slant Zenithal Perspective</li>
<li><strong>TAN: Gnomonic = Tangent Plane</strong></li>
<li>SIN: Orthographic/synthesis</li>
<li>STG: Stereographic</li>
<li>ARC: Zenithal/azimuthal equidistant</li>
<li>ZPN: Zenithal/azimuthal PolyNomial</li>
<li>ZEA: Zenithal/azimuthal Equal Area</li>
<li>AIR: Airy</li>
<li>CYP: CYlindrical Perspective</li>
<li>CAR: Cartesian</li>
<li>MER: Mercator</li>
<li>CEA: Cylindrical Equal Area</li>
<li>COP: COnic Perspective</li>
<li>COD: COnic equiDistant</li>
<li>COE: COnic Equal area</li>
<li>COO: COnic Orthomorphic</li>
<li>BON: Bonne</li>
<li>PCO: Polyconic</li>
<li>SFL: Sanson-Flamsteed</li>
<li>PAR: Parabolic</li>
<li>AIT: Hammer-Aitoff equal area all-sky</li>
<li>MOL: Mollweide</li>
<li>CSC: COBE quadrilateralized Spherical Cube</li>
<li>QSC: Quadrilateralized Spherical Cube</li>
<li>TSC: Tangential Spherical Cube</li>
<li>NCP: North celestial pole (special case of SIN)</li>
<li>GLS: GLobal Sinusoidal (Similar to SFL)</li>
</ul>
</blockquote>
</div>
<div class="section" id="wcs-keywords-basics">
<h2><a class="toc-backref" href="#id8">WCS Keywords basics</a></h2>
<p>CTYPE1 and CTYPE2 indicate the coordinate type and projection.</p>
<p>CTYEP1 = xxxxyyyy / 'Comment'
CTYEP2 = xxxxyyyy / 'Comment'</p>
<p>The first four characters are <strong>RA-- and DEC-</strong>, GLON and GLAT, or ELON and ELAT, for equatorial, galactic, and ecliptic coordinates, respectively.</p>
<p>The second four characters contain a four-character code for the projection.</p>
<p>CRPIX1 and CRPIX2 are the pixel coordinates of the reference point to which the projection and the rotation refer.</p>
<p>CRVAL1 and CRVAL2 give the center coordinate as right ascension and declination or longitude and latitude in decimal degrees.</p>
</div>
<div class="section" id="wcs-rotation">
<h2><a class="toc-backref" href="#id9">WCS rotation</a></h2>
<p>Many astronomical instruments provide image files in which the <strong>'x' and 'y' coordinate axes are not orientated with equatorial north</strong> corresponding to 'up' (<strong>and east == 'left'</strong>). According to WCS, there are three options for the scale and rotation:</p>
<p>Historically, CDELT1 and CDELT2 have been used to indicate the plate scale in degrees per pixel and <strong>CROTA2</strong> has been used to indicate the rotation of the horizontal and vertical axes in degrees. Usually the axes rotate together and CROTA2 is used to indicate that angle in degrees.</p>
<p>The FITS WCS standard uses a rotation matrix, <strong>CD1_1, CD1_2, CD2_1, and CD2_2</strong> to indicate both rotation and scale, allowing a more intuitive computation if the axes are skewed. This model has been used by HST and IRAF for several years.</p>
<ul class="simple">
<li>CD1_1 =  CDELT1 * cos (CROTA2)</li>
<li>CD1_2 = -CDELT2 * sin (CROTA2)</li>
<li>CD2_1 =  CDELT1 * sin (CROTA2)</li>
<li>CD2_2 =  CDELT2 * cos (CROTA2)</li>
</ul>
<p>The 1996 proposed FITS WCS standard used PC001001, PC001002, PC002001, and PC002002 to represent the rotation matrix but retained CDELT1 and CDELT2 for the scale. It is also read by this software, but <em>should not be used for new WCS's</em>.</p>
</div>
<div class="section" id="alma-ost-requeriments">
<h2><a class="toc-backref" href="#id10">ALMA OST requeriments</a></h2>
<p>OST = Observation Support Tool, <a class="reference external" href="http://almaost.jb.man.ac.uk">http://almaost.jb.man.ac.uk</a></p>
<blockquote>
<ul class="simple">
<li><strong>[BUNIT:]</strong> The physical units of the FITS image array values.</li>
<li><strong>CDELTn*</strong>: Coordinate increment along axis n.</li>
<li><strong>[CROTAn]</strong>: Coordinate system rotation angle.</li>
<li><strong>[CDn_n]</strong>: Usually a matrix of four values which describe the mapping of the Coordinate system within the FITS image, i.e both increment and rotation. CDn_n matrix values and CDELTn and CROTAn are degenerate.</li>
<li><strong>CTYPEn</strong>: Name of the CDELTn coordinate axis.</li>
<li><strong>NAXIS</strong>: Number of axes.</li>
<li><strong>NAXISn</strong>: Size of the axis n.</li>
</ul>
</blockquote>
<p>CRVAL3: good to save wavelength info.</p>
</div>
<div class="section" id="from-an-image-to-alma">
<h2><a class="toc-backref" href="#id11">From an image to ALMA!</a></h2>
<p>Attention! ALMA OST do not rotate images for now. Instead it assumes that an uploaded image does have equatorial north corresponding to 'up' (<a class="reference external" href="http://almaost.jb.man.ac.uk/help/#Rotation">http://almaost.jb.man.ac.uk/help/#Rotation</a>).</p>
<p>Suggestion - use of PyHdust (<a class="reference external" href="http://github.com/danmoser/pyhdust">http://github.com/danmoser/pyhdust</a>).</p>
<p>One example: ramp image with 2 AU in size at 10 parsecs, rotated at 45 degree (by definition, to <strong>east</strong>) at 21 cm.</p>
<pre class="code python literal-block">
<span class="keyword namespace">import</span> <span class="name namespace">numpy</span> <span class="keyword namespace">as</span> <span class="name namespace">np</span>
<span class="keyword namespace">import</span> <span class="name namespace">pyhdust.phc</span> <span class="keyword namespace">as</span> <span class="name namespace">phc</span>
<span class="keyword namespace">import</span> <span class="name namespace">pyhdust.interftools</span> <span class="keyword namespace">as</span> <span class="name namespace">intt</span>

<span class="name">img</span> <span class="operator">=</span> <span class="name">np</span><span class="operator">.</span><span class="name">arange</span><span class="punctuation">(</span><span class="literal number integer">900</span><span class="punctuation">)</span><span class="operator">.</span><span class="name">reshape</span><span class="punctuation">((</span><span class="literal number integer">30</span><span class="punctuation">,</span><span class="literal number integer">30</span><span class="punctuation">))</span>

<span class="name">intt</span><span class="operator">.</span><span class="name">img2fits</span><span class="punctuation">(</span><span class="name">img</span><span class="punctuation">,</span> <span class="literal number float">21.</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="literal number integer">2</span><span class="operator">*</span><span class="name">phc</span><span class="operator">.</span><span class="name">au</span><span class="operator">.</span><span class="name">cgs</span><span class="operator">/</span><span class="name">phc</span><span class="operator">.</span><span class="name">Rsun</span><span class="operator">.</span><span class="name">cgs</span><span class="punctuation">],</span> <span class="literal number integer">10</span><span class="punctuation">,</span> <span class="name">orient</span><span class="operator">=</span><span class="literal number float">45.</span><span class="punctuation">,</span> \
<span class="name">coordsinf</span><span class="operator">=</span><span class="punctuation">[</span><span class="literal string single">'21:51:12.055'</span><span class="punctuation">,</span> <span class="literal string single">'-28:51:38.72'</span><span class="punctuation">],</span> <span class="name">ulbd</span><span class="operator">=</span><span class="literal string single">'cm'</span><span class="punctuation">,</span> <span class="name">deg</span><span class="operator">=</span><span class="name builtin pseudo">True</span><span class="punctuation">)</span>

<span class="name">intt</span><span class="operator">.</span><span class="name">img2fits</span><span class="punctuation">(</span><span class="name">img</span><span class="punctuation">,</span> <span class="literal number float">21.</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="literal number integer">2</span><span class="operator">*</span><span class="name">phc</span><span class="operator">.</span><span class="name">au</span><span class="operator">.</span><span class="name">cgs</span><span class="operator">/</span><span class="name">phc</span><span class="operator">.</span><span class="name">Rsun</span><span class="operator">.</span><span class="name">cgs</span><span class="punctuation">],</span> <span class="literal number integer">10</span><span class="punctuation">,</span> <span class="name">rot</span><span class="operator">=</span><span class="literal number float">45.</span><span class="punctuation">,</span> \
<span class="name">coordsinf</span><span class="operator">=</span><span class="punctuation">[</span><span class="literal string single">'21:51:12.055'</span><span class="punctuation">,</span> <span class="literal string single">'-28:51:38.72'</span><span class="punctuation">],</span> <span class="name">ulbd</span><span class="operator">=</span><span class="literal string single">'cm'</span><span class="punctuation">,</span> <span class="name">deg</span><span class="operator">=</span><span class="name builtin pseudo">True</span><span class="punctuation">,</span> \
<span class="name">outname</span><span class="operator">=</span><span class="literal string single">'model_rotated'</span><span class="punctuation">)</span>
</pre>
<p>Output - <a class="reference external" href="../static/model.fits">Coordinate rotation</a>:</p>
<img alt="../figs/gai_fits-imgs_model.png" src="../figs/gai_fits-imgs_model.png" />
<p>Output - <a class="reference external" href="../static/model_rotated.fits">Image rotation</a>:</p>
<img alt="../figs/gai_fits-imgs_model_rotated.png" src="../figs/gai_fits-imgs_model_rotated.png" />
</div>
</div>
</div>
</body>
</html>
